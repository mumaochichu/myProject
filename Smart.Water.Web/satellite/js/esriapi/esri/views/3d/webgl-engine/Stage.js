// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),function(l,m,b,r,t,d,n,f,p,u,h,v,w){function q(b){return"function"===typeof b.addParentStage&&"function"===typeof b.removeParentStage}Object.defineProperty(m,"__esModule",{value:!0});l=function(k){function a(){var c=
null!==k&&k.apply(this,arguments)||this;c.model=new v.Model;c._viewContent=[];c._mainLightDirection=f.vec3f64.fromValues(0,1,0);return c}b.__extends(a,k);e=a;a.prototype.initialize=function(){this._set("renderView",new w.RenderView(this.container,this,this.options));this.setLighting({lights:[new h.MainLight(f.vec3f64.fromValues(.7,.7,.7)),new h.AmbientLight(f.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})};a.prototype.destroy=function(){u.pool.prune(0);this.dispose()};Object.defineProperty(a.prototype,
"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lighting",{get:function(){return this._lighting},enumerable:!0,configurable:!0});a.prototype.setLighting=function(c){n.vec3.set(this._mainLightDirection,0,0,0);for(var a=0,g=c.lights;a<g.length;a++){var b=g[a];if(b instanceof
h.MainLight){n.vec3.negate(this._mainLightDirection,b.direction);break}}this._lighting=c;this.renderView.setNeedsRender()};a.prototype.stopAnimationsAtTime=function(c){this.getAll(3).forEach(function(a){t.applySome(a.animation,function(a){return a.stopAtTime(c)})});this.renderView.setNeedsRender()};a.prototype.add=function(c,a){this.model.add(c,a);q(a)&&a.addParentStage(this);this.renderView.setNeedsRender()};a.prototype.remove=function(c,a){this.renderView.setNeedsRender();c=this.model.remove(c,
a);q(c)&&c.removeParentStage(this);return c};a.prototype.notifyDirty=function(c,a,g){this.model.notifyDirty(c,a,g);this.renderView.setNeedsRender()};a.prototype.processDirty=function(){var c=this.model.getDirtySet();if(c.hasDirtyGeometryRecords()){e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var a=c.commitLayers(this._viewContent);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);e.DebugSettings.logDirtySet&&(console.log("RGs add: "+
a[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+a[1].map(function(a){return a.uniqueName})));c.commit();this.renderView.setNeedsRender()}};a.prototype.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};a.prototype.getContent=function(a,b){return this.model.get(a,b)};a.prototype.getAll=function(a){return this.model.getAll(a)};a.prototype.getCount=
function(a){return this.model.getAll(a).size};a.prototype.getCamera=function(){return this.renderView.getCamera()};a.prototype.setCamera=function(a){this.renderView.setCamera(a)};a.prototype.getLayers=function(){return this.model.getAll(0)};a.prototype.getViewContent=function(){return this._viewContent.slice(0)};a.prototype.addToViewContent=function(a){for(var c=[],b=0;b<a.length;b++)-1===this._viewContent.indexOf(a[b])&&c.push(a[b]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(c),
this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,c))};a.prototype.removeFromViewContent=function(a){this.processDirty();for(var c=this.model.getDirtySet(),b=this._viewContent,d=[],e=0;e<a.length;e++){var f=b.indexOf(a[e]);-1<f&&(b[f]=b[b.length-1],b.pop(),d.push(a[e]))}a=c.getResidentRenderGeometriesFilteredByLayers(d);this.renderView.modify([],a,[])};a.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,
b)};a.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};a.prototype.getCombinedStats=function(){return{renderView:this.renderView.getCombinedStats(),model:this.model.getStats()}};var e;a.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};b.__decorate([d.property({constructOnly:!0})],a.prototype,"options",void 0);b.__decorate([d.property({constructOnly:!0})],a.prototype,"sceneIntersectionHelper",
void 0);b.__decorate([d.property({constructOnly:!0})],a.prototype,"viewingMode",void 0);b.__decorate([d.property({constructOnly:!0})],a.prototype,"container",void 0);b.__decorate([p.autoDispose(),d.property()],a.prototype,"renderView",void 0);return a=e=b.__decorate([d.subclass("esri.views.3d.webgl-engine.Stage")],a)}(p.AutoDisposableMixin(r));m.Stage=l});