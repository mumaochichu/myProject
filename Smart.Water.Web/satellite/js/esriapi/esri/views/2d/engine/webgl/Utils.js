// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../webgl ./color ./enums ./SymbolProperties".split(" "),function(K,a,r,m,A,t,u,B,v,c,C){function h(b){for(var a={},g=0;g<b.length;g++){var e=b[g];a[e.name]=e.strideInBytes}return a}function w(b){switch(b){case c.WGLGeometryType.MARKER:return D;case c.WGLGeometryType.FILL:return E;case c.WGLGeometryType.LINE:return F;case c.WGLGeometryType.TEXT:return G;case c.WGLGeometryType.LABEL:return H}}
function x(b){switch(b%4){case 0:case 2:return 4;case 1:case 3:return 1}}function y(b){return"string"===typeof b}function z(b){switch(b){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function I(b){var a={},g=function(d){var g=0;a[d]=b[d].map(function(b){var a=r.__assign(r.__assign({},b),{normalized:b.normalized||!1,divisor:b.divisor||0,offset:g,stride:0});g+=b.count*z(b.type);return a});a[d].forEach(function(b){return b.stride=g})},e;for(e in b)g(e);
return a}var p;Object.defineProperty(a,"__esModule",{value:!0});var k=A.getLogger("esri.views.2d.engine.webgl.Utils");a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF_DD=[{name:a.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,
divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];a.C_ICON_STRIDE_SPEC=h(a.C_ICON_VERTEX_DEF);a.C_FILL_STRIDE_SPEC=h(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_DD=h(a.C_FILL_VERTEX_DEF_DD);a.C_LINE_STRIDE_SPEC=h(a.C_LINE_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC=h(a.C_TEXT_VERTEX_DEF);a.C_LABEL_STRIDE_SPEC=h(a.C_LABEL_VERTEX_DEF);a.getStrides=function(b,d){switch(b){case c.WGLGeometryType.MARKER:return a.C_ICON_STRIDE_SPEC;
case c.WGLGeometryType.FILL:return d?a.C_FILL_STRIDE_SPEC_DD:a.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return a.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return a.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}};var D=[a.C_VBO_GEOMETRY],E=[a.C_VBO_GEOMETRY],F=[a.C_VBO_GEOMETRY],G=[a.C_VBO_GEOMETRY],H=[a.C_VBO_GEOMETRY];a.getNamedBuffers=w;a.strideToPackingFactor=x;a.allocateTypedArrayBuffer=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(Math.floor(b*
a/4));case 1:case 3:return new Uint8Array(b*a)}};a.allocateTypedArrayBufferwithData=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(b);case 1:case 3:return new Uint8Array(b)}};a.getTextProperties=function(b){return C.TextProperties.pool.acquire(b.color?v.copyAndPremultiply(b.color):[255,255,255,255],b.haloColor?v.copyAndPremultiply(b.haloColor):[255,255,255,255],u.pt2px(b.haloSize),u.pt2px(b.font.size),b.angle*Math.PI/180,b.xoffset/b.font.size,b.yoffset/b.font.size,"left"===b.horizontalAlignment?
0:"right"===b.horizontalAlignment?1:.5,"top"===b.verticalAlignment?0:"bottom"===b.verticalAlignment?1:.5)};a.isDefined=function(b){return null!=b};a.isNumber=function(b){return"number"===typeof b};a.isString=y;a.isStringOrNull=function(b){return null==b||y(b)};a.getCapType=function(b,a){switch(b){case "butt":return 0;case "round":return a?2:1;case "square":return 2;default:return k.error(new m("mapview-invalid-type","Cap type "+b+" is not a valid option. Defaulting to round")),1}};a.getJoinType=function(b){switch(b){case "miter":return 2;
case "bevel":return 0;case "round":return 1;default:return k.error(new m("mapview-invalid-type","Join type "+b+" is not a valid option. Defaulting to round")),1}};a.getVVType=function(b){switch(b){case "opacity":return c.VVType.OPACITY;case "color":return c.VVType.COLOR;case "rotation":return c.VVType.ROTATION;case "size":return c.VVType.SIZE;default:return k.error("Cannot interpret unknown vv: "+b),null}};a.getTransformParams=function(b){return{transform:b.transform,hasZ:b.hasZ,hasM:b.hasM}};a.copyMeshData=
function(b,a,g,e,n,c,h){for(var d in c)for(var f=c[d].stride,l=x(f),k=c[d].data,m=g[d].data,J=f*n.vertexCount/l,p=f*b/l,l=f*n.vertexFrom/l,f=0;f<J;++f)m[f+p]=k[f+l];g=n.indexCount;for(f=0;f<g;++f)e[f+a]=h[f+n.indexFrom]-n.vertexFrom+b};a.C_VBO_INFO=(p={},p[a.C_VBO_GEOMETRY]=35044,p);a.createGeometryData=function(b,a){for(var g=[],e=0;5>e;++e){for(var c={},d=0,h=w(e);d<h.length;d++){var k=h[d];c[k]={data:a(e,k)}}g.push({data:b(e),buffers:c})}return g};a.createTextureFromTexelData=function(a,c){var b,
e;t.isPowerOfTwo(c.width)&&t.isPowerOfTwo(c.height)?(b=!0,e=9987):(b=!1,e=9729);return new B.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:b,samplingMode:e,wrapMode:33071,flipped:!0},c)};a.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};a.getBytes=z;a.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:k.error(new m("webgl-utils","Unable to handle type "+a))}};a.getPixelArrayCtor=
function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:k.error(new m("webgl-utils","Unable to handle type "+a))}};var q=new Map;a.createProgramDescriptor=function(a,c){if(!q.has(a)){var b=I(c),e={},d;for(d in b){var l=b[d];e[d]=l.length?l[0].stride:0}d={};for(var h in c)for(var l=0,k=c[h];l<k.length;l++){var f=k[l];d[f.name]=f.location}q.set(a,{strides:e,bufferLayouts:b,attributes:d})}return q.get(a)}});