// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../Graphic ../../../core/maybe ../../../core/maybe ../../../core/promiseUtils ../../../geometry/Polygon ./geometryUtils".split(" "),function(D,q,x,u,y,r,z,n){function A(a,c){var b=a.source,f=a.spatialReference,e=a.location,h=a.sourceIndex,g=a.view;a=b.locator;var m=b.zoomScale,l=b.defaultZoomScale,k=g&&g.scale;c=c&&c.signal;f&&(a.outSpatialReference=f);return a.locationToAddress({location:e},{signal:c}).then(function(a){return v([a],{sourceIndex:h,scale:k,view:g,zoomScale:m,
defaultZoomScale:l})})}function w(a,c){var b=a.filter;a=a.withinViewEnabled;var f=c&&c.extent;return(c=n.createExtentFromGeometry(b&&b.geometry,c,c&&c.scale))||(a&&f?f:void 0)}function B(a,c){var b=a.source,f=a.suggestResult,e=a.spatialReference,h=a.view,g=a.maxResults,m=a.sourceIndex,l=b&&b.zoomScale,k=b&&b.defaultZoomScale;if(!f.text.trim())return r.resolve();a=""+(!f.key&&b.prefix?b.prefix:"")+f.text+(!f.key&&b.suffix?b.suffix:"");var d={},p=b.locator,q=h&&h.scale,n=w(b,h);c=c&&c.signal;if(!p)return r.resolve();
b.categories&&(d.categories=b.categories);b.locationType&&(d.locationType=b.locationType);e&&(p.outSpatialReference=e);if(e=h&&h.get("extent.center"))d.location=e;d.maxLocations=g;n&&(d.searchExtent=u.unwrap(n));b.countryCode&&(d.countryCode=b.countryCode);var t=f.key;t&&(d.magicKey=t);d.address={};d.address[b.singleLineFieldName||"Single Line Input"]=a;b.outFields&&(d.outFields=b.outFields);return p.addressToLocations(d,{signal:c}).then(function(a){return v(a,{key:t,scale:q,sourceIndex:m,view:h,
zoomScale:l,defaultZoomScale:k})})}function C(a,c){return a.map(function(a){return{text:a.text,key:a.magicKey,sourceIndex:c}})}function v(a,c){return a.map(function(a){var b=c.key,e=c.scale,h=c.sourceIndex,g=c.view,m=c.zoomScale,l=c.defaultZoomScale,k=a.extent,d=a.location,p=a.address;a=new x({geometry:d,attributes:a.attributes});k=k||d;e=n.createExtentFromGeometry(k,g,e);g="number"===typeof m?n.scaleExtent(e,g,m):"number"===typeof l&&"point"===k.type?n.scaleExtent(e,g,l):e;d=d?d.x+","+d.y:"";p=p||
d;d=a.clone();y.isSome(g)&&(d.geometry=z.fromExtent(g));return{extent:g,feature:a,target:d,key:b,name:p,sourceIndex:h}})}Object.defineProperty(q,"__esModule",{value:!0});q.getResults=function(a,c){return a.location?A(a,c):B(a,c)};q.getSuggestions=function(a,c){var b=a.source,f=a.spatialReference,e=a.view,h=a.suggestTerm,g=a.maxSuggestions,m=a.sourceIndex;a={};var l=b.locator,k=w(b,e);c=c&&c.signal;if(!l)return r.resolve();b.categories&&(a.categories=b.categories);l.outSpatialReference=f;if(f=e&&e.get("extent.center"))a.location=
f;if(!h.trim())return r.resolve();f=b.prefix;e=b.suffix;a.text=""+(void 0===f?"":f)+h+(void 0===e?"":e);k&&(a.searchExtent=u.unwrap(k));a.maxSuggestions=g;b.countryCode&&(a.countryCode=b.countryCode);return l.suggestLocations(a,{signal:c}).then(function(a){return C(a,m)})};q.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1}});