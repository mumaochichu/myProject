// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./Rect".split(" "),function(l,k,q,n,r,u,t,v,w){Object.defineProperty(k,"__esModule",{value:!0});k.C_DEG_TO_RAD=Math.PI/180;var x=n.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),p=function(){function c(a){this._t=a}c.createIdentity=function(){return new c([1,0,0,0,1,0])};c.prototype.clone=function(){return new c(this._t.slice())};c.prototype.transform=function(a){var b=
this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};c.createScale=function(a,b){return new c([a,0,0,0,b,0])};c.prototype.scale=function(a,b){var d=this._t;d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=b;d[4]*=b;d[5]*=b;return this};c.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};c.createTranslate=function(a,b){return new c([0,0,a,0,0,b])};c.prototype.translate=function(a,b){var d=this._t;d[2]+=a;d[5]+=b;return this};c.createRotate=function(a){var b=
Math.cos(a);a=Math.sin(a);return new c([b,-a,0,a,b,0])};c.prototype.rotate=function(a){return this.multiply(c.createRotate(a))};c.prototype.multiply=function(a){var b=this._t;a=a._t;var d=b[1]*a[0]+b[4]*a[1],h=b[2]*a[0]+b[5]*a[1]+a[2],e=b[0]*a[3]+b[3]*a[4],c=b[1]*a[3]+b[4]*a[4],f=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=d;b[2]=h;b[3]=e;b[4]=c;b[5]=f;return this};return c}();k.Transformation=p;l=function(){function c(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||p.createIdentity());
this._sizeTransfos.push(a?a.scaleRatio():1)}c.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};c.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-1]};c.prototype.back=function(){return this._transfos[this._transfos.length-1]};c.prototype.push=function(a,b){b=b?a.scaleRatio():1;a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)};c.prototype.pop=
function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};c.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,b)}};c.prototype.drawMultiLayerSymbol=function(a,b){if(a){var d=a.symbolLayers;if(d)if(a=a.effects){if(b=this.executeEffects(a,b))for(a=b.next();a;)this.drawSymbolLayers(d,a),a=b.next()}else this.drawSymbolLayers(d,b)}};c.prototype.executeEffects=function(a,b){b=new u.SimpleGeometryCursor(b);
for(var d=0;d<a.length;d++){var h=a[d],e=t.getEffectOperator(h);e&&(b=e.execute(b,h,1))}return b};c.prototype.drawSymbolLayers=function(a,b){for(var d=a.length;d--;){var h=a[d];if(h&&!1!==h.enable){var e=h.effects;if(e){if(e=this.executeEffects(e,b))for(var c=e.next();c;)this.drawSymbolLayer(h,c),c=e.next()}else this.drawSymbolLayer(h,b)}}};c.prototype.drawSymbolLayer=function(a,b){switch(a.type){case "CIMSolidFill":this.drawSolidFill(b,a.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,
a.color,a.width,a.capStyle,a.joinStyle,a.miterLimit);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(a,b)}};c.prototype.drawMarkerLayer=function(a,b){var d=a.markerPlacement;if(d){var c=t.getPlacementOperator(d);if(c&&(b=c.execute(b,d,1)))for(d=b.next();d;)this.drawMarker(a,d),d=b.next()}else d=new v.Placement,d.tx=b.x,d.ty=b.y,this.drawMarker(a,d)};c.prototype.drawMarker=function(a,b){switch(a.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(a,
b);break;case "CIMVectorMarker":this.drawVectorMarker(a,b)}};c.prototype.drawPictureMarker=function(a,b){};c.prototype.drawVectorMarker=function(a,b){if(a){var d=a.markerGraphics;if(d){var c=a.size,e=a.frame,g=e?e.ymax-e.ymin:0,c=c&&g?c/g:1,g=p.createIdentity();e&&g.translate(.5*-(e.xmax+e.xmin),.5*-(e.ymax+e.ymin));var f=a.anchorPoint;if(f){var m=f.x,f=f.y;"Absolute"!==a.anchorPointUnits&&e&&(m*=e.xmax-e.xmin,f*=e.ymax-e.ymin);g.translate(-m,-f)}1!==c&&g.scale(c,c);a.rotation&&g.rotate(a.rotation*
k.C_DEG_TO_RAD);g.translate(a.offsetX||0,a.offsetY||0);g.translate(b.tx,b.ty);this.push(g,a.scaleSymbolsProportionally);for(a=0;a<d.length;a++)(b=d[a])&&b.symbol&&b.geometry||x.error("Invalid marker graphic",b),this.drawSymbol(b.symbol,b.geometry);this.pop()}}};return c}();k.CIMSymbolDrawHelper=l;n=function(c){function a(){var b=c.call(this)||this;b.reset();return b}q.__extends(a,c);a.prototype.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity};a.prototype.envelope=function(){return new w.default(this._xmin,
this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};a.prototype._merge=function(b,a){b[0]-a<this._xmin&&(this._xmin=b[0]-a);b[0]+a>this._xmax&&(this._xmax=b[0]+a);b[1]-a<this._ymin&&(this._ymin=b[1]-a);b[1]+a>this._ymax&&(this._ymax=b[1]+a)};a.prototype.drawSolidFill=function(a){if(a&&a.rings){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b],e=c?c.length:0;if(2<e){this._merge(this.transformPt(c[0]),0);for(var g=1;g<e;++g)this._merge(this.transformPt(c[g]),0)}}}};a.prototype.drawSolidStroke=function(a,
d,c){d=.5*this.transformSize(c);if(a=r.isPolygon(a)?a.rings:a.paths)for(c=0;c<a.length;c++){var b=a[c],g=b?b.length:0;if(1<g){this._merge(this.transformPt(b[0]),d);for(var f=1;f<g;++f)this._merge(this.transformPt(b[f]),d)}}};return a}(l);k.EnvDrawHelper=n;l=function(c){function a(a,d){d=c.call(this,d)||this;d._ctx=a;return d}q.__extends(a,c);a.prototype.drawSolidFill=function(a,d){if(a&&a.rings){var b=this._ctx;b.fillStyle="string"===typeof d?d:"rgba("+Math.round(d[0])+","+Math.round(d[1])+","+Math.round(d[2])+
","+d[3]/255+")";b.beginPath();d=0;for(a=a.rings;d<a.length;d++){var c=a[d],g=c?c.length:0;if(2<g){var f=this.transformPt(c[0]);b.moveTo(f[0],f[1]);for(var m=1;m<g;++m)f=this.transformPt(c[m]),b.lineTo(f[0],f[1]);b.closePath()}}b.fill("evenodd")}};a.prototype.drawSolidStroke=function(a,d,c,e,g,f){if(d&&0!==c){var b=this._ctx;b.strokeStyle="string"===typeof d?d:"rgba("+Math.round(d[0])+","+Math.round(d[1])+","+Math.round(d[2])+","+d[3]/255+")";b.lineWidth=this.transformSize(c)+.5;this._setCapStyle(e);
this._setJoinStyle(g);b.miterLimit=f;b.beginPath();d=!1;r.isPolygon(a)?(c=a.rings,d=!0):c=a.paths;for(a=0;a<c.length;a++)if(g=(e=c[a])?e.length:0,1<g){f=this.transformPt(e[0]);b.moveTo(f[0],f[1]);for(var h=1;h<g;++h)f=this.transformPt(e[h]),b.lineTo(f[0],f[1]);d&&b.closePath()}b.stroke()}};a.prototype._setCapStyle=function(a){switch(a){case "Butt":this._ctx.lineCap="butt";break;case "Round":this._ctx.lineCap="round";break;case "Square":this._ctx.lineCap="square"}};a.prototype._setJoinStyle=function(a){switch(a){case "Bevel":this._ctx.lineJoin=
"bevel";break;case "Round":this._ctx.lineJoin="round";break;case "Miter":this._ctx.lineJoin="miter"}};return a}(l);k.CanvasDrawHelper=l});