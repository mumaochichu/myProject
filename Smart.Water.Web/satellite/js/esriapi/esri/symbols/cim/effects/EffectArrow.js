// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../CIMCursor","../CurveHelper"],function(m,n,p,l,k){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function e(){}e.local=function(){null===e.instance&&(e.instance=new e);return e.instance};e.prototype.execute=function(e,a,d){return new q(e,a,d)};e.instance=null;return e}();n.EffectArrow=m;var q=function(e){function h(a,d,b){a=e.call(this,a,!1,!0)||this;a._curveHelper=new k.CurveHelper;a._width=(void 0!==d.width?d.width:5)*b;a._arrowType=d.geometricEffectArrowType;
a._offsetFlattenError=k.PIXEL_TOLERANCE*b;return a}p.__extends(h,e);h.prototype.processPath=function(a){switch(this._arrowType){default:return this._constructSimpleArrow(a,!0);case "Block":return this._constructSimpleArrow(a,!1);case "Crossed":return this._constructCrossedArrow(a)}};h.prototype._constructSimpleArrow=function(a,d){var b=this._curveHelper.calculatePathLength(a),f=this._width;b<2*f&&(f=b/2);b=this._curveHelper.getSubCurve(a,0,b-f);if(!b)return null;var g=f/2;if(this._curveHelper.isEmpty(b,
!1))return null;f=this._constructOffset(b,-g);if(!f)return null;b=this._constructOffset(b,g);if(!b)return null;var e=this._constructArrowBasePoint(f,-g);if(!e)return null;g=this._constructArrowBasePoint(b,g);if(!g)return null;a=a[a.length-1];d||(this._makeControlPoint(b,!0),this._makeControlPoint(f,!0));var c=new k.PathHelper;c.addPath(b,!0);c.lineTo(g);this._makeControlPoint(c.path());c.lineTo(a);this._makeControlPoint(c.path());c.lineTo(e);this._makeControlPoint(c.path());c.addPath(f,!1);return d?
{paths:[c.path()]}:(c.close(),{rings:[c.path()]})};h.prototype._constructCrossedArrow=function(a){var d=this._curveHelper.calculatePathLength(a),b=this._width;d<3.732050807568877*b&&(b=d/3.732050807568877);var f=this._curveHelper.getSubCurve(a,0,d-2.732050807568877*b);if(!f)return null;var g=b/2;if(this._curveHelper.isEmpty(f,!1))return null;var e=this._constructOffset(f,g);if(!e)return null;f=this._constructOffset(f,-g);if(!f)return null;d=this._curveHelper.getSubCurve(a,0,d-b);if(!d||this._curveHelper.isEmpty(d,
!1))return null;b=this._constructOffset(d,g);if(!b)return null;var c=this._constructOffset(d,-g);if(!c)return null;d=b[b.length-1];b=this._constructArrowBasePoint(b,g);if(!b)return null;var h=c[c.length-1],g=this._constructArrowBasePoint(c,-g);if(!g)return null;a=a[a.length-1];this._makeControlPoint(e,!1);this._makeControlPoint(f,!1);c=new k.PathHelper;c.addPath(e,!0);this._makeControlPoint(c.path());c.lineTo(h);c.lineTo(g);this._makeControlPoint(c.path());c.lineTo(a);this._makeControlPoint(c.path());
c.lineTo(b);this._makeControlPoint(c.path());c.lineTo(d);this._makeControlPoint(c.path());c.addPath(f,!1);return{paths:[c.path()]}};h.prototype._constructOffset=function(a,d){return this._curveHelper.offset(a,d,"Rounded",4,this._offsetFlattenError)};h.prototype._constructArrowBasePoint=function(a,d){if(!a||2>a.length)return null;var b=a[a.length-2];a=a[a.length-1];b=[a[0]-b[0],a[1]-b[1]];this._curveHelper.normalize(b);return[a[0]+b[1]*d,a[1]-b[0]*d]};h.prototype._makeControlPoint=function(a,d){void 0===
d&&(d=!1);d?l.setId(a[0],1):l.setId(a[a.length-1],1)};return h}(l.PathGeometryCursor)});