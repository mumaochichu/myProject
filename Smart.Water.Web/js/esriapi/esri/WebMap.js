// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../multiOriginJSONSupportUtils"],function(p,n,a){Object.defineProperty(n,"__esModule",{value:!0});n.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(function(c){var f=c.target;c.newOrigin&&c.oldOrigin!==c.newOrigin&&a.isMultiOriginJSONMixin(f)&&f.updateOrigin(c.propName,c.newOrigin)})}})},"esri/tasks/support/ProjectParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(p,n,a,b,c,f,h){var l=c.getLogger("esri.tasks.support.ProjectParameters");return function(d){function c(a){a=d.call(this,a)||this;a.geometries=null;a.outSpatialReference=null;a.transformation=null;a.transformForward=null;return a}a.__extends(c,d);Object.defineProperty(c.prototype,"outSR",{get:function(){l.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){l.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});c.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),d=this.geometries[0],c={};c.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());c.inSR=d.spatialReference.wkid||JSON.stringify(d.spatialReference.toJSON());c.geometries=JSON.stringify({geometryType:h.getJsonType(d),geometries:a});this.transformation&&(c.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(c.transformForward=this.transformForward);return c};a.__decorate([f.property()],c.prototype,"geometries",void 0);a.__decorate([f.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);a.__decorate([f.property({json:{read:!1}})],c.prototype,"outSR",null);a.__decorate([f.property()],c.prototype,"transformation",void 0);a.__decorate([f.property()],c.prototype,"transformForward",void 0);return c=a.__decorate([f.subclass("esri.tasks.support.ProjectParameters")],
c)}(b.JSONSupport)})},"esri/webdoc/RangeInfo":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators".split(" "),function(p,n,a,b,c,f){return function(h){function l(a){a=h.call(this,a)||this;a.activeRange=null;a.currentRangeExtent=null;a.fullRangeExtent=null;return a}a.__extends(l,h);d=l;l.prototype.clone=function(){return new d(c.clone({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))};
var d;a.__decorate([f.property({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],l.prototype,"activeRange",void 0);a.__decorate([f.property({type:[Number],json:{write:!0}})],l.prototype,"currentRangeExtent",void 0);a.__decorate([f.property({type:[Number],json:{write:!0}})],l.prototype,"fullRangeExtent",void 0);return l=d=a.__decorate([f.subclass("esri.webdoc.RangeInfo")],l)}(b.JSONSupport)})},"esri/webdoc/Widgets":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./widgets/Range ./widgets/TimeSlider".split(" "),
function(p,n,a,b,c,f,h,l){return function(d){function b(a){a=d.call(this,a)||this;a.range=null;a.timeSlider=null;return a}a.__extends(b,d);m=b;b.prototype.clone=function(){return new m(c.clone({range:this.range,timeSlider:this.timeSlider}))};var m;a.__decorate([f.property({type:h,json:{write:!0}})],b.prototype,"range",void 0);a.__decorate([f.property({type:l,json:{write:!0}})],b.prototype,"timeSlider",void 0);return b=m=a.__decorate([f.subclass("esri.webdoc.Widgets")],b)}(b.JSONSupport)})},"esri/webdoc/widgets/Range":function(){define("require exports tslib ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,n,a,b,c,f){var h=new b.default({slider:"slider",picker:"picker"});return function(c){function d(a){a=c.call(this,a)||this;a.interactionMode=null;a.numStops=null;a.stopInterval=null;return a}a.__extends(d,c);b=d;d.prototype.clone=function(){return new b({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})};var b;a.__decorate([f.property({type:h.apiValues,nonNullable:!0,json:{type:h.jsonValues,default:null,read:{reader:h.read},write:{isRequired:!0,
writer:h.write}}})],d.prototype,"interactionMode",void 0);a.__decorate([f.property({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy:function(){var a=null!=this.stopInterval;return{enabled:!a,isRequired:!a}}}}})],d.prototype,"numStops",void 0);a.__decorate([f.property({type:Number,json:{write:{overridePolicy:function(){return{isRequired:null==this.numStops}}}}})],d.prototype,"stopInterval",void 0);return d=b=a.__decorate([f.subclass("esri.webdoc.widgets.Range")],
d)}(c.JSONSupport)})},"esri/webdoc/widgets/TimeSlider":function(){define("require exports tslib ../../TimeExtent ../../TimeInterval ../../core/JSONSupport ../../core/lang ../../core/object ../../core/accessorSupport/decorators".split(" "),function(p,n,a,b,c,f,h,l,d){return function(f){function m(a){a=f.call(this,a)||this;a.currentTimeExtent=null;a.fullTimeExtent=null;a.numStops=null;a.numThumbs=null;a.stopDelay=null;a.stopInterval=null;return a}a.__extends(m,f);t=m;m.prototype.readCurrentTimeExtent=
function(a){if(a)return new b({start:null!=a[0]?new Date(a[0]):null,end:null!=a[1]?new Date(a[1]):null})};m.prototype.writeCurrentTimeExtent=function(a,c,d){a&&l.setDeepValue(d,[a.start?a.start.getTime():null,a.end?a.end.getTime():null],c)};m.prototype.readFullTimeExtent=function(a,c){if(a=c.properties)return new b({start:null!=a.startTime?new Date(a.startTime):null,end:null!=a.endTime?new Date(a.endTime):null})};m.prototype.writeFullTimeExtent=function(a,c){if(a){c=c.properties=c.properties||{};
var d=a.end;a=a.start;d&&(c.endTime=d?d.getTime():null);a&&(c.startTime=a?a.getTime():null)}};m.prototype.readStopInterval=function(a,d,f){return a?c.fromJSON({value:a.interval,unit:a.units},f):null};m.prototype.writeStopInterval=function(a,c,d,f){a&&(a=a.toJSON(f),l.setDeepValue(d,{interval:a.value,units:a.unit},c))};m.prototype.clone=function(){return new t(h.clone({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,
stopInterval:this.stopInterval}))};var t;a.__decorate([d.property({type:b,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],m.prototype,"currentTimeExtent",void 0);a.__decorate([d.reader("currentTimeExtent")],m.prototype,"readCurrentTimeExtent",null);a.__decorate([d.writer("currentTimeExtent")],m.prototype,"writeCurrentTimeExtent",null);a.__decorate([d.property({type:b,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},
"properties.startTime":{type:Number}}}}})],m.prototype,"fullTimeExtent",void 0);a.__decorate([d.reader("fullTimeExtent")],m.prototype,"readFullTimeExtent",null);a.__decorate([d.writer("fullTimeExtent")],m.prototype,"writeFullTimeExtent",null);a.__decorate([d.property({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy:function(){var a=!!this.stopInterval;return{enabled:!a,isRequired:!a}}}}})],m.prototype,"numStops",void 0);a.__decorate([d.property({type:[1,
2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],m.prototype,"numThumbs",void 0);a.__decorate([d.property({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],m.prototype,"stopDelay",void 0);a.__decorate([d.property({type:c,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy:function(){return{isRequired:null==
this.numStops}}}}})],m.prototype,"stopInterval",void 0);a.__decorate([d.reader("stopInterval")],m.prototype,"readStopInterval",null);a.__decorate([d.writer("stopInterval")],m.prototype,"writeStopInterval",null);return m=t=a.__decorate([d.subclass("esri.webdoc.widgets.TimeSlider")],m)}(f.JSONSupport)})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(p,n){Object.defineProperty(n,"__esModule",{value:!0});var a={width:600,height:400};n.getOptimalThumbnailSize=function(b,
c){c=c||a;var f=c.width;c=c.height;var h=f/c;1.5>h?c=f/1.5:1.5<h&&(f=1.5*c);f>b.width&&(c*=b.width/f,f=b.width);c>b.height&&(f*=b.height/c,c=b.height);return{width:Math.round(f),height:Math.round(c)}}})},"esri/webmap/ApplicationProperties":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(p,n,a,b,c,f,h){return function(b){function d(a){a=b.call(this,a)||this;a.editing=null;a.offline=
null;a.viewing=null;return a}a.__extends(d,b);l=d;d.prototype.clone=function(){return new l(c.clone({editing:this.editing,offline:this.offline,viewing:this.viewing}))};var l;a.__decorate([f.property({json:{write:!0}})],d.prototype,"editing",void 0);a.__decorate([f.property({json:{write:!0}})],d.prototype,"offline",void 0);a.__decorate([f.property({type:h,json:{write:!0}})],d.prototype,"viewing",void 0);return d=l=a.__decorate([f.subclass("esri.webmap.ApplicationProperties")],d)}(b.JSONSupport)})},
"esri/webdoc/applicationProperties/Viewing":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),function(p,n,a,b,c,f,h){return function(b){function d(a){a=b.call(this,a)||this;a.search=null;return a}a.__extends(d,b);l=d;d.prototype.clone=function(){return new l(c.clone({search:this.search}))};var l;a.__decorate([f.property({type:h,json:{write:!0}})],d.prototype,"search",void 0);return d=l=a.__decorate([f.subclass("esri.webdoc.applicationProperties.Viewing")],
d)}(b.JSONSupport)})},"esri/webdoc/applicationProperties/Search":function(){define("require exports tslib ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),function(p,n,a,b,c,f,h,l){var d=b.ofType(l);return function(c){function b(a){a=c.call(this,a)||this;a.addressSearchEnabled=!0;a.enabled=!0;a.hintText=null;a.layers=new d;return a}a.__extends(b,c);l=b;b.prototype.readAddressSearchEnabled=function(a){return!a};b.prototype.writeAddressSearchEnabled=
function(a,c,d){c[d]=!a};b.prototype.clone=function(){return new l(f.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var l;a.__decorate([h.property({type:Boolean,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"addressSearchEnabled",void 0);a.__decorate([h.reader("addressSearchEnabled")],b.prototype,"readAddressSearchEnabled",null);
a.__decorate([h.writer("addressSearchEnabled")],b.prototype,"writeAddressSearchEnabled",null);a.__decorate([h.property({type:Boolean,json:{write:!0,default:!0}})],b.prototype,"enabled",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],b.prototype,"hintText",void 0);a.__decorate([h.property({type:d,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"layers",void 0);return b=l=a.__decorate([h.subclass("esri.webdoc.applicationProperties.Search")],b)}(c.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(p,n,a,b,c,f,h,l){return function(d){function b(a){a=d.call(this,a)||this;a.field=null;a.id=null;a.subLayer=null;return a}a.__extends(b,d);m=b;b.prototype.clone=function(){return new m(c.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var m;a.__decorate([f.property({type:l,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);a.__decorate([f.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);a.__decorate([f.property({type:h.Integer,
json:{write:!0}})],b.prototype,"subLayer",void 0);return b=m=a.__decorate([f.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(b.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(p,n,a,b,c,f){return function(b){function h(a){a=b.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}a.__extends(h,b);d=
h;h.prototype.clone=function(){return new d({exactMatch:this.exactMatch,type:this.type,name:this.name})};var d;a.__decorate([c.property({type:Boolean,json:{write:!0}})],h.prototype,"exactMatch",void 0);a.__decorate([c.property({type:String,json:{write:!0}})],h.prototype,"name",void 0);a.__decorate([c.enumeration(f.kebabDict)],h.prototype,"type",void 0);return h=d=a.__decorate([c.subclass("esri.webdoc.applicationProperties.SearchLayerField")],h)}(b.JSONSupport)})},"esri/webmap/Bookmark":function(){define("require exports tslib ../core/Identifiable ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ../webdoc/support/Thumbnail".split(" "),
function(p,n,a,b,c,f,h,l,d,t){return function(c){function b(a){a=c.call(this,a)||this;a.extent=null;a.name=null;a.thumbnail=new t.default;return a}a.__extends(b,c);m=b;b.prototype.castThumbnail=function(a){return"string"===typeof a?new t.default({url:a}):l.ensureType(t.default,a)};b.prototype.clone=function(){return new m(f.clone({extent:this.extent,name:this.name,thumbnail:this.thumbnail}))};var m;a.__decorate([h.property({type:d,nonNullable:!0,json:{write:{isRequired:!0}}})],b.prototype,"extent",
void 0);a.__decorate([h.property({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],b.prototype,"name",void 0);a.__decorate([h.property({type:t.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.url)}}}}})],b.prototype,"thumbnail",void 0);a.__decorate([h.cast("thumbnail")],b.prototype,"castThumbnail",null);return b=m=a.__decorate([h.subclass("esri.webmap.Bookmark")],b)}(b.IdentifiableMixin(c.JSONSupport))})},"esri/webdoc/support/Thumbnail":function(){define(["require",
"exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(p,n,a,b,c){Object.defineProperty(n,"__esModule",{value:!0});p=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.url="";return a}a.__extends(f,b);l=f;f.prototype.destroy=function(){this.url=""};f.prototype.clone=function(){return new l({url:this.url})};var l;a.__decorate([c.property({type:String,json:{write:{isRequired:!0}}})],f.prototype,"url",void 0);return f=l=a.__decorate([c.subclass("esri.webdoc.support.Thumbnail")],
f)}(b.JSONSupport);n.default=p})},"esri/webmap/InitialViewProperties":function(){define("require exports tslib ../Viewpoint ../core/Accessor ../core/lang ../core/accessorSupport/decorators ../geometry/SpatialReference ../webdoc/RangeInfo ./background/ColorBackground".split(" "),function(p,n,a,b,c,f,h,l,d,t){return function(c){function m(a){a=c.call(this,a)||this;a.background=null;a.rangeInfo=null;a.spatialReference=null;a.viewpoint=null;return a}a.__extends(m,c);n=m;m.prototype.clone=function(){return new n(f.clone({background:this.background,
rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))};var n;a.__decorate([h.property({type:t})],m.prototype,"background",void 0);a.__decorate([h.property({type:d})],m.prototype,"rangeInfo",void 0);a.__decorate([h.property({type:l})],m.prototype,"spatialReference",void 0);a.__decorate([h.property({type:b})],m.prototype,"viewpoint",void 0);return m=n=a.__decorate([h.subclass("esri.webmap.InitialViewProperties")],m)}(c)})},"esri/webmap/background/ColorBackground":function(){define("require exports tslib ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators".split(" "),
function(p,n,a,b,c,f,h){return function(c){function d(a){a=c.call(this,a)||this;a.color=new b([0,0,0,1]);return a}a.__extends(d,c);l=d;d.prototype.clone=function(){return new l(f.clone({color:this.color}))};var l;a.__decorate([h.property({type:b,json:{write:!0}})],d.prototype,"color",void 0);return d=l=a.__decorate([h.subclass("esri.webmap.background.ColorBackground")],d)}(c.JSONSupport)})},"esri/webmap/Version":function(){define(["require","exports","tslib","../core/Version"],function(p,n,a,b){Object.defineProperty(n,
"__esModule",{value:!0});p=function(c){function b(a,b){return c.call(this,a,b,"webmap")||this}a.__extends(b,c);return b}(b.Version);n.Version=p;n.default=p})},"esri/core/Version":function(){define(["require","exports","./Error"],function(p,n,a){Object.defineProperty(n,"__esModule",{value:!0});p=function(){function b(a,b,h){void 0===h&&(h="");this.major=a;this.minor=b;this._context=h}b.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};b.prototype.since=function(a,
b){return!this.lessThan(a,b)};b.prototype.validate=function(b){if(this.major!==b.major)throw new a((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,this.minor,this._context)};b.parse=function(c,f){void 0===f&&(f="");var h=c.split("."),l=h[0],h=h[1],d=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(d))throw new a((f&&
f+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:c});if(!h||!h.match||!h.match(d))throw new a((f&&f+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:c});c=parseInt(l,10);l=parseInt(h,10);return new b(c,l,f)};return b}();n.Version=p})},"*noref":1}});
define("require exports tslib ./kernel ./Map ./Viewpoint ./core/arrayUtils ./core/Collection ./core/Error ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/watchUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/SpatialReference ./geometry/support/webMercatorUtils ./layers/support/arcgisLayerUrl ./portal/Portal ./portal/PortalItem ./portal/support/portalItemUtils ./tasks/support/ProjectParameters ./webdoc/RangeInfo ./webdoc/Widgets ./webdoc/support/thumbnailUtils ./webdoc/support/writeUtils ./webmap/ApplicationProperties ./webmap/Bookmark ./webmap/InitialViewProperties ./webmap/Version ./webmap/background/ColorBackground @dojo/framework/shim/Promise".split(" "),function(p,
n,a,b,c,f,h,l,d,t,m,K,L,D,M,u,v,N,q,O,P,C,E,Q,x,F,r,G,H,R,S,T,U,V,y,z,I){var A=new z.default(2,17),J=l.ofType(V),B=K.getLogger("esri.WebMap"),w=new Map;w.set("image/jpeg","jpeg");w.set("image/jpg","jpg");w.set("image/png","png");w.set("image/gif","gif");var W="NatGeo_World_Map Ocean_Basemap USA_Topo_Maps World_Imagery World_Street_Map World_Terrain_Base World_Topo_Map World_Hillshade Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Reference_Overlay Reference/World_Transportation".split(" ").map(function(a){return a.toLowerCase()});
return function(c){function e(a){a=c.call(this,a)||this;a.applicationProperties=null;a.bookmarks=new J;a.initialViewProperties=new y;a.portalItem=null;a.presentation=null;a.sourceVersion=null;a.tables=null;a.widgets=null;a.authoringApp=a.authoringAppVersion=null;a._isAuthoringAppSetByUser=a._isAuthoringAppVersionSetByUser=!1;return a}a.__extends(e,c);e.prototype.initialize=function(){this.when().catch(function(a){B.error("#load()","Failed to load web map",a)});if(this.resourceInfo){var a=void 0;try{a=
this._validateJSON(this.resourceInfo)}catch(k){this.addResolvingPromise(u.reject(k));return}this.read(a)}};Object.defineProperty(e.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringApp=function(a,k){k.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(e.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;
this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringAppVersion=function(a,k){k.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:b.version};e.prototype.readInitialViewProperties=function(a,k){a=new y;k.background&&(a.background=I.fromJSON(k.background));k.initialState&&k.initialState.viewpoint&&(a.viewpoint=f.fromJSON(k.initialState.viewpoint));k.mapRangeInfo&&(a.rangeInfo=H.fromJSON(k.mapRangeInfo));k.spatialReference&&(a.spatialReference=C.fromJSON(k.spatialReference));
return a};e.prototype.writeInitialViewProperties=function(a,k,b,c){a&&((b=a.background)&&b.color&&(k.background=b.write(null,c)),a.viewpoint&&(k.initialState={viewpoint:a.viewpoint.write(null,c)}),a.rangeInfo&&(k.mapRangeInfo=a.rangeInfo.toJSON(c)),a.spatialReference&&(k.spatialReference=a.spatialReference.write(null,c)))};e.prototype.writeLayers=function(g,k,b,c){var X=this;c=a.__assign(a.__assign({},c),{layerContainerType:"operational-layers"});g=g.map(function(a){return T.getLayerJSON(a,X.getLayerJSONFromResourceInfo(a),
c)}).filter(function(a){return!!a});k[b]=g.toArray()};e.prototype.readSourceVersion=function(a,k){a=k.version.split(".");k=a[1];return new z.default(parseInt(a[0],10),parseInt(k,10))};e.prototype.writeSourceVersion=function(a,k,b){k[b]=A.major+"."+A.minor};Object.defineProperty(e.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?(this._override("thumbnailUrl",a),this._thumbnailFilename=this._generateCustomThumbnailFilename(a)):this._clearThumbnailOverride()},
enumerable:!0,configurable:!0});e.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return u.resolve(this)};e.prototype.loadAll=function(){var a=this;return m.loadAll(this,function(g){g(a.ground,a.basemap,a.layers)})};e.prototype.read=function(g,k){var b=this;k=a.__assign(a.__assign({},k),{origin:"web-map"});var d=this._getAuthoringPropsState();P.readLoadable(this,g,function(a){return c.prototype.read.call(b,g,a)},k);this._restoreAuthoringPropsFromState(d)};e.prototype.write=
function(g,k){if("loaded"!==this.loadStatus)throw g=new d("webmap:not-loaded","Web map must be loaded before it can be serialized"),B.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),g;this._removeDanglingLayerRefs();k=a.__assign(a.__assign({},k),{origin:"web-map",restrictedWebMapWriting:!0,webmap:this});return c.prototype.write.call(this,g,k)};e.prototype.save=function(g){return a.__awaiter(this,void 0,void 0,function(){var k,b,c;return a.__generator(this,
function(a){switch(a.label){case 0:return g=g||{},this._validateItem(),[4,this._updateFromPromise];case 1:return a.sent(),[4,this.load()];case 2:return a.sent(),[4,this._loadLayerContainers()];case 3:return a.sent(),this._validateMap(),k=this.portalItem,b={origin:"web-map",messages:[],writtenProperties:[],url:k.itemUrl&&v.urlToObject(k.itemUrl),portal:k.portal||x.getDefault()},c=this.write(null,b),this._validateJSONForWriting(b,g),[4,this._updateItemProperties(k)];case 4:return a.sent(),[4,this._updateItem(k,
c,b)];case 5:return a.sent(),[4,this._updateItemThumbnail()];case 6:return a.sent(),[2,k]}})})};e.prototype.saveAs=function(g,k){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e;return a.__generator(this,function(a){switch(a.label){case 0:return k=k||{},b=this._getPortalItem(g),[4,this._updateFromPromise];case 1:return a.sent(),[4,this.load()];case 2:return a.sent(),[4,this._loadLayerContainers()];case 3:return a.sent(),this._validateMap(),c={origin:"web-map",messages:[],writtenProperties:[],
url:null,portal:b.portal},d=this.write(null,c),this._validateJSONForWriting(c,k),[4,this._updateItemPropertiesForSaveAs(b)];case 4:return a.sent(),e=this._getThumbnailState(),[4,this._createItem(b,d,c,k)];case 5:return a.sent(),this._restoreThumbnailFromState(e),[4,this._updateItemThumbnail()];case 6:return a.sent(),[2,b]}})})};e.prototype.updateFrom=function(g,k){return a.__awaiter(this,void 0,void 0,function(){var b,c;return a.__generator(this,function(a){switch(a.label){case 0:return this._updateFromPromise=
b=this._updateFromInternal(g,k),[4,b];case 1:a.sent();if(c=b===this._updateFromPromise)this._updateFromPromise=null;return[2]}})})};e.prototype.getLayerJSONFromResourceInfo=function(a){var g,b,c,d,e=this.resourceInfo,e=this._collectAllLayersJSON(h.flatten([null===(g=null===e||void 0===e?void 0:e.baseMap)||void 0===g?void 0:g.baseMapLayers,null===e||void 0===e?void 0:e.operationalLayers,null===(d=null===(c=null===(b=this.basemap)||void 0===b?void 0:b.resourceInfo)||void 0===c?void 0:c.data)||void 0===
d?void 0:d.baseMapLayers]));return h.find(e,function(g){return g.id===a.id})};e.prototype._collectAllLayersJSON=function(a){var g=this;return a.reduce(function(a,b){a.push(b);"GroupLayer"===b.layerType&&(a=a.concat(g._collectAllLayersJSON(b.layers||[])));return a},[])};e.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):u.resolve(null)};e.prototype._loadFromItem=
function(a){var g=this;return a.load().catch(function(a){throw new d("webmap:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Map"!==a.type)throw new d("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(b){g.resourceInfo=b;return g._readAndLoadFromJSON(b,{origin:"web-map",portal:a.portal||x.getDefault()})}).then(function(){return g._computeInitialViewpoint()})};
e.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};e.prototype._validateJSON=function(a){var g=z.default.parse(a.version||"","webmap");A.validate(g);a.version=g.major+"."+g.minor;return a};e.prototype._loadFromJSON=function(g,b){var c=this,k={context:a.__assign(a.__assign({},b),{layerContainerType:"operational-layers"})};this.portalItem&&(k.context.portal=this.portalItem.portal||x.getDefault());return(new Promise(function(a,g){p(["./portal/support/layersCreator"],
a,g)})).then(function(a){var b=[],d=g.operationalLayers;d&&d.length&&b.push(a.populateOperationalLayers(c.layers,d,k));return u.eachAlways(b).then(function(){})})};e.prototype._computeInitialViewpoint=function(){var g;return a.__awaiter(this,void 0,void 0,function(){var b,c,d;return a.__generator(this,function(a){switch(a.label){case 0:return b=this.initialViewProperties,(c=null===(g=null===b||void 0===b?void 0:b.viewpoint)||void 0===g?void 0:g.targetGeometry)?[2]:[4,this._getExtentFromItem()];case 1:if(d=
a.sent())b=b?b.clone():new y,b.viewpoint=new f,b.viewpoint.targetGeometry=d,this.initialViewProperties=b;return[2]}})})};e.prototype._getExtentFromItem=function(){var g,b;return a.__awaiter(this,void 0,void 0,function(){var c,k,d;return a.__generator(this,function(a){switch(a.label){case 0:return c=null===(g=this.initialViewProperties)||void 0===g?void 0:g.spatialReference,k=null===(b=this.portalItem)||void 0===b?void 0:b.extent,c&&k?c.isWGS84?[2,k.clone()]:c.isWebMercator?[2,E.geographicToWebMercator(k)]:
[4,new Promise(function(a,g){p(["./portal/support/geometryServiceUtils"],a,g)})]:[3,2];case 1:return d=a.sent(),[2,d.create(this.portalItem).then(function(a){var g=new G;g.geometries=[k];g.outSpatialReference=c;return a.project(g)}).then(function(a){return a[0]}).catch(function(a){B.error("Error projecting item's extent:",a);return null})];case 2:return[2,null]}})})};e.prototype._removeDanglingLayerRefs=function(){var a=this,b=function(g){return!!a.allLayers.find(function(a){return a.id===g})},c=
this.applicationProperties,d=c&&c.viewing&&c.viewing.search;d&&d.layers&&(d.layers=d.layers.filter(function(a){return b(a.id)}));(d=c&&c.editing&&c.editing.locationTracking)&&d.info&&!b(d.info.layerId)&&(c.editing=null);(c=this.presentation&&this.presentation.slides)&&c.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return b(a.id)}))})};e.prototype._validateMap=function(){if(!this.basemap||!this.basemap.baseLayers.length)throw new d("webmap:save","Map does not have a valid basemap with a base layer.");
};e.prototype._validateItem=function(){if(!this.portalItem)throw B.error("save: requires the portalItem property to be set"),new d("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)};e.prototype._validateItemType=function(a){if("Web Map"!==a.type)throw new d("webmap:portal-item-wrong-type",'Portal item needs to have type "Web Map"');};e.prototype._loadLayerContainers=function(){var a=[];this.basemap&&a.push(this.basemap.load());
this.ground&&a.push(this.ground.load());return u.eachAlways(a).then(function(){})};e.prototype._loadAllLayers=function(){var a=this.allLayers.map(function(a){return a.load()});return u.eachAlways(a).then(function(){})};e.prototype._validateJSONForWriting=function(a,b){a=a.messages.filter(function(a){return"error"===a.type}).map(function(a){return new d(a.name,a.message,a.details)});b.ignoreUnsupported&&(a=a.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==
a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));if(0<a.length)throw new d("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a});};e.prototype._updateItemProperties=function(g){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(a){switch(a.label){case 0:return b=g,[4,this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry)];case 1:return b.extent=
a.sent(),[4,this._updateTypeKeywords(g)];case 2:return a.sent(),[2]}})})};e.prototype._updateItemPropertiesForSaveAs=function(g){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return r.removeTypeKeyword(g,"CollectorDisabled"),r.removeTypeKeyword(g,"OfflineDisabled"),r.removeTypeKeyword(g,"Workforce Project"),r.removeTypeKeyword(g,"Workforce Worker"),r.removeTypeKeyword(g,"Workforce Dispatcher"),[4,this._updateItemProperties(g)];case 1:return a.sent(),
[2]}})})};e.prototype._getWGS84Extent=function(g){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e,f;return a.__generator(this,function(a){b=g.clone().normalize();if(1<b.length)for(d=0,e=b;d<e.length;d++)f=e[d],c?f.width>c.width&&(c=f):c=f;else c=b[0];return[2,this._projectToWGS84(c)]})})};e.prototype._projectToWGS84=function(g){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:return b=g.spatialReference,b.isWGS84?
[2,g.clone()]:b.isWebMercator?[2,E.webMercatorToGeographic(g)]:[4,new Promise(function(a,b){p(["./portal/support/geometryServiceUtils"],a,b)})];case 1:return c=a.sent(),[4,c.create(this.portalItem)];case 2:return d=a.sent(),e=new G,e.geometries=[g],e.outSpatialReference=C.WGS84,[4,d.project(e)];case 3:return f=a.sent(),[2,f[0]]}})})};e.prototype._updateTypeKeywords=function(b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return r.addTypeKeyword(b,
"ArcGIS API for JavaScript"),[4,this._loadAllLayers()];case 1:return a.sent(),this._evalCollectorKeyword(b),this._evalDataEditingKeyword(b),this._evalOfflineKeyword(b),b.typeKeywords&&(b.typeKeywords=b.typeKeywords.filter(function(a,b,g){return g.indexOf(a)===b})),[2]}})})};e.prototype._evalCollectorKeyword=function(a){r.hasTypeKeyword(a,"CollectorDisabled")||r.hasTypeKeyword(a,"Workforce Project")||r.hasTypeKeyword(a,"Workforce Worker")||r.hasTypeKeyword(a,"Workforce Dispatcher")||!this._hasEditableFeatureLayer()?
r.removeTypeKeyword(a,"Collector"):r.addTypeKeyword(a,"Collector")};e.prototype._evalDataEditingKeyword=function(a){this._hasEditableFeatureLayer()?r.addTypeKeyword(a,"Data Editing"):r.removeTypeKeyword(a,"Data Editing")};e.prototype._evalOfflineKeyword=function(a){!r.hasTypeKeyword(a,"OfflineDisabled")&&this._isOfflineCapableMap()?r.addTypeKeyword(a,"Offline"):r.removeTypeKeyword(a,"Offline")};e.prototype._hasEditableFeatureLayer=function(){var a=this;return this.allLayers.some(function(b){return b.loaded&&
a._isFeatureServiceLayer(b)&&b.capabilities.operations.supportsEditing&&b.editingEnabled})};e.prototype._isFeatureServiceLayer=function(a){return!("feature"!==a.type||!a.source||"feature-layer"!==a.source.type)};e.prototype._isOfflineCapableMap=function(){var a=this;return this.allLayers.every(function(b){return b.loaded&&a._isOfflineCapableLayer(b)})};e.prototype._isOfflineCapableLayer=function(a){return this._isFeatureServiceLayer(a)&&a.capabilities.operations.supportsSync||("tile"===a.type||"vector-tile"===
a.type)&&(a.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(a))&&a.spatialReference.equals(this.initialViewProperties.spatialReference)};e.prototype._isExportableAGOLTileLayer=function(a){return"tile"===a.type?Q.isServerOrServicesAGOLUrl(a.url)&&W.some(function(b){return-1<a.url.toLowerCase().indexOf("/"+b+"/")}):!1};e.prototype._updateItem=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,
b.update({data:c})];case 1:return a.sent(),this._syncUpInstanceWithItem(b,c,d),[2]}})})};e.prototype._createItem=function(b,c,e,f){return a.__awaiter(this,void 0,void 0,function(){var g,k,h;return a.__generator(this,function(a){switch(a.label){case 0:return g=this.portalItem,k=!!(g&&g.id&&g.portal.user),h=b.portal,[4,h._signIn()];case 1:return a.sent(),[4,this._canCopyItem(g,k,h)];case 2:if(!a.sent())throw new d("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");
return[4,h.user.addItem({item:b,folder:f.folder,data:c})];case 3:return a.sent(),this.portalItem=b,this._syncUpInstanceWithItem(b,c,e),[2]}})})};e.prototype._canCopyItem=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return L.isSome(b)&&b.id&&b.typeKeywords&&-1<b.typeKeywords.indexOf("useOnly")?b.portal.portalHostname!==d.portalHostname?[2,!1]:c?[3,2]:[4,b.reload()]:[3,3];case 1:a.sent(),a.label=2;case 2:return[2,"admin"===
b.itemControl||"update"===b.itemControl];case 3:return[2,!0]}})})};e.prototype._syncUpInstanceWithItem=function(a,b,c){D.MultiOriginJSONSupport.prototype.read.call(this,{version:b.version,authoringApp:b.authoringApp,authoringAppVersion:b.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:a.itemUrl&&v.urlToObject(a.itemUrl)});O.updateOrigins(c);this.resourceInfo=b};e.prototype._updateItemThumbnail=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return this.thumbnailUrl&&
this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})]:[3,2];case 1:a.sent(),this._clearThumbnailOverride(),a.label=2;case 2:return[2]}})})};e.prototype._getPortalItem=function(a){a=F.from(a);a.id&&(a=a.clone(),a.id=null);a.type||(a.type="Web Map");a.portal||(a.portal=x.getDefault());this._validateItemType(a);return a};e.prototype._updateFromInternal=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,
function(a){switch(a.label){case 0:return c=c||{},[4,N.whenTrueOnce(b,"ready")];case 1:return a.sent(),this._updateInitialViewProperties(b,c),[4,this._updateThumbnailUrl(b,c)];case 2:return a.sent(),[2]}})})};e.prototype._updateInitialViewProperties=function(a,b){var c;b.backgroundExcluded||(this.initialViewProperties.background=null===(c=a.background)||void 0===c?void 0:c.clone());this.initialViewProperties.spatialReference=a.spatialReference.clone();b.viewpointExcluded||(this.initialViewProperties.viewpoint=
new f({rotation:a.rotation,scale:b.scalePreserved?a.scale:null,targetGeometry:this._getViewExtent(a)}))};e.prototype._getViewExtent=function(a){var b=a.center.clone().normalize();a=a.extent.clone();var c=a.width/2;a.xmin=b.x-c;a.xmax=b.x+c;return a};e.prototype._updateThumbnailUrl=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:if(c.thumbnailExcluded)return[2];d=S.getOptimalThumbnailSize(b,c.thumbnailSize);return[4,
b.takeScreenshot({format:"png",width:d.width,height:d.height})];case 1:return e=a.sent(),this._setAutoGeneratedThumbnail(e.dataUrl),[2]}})})};e.prototype._setAutoGeneratedThumbnail=function(a){this.thumbnailUrl=a;this._thumbnailFilename=null};e.prototype._clearThumbnailOverride=function(){this._clearOverride("thumbnailUrl");this.clear("thumbnailUrl","user");this._thumbnailFilename=null};e.prototype._generateCustomThumbnailFilename=function(a){if(v.isDataProtocol(a)){a=(a=(a=v.dataComponents(a))&&
a.mediaType)&&w.get(a.toLowerCase())||null;var b="thumbnail"+Date.now();return a?b+"."+a:b}return null};e.prototype._getThumbnailState=function(){var a=this.thumbnailUrl;a&&(a=this._isOverridden("thumbnailUrl")?a:v.addQueryParameter(a,"w","8192"));return{thumbnailUrl:a,filename:this._thumbnailFilename}};e.prototype._restoreThumbnailFromState=function(a){this.thumbnailUrl=a.thumbnailUrl;this._thumbnailFilename=a.filename};e.prototype._getAuthoringPropsState=function(){return{authoringApp:this.authoringApp,
authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}};e.prototype._restoreAuthoringPropsFromState=function(a){a.isAuthoringAppSetByUser?this.authoringApp=a.authoringApp:this._isAuthoringAppSetByUser=!1;a.isAuthoringAppVersionSetByUser?this.authoringAppVersion=a.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1};e.fromJSON=function(a){if(!a)throw new d("webmap:empty-resource",
"Expected a JSON resource but got nothing");return new this({resourceInfo:a})};e.VERSION=A;a.__decorate([q.property({type:U,json:{write:!0}})],e.prototype,"applicationProperties",void 0);a.__decorate([q.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],e.prototype,"authoringApp",null);a.__decorate([q.writer("authoringApp")],e.prototype,"writeAuthoringApp",null);a.__decorate([q.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],e.prototype,"authoringAppVersion",
null);a.__decorate([q.writer("authoringAppVersion")],e.prototype,"writeAuthoringAppVersion",null);a.__decorate([q.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],e.prototype,"basemap",void 0);a.__decorate([q.property({type:J,json:{write:{overridePolicy:function(a){return{enabled:!!(a&&0<a.length),ignoreOrigin:!0}}}}})],e.prototype,"bookmarks",void 0);a.__decorate([q.property({type:y,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},
write:{ignoreOrigin:!0,target:{background:{type:I},"initialState.viewpoint":{type:f},mapRangeInfo:{type:H},spatialReference:{type:C}}}}})],e.prototype,"initialViewProperties",void 0);a.__decorate([q.reader("initialViewProperties")],e.prototype,"readInitialViewProperties",null);a.__decorate([q.writer("initialViewProperties")],e.prototype,"writeInitialViewProperties",null);a.__decorate([q.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],e.prototype,"layers",void 0);a.__decorate([q.writer("layers")],
e.prototype,"writeLayers",null);a.__decorate([q.property({type:F})],e.prototype,"portalItem",void 0);a.__decorate([q.property({json:{write:!0}})],e.prototype,"presentation",void 0);a.__decorate([q.property()],e.prototype,"resourceInfo",void 0);a.__decorate([q.property({readOnly:!0,type:z.default,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],e.prototype,"sourceVersion",void 0);a.__decorate([q.reader("sourceVersion")],e.prototype,"readSourceVersion",
null);a.__decorate([q.writer("sourceVersion")],e.prototype,"writeSourceVersion",null);a.__decorate([q.property()],e.prototype,"tables",void 0);a.__decorate([q.property({dependsOn:["portalItem.thumbnailUrl"]})],e.prototype,"thumbnailUrl",null);a.__decorate([q.property({type:R,json:{write:!0}})],e.prototype,"widgets",void 0);return e=a.__decorate([q.subclass("esri.WebMap")],e)}(D.MultiOriginJSONMixin(t.LoadableMixin(M.EsriPromiseMixin(c))))});