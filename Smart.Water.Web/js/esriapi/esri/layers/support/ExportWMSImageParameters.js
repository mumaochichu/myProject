// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/accessorSupport/decorators ./wmsUtils".split(" "),function(u,v,c,p,k,e,q){var r={visible:"visibleSublayers"},l=[102100,3857,102113,900913],t=[3395,54004];return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._layerHandles=new k;a.extent=null;a._scale=null;a.view=null;return a}c.__extends(b,g);Object.defineProperty(b.prototype,"layer",{set:function(a){var d=this;this._get("layer")!==a&&(this._set("layer",
a),this._layerHandles&&(this._layerHandles.removeAll(),this._layerHandles=null),a&&(this._layerHandles||(this._layerHandles=new k),this._layerHandles.add([a.sublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),a.on("wms-sublayer-update",function(a){return d.notifyChange(r[a.propertyName])})])))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layers",{get:function(){return this.visibleSublayers.filter(function(a){return a.name}).map(function(a){return a.name}).join(",")},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visibleSublayers",{get:function(){var a=this.scale,d=this.layer.sublayers,b=[],
c=function(d){var f=d.minScale,e=d.maxScale,m=d.sublayers,f=0===a||(0===f||a<=f)&&(0===e||a>=e);d.visible&&f&&(b.unshift(d),m&&m.forEach(c))};d&&d.forEach(c);return b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){var a=this.extent,d=this.layer.spatialReferences,b=a.spatialReference&&a.spatialReference.wkid;d&&-1===d.indexOf(b)&&a.spatialReference.latestWkid&&(b=a.spatialReference.latestWkid);a=l.some(function(a){return a===b});if(!d)return b;if(a){var c=
[];d.forEach(function(a){-1<l.indexOf(a)&&c.push(a)});c.length||d.forEach(function(a){-1<t.indexOf(a)&&c.push(a)});b=0<c.length?c[0]:l[0]}return b},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){var a=this.extent,b=this.layer,e=this.layers,l=b.imageFormat,m=b.imageTransparency,f=b.spatialReferences,g=b.version,h=this.wkid;f&&-1===f.indexOf(h)&&a.spatialReference.latestWkid&&(h=a.spatialReference.latestWkid);var f=a.xmin,k=a.ymin,n=a.xmax,a=a.ymax,b={bbox:"1.3.0"===b.version&&q.coordsReversed(h)?
k+","+f+","+a+","+n:f+","+k+","+n+","+a,format:l,request:"GetMap",service:"WMS",styles:"",transparent:m,version:g};isNaN(h)||("1.3.0"===g?b.crs="EPSG:"+h:b.srs="EPSG:"+h);return c.__assign(c.__assign({},b),{layers:e})};c.__decorate([e.property()],b.prototype,"extent",void 0);c.__decorate([e.property()],b.prototype,"layer",null);c.__decorate([e.property({readOnly:!0,dependsOn:["visibleSublayers"]})],b.prototype,"layers",null);c.__decorate([e.property({type:Number,dependsOn:["view.scale"]})],b.prototype,
"scale",null);c.__decorate([e.property()],b.prototype,"view",void 0);c.__decorate([e.property({dependsOn:["layers","layer.imageTransparency"],readOnly:!0})],b.prototype,"version",null);c.__decorate([e.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],b.prototype,"visibleSublayers",null);c.__decorate([e.property()],b.prototype,"wkid",null);return b=c.__decorate([e.subclass("esri.layers.support.ExportWMSImageParameters")],b)}(p)});