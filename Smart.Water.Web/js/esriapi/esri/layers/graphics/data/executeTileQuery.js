// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry/support/aaBoundingRect ../featureConversionUtils ../OptimizedGeometry ./QueryEngine ./utils".split(" "),function(H,l,A,b,E,q,B){function v(a,d,u,C,w,k){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!d||!d.coords.length)return null;var p=d.coords;d=d.lengths;if(!d.length)return a.coords[0]=b.quantizeX(k,p[0]),a.coords[1]=b.quantizeY(k,p[1]),a.coords.length=u,a;for(var e,g,f,n,m=0,h,c=0,y=0;y<d.length;y++){var z=d[y];if(!(z<
C))if(h=c,f=e=b.quantizeX(k,p[m]),n=g=b.quantizeY(k,p[m+1]),a.coords[h]=f,a.coords[h+1]=n,m+=u,1===z)a.lengths.push(1),c=h+2;else{f=b.quantizeX(k,p[m]);n=b.quantizeY(k,p[m+1]);var r=f-e,t=n-g,x=t/r;h+=2;a.coords[h]=r;a.coords[h+1]=t;e=f;g=n;for(var m=m+u,l=2;l<z;l++){f=b.quantizeX(k,p[m]);n=b.quantizeY(k,p[m+1]);if(f!==e||n!==g){e=f-e;g=n-g;var q=g/e,x=x===q||!isFinite(x)&&!isFinite(q),v=(0<=t&&0<=g||0>=t&&0>=g)&&(0<=r&&0<=e||0>=r&&0>=e);x&&(w||v)?(r+=e,t+=g):(r=e,t=g,h+=2);a.coords[h]=r;a.coords[h+
1]=t;x=q;e=f;g=n}m+=u}f=(h+2-c)/2;f>=C&&(a.lengths.push(f),c=h+2)}}a.coords.length>c&&(a.coords.length=c);return a.coords.length?a:null}Object.defineProperty(l,"__esModule",{value:!0});var D=new E.default,F={esriGeometryPoint:b.convertToPoint,esriGeometryPolyline:b.convertToPolyline,esriGeometryPolygon:b.convertToPolygon,esriGeometryMultipoint:b.convertToMultipoint};l.executeTileQueryForIds=function(a,d,u){d=A.pad(d.bounds,u.pixelBuffer*d.resolution,A.create());var b=[];a.featureStore.forEachInBounds(d,
function(d){return b.push(a.featureAdapter.getObjectId(d))});return b};l.createTileFeatures=function(a,d,b,l,w,k,p,e,g){var f=F[b.geometryType],n=G[b.geometryType],m="esriGeometryPolygon"===b.geometryType&&!e,h=b.hasZ?b.hasM?4:3:b.hasM?3:2;p&&!k?l.forEachInBounds(w,function(c){if(!d.has(c.objectId)){var f=B.getCentroid(b,c,g),h=c.attributes;f&&(d.add(c.objectId),a.push(new q.Feature(h,c.localId,null,f)))}}):k&&!p?l.forEachInBounds(w,function(c){if(!d.has(c.objectId)){var b=c.attributes,e=f(v(D,c.geometry,
h,n,m,g),!1,!1);e&&(d.add(c.objectId),a.push(new q.Feature(b,c.localId,e,null)))}}):l.forEachInBounds(w,function(c){if(!d.has(c.objectId)){var e=B.getCentroid(b,c,g),l=c.attributes,k=f(v(D,c.geometry,h,n,m,g),!1,!1);k&&e&&(d.add(c.objectId),a.push(new q.Feature(l,c.localId,k,e)))}})};var G={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};l.quantizeOptimizedGeometryForDisplay=v});