// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/Error ../../core/maybe ../../core/urlUtils ../../core/urlUtils".split(" "),function(F,c,d,D,u,l,n,v){function w(a){var b=a.lastIndexOf("/");return-1===b?[".",a]:[a.slice(0,b),a.slice(b+1)]}function x(a){var b;b=v.getPathExtension(a);b=l.isNone(b)?[a,""]:[a.slice(0,a.length-b.length-1),"."+b];a=b[1];b=w(b[0]);return[b[0],b[1],a]}function y(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(e){switch(e.label){case 0:return a instanceof
Blob?[2,a]:[4,D(a.url,{responseType:"blob"})];case 1:return b=e.sent(),[2,b.data]}})})}function z(a){if(a instanceof Blob)return a.type;a=v.getPathExtension(a.url);return f[a]||A}Object.defineProperty(c,"__esModule",{value:!0});c.fetchResources=function(a,b,e){void 0===b&&(b={});return d.__awaiter(this,void 0,void 0,function(){var p,c,B,k,C,m,g,r,f,h,q;return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.load(e)];case 1:return d.sent(),p=n.join(a.itemUrl,"resources"),c=b.start,
B=void 0===c?1:c,k=b.num,C=void 0===k?10:k,m=b.sortOrder,g=void 0===m?"asc":m,r=b.sortField,f=void 0===r?"created":r,h={query:{start:B,num:C,sortOrder:g,sortField:f},signal:l.get(e,"signal")},[4,a.portal._request(p,h)];case 2:return q=d.sent(),[2,{total:q.total,nextStart:q.nextStart,resources:q.resources.map(function(b){return{created:new Date(b.created),size:b.size,resource:a.resourceFromPath(b.resource)}})}]}})})};c.addOrUpdateResource=function(a,b,e,c){return d.__awaiter(this,void 0,void 0,function(){var p,
f,k,h,m,g;return d.__generator(this,function(d){switch(d.label){case 0:if(!a.hasPath())throw new u("portal-item-resource-"+b+":invalid-path","Resource does not have a valid path");return[4,a.portalItem.load(c)];case 1:return d.sent(),p=n.join(a.portalItem.userItemUrl,"add"===b?"addResources":"updateResources"),f=w(a.path),k=f[0],h=f[1],[4,y(e)];case 2:return m=d.sent(),g=new FormData,k&&"."!==k&&g.append("resourcesPrefix",k),g.append("fileName",h),g.append("file",m,h),g.append("f","json"),l.isSome(c)&&
c.access&&g.append("access",c.access),[4,a.portalItem.portal._request(p,{method:"post",body:g,signal:l.get(c,"signal")})];case 3:return d.sent(),[2,a]}})})};c.removeResource=function(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var e;return d.__generator(this,function(d){switch(d.label){case 0:if(!b.hasPath())throw new u("portal-item-resources-remove:invalid-path","Resource does not have a valid path");return[4,a.load(c)];case 1:return d.sent(),e=n.join(a.userItemUrl,"removeResources"),
[4,a.portal._request(e,{method:"post",query:{resource:b.path},signal:l.get(c,"signal")})];case 2:return d.sent(),b.portalItem=null,[2]}})})};c.removeAllResources=function(a,b){return d.__awaiter(this,void 0,void 0,function(){var c;return d.__generator(this,function(d){switch(d.label){case 0:return[4,a.load(b)];case 1:return d.sent(),c=n.join(a.userItemUrl,"removeResources"),[2,a.portal._request(c,{method:"post",query:{deleteAll:!0},signal:l.get(b,"signal")})]}})})};c.splitPrefixFileNameAndExtension=
x;c.contentToBlob=y;c.getSiblingOfSameType=function(a,b){if(!a.hasPath())return null;var c=x(a.path);return a.portalItem.resourceFromPath(n.join(c[0],b+c[2]))};c.resourceContentType=z;c.resourceContentExtension=function(a){return h[z(a)]||E};var f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"},h=
{},t;for(t in f)h[f[t]]=t;var A="text/plain",E=h[A]});