// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../config ../kernel ./Error ./global ./Logger ./maybe ./string".split(" "),function(la,e,I,J,K,Y,u,Z,L,A){function l(a){var b={path:null,query:null},c=new m(a),d=a.indexOf("?");null===c.query?b.path=a:(b.path=a.substring(0,d),b.query=B(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1))));return b}function B(a){var b={},c=0;for(a=a.split("\x26");c<a.length;c++){var d=a[c];if(d){var e=d.indexOf("\x3d"),
h=void 0,k=void 0;0>e?(h=decodeURIComponent(d),k=""):(h=decodeURIComponent(d.slice(0,e)),k=decodeURIComponent(d.slice(e+1)));d=b[h];"string"===typeof d&&(d=b[h]=[d]);Array.isArray(d)?d.push(k):b[h]=k}}return b}function M(a){return a&&"object"===typeof a&&"toJSON"in a&&"function"===typeof a.toJSON}function q(a,b){return a?b&&"function"===typeof b?Object.keys(a).map(function(c){return encodeURIComponent(c)+"\x3d"+encodeURIComponent(b(c,a[c]))}).join("\x26"):Object.keys(a).map(function(c){var d=a[c];
if(null==d)return"";var e=encodeURIComponent(c)+"\x3d";return(c=b&&b[c])?e+encodeURIComponent(c(d)):Array.isArray(d)?d.map(function(a){return M(a)?e+encodeURIComponent(JSON.stringify(a)):e+encodeURIComponent(a)}).join("\x26"):M(d)?e+encodeURIComponent(JSON.stringify(d)):e+encodeURIComponent(d)}).filter(function(a){return a}).join("\x26"):""}function C(a){var b=a.indexOf("?");-1!==b?(r.path=a.slice(0,b),r.query=a.slice(b+1)):(r.path=a,r.query=null);return r}function N(a){a=C(a).path;a&&"/"===a[a.length-
1]||(a+="/");a=v(a,!0);return a=a.toLowerCase()}function w(a){var b=n.proxyRules;a=N(a);for(var c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}function O(a){a=t(a);var b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function D(a,b,c){void 0===c&&(c=!1);a=E(a);b=E(b);return c||a.scheme===b.scheme?a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port:!1}function x(a,b,c){void 0===b&&(b=e.appBaseUrl);if(f(a))return c&&c.preserveProtocolRelative?a:"http"===
e.appUrl.scheme&&e.appUrl.authority===P(a).slice(2)?"http:"+a:"https:"+a;if(!y(a)){c=Q;if("/"===a[0]){var d=b.indexOf("//"),d=b.indexOf("/",d+2);b=-1===d?b:b.slice(0,d)}return c(b,a)}return a}function t(a){a=a.trim();a=x(a);if(/^https?:\/\//i.test(a)){var b=C(a);a=b.path.replace(/\/{2,}/g,"/");a=a.replace("/","//");b.query&&(a+="?"+b.query)}a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");return a=aa(a)}function Q(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if((b=a.filter(L.isSome))&&
b.length){a=[];if(p(b[0])){var c=b[0],d=c.indexOf("//");-1!==d&&(a.push(c.slice(0,d+1)),ba.test(b[0])&&(a[0]+="/"),b[0]=c.slice(d+2))}else"/"===b[0][0]&&a.push("");b=b.reduce(function(a,b){return b?a.concat(b.split("/")):a},[]);for(c=0;c<b.length;c++)d=b[c],".."===d&&0<a.length&&".."!==a[a.length-1]?a.pop():(!d&&c===b.length-1||d&&("."!==d||0===a.length))&&a.push(d);return a.join("/")}}function P(a,b){void 0===b&&(b=!1);if(R(a)||S(a))return null;var c=a.indexOf("://");if(-1===c&&f(a))c=2;else if(-1!==
c)c+=3;else return null;c=a.indexOf("/",c);-1!==c&&(a=a.slice(0,c));b&&(a=v(a,!0));return a}function p(a){return f(a)||y(a)}function R(a){return a&&"blob:"===a.slice(0,5)}function S(a){return"data:"===a.slice(0,5)}function T(a){a=F(a);if(!a||!a.isBase64)return null;a=atob(a.data);for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}function F(a){return(a=a.match(ca))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null}function G(a){var b=T(a);if(!b)return null;a=
F(a);return new Blob([b],{type:a.mediaType})}function f(a){return a&&"/"===a[0]&&"/"===a[1]}function y(a){return U.test(a)}function da(a){return V.test(a)||"http"===e.appUrl.scheme&&f(a)}function H(a){return f(a)?"https:"+a:a.replace(V,"https:")}function z(){return"https"===e.appUrl.scheme}function v(a,b){void 0===b&&(b=!1);if(f(a))return a.slice(2);a=a.replace(U,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function aa(a){var b=n.httpsDomains;if(!da(a))return a;var c=a.indexOf("/",
7),d;d=-1===c?a:a.slice(0,c);d=d.toLowerCase().slice(7);if(ea.test(d))if(A.endsWith(d,":80"))d=d.slice(0,-3),a=a.replace(":80","");else return a;if("http"===e.appUrl.scheme&&d===e.appUrl.authority&&!fa.test(a))return a;if(z()&&d===e.appUrl.authority||b&&b.some(function(a){return d===a||A.endsWith(d,"."+a)})||z()&&!w(a))a=H(a);return a}function E(a){if("string"===typeof a)return new m(x(a));a.scheme||(a.scheme=e.appUrl.scheme);return a}function W(a,b,c){a=l(a);var d=a.query||{};d[b]=String(c);return a.path+
"?"+q(d)}Object.defineProperty(e,"__esModule",{value:!0});var ga=Z.getLogger("esri.core.urlUtils"),n=J.request,U=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,V=/^\s*http:/i,X=/^\s*https:/i,ba=/^\s*file:/i,ea=/:\d+$/,fa=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,ha=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,ia=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,m=function(){function a(a){void 0===a&&(a="");this.uri=a;this.port=this.host=this.password=this.user=this.fragment=
this.query=this.path=this.authority=this.scheme=null;a=this.uri.match(ha);this.scheme=a[2]||(a[1]?"":null);this.authority=a[4]||(a[3]?"":null);this.path=a[5];this.query=a[7]||(a[6]?"":null);this.fragment=a[9]||(a[8]?"":null);null!=this.authority&&(a=this.authority.match(ia),this.user=a[3]||null,this.password=a[4]||null,this.host=a[6]||a[7],this.port=a[9]||null)}a.prototype.toString=function(){return this.uri};return a}();e.Url=m;e.appUrl=new m(J.applicationUrl);e.trustedServersUrlCache={};e.appBaseUrl=
function(){var a=e.appUrl.path,a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(e.appUrl.scheme+"://"+e.appUrl.host+(null!=e.appUrl.port?":"+e.appUrl.port:""))+a}();e.urlToObject=l;e.queryToObject=B;e.objectToQuery=q;e.getProxyUrl=function(a){void 0===a&&(a=!1);var b,c=n.proxyUrl;if("string"===typeof a){if(b=a,b=X.test(b)||"https"===e.appUrl.scheme&&f(b),a=w(a))c=a.proxyUrl}else b=!!a;if(!c)throw ga.warn("esri/config: esriConfig.request.proxyUrl is not set."),new Y("urlutils:proxy-not-set",
"esri/config: esriConfig.request.proxyUrl is not set.");b&&z()&&(c=H(c));return l(c)};e.addProxy=function(a){var b=w(a),c,d;b&&(d=C(b.proxyUrl),c=d.path,d=d.query?B(d.query):null);c&&(b=l(a),a=c+"?"+b.path,(c=q(I.__assign(I.__assign({},d),b.query)))&&(a=a+"?"+c));return a};var r={path:"",query:""};e.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:N(a.urlPrefix)};for(var b=n.proxyRules,c=a.urlPrefix,d=b.length,e=0;e<b.length;e++){var h=b[e].urlPrefix;if(0===c.indexOf(h)){if(c.length===h.length)return-1;
d=e;break}0===h.indexOf(c)&&(d=e+1)}b.splice(d,0,a);return d};e.getProxyRule=w;e.hasSamePortal=function(a,b){a=O(a);b=O(b);return v(a)===v(b)};e.getInterceptor=function(a){var b=function(b){return null==b||b instanceof RegExp&&b.test(a)||"string"===typeof b&&A.startsWith(a,b)},c=n.interceptors;if(c)for(var d=0;d<c.length;d++){var e=c[d];if(Array.isArray(e.urls)){if(e.urls.some(b))return e}else if(b(e.urls))return e}return null};e.hasSameOrigin=D;e.isTrustedServer=function(a){if("string"===typeof a)if(p(a))a=
E(a);else return!0;if(D(a,e.appUrl))return!0;for(var b=n.trustedServers||[],c=0;c<b.length;c++){var d;d=b[c];e.trustedServersUrlCache[d]||(y(d)||f(d)?e.trustedServersUrlCache[d]=[new m(x(d))]:e.trustedServersUrlCache[d]=[new m("http://"+d),new m("https://"+d)]);d=e.trustedServersUrlCache[d];for(var g=0;g<d.length;g++)if(D(a,d[g]))return!0}return!1};e.makeAbsolute=x;e.makeRelative=function(a,b,c){void 0===b&&(b=e.appBaseUrl);if(!p(a))return a;var d=t(a),g=d.toLowerCase();b=t(b).toLowerCase().replace(/\/+$/,
"");if((c=c?t(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;for(var h=function(a,b,c){c=a.indexOf(b,c);return-1===c?a.length:c},k=h(g,"/",g.indexOf("//")+2),f=-1;g.slice(0,k+1)===b.slice(0,k)+"/";){f=k+1;if(k===g.length)break;k=h(g,"/",k+1)}if(-1===f||c&&f<c.length)return a;a=d.slice(f);d=b.slice(f-1).replace(/[^/]+/g,"").length;if(0<d)for(g=0;g<d;g++)a="../"+a;else a="./"+a;return a};e.normalize=t;e.join=Q;e.getOrigin=P;e.isAbsolute=p;e.isBlobProtocol=R;e.isDataProtocol=S;
e.dataToArrayBuffer=T;var ca=/^data:(.*?)(;base64)?,(.*)$/;e.dataComponents=F;e.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};e.dataToBlob=G;e.downloadDataAsFile=function(a,b){var c;a:if(c=document.createElement("a"),"download"in c){var d=null;if(u.URL&&u.URL.createObjectURL){d=G(a);if(!d){c=!1;break a}d=u.URL.createObjectURL(d)}c.download=b;c.href=d||a;c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c);
d&&u.URL.revokeObjectURL(d);c=void 0}else c=!1;c||window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(G(a),b)};e.isProtocolRelative=f;e.hasProtocol=y;e.toHTTP=function(a){return f(a)?"http:"+a:a.replace(X,"http:")};e.toHTTPS=H;e.isAppHTTPS=z;e.removeFile=function(a){var b=0;if(p(a)){var c=a.indexOf("//");-1!==c&&(b=c+2)}c=a.lastIndexOf("/");return c<b?a:a.slice(0,c+1)};e.removeTrailingSlash=function(a){return a.replace(/\/+$/,"")};e.changeDomain=function(a,b,c){if(!(b&&c&&a&&p(a)))return a;
var d=a.indexOf("//"),e=a.indexOf("/",d+2),f=a.indexOf(":",d+2),e=Math.min(0>e?a.length:e,0>f?a.length:f);if(a.slice(d+2,e).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,d+2);a=a.slice(e);return""+b+c+a};e.isSVG=function(a){return ja.test(a)};e.removeQueryParameters=function(a,b){a=l(a);var c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()","Url query parameters are not supported, the following parameters have been removed: "+c.join(", ")+".");return a.path};e.addQueryParameter=
W;e.addQueryParameters=function(a,b){a=l(a);var c=a.query||{},d;for(d in b)c[d]=b[d];return(b=q(c))?a.path+"?"+b:a.path};e.removeQueryParameter=function(a,b){var c=l(a),d=c.path,c=c.query;if(!c)return a;delete c[b];return(a=q(c))?d+"?"+a:d};e.addTokenParameter=function(a){var b=K.id&&K.id.findCredential(a);return b&&b.token?W(a,"token",b.token):a};e.getPathExtension=function(a){return L.isNone(a)?null:(a=a.match(ka))?a[1]:null};var ka=/.*?\.([^\/]*)$/,ja=/(^data:image\/svg|\.svg$)/i});