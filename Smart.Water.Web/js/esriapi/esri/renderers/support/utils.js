// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/arrayUtils ../../core/Logger ../../core/unitUtils ../../intl/date ./numberUtils ../visualVariables/support/ColorStop".split(" "),function(B,f,w,x,k,q,m,y){function u(a,c,d){var b="";0===c?b=r.lt+" ":c===d&&(b=r.gt+" ");return b+a}function t(a){var c=a.minValue,d=a.maxValue,b=a.isFirstBreak?"":r.gt+" ";a="percent-of-total"===a.normalizationType?r.pct:"";c=null==c?"":m.format(c);d=null==d?"":m.format(d);return b+c+a+" "+r.ld+" "+d+a}function p(a,c){return"normalizationField"in
a&&a.normalizationField?{type:"normalized-field",field:a.field,normalizationField:a.normalizationField}:"field"in a&&a.field?{type:"field",field:a.field}:"valueExpression"in a&&a.valueExpression?{type:"expression",expression:a.valueExpression,title:a.valueExpressionTitle,returnType:c}:null}Object.defineProperty(f,"__esModule",{value:!0});var v=x.getLogger("esri.renderers.support.utils"),r={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},z={millisecond:0,second:1,minute:2,hour:3,
day:4,month:5,year:6},A={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};f.meterIn={inches:k.convertUnit(1,"meters","inches"),feet:k.convertUnit(1,"meters","feet"),"us-feet":k.convertUnit(1,"meters","us-feet"),yards:k.convertUnit(1,"meters","yards"),miles:k.convertUnit(1,"meters","miles"),"nautical-miles":k.convertUnit(1,
"meters","nautical-miles"),millimeters:k.convertUnit(1,"meters","millimeters"),centimeters:k.convertUnit(1,"meters","centimeters"),decimeters:k.convertUnit(1,"meters","decimeters"),meters:k.convertUnit(1,"meters","meters"),kilometers:k.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/k.lengthToDegrees(1,"meters")};f.timelineDateFormatOptions=q.convertDateFormatToIntlOptions("short-date");f.createColorStops=function(a){var c=a.values,d=a.colors,b=a.labelIndexes,e=a.isDate,g=a.dateFormatOptions;
return c.map(function(a,l){var h=null;if(!b||-1<b.indexOf(l)){var f=void 0;(f=e?q.formatDate(a,g):m.format(a))&&(h=u(f,l,c.length-1))}return new y({value:a,color:d[l],label:h})})};f.updateColorStops=function(a){var c=a.stops,d=a.changes,b=a.isDate,e=a.dateFormatOptions,g=c.map(function(a){return a.value});a=[];for(var h=0;h<d.length;h++){var l=d[h];a.push(l.index);g[l.index]=l.value}var f=m.round(g,{indexes:a});c.forEach(function(a,d){a.value=g[d];if(null!=a.label){var h=void 0,l=null;(h=b?q.formatDate(f[d],
e):m.format(f[d]))&&(l=u(h,d,c.length-1));a.label=l}})};f.createClassBreakLabel=t;f.setLabelsForClassBreaks=function(a){var c=a.classBreakInfos,d=a.normalizationType,b=[];if(c&&c.length)if("standard-deviation"===a.classificationMethod)v.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");else if(a.round){b.push(c[0].minValue);for(a=0;a<c.length;a++)b.push(c[a].maxValue);b=m.round(b);c.forEach(function(a,c){a.label=t({minValue:0===c?b[0]:
b[c],maxValue:b[c+1],isFirstBreak:0===c,normalizationType:d})})}else c.forEach(function(a,b){a.label=t({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:d})})};f.updateClassBreak=function(a){if("standard-deviation"===a.classificationMethod)v.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.");else{var c=a.classBreaks,d=a.change,b=d.index,d=d.value,e=c.length,g=-1,h=-1;0===b?g=b:b===e?h=b-1:(h=b-1,g=b);a=a.normalizationType;
b=null;-1<g&&g<e&&(b=c[g],b.minValue=d,b.label=t({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===g,normalizationType:a}));-1<h&&h<e&&(b=c[h],b.maxValue=d,b.label=t({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===h,normalizationType:a}))}};f.calculateDateFormatInterval=function(a){a=a.map(function(a){return new Date(a)});for(var c=a.length,d=Infinity,b=null,e=0;e<c-1;e++){for(var g=a[e],h=[],l=Infinity,f=null,k=e+1;k<c;k++){var n=a[k],n=g.getFullYear()!==n.getFullYear()&&"year"||
g.getMonth()!==n.getMonth()&&"month"||g.getDate()!==n.getDate()&&"day"||g.getHours()!==n.getHours()&&"hour"||g.getMinutes()!==n.getMinutes()&&"minute"||g.getSeconds()!==n.getSeconds()&&"second"||"millisecond",m=z[n];m<l&&(l=m,f=n);h.push(n)}l<d&&(d=l,b=f)}return b};f.createUniqueValueLabel=function(a){var c=a.value,d=a.domain,b=a.fieldInfo;a=a.dateFormatInterval;var e=String(c);(d=d&&"codedValues"in d&&d.codedValues?d.getName(c):null)?e=d:"number"===typeof c&&(e=b&&"date"===b.type?q.formatDate(c,
a&&q.convertDateFormatToIntlOptions(A[a])):m.format(c));return e};f.getAttribute=p;f.getAttributes=function(a,c){var d=[];if("class-breaks"===a.type||"heatmap"===a.type)d.push(p(a,"number"));else if("unique-value"===a.type){var b=a.authoringInfo;if(b&&"relationship"===b.type){if(b.field1&&b.field2){var e=b.field2.field,f=b.field2.normalizationField;d.push(p({field:b.field1.field,normalizationField:b.field1.normalizationField}));d.push(p({field:e,normalizationField:f}))}}else e=a.uniqueValueInfos[0],
b=null,e&&e.value&&(e=typeof a.uniqueValueInfos[0].value,"string"===e||"number"===e)&&(b=e),d.push(p(a,b)),[a.field2,a.field3].forEach(function(a){return a&&d.push({type:"field",field:a})})}else"dot-density"===a.type&&a.attributes.forEach(function(a){return d.push(p(a,"number"))});(a=c?c(a):"visualVariables"in a?a.visualVariables:null)&&a.forEach(function(a){return d.push(p(a,"number"))});return w.unique(d.filter(Boolean),function(a,b){return"field"===a.type&&"field"===b.type?a.field===b.field:"normalized-field"===
a.type&&"normalized-field"===b.type?a.field===b.field&&a.normalizationField===b.normalizationField:"expression"===a.type&&"expression"===b.type?a.expression===b.expression:!1})}});