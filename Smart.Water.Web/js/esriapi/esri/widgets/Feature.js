// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Attachments":function(){define("require exports tslib ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widget".split(" "),function(f,v,a,p,m,u,w,g,t,y,c){var e={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},b=window.CSS;return function(g){function h(c,
n){c=g.call(this,c,n)||this;c.abilities=null;c.displayType="list";c.graphic=null;c.label=void 0;c.messages=null;c.messagesUnits=null;c.selectedFile=null;c.submitting=!1;c.viewModel=new t;c.visibleElements=a.__assign({},e);c._supportsImageOrientation=b&&b.supports&&b.supports("image-orientation","from-image");c._addAttachmentForm=null;c._updateAttachmentForm=null;return c}a.__extends(h,g);h.prototype.initialize=function(){var c=this;this.own(u.on(this,"viewModel.attachmentInfos","change",function(){return c.scheduleRender()}),
u.init(this,"viewModel.mode",function(){return c._modeChanged()}))};h.prototype.castVisibleElements=function(c){return a.__assign(a.__assign({},e),c)};h.prototype.addAttachment=function(){var c=this,b=this._addAttachmentForm,e=this.viewModel;this._set("submitting",!0);this._set("error",null);return e.addAttachment(b).then(function(b){c._set("submitting",!1);c._set("error",null);e.mode="view";return b}).catch(function(b){c._set("submitting",!1);c._set("error",new p("attachments:add-attachment",c.messages.addErrorMessage,
b));throw b;})};h.prototype.deleteAttachment=function(c){var b=this,e=this.viewModel;this._set("submitting",!0);this._set("error",null);return e.deleteAttachment(c).then(function(c){b._set("submitting",!1);b._set("error",null);e.mode="view";return c}).catch(function(c){b._set("submitting",!1);b._set("error",new p("attachments:delete-attachment",b.messages.deleteErrorMessage,c));throw c;})};h.prototype.updateAttachment=function(){var c=this,b=this.viewModel,e=this._updateAttachmentForm;this._set("submitting",
!0);this._set("error",null);return b.updateAttachment(e).then(function(e){c._set("submitting",!1);c._set("error",null);b.mode="view";return e}).catch(function(b){c._set("submitting",!1);c._set("error",new p("attachments:update-attachment",c.messages.updateErrorMessage,b));throw b;})};h.prototype.render=function(){var b=this.submitting,e=this.viewModel.state;return c.tsx("div",{class:this.classes("esri-attachments","esri-widget")},b?this.renderProgressBar():null,"loading"===e?this.renderLoading():
this.renderAttachments(),this.renderErrorMessage())};h.prototype.renderErrorMessage=function(){var b=this.error,e=this.visibleElements;return b&&e.errorMessage?c.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},b.message):null};h.prototype.renderAttachments=function(){var c=this.viewModel,b=c.mode,c=c.activeAttachmentInfo;return"add"===b?this.renderAddForm():"edit"===b?this.renderDetailsForm(c):this.renderAttachmentContainer()};h.prototype.renderLoading=function(){return c.tsx("div",
{class:"esri-attachments__loader-container",key:"loader"},c.tsx("div",{class:"esri-attachments__loader"}))};h.prototype.renderProgressBar=function(){return this.visibleElements.progressBar?c.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};h.prototype.renderAddForm=function(){var b,e=this.submitting,z=this.selectedFile,a=e||!z,e=this.visibleElements.cancelAddButton?c.tsx("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes("esri-button",
"esri-button--tertiary","esri-button--small","esri-button--half",e&&"esri-button--disabled")},this.messages.cancel):null,a=this.visibleElements.addSubmitButton?c.tsx("button",{type:"submit",disabled:a,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",(b={},b["esri-button--disabled"]=a,b))},this.messages.add):null;b=z?c.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},z.name):null;z=c.tsx("form",{bind:this,afterCreate:c.storeNode,afterRemoved:c.discardNode,
"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c.tsx("fieldset",{class:"esri-attachments__file-fieldset"},b,c.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},z?this.messages.changeFile:this.messages.selectFile,c.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),a,e);return c.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},
z)};h.prototype.renderDetailsForm=function(b){var e,z,a,g=this,k=this.visibleElements,d=this.selectedFile,l=this.submitting,q=b.contentType,A=b.size,h=b.url,r=this.viewModel.abilities,C=l||!d,y=r.editing&&r.operations.delete&&k.deleteButton?c.tsx("button",{key:"delete-button",type:"button",disabled:l,bind:this,onclick:function(d){return g._submitDeleteAttachment(d,b)},class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",(e={},e["esri-button--disabled"]=
l,e))},this.messages.delete):null;e=r.editing&&r.operations.update&&k.updateButton?c.tsx("button",{disabled:C,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",(z={},z["esri-button--disabled"]=C,z))},this.messages.update):null;z=this.visibleElements.cancelUpdateButton?c.tsx("button",{disabled:l,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary",
"esri-button--third",(a={},a["esri-button--disabled"]=l,a))},this.messages.cancel):null;a=d?c.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},d.name):null;r=r.editing&&r.operations.update?c.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},a,c.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,c.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):
null;A=c.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},c.tsx("label",null,m.formatFileSize(this.messagesUnits,A)));q=c.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},c.tsx("label",null,q));y=c.tsx("form",{bind:this,afterCreate:c.storeNode,afterRemoved:c.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},c.tsx("div",{class:"esri-attachments__metadata"},A,q),r,c.tsx("div",{class:"esri-attachments__actions"},
y,z,e));return c.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},c.tsx("a",{class:"esri-attachments__item-link",href:h,rel:"noreferrer",target:"_blank",alt:name},this.renderImageMask({attachmentInfo:b,size:400}),c.tsx("div",{class:"esri-attachments__item-link-overlay"},c.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},c.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},c.tsx("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),
c.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),y)};h.prototype.renderImageMask=function(b){var e,a,x=b.attachmentInfo,g=b.size;b=this.viewModel.supportsResizeAttachments;var k=x.contentType,d=x.url,l=b&&y.isSupportedImage(k),x=(x=this._getCSSTransform(x,l))?{transform:x,"image-orientation":"none"}:{},q=-1===d.indexOf("?")?"?":"\x26",g=l?""+d+q+"w\x3d"+g:y.getIconPath(k),l=(e={},e["esri-attachments__item-mask--icon"]=!l,e);e=(a={},a["esri-attachments__image--resizable"]=b,a);return c.tsx("div",
{class:this.classes(l,"esri-attachments__item-mask")},c.tsx("img",{styles:x,alt:"",src:g,class:this.classes(e,"esri-attachments__image")}))};h.prototype.renderAttachmentInfo=function(b){var e=this,a=b.attachmentInfo,x=this.viewModel.abilities,g=a.name,k=a.url;b=this.renderImageMask({attachmentInfo:a,size:"list"===b.displayType?48:400});var d=x.editing?c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",c.isRTL()?"esri-icon-left":"esri-icon-right")}):null,g=
c.tsx("label",{class:"esri-attachments__label"},c.tsx("span",{class:"esri-attachments__filename"},g||this.messages.noTitle),d),g=[b,g],x=x.editing?c.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":a.id,onclick:function(){return e._startEditAttachment(a)}},g):c.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:k,target:"_blank"},g);return c.tsx("li",
{class:"esri-attachments__item",key:a},x)};h.prototype.renderAttachmentContainer=function(){var b,e=this,a=this.displayType,x=this.viewModel,g=this.visibleElements,k=x.attachmentInfos,d=x.abilities,l=k&&k.length,x=(b={},b["esri-attachments__container--list"]="preview"!==a,b["esri-attachments__container--preview"]="preview"===a,b);b=d.editing&&d.operations.add&&g.addButton?c.tsx("button",{bind:this,onclick:function(){return e._startAddAttachment()},class:this.classes("esri-button","esri-button--tertiary",
"esri-attachments__add-attachment-button")},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;k=l?c.tsx("ul",{class:"esri-attachments__items"},k.toArray().map(function(d){return e.renderAttachmentInfo({attachmentInfo:d,displayType:a})})):c.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return c.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",x)},k,
b)};h.prototype._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};h.prototype._handleFileInputChange=function(b){b=(b=b.target)&&b.files&&b.files.item(0);this._set("selectedFile",b)};h.prototype._submitDeleteAttachment=function(b,c){b.preventDefault();this.deleteAttachment(c)};h.prototype._submitAddAttachment=function(b){b.preventDefault();this.addAttachment()};h.prototype._submitUpdateAttachment=function(b){b.preventDefault();this.updateAttachment()};h.prototype._startEditAttachment=
function(b){var c=this.viewModel;c.activeAttachmentInfo=b;c.mode="edit"};h.prototype._startAddAttachment=function(){this.viewModel.mode="add"};h.prototype._cancelForm=function(b){b.preventDefault();this.viewModel.mode="view"};h.prototype._getCSSTransform=function(b,c){b=b.orientationInfo;return!this._supportsImageOrientation&&c&&b?[b.rotation?"rotate("+b.rotation+"deg)":"",b.mirrored?"scaleX(-1)":""].join(" "):""};a.__decorate([w.aliasOf("viewModel.abilities")],h.prototype,"abilities",void 0);a.__decorate([w.property(),
c.renderable()],h.prototype,"displayType",void 0);a.__decorate([w.aliasOf("viewModel.graphic")],h.prototype,"graphic",void 0);a.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);a.__decorate([w.property(),c.renderable(),c.messageBundle("esri/widgets/Attachments/t9n/Attachments")],h.prototype,"messages",void 0);a.__decorate([w.property(),c.renderable(),c.messageBundle("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0);a.__decorate([w.property({readOnly:!0})],
h.prototype,"selectedFile",void 0);a.__decorate([c.renderable(),w.property({readOnly:!0})],h.prototype,"submitting",void 0);a.__decorate([c.renderable(),w.property({readOnly:!0})],h.prototype,"error",void 0);a.__decorate([w.property({type:t}),c.renderable("viewModel.activeAttachmentInfo viewModel.mode viewModel.state viewModel.supportsResizeAttachments viewModel.attachmentInfos viewModel.graphic viewModel.abilities viewModel.abilities.editing viewModel.abilities.operations".split(" "))],h.prototype,
"viewModel",void 0);a.__decorate([w.property(),c.renderable()],h.prototype,"visibleElements",void 0);a.__decorate([w.cast("visibleElements")],h.prototype,"castVisibleElements",null);return h=a.__decorate([w.subclass("esri.widgets.Attachments")],h)}(g)})},"esri/core/unitFormatUtils":function(){define("require exports ./mathUtils ./string ./unitUtils ../intl/number".split(" "),function(f,v,a,p,m,u){function w(a,c,e){return a.units[c][e]}function g(a,c,e,b,g){void 0===b&&(b=2);void 0===g&&(g="abbr");
return u.formatNumber(c,{minimumFractionDigits:b,maximumFractionDigits:b})+" "+w(a,e,g)}Object.defineProperty(v,"__esModule",{value:!0});v.unitName=w;v.formatDecimal=g;v.formatMetricLength=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredMetricLengthUnit(c,e);return g(a,m.convertUnit(c,e,h),h,b,r)};v.formatMetricVerticalLength=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredMetricVerticalLengthUnit(c,e);return g(a,m.convertUnit(c,e,h),h,b,
r)};v.formatImperialLength=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredImperialLengthUnit(c,e);return g(a,m.convertUnit(c,e,h),h,b,r)};v.formatImperialVerticalLength=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredImperialVerticalLengthUnit(c,e);return g(a,m.convertUnit(c,e,h),h,b,r)};v.formatMetricArea=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredMetricAreaUnit(c,e);return g(a,m.convertUnit(c,e,h),h,
b,r)};v.formatImperialArea=function(a,c,e,b,r){void 0===b&&(b=2);void 0===r&&(r="abbr");var h=m.preferredImperialAreaUnit(c,e);return g(a,m.convertUnit(c,e,h),h,b,r)};v.formatDMS=function(a,c,e){void 0===e&&(e=2);a=m.convertUnit(a,c,"degrees");c=a-Math.floor(a);a-=c;c*=60;var b=c-Math.floor(c);c-=b;b*=60;return a.toFixed()+"\u00b0 "+c.toFixed()+"' "+b.toFixed(e)+'"'};var t=["B","kB","MB","GB","TB"];v.formatFileSize=function(g,c){var e=0===c?0:Math.floor(Math.log(c)/Math.log(1024)),e=a.clamp(e,0,t.length-
1);c=u.formatNumber(c/Math.pow(1024,e),{maximumFractionDigits:2});return p.replace(g.units.bytes[t[e]],{fileSize:c})}})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("require exports tslib ../../Graphic ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/AttachmentInfo ../../tasks/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),function(f,v,a,p,m,u,w,g,t,y,c,e){var b=
{editing:!1,operations:{add:!0,update:!0,delete:!0}},r=m.ofType(y);return function(m){function h(c){var e=m.call(this,c)||this;e._getAttachmentsPromise=null;e._attachmentLayer=null;e.abilities=a.__assign({},b);e.activeAttachmentInfo=null;e.attachmentInfos=new r;e.graphic=null;e.mode="view";e.handles.add([g.init(e,"graphic",function(){return e._graphicChanged()})]);return e}a.__extends(h,m);h.prototype.destroy=function(){this.graphic=this._attachmentLayer=null};h.prototype.castAbilities=function(c){return a.__assign(a.__assign({},
b),c)};Object.defineProperty(h.prototype,"state",{get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"supportsResizeAttachments",{get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1},enumerable:!0,configurable:!0});h.prototype.getAttachments=function(){return a.__awaiter(this,void 0,void 0,function(){var b,e,x,g,k,d,l,q;return a.__generator(this,
function(a){switch(a.label){case 0:b=this;e=b._attachmentLayer;x=b.attachmentInfos;if(!e||"function"!==typeof e.queryAttachments)throw new u("invalid-layer","getAttachments(): A valid layer is required.");g=this._getFeatureId();k=new c({objectIds:[g],returnMetadata:!0});d=[];this._getAttachmentsPromise=l=e.queryAttachments(k).then(function(b){return b[g]||d}).catch(function(){return d});this.notifyChange("state");return[4,l];case 1:return q=a.sent(),x.removeAll(),q.length&&x.addMany(q),this._getAttachmentsPromise=
null,this.notifyChange("state"),[2,q]}})})};h.prototype.addAttachment=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,e,g,k,d,l,q,h=this;return a.__generator(this,function(a){switch(a.label){case 0:c=this;e=c._attachmentLayer;g=c.attachmentInfos;k=c.graphic;d=c.abilities;if(!b)throw new u("invalid-attachment","addAttachment(): An attachment is required.",{attachment:b});if(!d.operations.add)throw new u("invalid-abilities","addAttachment(): add abilities are required.");if(!e||"function"!==
typeof e.addAttachment)throw new u("invalid-layer","addAttachment(): A valid layer is required.");l=e.addAttachment(k,b).then(function(b){return h._queryAttachment(b.objectId)});return[4,l];case 1:return q=a.sent(),g.add(q),[2,q]}})})};h.prototype.deleteAttachment=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,e,g,k,d,l,q;return a.__generator(this,function(a){switch(a.label){case 0:c=this;e=c._attachmentLayer;g=c.attachmentInfos;k=c.graphic;d=c.abilities;if(!b)throw new u("invalid-attachment-info",
"deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:b});if(!d.operations.delete)throw new u("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!e||"function"!==typeof e.deleteAttachments)throw new u("invalid-layer","deleteAttachment(): A valid layer is required.");l=e.deleteAttachments(k,[b.id]).then(function(){return b});return[4,l];case 1:return q=a.sent(),g.remove(q),[2,q]}})})};h.prototype.updateAttachment=function(b,c){void 0===c&&(c=this.activeAttachmentInfo);
return a.__awaiter(this,void 0,void 0,function(){var e,g,k,d,l,q,z,h,m=this;return a.__generator(this,function(a){switch(a.label){case 0:e=this;g=e._attachmentLayer;k=e.attachmentInfos;d=e.graphic;l=e.abilities;if(!b)throw new u("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:b});if(!c)throw new u("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:c});if(!l.operations.update)throw new u("invalid-abilities","updateAttachment(): Update abilities are required.");
q=k.findIndex(function(b){return b===c});if(!g||"function"!==typeof g.updateAttachment)throw new u("invalid-layer","updateAttachment(): A valid layer is required.");z=g.updateAttachment(d,c.id,b).then(function(b){return m._queryAttachment(b.objectId)});return[4,z];case 1:return h=a.sent(),k.splice(q,1,h),[2,h]}})})};h.prototype._queryAttachment=function(b){return a.__awaiter(this,void 0,void 0,function(){var e,g,h;return a.__generator(this,function(a){if(!b)throw new u("invalid-attachment-id","Could not query attachment.");
e=this._attachmentLayer;g=this._getFeatureId();h=new c({objectIds:[g],attachmentsWhere:"AttachmentId\x3d"+b,returnMetadata:!0});return[2,e.queryAttachments(h).then(function(b){return b[g][0]})]})})};h.prototype._getFeatureId=function(){var b=this._attachmentLayer,c=this.graphic;if(!b||!c)return null;b=b.objectIdField;return(c=c.attributes)&&c[b]};h.prototype._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(function(){}))};h.prototype._setAttachmentLayer=
function(){var b=e.getSourceLayer(this.graphic);this._attachmentLayer=b?"scene"===b.type&&b.associatedLayer?b.associatedLayer:b:null};a.__decorate([t.property()],h.prototype,"abilities",void 0);a.__decorate([t.cast("abilities")],h.prototype,"castAbilities",null);a.__decorate([t.property()],h.prototype,"activeAttachmentInfo",void 0);a.__decorate([t.property({readOnly:!0,type:r})],h.prototype,"attachmentInfos",void 0);a.__decorate([t.property({type:p})],h.prototype,"graphic",void 0);a.__decorate([t.property()],
h.prototype,"mode",void 0);a.__decorate([t.property({dependsOn:["graphic"],readOnly:!0})],h.prototype,"state",null);a.__decorate([t.property({readOnly:!0,dependsOn:["graphic","graphic.layer","graphic.layer.loaded","graphic.layer.capabilities.operations.supportsResizeAttachments"]})],h.prototype,"supportsResizeAttachments",null);return h=a.__decorate([t.subclass("esri.widgets.Attachments.AttachmentsViewModel")],h)}(w.HandleOwner)})},"esri/widgets/Feature/support/featureUtils":function(){define(["require",
"exports","tslib"],function(f,v,a){function p(a){return u.test(a)}function m(a,g){if(!p(g)||!a)return null;var m=g.replace(u,"").toLowerCase(),w;a.some(function(c){return c.name.toLowerCase()===m?(w=c,!0):!1});return w}Object.defineProperty(v,"__esModule",{value:!0});v.getSourceLayer=function(a){if(a)return a.get("sourceLayer")||a.get("layer")};v.graphicCallback=function(m,g){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,"function"===typeof m?m.call(null,
g):m]})})};v.shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};var u=/^\s*expression\//i;v.isExpressionField=p;v.getFieldInfoLabel=function(a,g){return(g=m(g,null===a||void 0===a?void 0:a.fieldName))?g.title||null:a?a.label||a.fieldName:null}})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["require","exports","../../../assets"],function(f,v,a){Object.defineProperty(v,"__esModule",{value:!0});var p=a.getAssetUrl("esri/themes/base/images/files/");
v.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===a||"image/x-icon"===a||"image/jpeg"===a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};v.getIconPath=function(a){return a?"text/plain"===a?p+"text-32.svg":"application/pdf"===a?p+"pdf-32.svg":"text/csv"===a?p+"csv-32.svg":"application/gpx+xml"===a?p+"gpx-32.svg":"application/x-dwf"===a?p+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||
"model/vrml"===a?p+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===a||"application/x-tar"===a||"application/x-gtar"===a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?p+"zip-32.svg":-1!==a.indexOf("image/")?p+"image-32.svg":-1!==a.indexOf("audio/")?p+"sound-32.svg":-1!==a.indexOf("video/")?p+"video-32.svg":-1!==
a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?p+"excel-32.svg":-1!==a.indexOf("msword")||-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?p+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?p+"report-32.svg":p+"generic-32.svg":p+"generic-32.svg"}})},"esri/widgets/Feature/FeatureContent":function(){define("require exports tslib ../../core/arrayUtils ../../core/accessorSupport/decorators ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget".split(" "),
function(f,v,a,p,m,u,w,g,t){return function(y){function c(a,b){a=y.call(this,a,b)||this;a.creator=null;a.graphic=null;a.viewModel=null;a._addTargetToAnchors=function(b){p.from(b.querySelectorAll("a")).forEach(function(b){g.shouldOpenInNewTab(b.href)&&!b.hasAttribute("target")&&b.setAttribute("target","_blank")})};return a}a.__extends(c,y);c.prototype.renderLoading=function(){return t.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},t.tsx("div",{class:"esri-feature-content__loader"}))};
c.prototype.renderCreated=function(){var a,b=null===(a=this.viewModel)||void 0===a?void 0:a.created;return b?b instanceof HTMLElement?t.tsx("div",{key:b,bind:b,afterCreate:this._attachToNode}):t.isWidget(b)?t.tsx("div",{key:b},!b.destroyed&&b.render()):t.tsx("div",{key:b,innerHTML:b,afterCreate:this._addTargetToAnchors}):null};c.prototype.render=function(){var a,b=null===(a=this.viewModel)||void 0===a?void 0:a.state;return t.tsx("div",{class:"esri-feature-content"},"loading"===b?this.renderLoading():
this.renderCreated())};c.prototype._attachToNode=function(a){a.appendChild(this)};a.__decorate([m.aliasOf("viewModel.creator")],c.prototype,"creator",void 0);a.__decorate([m.aliasOf("viewModel.graphic")],c.prototype,"graphic",void 0);a.__decorate([t.renderable(["viewModel.created","viewModel.state"]),m.property({type:w})],c.prototype,"viewModel",void 0);return c=a.__decorate([m.subclass("esri.widgets.Feature.FeatureContent")],c)}(u)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("require exports tslib ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/watchUtils ../../../core/accessorSupport/decorators ../support/featureUtils".split(" "),
function(f,v,a,p,m,u,w,g,t){return function(m){function c(a){var b=m.call(this,a)||this;b._loadingPromise=null;b.created=null;b.creator=null;b.destroyer=null;b.graphic=null;b.handles.add(w.init(b,"creator",function(a){b._destroyContent();b._createContent(a)}));return b}a.__extends(c,m);c.prototype.destroy=function(){this._destroyContent()};Object.defineProperty(c.prototype,"state",{get:function(){return this._loadingPromise?"loading":"ready"},enumerable:!0,configurable:!0});c.prototype._destroyContent=
function(){var a=this.graphic,b=this.destroyer;this.created&&(t.graphicCallback(b,{graphic:a}).catch(function(){return null}),this._set("created",null))};c.prototype._createContent=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,e,g;return a.__generator(this,function(a){switch(a.label){case 0:return b=this.graphic,this._loadingPromise=e=t.graphicCallback(c,{graphic:b}).catch(function(){return null}),this.notifyChange("state"),[4,e];case 1:g=a.sent();if(e!==this._loadingPromise)return[2];
this._loadingPromise=null;this.notifyChange("state");this._set("created",g);return[2]}})})};a.__decorate([g.property({readOnly:!0})],c.prototype,"created",void 0);a.__decorate([g.property()],c.prototype,"creator",void 0);a.__decorate([g.property()],c.prototype,"destroyer",void 0);a.__decorate([g.property({type:p})],c.prototype,"graphic",void 0);a.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);return c=a.__decorate([g.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],
c)}(u.HandleOwnerMixin(m))})},"esri/widgets/Feature/FeatureFields":function(){define("require exports tslib ../../core/accessorSupport/decorators ../Widget ./FeatureFields/FeatureFieldsViewModel ../support/uriUtils ../support/widget".split(" "),function(f,v,a,p,m,u,w,g){return function(m){function f(a,e){a=m.call(this,a,e)||this;a.attributes=null;a.expressionInfos=null;a.fieldInfos=null;a.viewModel=new u;a.messages=null;a.messagesURIUtils=null;return a}a.__extends(f,m);f.prototype.renderFieldInfo=
function(a,e){var b,c=this.viewModel.attributes,h=a.fieldName,f=a.label||h,c=c?null==c[h]?"":c[h]:"";a=!(!a.format||!a.format.dateFormat);c="number"!==typeof c||a?w.autoLink(this.messagesURIUtils,c):this._forceLTR(c);a=(b={},b["esri-feature-fields__field-data--date"]=a,b);return g.tsx("tr",{key:"fields-element-info-row-"+h+"-"+e},g.tsx("th",{key:"fields-element-info-row-header-"+h+"-"+e,class:"esri-feature-fields__field-header",innerHTML:f}),g.tsx("td",{key:"fields-element-info-row-data-"+h+"-"+e,
class:this.classes("esri-feature-fields__field-data",a),innerHTML:c}))};f.prototype.renderFields=function(){var a=this,e=this.viewModel.formattedFieldInfos;return e.length?g.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},g.tsx("tbody",null,e.map(function(b,c){return a.renderFieldInfo(b,c)}))):null};f.prototype.render=function(){return g.tsx("div",{class:"esri-feature-fields"},this.renderFields())};f.prototype._forceLTR=function(a){return"\x26lrm;"+a};a.__decorate([p.aliasOf("viewModel.attributes")],
f.prototype,"attributes",void 0);a.__decorate([p.aliasOf("viewModel.expressionInfos")],f.prototype,"expressionInfos",void 0);a.__decorate([p.aliasOf("viewModel.fieldInfos")],f.prototype,"fieldInfos",void 0);a.__decorate([p.property({type:u}),g.renderable(["viewModel.attributes","viewModel.formattedFieldInfos"])],f.prototype,"viewModel",void 0);a.__decorate([p.property(),g.renderable(),g.messageBundle("esri/widgets/Feature/t9n/Feature")],f.prototype,"messages",void 0);a.__decorate([p.property(),g.renderable(),
g.messageBundle("esri/widgets/support/t9n/uriUtils")],f.prototype,"messagesURIUtils",void 0);return f=a.__decorate([p.subclass("esri.widgets.Feature.FeatureFields")],f)}(m)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),function(f,v,a,p,m,u,w,g){return function(f){function p(a){a=f.call(this,
a)||this;a.attributes=null;a.expressionInfos=null;a.fieldInfos=null;return a}a.__extends(p,f);Object.defineProperty(p.prototype,"formattedFieldInfos",{get:function(){var a=this.expressionInfos,e=this.fieldInfos,b=[];null===e||void 0===e?void 0:e.forEach(function(c){if(!c.hasOwnProperty("visible")||c.visible)c=c.clone(),c.label=g.getFieldInfoLabel(c,a),b.push(c)});return b},enumerable:!0,configurable:!0});a.__decorate([m.property()],p.prototype,"attributes",void 0);a.__decorate([m.property({type:[u]})],
p.prototype,"expressionInfos",void 0);a.__decorate([m.property({type:[w]})],p.prototype,"fieldInfos",void 0);a.__decorate([m.property({readOnly:!0,dependsOn:["expressionInfos","fieldInfos"]})],p.prototype,"formattedFieldInfos",null);return p=a.__decorate([m.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],p)}(p)})},"esri/widgets/support/uriUtils":function(){define(["require","exports","../../core/string"],function(f,v,a){function p(a){var f=null;m.some(function(g){g.pattern.test(a)&&
(f=g);return!!f});return f}Object.defineProperty(v,"__esModule",{value:!0});var m=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,
label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];v.autoLink=function(f,m){if("string"!==typeof m||!m)return m;var g=p(m);if(!g)return m;var t=m.match(g.pattern);f=a.replace(a.replace(g.label,{messages:f,hierPart:t&&t[2]}),{appName:g.appName});return m.replace(g.pattern,
"\x3ca"+(g.target?' target\x3d"'+g.target+'"':"")+' href\x3d"$1"'+("_blank"===g.target?' rel\x3d"noreferrer"':"")+"\x3e"+f+"\x3c/a\x3e")}})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports tslib ../../Graphic ../../intl ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/string ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/FieldInfo ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../Attachments/AttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureFields/FeatureFieldsViewModel ./support/featureUtils ./support/RelatedFeatures @dojo/framework/shim/Promise".split(" "),
function(f,v,a,p,m,u,w,g,t,y,c,e,b,r,h,C,n,z,x,I,k,d,l,q,A,J){function K(){return new Promise(function(a,b){f(["../../support/arcadeUtils"],a,b)})}function D(a){var b=/(\n)/gi;return"string"===typeof a?a.replace(b,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function G(a,b){return a&&"function"===typeof a.getField?a.getField(b):null}function F(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var L=["$datastore","$map","$layer"],E=t.getLogger("esri.widgets.FeatureViewModel"),
H=h.convertDateFormatToIntlOptions("short-date-short-time");return function(h){function f(a){var d=h.call(this,a)||this;d._handles=new w;d._featureAbortController=null;d._graphicChangedThrottled=e.throttle(d._graphicChanged,1,d);d._effectivePopupTemplate=null;d._graphic=null;d._fieldInfoMap=null;d.content=null;d.contentVMs=[];d.defaultPopupTemplateEnabled=!1;d.formattedAttributes=null;d.graphic=null;d.lastEditInfo=null;d.title="";d.view=null;d._handles.add(b.init(d,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.expressionInfos graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.sourceLayer.popupTemplate.outFields graphic.sourceLayer.popupTemplate.relatedRecordsInfo graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.expressionInfos graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.outFields graphic.popupTemplate.relatedRecordsInfo".split(" "),
function(){return d._graphicChangedThrottled()}));return d}a.__extends(f,h);f.prototype.destroy=function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null;this._destroyContentViewModels()};Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",a)},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"map",{get:function(){return this.get("view.map")||null},set:function(a){void 0===a?this._clearOverride("map"):this._override("map",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});f.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};f.prototype._graphicChanged=function(){return a.__awaiter(this,
void 0,void 0,function(){var b,d,c,e;return a.__generator(this,function(a){switch(a.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=d=(b=this.graphic)?b.clone():null;if(!d)return[2];this._featureAbortController=c=y.createAbortController();a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._queryFeature({signal:c.signal})];case 2:return a.sent(),[3,4];case 3:return e=a.sent(),E.error("error","error loading template",e),[3,4];case 4:return this._featureAbortController=null,[2]}})})};
f.prototype._cancelFeatureQuery=function(){var a=this._featureAbortController;a&&a.abort();this._featureAbortController=null};f.prototype._compileContent=function(a){var b=this;this._destroyContentViewModels();if(this._graphic)return Array.isArray(a)?a.map(function(a,d){if("attachments"===a.type)return b._compileAttachments(a,d);if("custom"===a.type)return b._compileCustom(a,d);if("fields"===a.type)return b._compileFields(a,d);if("media"===a.type)return b._compileMedia(a);if("text"===a.type)return b._compileText(a,
d)}):"string"===typeof a?this._compileText(new x({text:a}),0).text:a};f.prototype._destroyContentViewModels=function(){this.contentVMs.forEach(function(a){return a&&!a.destroyed&&a.destroy()});this._set("contentVMs",[])};f.prototype._compileAttachments=function(a,b){this.contentVMs[b]=new d({graphic:this.graphic});return a};f.prototype._compileCustom=function(a,b){this.contentVMs[b]=new l({graphic:this.graphic,creator:a.creator,destroyer:a.destroyer});return a};f.prototype._compileFields=function(b,
d){var c=this._effectivePopupTemplate,e=this.formattedAttributes,B=b.clone();b=(null===b||void 0===b?void 0:b.fieldInfos)||(null===c||void 0===c?void 0:c.fieldInfos);c=null===c||void 0===c?void 0:c.expressionInfos;e=a.__assign(a.__assign({},e.global),e.content[d]);e=new q({attributes:e,expressionInfos:c,fieldInfos:b});this.contentVMs[d]=e;B.fieldInfos=g.clone(e.formattedFieldInfos);return B};f.prototype._setImageValue=function(a){var b=a.value,d=a.formattedAttributes;a=a.layer;var c=b.linkURL,e=b.sourceURL;
e&&(e=this._fixTokens(e,a),b.sourceURL=this._substituteAttributes(d,e));c&&(a=this._fixTokens(c,a),b.linkURL=this._substituteAttributes(d,a))};f.prototype._compileMedia=function(b){var d=this,c=this._graphic;b=g.clone(b);var e=b.mediaInfos,l=c.attributes,B=A.getSourceLayer(c),q=this.formattedAttributes.global,f=a.__assign(a.__assign({},q),l);b.mediaInfos=e&&e.map(function(a){if(a=g.clone(a)){var b=a.title?d._processFieldsInLinks(a.title,f):"";a.title=b?d._substituteAttributes(q,b):"";b=a.caption?
d._processFieldsInLinks(a.caption,f):"";a.caption=b?d._substituteAttributes(q,b):"";b=a.altText?d._processFieldsInLinks(a.altText,f):"";a.altText=b?d._substituteAttributes(q,b):"";if("image"===a.type)return b=a.value,d._setImageValue({value:b,formattedAttributes:q,layer:B}),a.value.sourceURL?a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return b=a.value,d._setChartValue({value:b,chartType:a.type,attributes:l,formattedAttributes:q,layer:B}),
a}}).filter(Boolean);return b};f.prototype._normalizeTemplateFields=function(a){var b=this._fieldInfoMap.get(a.toLowerCase());return"{"+(b&&b.fieldName||a)+"}"};f.prototype._substituteAttributes=function(a,b){var d=this;return(""+this._removeEmptyHref(c.replace(c.replace(b,function(a){return d._normalizeTemplateFields(a)}),a))).trim()};f.prototype._compileText=function(b,d){b=g.clone(b);var c=this._graphic;if(b&&b.text){var e=c.attributes,B=this.formattedAttributes.global,e=this._processFieldsInLinks(b.text,
a.__assign(a.__assign({},B),e));b.text=this._substituteAttributes(B,e)}this.contentVMs[d]=new l({graphic:c,creator:b.text});return b};f.prototype._formatEditInfo=function(a,b){var d=a.creatorField,c=a.creationDateField,e=a.editorField;if(b){a=b[a.editDateField];if("number"===typeof a)return b=b[e],d=m.formatDate(a,H),{type:"edit",date:d,user:b};c=b[c];if("number"===typeof c)return b=b[d],d=m.formatDate(c,H),{type:"create",date:d,user:b}}};f.prototype._compileLastEditInfo=function(){var a=this._effectivePopupTemplate,
b=this._graphic;if(a){var a=a.lastEditInfoEnabled,d=b.get("sourceLayer.editFieldsInfo");if(a&&d)return this._formatEditInfo(d,b.attributes)}};f.prototype._compileTitle=function(b){var d=this._graphic.attributes,c=this.formattedAttributes.global;return b?(b=this._processFieldsInLinks(b,a.__assign(a.__assign({},c),d)),this._substituteAttributes(c,b)):""};f.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,d,c){return(a=G(b,c))?"{"+a.name+"}":d})};f.prototype._encodeAttributes=
function(a){var b=a?g.clone(a):{};Object.keys(b).forEach(function(a){var d=b[a];"string"===typeof d&&(d=encodeURIComponent(d).replace(/\'/g,"\x26apos;"),b[a]=d)});return b};f.prototype._createfieldInfoMap=function(a,b){var d=this,c=new Map;a&&a.forEach(function(a){var e=d._getFixedFieldName(a.fieldName,b);a.fieldName=e;c.set(e.toLowerCase(),a)});return c};f.prototype._formatAttributeValue=function(a){var b=a.value,d=a.fieldName,c=a.fieldInfos,e=a.fieldInfoMap;a=a.layer;if(null==b)return"";var l=this._getDomainName(d,
b);return l||(l=this._getTypeName(d))?l:e.get(d.toLowerCase())?this._formatValueToFieldInfo(b,{fieldInfos:c,fieldName:d,layer:a}):(c=a&&a.fieldsIndex)&&c.isDateField(d)?m.formatDate(b,H):D(b)};f.prototype._formatAttributes=function(a){var b=this,d=this._graphic,c=A.getSourceLayer(d),e=g.clone(d.attributes);this.addRelatedFeatureAttributes(e);var l=this._createfieldInfoMap(a,c);this._fieldInfoMap=l;Object.keys(e).forEach(function(d){e[d]=b._formatAttributeValue({fieldName:d,fieldInfos:a,fieldInfoMap:l,
layer:c,value:e[d]})});return e};f.prototype._parseNumberFromString=function(a,b){return"string"!==typeof a||!b||null!=b.dateFormat||null==b.places&&null==b.digitSeparator||(b=Number(a),isNaN(b))?a:b};f.prototype._formatValueToFieldInfo=function(b,d){var c=d.fieldName,e=this._getFieldInfo(d.fieldInfos,c),l=g.clone(e),e=d.preventPlacesFormatting;(d=G(d.layer,c))&&"date"===d.type&&(d=l.format||new k,d.dateFormat=d.dateFormat||"short-date-short-time",l.format=d);l=l&&l.format;b=this._parseNumberFromString(b,
l);return"string"===typeof b||null==b||null==l?b:e?C.formatNumber(b,a.__assign(a.__assign({},C.convertNumberFormatToIntlOptions(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(b)};f.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var d=this._graphic,c=A.getSourceLayer(d);return c&&"function"===typeof c.getFieldDomain?(a=c.getFieldDomain(a,{feature:d}))&&"coded-value"===a.type?a.getName(b):null:null};f.prototype._getFieldInfo=function(a,b){if(a&&a.length&&
b){var d=b.toLowerCase(),c=void 0;a.some(function(a){return a.fieldName&&a.fieldName.toLowerCase()===d?(c=a,!0):!1});return c}};f.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this._graphic,d=A.getSourceLayer(b);if(!d||"function"!==typeof d.getFeatureType)return null;var c=d.typeIdField;return c&&a===c?(a=d.getFeatureType(b))?a.name:null:null};f.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};f.prototype._processFieldsInLinks=function(a,
b){var d=this.get("_graphic.layer");a=this._fixTokens(a,d);var e=this._encodeAttributes(b),d=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(d,function(a,d,l){d=(""+(d||l)).trim();return c.replace(a,d&&"{"===d[0]?b:e)}):a};f.prototype._getTitle=function(){return a.__awaiter(this,void 0,void 0,function(){var b,d,c,e;return a.__generator(this,function(a){b=this;d=b._effectivePopupTemplate;c=b._graphic;e=d&&d.title;return[2,A.graphicCallback(e,{graphic:c})]})})};f.prototype._getContent=
function(){return a.__awaiter(this,void 0,void 0,function(){var b,d,c,e;return a.__generator(this,function(a){b=this;d=b._effectivePopupTemplate;c=b._graphic;e=d&&d.content;return[2,A.graphicCallback(e,{graphic:c})]})})};f.prototype._querySourceLayer=function(a,b){var d=a.layer,c=a.graphic,e=a.outFields;a=a.objectIds;var l=a[0];if("number"!==typeof l)return b="Could not query required fields for the specified feature. The feature's ID is invalid.",d={layer:d,graphic:c,objectId:l,requiredFields:e},
e=new u("layer-query-features-invalid-objectid",b,d),E.warn(b,d),y.reject(e);if("function"!==typeof d.queryFeatures)return b="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",d={layer:d,graphic:c,requiredFields:e},e=new u("layer-query-features-unsupported",b,d),E.warn(b,d),y.reject(e);c=d.createQuery();c.objectIds=a;c.outFields=e;c.returnGeometry=!0;return d.queryFeatures(c,b).then(function(a){return a.features[0]})};f.prototype._queryRequiredFieldsFeature=
function(a){var b=this,d=this._graphic,c=this._effectivePopupTemplate,e=d.sourceLayer;return e&&c?("function"===typeof e.load?e.load(a):y.resolve()).then(function(){var l=[d.attributes[e.objectIdField]];return c.getRequiredFields(e.fields).then(function(c){return n.featureHasFields(c,d)?null:b._querySourceLayer({layer:e,graphic:d,outFields:c,objectIds:l},a)})}):y.resolve(null)};f.prototype._queryFeature=function(b){var d=this,c=this._featureAbortController,e=this._graphic;this._effectivePopupTemplate=
e&&e.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return y.eachAlways({content:this._getContent(),title:this._getTitle()}).then(function(l){var q=l.content.value,f=l.title.value;if(c===d._featureAbortController&&e){l=d._checkForRelatedFeatures(q,b);var g=d._createFormattedExpressions().then(function(b){e.attributes=a.__assign(a.__assign({},e.attributes),b)}),k=d._queryRequiredFieldsFeature(b).then(function(b){b&&(e.geometry=b.geometry,e.attributes=a.__assign(a.__assign({},e.attributes),
b.attributes))});return y.eachAlways([l,g,k]).then(function(){if(c===d._featureAbortController&&e){d._set("formattedAttributes",d._createFormattedAttributes(q));d._set("title",d._compileTitle(f));var a=d._compileLastEditInfo();d._set("lastEditInfo",a||null);a=d._compileContent(q);d._set("content",a||null);return a}})}})};f.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?D(F(a)):a)+"\x3c/li\x3e"}).join("")+
"\x3c/ul\x3e"};f.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var d=a.field(b),d="string"===typeof d?D(F(d)):d;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};f.prototype._createFormattedExpressions=function(){return a.__awaiter(this,void 0,void 0,function(){var b,d,c,e,l,q,f,g,k,h,z,x=this;return a.__generator(this,function(A){switch(A.label){case 0:return b=
this,d=b._effectivePopupTemplate,c=b._graphic,e=d&&d.expressionInfos,l=[],q={},e&&e.length?[4,K()]:[2,q];case 1:f=A.sent();g=function(b){var d="expression/"+b.name,e=f.createSyntaxTree(b.expression),k=L.filter(function(a){return f.hasVariable(e,a)});b=f.loadScriptDependencies(e,!0,k).then(function(){return a.__awaiter(x,void 0,void 0,function(){var b,l,g,h,z=this;return a.__generator(this,function(a){b=this.spatialReference;l=f.getViewInfo({spatialReference:b});g=f.createExecContext(c,l);g.useAsync=
!0;this._addVarsToContext(f,k,g,l);h=f.createFunction(e,g);return[2,f.executeAsyncFunction(h,g).then(function(a){q[d]="string"===typeof a?D(F(a)):Array.isArray(a)?z._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?z._formatArcadeDictionary(a):a},function(a){return E.error("arcade-execution-error",a)})]})})});l.push(b)};k=0;for(h=e;k<h.length;k++)z=h[k],g(z);return[2,y.eachAlways(l).then(function(){return q})]}})})};f.prototype._addVarsToContext=function(a,b,d,c){var e=this.graphic,
l=this.map;b.forEach(function(b){b=b.toLowerCase();var q={map:l,spatialReference:c.sr};"$map"===b&&(d.vars[b]=a.convertMapToFeatureSetCollection(q));"$layer"===b&&(d.vars[b]=a.convertFeatureLayerToFeatureSet(e.sourceLayer,c.sr));"$datastore"===b&&(d.vars[b]=a.convertServiceUrlToWorkspace(e.sourceLayer.url,c.sr))})};f.prototype._createFormattedAttributes=function(a){var b=this,d=this._effectivePopupTemplate,c={global:this._formatAttributes(d&&d.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,
d){"fields"===a.type&&a.fieldInfos&&(c.content[d]=b._formatAttributes(a.fieldInfos))});return c};f.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,d=[];(b=b&&b.fieldInfos)&&d.push.apply(d,b);if(!a||!Array.isArray(a))return d;a.forEach(function(a){"fields"===a.type&&d.push.apply(d,a&&a.fieldInfos)});return d};f.prototype._checkForRelatedFeatures=function(a,b){var d=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(d,a,b)};f.prototype._getTooltip=function(a){var b=
a.label;return"pie-chart"===a.chartType?b:b+": "+a.value};f.prototype._getChartOption=function(a){var b,d=a.value,c=a.attributes,e=a.formattedAttributes,l=a.fieldName,q=a.relatedFieldName,f=a.fieldInfos,g=a.index;a=a.chartType;var k=A.getSourceLayer(this._graphic),h=d.normalizeField,d=d.tooltipField,h=h?this.isRelatedField(h)?c[this.getRelatedFieldInfo(h).fieldName]:c[h]:null,x=q&&void 0!==c[q]?c[q]:void 0!==c[l]?c[l]:e[l],x=void 0===x?null:x&&h?x/h:x,g=new I({x:g,y:x});if(this.isRelatedField(l))return b=
this.getRelatedFieldInfo(l),e=(e=this.getRelatedFieldInfo(d))?e.fieldName:null,f=this._formatValueToFieldInfo(x,{fieldInfos:f,fieldName:q,layer:k,preventPlacesFormatting:!!h}),q=b?b.label||b.fieldName:q,g.tooltip=this._getTooltip({label:e&&void 0!==c[e]?c[e]:q,value:f,chartType:a}),g;c=this._getFieldInfo(f,l);q=this._getFixedFieldName(l,k);c=d&&void 0!==e[d]?e[d]:A.getFieldInfoLabel(c||new z({fieldName:q}),null===(b=this._effectivePopupTemplate)||void 0===b?void 0:b.expressionInfos);g.tooltip=this._getTooltip({label:c,
value:e[q],chartType:a});return g};f.prototype._getFixedFieldName=function(a,b){return(b=G(b,a))?b.name:a};f.prototype._getFixedFieldNames=function(a,b){var d=this;return a&&a.map(function(a){return d._getFixedFieldName(a,b)})};f.prototype._setChartValue=function(b){var d=this,c=b.value,e=b.attributes,l=b.formattedAttributes,q=b.chartType;b=b.layer;var f=this._effectivePopupTemplate,g=this.relatedInfoCount,k=c.fields,h=c.normalizeField;c.fields=this._getFixedFieldNames(k,b);h&&(c.normalizeField=this._getFixedFieldName(h,
b));if(k.some(function(a){return!!(null!=l[a]||d.isRelatedField(a)&&g)})){var z=f&&f.fieldInfos;k.forEach(function(b,f){d.isRelatedField(b)?c.series=a.__spreadArrays(c.series,d._getRelatedChartInfos({fieldInfos:z,fieldName:b,formattedAttributes:l,chartType:q,value:c})):(b=d._getChartOption({value:c,index:f,attributes:e,chartType:q,formattedAttributes:l,fieldName:b,fieldInfos:z}),c.series.push(b))})}};f.prototype._getRelatedChartInfos=function(a){var b=this,d=a.fieldInfos,c=a.fieldName,e=a.formattedAttributes,
l=a.chartType,q=a.value,f=[];a=this.getRelatedFieldInfo(c);var g=a.fieldName,k=this.getRelatedInfo(a.layerId);if(!k)return f;a=k.relatedFeatures;k=k.relation;if(!k||!a)return f;k=k.cardinality;a.forEach(function(a,k){var h=a.attributes;h&&Object.keys(h).forEach(function(a){a===g&&f.push(b._getChartOption({value:q,index:k,attributes:h,formattedAttributes:e,fieldName:c,chartType:l,relatedFieldName:a,fieldInfos:d}))})});return"one-to-many"===k||"many-to-many"===k?f:[f[0]]};a.__decorate([r.property()],
f.prototype,"_featureAbortController",void 0);a.__decorate([r.property({readOnly:!0})],f.prototype,"content",void 0);a.__decorate([r.property({readOnly:!0})],f.prototype,"contentVMs",void 0);a.__decorate([r.property({type:Boolean})],f.prototype,"defaultPopupTemplateEnabled",void 0);a.__decorate([r.property({readOnly:!0})],f.prototype,"formattedAttributes",void 0);a.__decorate([r.property({type:p})],f.prototype,"graphic",void 0);a.__decorate([r.property({readOnly:!0})],f.prototype,"lastEditInfo",void 0);
a.__decorate([r.property({dependsOn:["view"]})],f.prototype,"spatialReference",null);a.__decorate([r.property({readOnly:!0})],f.prototype,"title",void 0);a.__decorate([r.property({dependsOn:["view"]})],f.prototype,"map",null);a.__decorate([r.property({readOnly:!0,dependsOn:["_featureAbortController"]})],f.prototype,"waitingForContent",null);a.__decorate([r.property()],f.prototype,"view",void 0);return f=a.__decorate([r.subclass("esri.widgets.FeatureViewModel")],f)}(J)})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports tslib ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(f,v,a,p,m,u,w,g,t,y,c,e,b){var r=new Map,h=w.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(f){function n(a){a=f.call(this,a)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}a.__extends(n,f);n.prototype.destroy=function(){this.relatedInfos.clear()};n.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(c){return b._addRelatedFeatureAttribute(a,c)})};n.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};n.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};n.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};n.prototype.queryRelatedInfos=function(a,c,e){var f=this;this.relatedInfos.clear();var d=b.getSourceLayer(a);if(!d)return g.resolve();var l=c.filter(function(a){return a&&f.isRelatedField(a.fieldName)});if(!l||!l.length)return g.resolve();this._createRelatedInfos(c,
d);return this._queryLayerInfos(d,e).then(function(b){f._updateRelatedInfoLayerInfos(b);return f._queryRelatedFeatureMap(a,e).then(function(a){Object.keys(a).forEach(function(b){f._setRelatedFeatures(a[b],b.toString())});return a})})};n.prototype._addRelatedFeatureAttribute=function(a,b){var c=this;a&&b&&(b.relatedFeatures&&b.relatedFeatures&&b.relatedFeatures.forEach(function(e){return c._addAttributesFromFeature(a,e,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(e){return c._addAttributesFromFeature(a,
e,b)}))};n.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};n.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(c){return b._updateRelatedInfoLayerInfo(a[c],c.toString())})};n.prototype._addAttributesFromFeature=function(a,b,c){var e=this;a&&b&&c&&Object.keys(b.attributes).forEach(function(d){var l=e._relatedFieldInfoToString({layerId:c.relation.id.toString(),fieldName:d});a[l]=b.attributes[d]})};
n.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};n.prototype._createRelatedInfoForFieldInfo=function(a,b){var c=this.getRelatedFieldInfo(a.fieldName);if(c){var f=c.layerId,c=c.fieldName;f&&(b=this.getRelatedInfo(f)||this._createRelatedInfo(f,b))&&(b.relatedFields.push(c),a.statisticType&&(a=new e({statisticType:a.statisticType,onStatisticField:c,outStatisticFieldName:c}),b.outStatistics.push(a)))}};n.prototype._createRelatedInfos=function(a,
b){var c=this;a.forEach(function(a){return c._createRelatedInfoForFieldInfo(a,b)})};n.prototype._queryRelatedFeatureMap=function(a,b){var c=this,e={};this.relatedInfos.forEach(function(d,l){d.layerInfo&&(e[l]=c._queryRelatedLayerFeatures(a,d,b))});return g.eachAlways(e)};n.prototype._queryLayerInfos=function(a,b){var c=this,e={};this.relatedInfos.forEach(function(d,l){d=d.relation;if(!d)throw l=new u("relation-required","A relation is required on a layer to retrieve related records."),h.error(l),
l;d=d.relatedTableId;if("number"!==typeof d)throw l=new u("A related table ID is required on a layer to retrieve related records."),h.error(l),l;d=a.url+"/"+d;var f=r.get(d),g=f?f:c._queryLayerInfo(d,b);f||r.set(d,g);e[l]=g});return g.eachAlways(e)};n.prototype._queryLayerInfo=function(a,b){return p(a,{query:{f:"json"},signal:b&&b.signal})};n.prototype._queryRelatedLayerFeatures=function(a,e,f){var k=b.getSourceLayer(a).layerId.toString(),d=e.layerInfo,l=e.queryTask,q=e.relation;if(k=this._getDestinationRelation(d,
k)){var q=q.keyField,h=k.keyField,k="string"===this._getDestinationFieldType(d,k)?h+"\x3d'"+a.attributes[q]+"'":h+"\x3d"+a.attributes[q];a=l.execute(new c({where:k,outFields:e.relatedFields}),f);e=e.outStatistics&&0<e.outStatistics.length&&d.supportsStatistics?l.execute(new c({where:k,outFields:e.relatedFields,outStatistics:e.outStatistics}),f):null;return g.eachAlways({features:a,statsFeatures:e?e:g.resolve()})}return g.resolve()};n.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var c=
a.value;c&&(a=c.features,c=c.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=c&&c.value,b.relatedStatsFeatures=a?a.features:[])}};n.prototype._getRelation=function(a,b){if(!b.relationships)return null;var c=null;b.relationships.some(function(b){return b.id===parseInt(a,10)?(c=b,!0):!1});return c};n.prototype._createRelatedInfo=function(a,b){var c=this._getRelation(a,b);if(c){var e=b.url+"/"+c.relatedTableId;b=new y({url:e,sourceSpatialReference:b.spatialReference});c={url:e,queryTask:b,
relation:c,relatedFields:[],outStatistics:[]};this.relatedInfos.set(a,c);return c}};n.prototype._getDestinationRelation=function(a,b){var c;a&&a.relationships&&a.relationships.some(function(a){return""+a.relatedTableId===b?(c=a,!0):!1});return c};n.prototype._getDestinationFieldType=function(a,b){var c=void 0;a.fields.some(function(a){return a.name===b.keyField?(c=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",
!0):!1});return c};a.__decorate([t.aliasOf("relatedInfos.size")],n.prototype,"relatedInfoCount",void 0);a.__decorate([t.property()],n.prototype,"relatedInfos",void 0);return n=a.__decorate([t.subclass("esri.widgets.Popup.support.RelatedFeatures")],n)}(m)})},"esri/widgets/support/chartUtils":function(){define("require exports tslib ../../intl ../../core/MapUtils ../../core/promiseUtils ../../core/string @dojo/framework/shim/Promise".split(" "),function(f,v,a,p,m,u,w){function g(a){if(!a)return"en-us";
if(t.has(a.toLowerCase()))return a.toLowerCase();a=a.split("-")[0].toLowerCase();for(var b=null,c=0,e=m.keysOfMap(t);c<e.length;c++){var f=e[c];if(w.startsWith(f,a)){b=f;break}}return b||"en-us"}Object.defineProperty(v,"__esModule",{value:!0});var t=m.MapFromValues([["ar",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/ar"],a,b)})}],["bs-ba",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/bs_BA"],a,b)})}],["ca-es",function(){return new Promise(function(a,
b){f(["../../libs/amcharts4/lang/ca_ES"],a,b)})}],["cs-cz",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/cs_CZ"],a,b)})}],["da-dk",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/da_DK"],a,b)})}],["de-de",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/de_DE"],a,b)})}],["de-ch",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/de_CH"],a,b)})}],["el-gr",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/el_GR"],
a,b)})}],["en-us",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/en_US"],a,b)})}],["en-ca",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/en_CA"],a,b)})}],["es-es",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/es_ES"],a,b)})}],["et-ee",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/et_EE"],a,b)})}],["fi-fi",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/fi_FI"],a,
b)})}],["fr-fr",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/fr_FR"],a,b)})}],["he-il",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/he_IL"],a,b)})}],["hr-hr",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/hr_HR"],a,b)})}],["hu-hu",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/hu_HU"],a,b)})}],["id-id",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/id_ID"],a,b)})}],
["it-it",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/it_IT"],a,b)})}],["ja-jp",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/ja_JP"],a,b)})}],["ko-kr",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/ko_KR"],a,b)})}],["lt-lt",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/lt_LT"],a,b)})}],["lv-lv",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/lv_LV"],a,b)})}],["nb-no",
function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/nb_NO"],a,b)})}],["nl-nl",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/nl_NL"],a,b)})}],["pl-pl",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/pl_PL"],a,b)})}],["pt-br",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/pt_BR"],a,b)})}],["pt-pt",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/pt_PT"],a,b)})}],["ro-ro",function(){return new Promise(function(a,
b){f(["../../libs/amcharts4/lang/ro_RO"],a,b)})}],["ru-ru",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/ru_RU"],a,b)})}],["sl-sl",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/sl_SL"],a,b)})}],["sr-rs",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/sr_RS"],a,b)})}],["sv-se",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/sv_SE"],a,b)})}],["th-th",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/th_TH"],
a,b)})}],["tr-tr",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/tr_TR"],a,b)})}],["uk-ua",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/uk_UA"],a,b)})}],["vi-vn",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/vi_VN"],a,b)})}],["zh-cn",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/zh_Hans"],a,b)})}],["zh-hk",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/zh_Hant"],
a,b)})}],["zh-tw",function(){return new Promise(function(a,b){f(["../../libs/amcharts4/lang/zh_Hant"],a,b)})}]]);v.getChartLocale=g;var y,c;v.loadChartsModule=function(e){void 0===e&&(e=p.getLocale());return a.__awaiter(this,void 0,void 0,function(){var b,m,h,p;return a.__generator(this,function(a){switch(a.label){case 0:e=g(e);if(y&&e===c)return[2,y];y=new Promise(function(a,b){f(["../../libs/amcharts4/index"],a,b)});c=e;a.label=1;case 1:return a.trys.push([1,5,,6]),[4,u.all([y,t.get(c)()])];case 2:return b=
a.sent(),m=b[0],h=b[1],c===e&&(m.am4core.options.defaultLocale=h.default),"function"===typeof Object.assign?[3,4]:[4,new Promise(function(a,b){f(["@dojo/framework/shim/object"],a,b)})];case 3:p=a.sent(),Object.defineProperty(Object,"assign",{value:p.assign,writable:!0,configurable:!0}),a.label=4;case 4:return[3,6];case 5:return a.sent(),c=y=null,[2,null];case 6:return[2,y]}})})}})},"*noref":1}});
define("require exports tslib ../intl ../core/events ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators ./Attachments ./Widget ./Feature/FeatureContent ./Feature/FeatureFields ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./Feature/support/featureUtils ./support/chartUtils ./support/widget ./support/widgetUtils".split(" "),function(f,v,a,p,m,u,w,g,t,y,c,e,b,r,h,C,n,z){var x={title:!0,content:!0,lastEditedInfo:!0};return function(f){function k(d,c){var e=f.call(this,
d,c)||this;e._chartUIds=new Map;e._contentElementCharts=new Map;e._activeMediaMap=new Map;e._refreshTimers=new Map;e._mediaInfo=new Map;e._renderChartThrottled=u.throttle(function(a){return e._renderChart(a)},100);e._contentWidgets=[];e.graphic=null;e.defaultPopupTemplateEnabled=!1;e.label=void 0;e.messages=null;e.messagesURIUtils=null;e.spatialReference=null;e.title=null;e.visibleElements=a.__assign({},x);e.map=null;e.view=null;e.viewModel=new b;return e}a.__extends(k,f);k.prototype.initialize=function(){var a=
this;this.own(w.init(this,"viewModel.content",function(){a._setupMediaRefreshTimers();a._setupContentWidgets()}),w.init(this,"viewModel.graphic",function(){return a._disposeCharts()}))};k.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._destroyContentWidgets();this._disposeCharts()};k.prototype.castVisibleElements=function(b){return a.__assign(a.__assign({},x),b)};k.prototype.render=function(){var a=this.viewModel.waitingForContent;
return n.tsx("div",{class:this.classes("esri-feature","esri-widget")},n.tsx("div",{class:"esri-feature__size-container"},this.renderTitle(),a?this.renderLoading():this.renderContentContainer()))};k.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};k.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};k.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};k.prototype.renderLoading=function(){return n.tsx("div",{key:"loading-container",
class:"esri-feature__loading-container"},n.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};k.prototype.renderContentContainer=function(){return this.visibleElements.content?n.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null};k.prototype.renderTitle=function(){var a=this.title;return this.visibleElements.title?n.tsx("h4",{class:"esri-feature__title",innerHTML:a}):null};k.prototype.renderContent=
function(){var a=this.viewModel.content;return a?Array.isArray(a)?a.length?n.tsx("div",{key:"content-content-elements"},a.map(this.renderContentElement,this)):null:"string"===typeof a?(a=this._contentWidgets[0],!a||a.destroyed?null:n.tsx("div",{key:"content-content"},a.render())):this.renderNodeContent(a):null};k.prototype.renderContentElement=function(a,b){var d=this.visibleElements;if("boolean"!==typeof d.content&&!d.content[a.type])return null;switch(a.type){case "attachments":return this.renderAttachments(b);
case "custom":return this.renderCustom(a,b);case "fields":return this.renderFields(b);case "media":return this.renderMedia(a,b);case "text":return this.renderText(a,b);default:return null}};k.prototype.renderAttachments=function(a){var b=this._contentWidgets[a];if(!b||b.destroyed)return null;var d=b.viewModel,c=d.attachmentInfos;return"loading"===d.state||0<c.length?n.tsx("div",{key:this._buildKey("attachments-element",a),class:this.classes("esri-feature__attachments","esri-feature__content-element")},
n.tsx("h2",null,this.messages.attach),b.render()):null};k.prototype.renderCustom=function(a,b){var d=this._contentWidgets[b];return!d||d.destroyed?null:a.creator?n.tsx("div",{key:this._buildKey("custom-element",b),class:"esri-feature__content-element"},d.render()):null};k.prototype.renderFields=function(a){var b=this._contentWidgets[a];return!b||b.destroyed?null:n.tsx("div",{key:this._buildKey("fields-element",a),class:"esri-feature__content-element"},b.render())};k.prototype.renderMediaInfoType=
function(a){var b=a.mediaInfo,c=a.total,d=a.contentElementIndex;a=a.activeMediaIndex;if(!b)return null;var e=b.title,e=void 0===e?"":e,f=b.altText,f=void 0===f?"":f;if("image"===b.type){var g=b.value,k=b.refreshInterval,m=g.sourceURL,g=g.linkURL,p=h.shouldOpenInNewTab(g)?"_blank":"_self",r="_blank"===p?"noreferrer":"",m=(k=k?this._mediaInfo.get(d):null)?k.sourceURL:m,b=n.tsx("img",{alt:f||e,key:this._buildKey(b.type,c,d,a,k?k.timestamp:0),src:m});return(c=g?n.tsx("a",{title:e,href:g,rel:r,target:p},
b):null)?c:b}if(-1!==b.type.indexOf("chart"))return n.tsx("div",{key:this._buildKey(b.type,c,d,a),bind:this,"data-media-info":b,"data-content-element-index":d,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterRemoved:this._disposeChartByNode})};k.prototype.renderMediaInfo=function(a){var b=a.total,c=a.mediaInfo,d=a.contentElementIndex;a=a.activeMediaIndex;if(!c)return null;var e=c.title?n.tsx("div",{key:this._buildKey("media-title",c.type,b,d),class:"esri-feature__media-item-title",
innerHTML:c.title}):null,f=c.caption?n.tsx("div",{key:this._buildKey("media-caption",c.type,b,d),class:"esri-feature__media-item-caption",innerHTML:c.caption}):null;return n.tsx("div",{key:this._buildKey("media-container",c.type,b,d),class:"esri-feature__media-item-container"},e,f,n.tsx("div",{key:this._buildKey("media-item-container",c.type,b,d),class:"esri-feature__media-item"},this.renderMediaInfoType({total:b,mediaInfo:c,contentElementIndex:d,activeMediaIndex:a})))};k.prototype.renderMediaPageButton=
function(a,b){var c=(a="previous"===a)?this.messages.previous:this.messages.next,d=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),e=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),f=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl",
"esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),l=a?this._previousClick:this._nextClick;return n.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,bind:this,onkeydown:l,onclick:l},n.tsx("span",{"aria-hidden":"true",class:e}),n.tsx("span",{"aria-hidden":"true",class:f}),n.tsx("span",{class:"esri-icon-font-fallback-text"},c))};
k.prototype.renderMedia=function(a,b){var c,d;a=null===(d=a.mediaInfos)||void 0===d?void 0:d.filter(Boolean);d=(null===a||void 0===a?void 0:a.length)||0;var e=(c={},c["esri-feature--media-pagination-visible"]=1<d,c);c=this.renderMediaPageButton("previous",b);var f=this.renderMediaPageButton("next",b),l=this._activeMediaMap.get(b);isNaN(l)&&(this._activeMediaMap.set(b,0),l=0);return d?n.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,
class:this.classes("esri-feature__media","esri-feature__content-element",e)},n.tsx("div",{key:this._buildKey("media-element-container",b),class:"esri-feature__media-container"},c,this.renderMediaInfo({total:d,mediaInfo:a[l],contentElementIndex:b,activeMediaIndex:l}),f)):null};k.prototype.renderLastEditInfo=function(){var a=this.visibleElements,b=this.messages,c=this.viewModel.lastEditInfo;if(!c||!a.lastEditedInfo)return null;a=c.user;b=p.substitute("edit"===c.type?a?b.lastEditedByUser:b.lastEdited:
a?b.lastCreatedByUser:b.lastCreated,{date:c.date,user:a});return n.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};k.prototype.renderText=function(a,b){var c=this._contentWidgets[b];return!c||c.destroyed?null:a.text?n.tsx("div",{key:this._buildKey("text-element",b),class:this.classes("esri-feature__content-element","esri-feature__text")},c.render()):null};k.prototype._buildKey=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-
1]=arguments[c];c=this.get("viewModel.graphic.uid")||"0";b=b.join("-");return a+"__"+c+"-"+b};k.prototype._disposeCharts=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){this._chartUIds.forEach(function(a){return a.dispose()});this._chartUIds.clear();this._contentElementCharts.forEach(function(a){return a.dispose()});this._contentElementCharts.clear();return[2]})})};k.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});
this._refreshTimers.clear()};k.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};k.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};k.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&
(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};k.prototype._destroyContentWidgets=function(){this._contentWidgets.forEach(function(a){return a&&!a.destroyed&&a.destroy()});this._contentWidgets=[]};k.prototype._setupContentWidgets=function(){var a=this;this._destroyContentWidgets();this._activeMediaMap.clear();var b=this.get("viewModel.content"),f=this.viewModel.contentVMs;Array.isArray(b)?b.forEach(function(b,d){"attachments"===b.type&&(a._contentWidgets[d]=
new t({displayType:b.displayType,viewModel:f[d]}));"fields"===b.type&&(a._contentWidgets[d]=new e({viewModel:f[d]}));"text"===b.type&&(a._contentWidgets[d]=new c({viewModel:f[d]}));"custom"===b.type&&(a._contentWidgets[d]=new c({viewModel:f[d]}))},this):(b=f[0])&&!b.destroyed&&(this._contentWidgets[0]=new c({viewModel:b}));this.scheduleRender()};k.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,
c){return a._setupMediaRefreshTimer(c)})};k.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};k.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,e=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(e.sourceURL,a)},b),this._refreshTimers.set(a,b))};k.prototype._getChartDependencies=function(a){var b=
this,c=a["data-media-info"],d=a["data-content-element-index"];this._disposeChartByNode(a);this._disposeChartByContgentElementIndex(d);var e=c.value,f=c.type;C.loadChartsModule().then(function(g){return b._renderChartThrottled({chartDiv:a,mediaInfo:c,contentElementIndex:d,type:f,value:e,chartsModule:g})})};k.prototype._disposeChartByContgentElementIndex=function(a){(a=this._contentElementCharts.get(a))&&a.dispose()};k.prototype._disposeChartByNode=function(a){a=a.getAttribute("data-chart-uid");(a=
this._chartUIds.get(a))&&a.dispose()};k.prototype._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};k.prototype._createPieChart=function(a){var b=a.chartsModule,c=b.am4core,b=b.am4charts;a=c.create(a.chartDiv,b.PieChart);a.rtl=z.isRTL();b=a.series.push(new b.PieSeries);b.labels.template.disabled=!0;b.ticks.template.disabled=!0;b.dataFields.value="y";b.dataFields.category=
"x";this._customizeChartTooltip(b.tooltip,c);return a};k.prototype._getMinSeriesValue=function(a){var b=0;a.forEach(function(a){return b=Math.min(a.x,b)});return b};k.prototype._createXYChart=function(a){var b=a.type,c=a.value,d=a.chartsModule,e=d.am4core,d=d.am4charts;a=e.create(a.chartDiv,d.XYChart);a.rtl=z.isRTL();var f=15<c.series.length;if("column-chart"===b){var g=a.xAxes.push(new d.CategoryAxis);g.dataFields.category="x";g.renderer.labels.template.disabled=!0;this._customizeChartTooltip(g.tooltip,
e);g.tooltip.events.on("sizechanged",function(){g.tooltip.dy=-g.tooltip.contentHeight});var h=a.yAxes.push(new d.ValueAxis),k=h.renderer.labels.template;h.renderer.minLabelPosition=.05;h.renderer.maxLabelPosition=.95;h.min=this._getMinSeriesValue(c.series);this._customizeChartTooltip(h.tooltip,e);k.wrap=!0;h=a.series.push(new d.ColumnSeries);h.dataFields.valueY="y";h.dataFields.categoryX="x";a.cursor=new d.XYCursor;f&&(a.scrollbarX=new e.Scrollbar)}if("bar-chart"===b){var m=a.yAxes.push(new d.CategoryAxis);
m.dataFields.category="x";m.renderer.inversed=!0;m.renderer.labels.template.disabled=!0;this._customizeChartTooltip(m.tooltip,e);m.tooltip.events.on("sizechanged",function(){m.tooltip.dx=m.tooltip.contentWidth});h=a.xAxes.push(new d.ValueAxis);k=h.renderer.labels.template;h.renderer.minLabelPosition=.05;h.renderer.maxLabelPosition=.95;h.min=this._getMinSeriesValue(c.series);this._customizeChartTooltip(h.tooltip,e);k.wrap=!0;h=a.series.push(new d.ColumnSeries);h.dataFields.valueX="y";h.dataFields.categoryY=
"x";a.cursor=new d.XYCursor;f&&(a.scrollbarY=new e.Scrollbar)}if("line-chart"===b){var n=a.xAxes.push(new d.CategoryAxis);n.dataFields.category="x";n.renderer.labels.template.disabled=!0;this._customizeChartTooltip(n.tooltip,e);n.tooltip.events.on("sizechanged",function(){n.tooltip.dy=-n.tooltip.contentHeight});h=a.yAxes.push(new d.ValueAxis);k=h.renderer.labels.template;h.renderer.minLabelPosition=.05;h.renderer.maxLabelPosition=.95;h.min=this._getMinSeriesValue(c.series);this._customizeChartTooltip(h.tooltip,
e);k.wrap=!0;h=a.series.push(new d.LineSeries);h.dataFields.categoryX="x";h.dataFields.valueY="y";a.cursor=new d.XYCursor;f&&(a.scrollbarX=new e.Scrollbar)}return a};k.prototype._renderChart=function(a){var b=a.type,c=a.mediaInfo,d=a.contentElementIndex,e=a.value,f=a.chartsModule,g=a.chartDiv;f.am4core.useTheme(f.am4themes_animated);a="pie-chart"===b?this._createPieChart(a):this._createXYChart(a);this._chartUIds.set(a.uid,a);this._contentElementCharts.set(d,a);g.setAttribute("data-chart-uid",a.uid);
g.setAttribute("aria-label",c.altText||c.title);a.data=e.series.map(function(a){return{x:a.tooltip,y:a.y}})};k.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=m.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previousMedia(b));"ArrowRight"===c&&(a.stopPropagation(),this.nextMedia(b))};k.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,
(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};k.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};k.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};k.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};a.__decorate([g.aliasOf("viewModel.graphic")],k.prototype,"graphic",void 0);a.__decorate([g.aliasOf("viewModel.defaultPopupTemplateEnabled")],
k.prototype,"defaultPopupTemplateEnabled",void 0);a.__decorate([g.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],k.prototype,"label",void 0);a.__decorate([g.property(),n.renderable(),n.messageBundle("esri/widgets/Feature/t9n/Feature")],k.prototype,"messages",void 0);a.__decorate([g.property(),n.renderable(),n.messageBundle("esri/widgets/support/t9n/uriUtils")],k.prototype,"messagesURIUtils",void 0);a.__decorate([g.aliasOf("viewModel.spatialReference")],k.prototype,"spatialReference",
void 0);a.__decorate([g.aliasOf("viewModel.title")],k.prototype,"title",void 0);a.__decorate([g.property(),n.renderable()],k.prototype,"visibleElements",void 0);a.__decorate([g.cast("visibleElements")],k.prototype,"castVisibleElements",null);a.__decorate([g.aliasOf("viewModel.map")],k.prototype,"map",void 0);a.__decorate([g.aliasOf("viewModel.view")],k.prototype,"view",void 0);a.__decorate([g.property({type:b}),n.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo",
"viewModel.contentVMs"])],k.prototype,"viewModel",void 0);a.__decorate([n.accessibleHandler()],k.prototype,"_previousClick",null);a.__decorate([n.accessibleHandler()],k.prototype,"_nextClick",null);return k=a.__decorate([g.subclass("esri.widgets.Feature")],k)}(r.FeatureContentMixin(y))});