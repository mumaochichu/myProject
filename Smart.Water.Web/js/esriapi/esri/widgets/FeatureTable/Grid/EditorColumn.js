// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","tslib","../../../core/accessorSupport/decorators","./Column"],function(q,r,d,g,p){return function(k){function c(b){var a=k.call(this,b)||this;a.activeEditInfo=null;a.cellValueValidatorFunction=function(a){return a.oldValue!==a.value};a.editable=!1;a.inputRenderFunction=function(h){var b=h.root,f=h.column;h=h.rowData;var e;if((null===(e=a.activeEditInfo)||void 0===e||!e.updating)&&a.editable){var c=a.getCellValue(f,h);e=a.createInputElement({root:b,column:f,rowData:h,value:c});
a._set("activeEditInfo",{column:f,input:e,root:b,rowData:h,updating:!0,oldValue:c});f=a.createInputContainer();f.appendChild(e);a.removeCellContent(b);b.appendChild(f);e.focus();e instanceof HTMLInputElement&&e.select()}};a.loadingMessage="";a.inputType="text";a.maxLength=null;a.parseInputValueFunction=function(a){return a.input.value};a.renderFunction=function(h){var b,f=h.root,e=h.column,c=h.rowData,d=a.activeEditInfo;d&&d.updating||(d=a.getCellValue(e,c),e=a.cellValueFormatFunction({column:e,rowData:c,
value:d}),f.onclick=function(){return f.focus()},f.ondblclick=function(){return a.inputRenderFunction(h)},f.ontouchend=function(){return a.inputRenderFunction(h)},(null===e||void 0===e?void 0:e.toString())!==f.innerHTML&&(f.innerHTML=e,e=null===(b=a.grid)||void 0===b?void 0:b.getSlotElementByName(f.slot),(b=null===e||void 0===e?void 0:e.parentElement)&&!b.onkeydown&&(b.onkeydown=function(b){"Enter"!==b.key||a.activeEditInfo||a.inputRenderFunction(h)})))};a.required=!1;a.store=null;a.updateRowItemFunction=
function(a){a.rowData.item[a.column.path]=a.value};a.updateStoreItemFunction=function(b){var c=b.rowData,h=b.column;b=b.value;var e;return null===(e=a.store)||void 0===e?void 0:e.updateItem({index:c.index,name:h.path,value:b})};return a}d.__extends(c,k);c.prototype.cancel=function(){var b=this.activeEditInfo;if(b){var a=b.root,b=this.cellValueFormatFunction({column:b.column,rowData:b.rowData,value:b.oldValue});a.innerHTML=b;this._set("activeEditInfo",null)}};c.prototype.createInputContainer=function(){var b=
document.createElement("div");b.classList.add("esri-editor-column__cell-input--container");return b};c.prototype.createInputElement=function(b){var a=this;b=b.value;var c=document.createElement("input");c.classList.add("esri-editor-column__cell-input");c.maxLength=this.maxLength;c.type=this.inputType;c.value=b;c.onblur=function(){c.onblur=null;a.submit()};return c};c.prototype.submit=function(){return d.__awaiter(this,void 0,void 0,function(){var b,a,c,g,f,e,l,k,m,n;return d.__generator(this,function(d){switch(d.label){case 0:b=
this.activeEditInfo;if(!b)return[2];a=b.column;c=b.input;g=b.root;f=b.rowData;e=b.oldValue;l=this.parseInputValueFunction({input:c,column:a,rowData:f});if(k=!this.cellValueValidatorFunction({value:l,oldValue:e,column:a,rowData:f}))return this.cancel(),[2];g.innerHTML=this.loadingMessage;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.updateStoreItemFunction({rowData:f,column:a,value:l})];case 2:return d.sent(),this.updateRowItemFunction({rowData:f,column:a,value:l}),m=this.getCellValue(a,f),
n=this.cellValueFormatFunction({column:a,rowData:f,value:m}),g.innerHTML=n,this.emit("value-change",{column:a,rowData:f,value:m}),this._set("activeEditInfo",null),[3,4];case 3:return d.sent(),console.log("update rejected..."),this.cancel(),[3,4];case 4:return[2]}})})};d.__decorate([g.property({readOnly:!0})],c.prototype,"activeEditInfo",void 0);d.__decorate([g.property()],c.prototype,"cellValueValidatorFunction",void 0);d.__decorate([g.property()],c.prototype,"editable",void 0);d.__decorate([g.property()],
c.prototype,"inputRenderFunction",void 0);d.__decorate([g.property({constructOnly:!0})],c.prototype,"loadingMessage",void 0);d.__decorate([g.property()],c.prototype,"inputType",void 0);d.__decorate([g.property()],c.prototype,"maxLength",void 0);d.__decorate([g.property()],c.prototype,"parseInputValueFunction",void 0);d.__decorate([g.property()],c.prototype,"renderFunction",void 0);d.__decorate([g.property()],c.prototype,"required",void 0);d.__decorate([g.property()],c.prototype,"store",void 0);d.__decorate([g.property()],
c.prototype,"updateRowItemFunction",void 0);d.__decorate([g.property()],c.prototype,"updateStoreItemFunction",void 0);return c=d.__decorate([g.subclass("esri.widgets.FeatureTable.EditorColumn")],c)}(p)});