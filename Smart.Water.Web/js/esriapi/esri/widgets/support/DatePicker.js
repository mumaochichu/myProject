// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../intl ../../core/events ../../core/accessorSupport/decorators ../../intl/moment ../Widget ./DatePickerViewModel ./Popover ./widget".split(" "),function(z,A,f,g,m,h,v,w,n,x,d){var p={year:"numeric",month:"2-digit",day:"2-digit"},y=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),q="onfocusout"in HTMLElement.prototype;return function(r){function a(b,a){var c=r.call(this,b,a)||this;c._activeDate=null;c._calendarNode=null;c._calendarPopover=
new x({owner:c,placement:"bottom-start",anchorElement:function(){return c._rootNode},renderContentFunction:c._renderCalendar});c._closedByUserAction=!1;c._isOpen=!1;c._rootNode=null;c.label=void 0;c.messages=null;c.value=null;c.commitOnMonthChange=!1;c.viewModel=new n;c._handleDatePickerBlur=q?null:c._handleDatePickerBlurOrFocusOut;c._handleDatePickerFocusOut=q?c._handleDatePickerBlurOrFocusOut:null;return c}f.__extends(a,r);a.prototype.loadLocale=function(){return f.__awaiter(this,void 0,void 0,
function(){var b;return f.__generator(this,function(a){switch(a.label){case 0:return b=this,[4,v.loadMoment()];case 1:return b._moment=a.sent(),this._isOpen&&(this._activeDate=this._moment(this._activeDate.toDate())),[2]}})})};a.prototype.destroy=function(){this._calendarPopover.destroy()};a.prototype.render=function(){var b,a=g.formatDate(this.viewModel.value,p),c=this._isOpen,l=(b={},b["esri-icon-down-arrow"]=!c,b["esri-icon-up-arrow"]=c,b);return d.tsx("div",{afterCreate:d.storeNode,bind:this,
class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},d.tsx("div",{afterUpdate:this._focusSelectedOrClosed,"aria-pressed":c.toString(),bind:this,class:this.classes("esri-widget--button","esri-date-picker__calendar-toggle"),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0},d.tsx("span",{class:"esri-date-picker__date"},a),d.tsx("span",{"aria-hidden":"true",class:this.classes(l)})))};a.prototype._focusSelectedOrClosed=function(b){this._closedByUserAction&&
(this._closedByUserAction=!1,b.focus())};a.prototype._handleDatePickerKeydown=function(b){"Escape"===m.eventKey(b)&&(this._closedByUserAction=!0,this._close(),b.preventDefault(),b.stopPropagation())};a.prototype._renderCalendar=function(){var b=this._activeDate,a=this._moment(this.viewModel.value);return d.tsx("div",{afterCreate:d.storeNode,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},
this._renderMonthPicker(b),this._renderDayPicker(b,a),this._renderYearPicker(b))};a.prototype._handleDatePickerBlurOrFocusOut=function(b){b.currentTarget===b.target&&(b=b.relatedTarget,this._calendarNode.contains(b)||this._rootNode.contains(b)||this._close())};a.prototype._renderMonthPicker=function(b){var a=d.isRTL(),c=a?"esri-icon-right":"esri-icon-left",a=a?"esri-icon-left":"esri-icon-right",l=this._moment.months().map(function(a,c){c=b.month()===c;return d.tsx("option",{selected:c},a)}),e=this.messages;
return d.tsx("div",{class:"esri-date-picker__month-picker"},d.tsx("div",{"aria-label":e.goToPreviousMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setPreviousMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousMonth,role:"button",tabIndex:0,title:e.goToPreviousMonth},d.tsx("span",{"aria-hidden":"true",class:c})),d.tsx("select",{"aria-live":"assertive",bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),
id:this.id+"__month-picker",onblur:this._handleDatePickerBlur,onchange:this._setMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setMonth},l),d.tsx("div",{"aria-label":e.goToNextMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setNextMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:e.goToNextMonth},d.tsx("span",{"aria-hidden":"true",class:a})))};a.prototype._renderDayPicker=function(b,
a){var c=this,l=b.clone().day(this._moment.localeData().firstDayOfWeek()),l=this._getWeekLabels(l),e=this._getDayId(b);b=this._renderMonth(b,a);return d.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":e,"aria-labelledby":this.id+"__month-picker "+this.id+"__selected-year",bind:this,class:"esri-date-picker__day-picker",id:this.id+"__day-picker",onblur:this._handleDatePickerBlur,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},
d.tsx("div",{class:"esri-date-picker__week-item",role:"row"},l.map(function(b){return d.tsx("div",{"aria-label":b.name,class:c.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:b.name},b.abbr)})),b)};a.prototype._getDayId=function(b){return this.id+"__"+g.formatDate(b.valueOf(),p)};a.prototype._handleDayPickerCreate=function(b){b.focus()};a.prototype._getWeekLabels=function(b){for(var a=[],c={weekday:"long"},d={weekday:"narrow"},e=0;7>e;e++)a.push({name:g.formatDate(b.valueOf(),
c),abbr:g.formatDate(b.valueOf(),d)}),b.add(1,"day");return a};a.prototype._handleDayPickerKeydown=function(b){var a=b.ctrlKey,c=b.shiftKey,d=m.eventKey(b),e=this._activeDate;if(-1!==y.indexOf(d)){if("ArrowLeft"===d)e.subtract(1,"day");else if("ArrowRight"===d)e.add(1,"day");else if("ArrowUp"===d)e.subtract(1,"week");else if("ArrowDown"===d)e.add(1,"week");else if("PageUp"===d)e.subtract(1,c?"year":"month");else if("PageDown"===d)e.add(1,c?"year":"month");else if("Home"===d)e.startOf(a?"year":"month");
else if("End"===d)e.endOf(a?"year":"month");else if("Enter"===d||" "===d)this.viewModel.value=e.toDate(),this._closedByUserAction=!0,this._close();b.preventDefault();b.stopPropagation()}};a.prototype._renderMonth=function(b,a){for(var c,f=this._moment(),e=b.clone().startOf("month"),g=b.clone().endOf("month"),k=e.clone().subtract(e.weekday(),"day"),h=[],u=0;6>u;u++){for(var m=[],n=0;7>n;n++){var p=k.date(),q=k.isSame(b,"day"),t=k.isSame(a,"day"),r=this._getDayId(k),t=(c={},c["esri-date-picker__day-item--nearby-month"]=
!k.isBetween(e,g,null,"[]"),c["esri-date-picker__day-item--today"]=k.isSame(f,"day"),c["esri-date-picker__day-item--active"]=q,c["esri-date-picker__day-item--selected"]=t,c);m.push(d.tsx("div",{"aria-label":p.toString(),"aria-selected":q.toString(),bind:this,class:this.classes("esri-date-picker__day-item",t),"data-iso-date":k.toISOString(),id:r,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},p));k.add(1,"day")}h.push(d.tsx("div",{class:"esri-date-picker__week-item",
role:"row"},m))}return h};a.prototype._renderYearPicker=function(b){var a={year:"numeric"},c=b.clone();b=g.formatDate(c.valueOf(),a);var f=g.formatDate(c.add(1,"year").valueOf(),a),a=g.formatDate(c.subtract(2,"year").valueOf(),a),c=this.messages;return d.tsx("div",{class:"esri-date-picker__year-picker"},d.tsx("div",{"aria-label":c.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setPreviousYear,onfocusout:this._handleDatePickerFocusOut,
onkeydown:this._setPreviousYear,tabIndex:0,title:c.goToPreviousYear},a),d.tsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:this.id+"__selected-year"},b),d.tsx("div",{"aria-label":c.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setNextYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextYear,tabIndex:0,title:c.goToNextYear},f))};a.prototype._toggle=
function(){this._isOpen?this._close():this._open(this.viewModel.value)};a.prototype._setMonth=function(a){this._activeDate.month(a.target.value);this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};a.prototype._close=function(){this._activeDate=null;this._isOpen=!1;this._calendarPopover.open=!1};a.prototype._open=function(a){this._activeDate=this._moment(a);this._isOpen=!0;this._calendarPopover.open=!0};a.prototype._setPreviousMonth=function(){this._activeDate.subtract(1,"month");
this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};a.prototype._setNextMonth=function(){this._activeDate.add(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};a.prototype._setPreviousYear=function(){this._activeDate.subtract(1,"year")};a.prototype._setNextYear=function(){this._activeDate.add(1,"year")};a.prototype._handleSelectedDate=function(a){this.viewModel.value=this._moment(a.target.getAttribute("data-iso-date")).toDate();this._closedByUserAction=
!0;this._close()};f.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);f.__decorate([h.property(),d.renderable(),d.messageBundle("esri/widgets/support/t9n/DatePicker")],a.prototype,"messages",void 0);f.__decorate([h.aliasOf("viewModel.value")],a.prototype,"value",void 0);f.__decorate([h.property()],a.prototype,"commitOnMonthChange",void 0);f.__decorate([h.property({type:n}),d.renderable("viewModel.value")],a.prototype,"viewModel",void 0);
f.__decorate([d.accessibleHandler()],a.prototype,"_toggle",null);f.__decorate([d.accessibleHandler()],a.prototype,"_setPreviousMonth",null);f.__decorate([d.accessibleHandler()],a.prototype,"_setNextMonth",null);f.__decorate([d.accessibleHandler()],a.prototype,"_setPreviousYear",null);f.__decorate([d.accessibleHandler()],a.prototype,"_setNextYear",null);f.__decorate([d.accessibleHandler()],a.prototype,"_handleSelectedDate",null);return a=f.__decorate([h.subclass("esri.widgets.support.DatePicker")],
a)}(w)});