// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../Color","../cim/utils"],function(u,g,k,f){function p(a){var b=f.toCIMSymbolJSON(a);if("CIMTextSymbol"===b.type)return b.height;a=0;if(b.symbolLayers)for(var d=0,b=b.symbolLayers;d<b.length;d++){var c=b[d];f.isCIMMarker(c)&&c.size>a?a=c.size:f.isCIMStroke(c)&&c.width>a?a=c.width:f.isCIMFill(c)}return a}function l(a,b,d){if("CIMTextSymbol"===a.type)a.height*=b;else{if(d&&a.effects){d=0;for(var c=a.effects;d<c.length;d++)q(c[d],b)}if(a.symbolLayers)for(d=0,a=a.symbolLayers;d<
a.length;d++)switch(c=a[d],c.type){case "CIMPictureMarker":case "CIMVectorMarker":c.markerPlacement&&r(c.markerPlacement,b);c.offsetX*=b;c.offsetY*=b;c.anchorPoint&&"Absolute"===c.anchorPointUnits&&(c.anchorPoint={x:c.anchorPoint.x*b,y:c.anchorPoint.y*b});c.size*=b;if("CIMVectorMarker"===c.type&&c.markerGraphics)for(var e=0,f=c.markerGraphics;e<f.length;e++){var h=f[e];c.scaleSymbolsProportionally||l(h.symbol,b,!0)}break;case "CIMPictureStroke":case "CIMSolidStroke":c.width*=b;break;case "CIMPictureFill":c.height*=
b;c.offsetX*=b;c.offsetY*=b;break;case "CIMHatchFill":l(c.lineSymbol,b,!0),c.offsetX*=b,c.offsetY*=b,c.separation*=b}}}function r(a,b){f.isCIMMarkerStrokePlacement(a)&&(a.offset*=b);switch(a.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":a.customEndingOffset*=b;a.offsetAlongLine*=b;if(a.placementTemplate&&a.placementTemplate.length){var d=a.placementTemplate.map(function(a){return a*b});a.placementTemplate=d}break;case "CIMMarkerPlacementAlongLineVariableSize":a.maxRandomOffset*=
b;a.placementTemplate&&a.placementTemplate.length&&(d=a.placementTemplate.map(function(a){return a*b}),a.placementTemplate=d);break;case "CIMMarkerPlacementOnLine":a.startPointOffset*=b;break;case "CIMMarkerPlacementAtExtremities":a.offsetAlongLine*=b;break;case "CIMMarkerPlacementAtRatioPositions":a.beginPosition*=b;a.endPosition*=b;break;case "CIMMarkerPlacementPolygonCenter":a.offsetX*=b;a.offsetY*=b;break;case "CIMMarkerPlacementInsidePolygon":a.offsetX*=b,a.offsetY*=b,a.stepX*=b,a.stepY*=b}}
function q(a,b){switch(a.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":a.width*=b;break;case "CIMGeometricEffectBuffer":a.size*=b;break;case "CIMGeometricEffectCut":a.beginCut*=b;a.endCut*=b;a.middleCut*=b;break;case "CIMGeometricEffectDashes":a.customEndingOffset*=b;a.offsetAlongLine*=b;if(a.dashTemplate&&a.dashTemplate.length){var d=a.dashTemplate.map(function(a){return a*b});a.dashTemplate=d}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":a.length*=
b;break;case "CIMGeometricEffectMove":a.offsetX*=b;a.offsetY*=b;break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":a.offset*=b;break;case "CIMGeometricEffectRegularPolygon":a.radius*=b;break;case "CIMGeometricEffectTaperedPolygon":a.fromWidth*=b;a.length*=b;a.toWidth*=b;break;case "CIMGeometricEffectWave":a.amplitude*=b,a.period*=b}}function m(a,b){var d;d="CIMTextSymbol"===a.type?a.symbol:a;a="CIMPolygonSymbol"===a.type;if(d.symbolLayers){var c=0;for(d=d.symbolLayers;c<
d.length;c++){var e=d[c];if(!(e.colorLocked||a&&(f.isCIMStroke(e)||f.isCIMMarker(e)&&e.markerPlacement&&f.isCIMMarkerStrokePlacement(e.markerPlacement))))switch(e.type){case "CIMVectorMarker":e.markerGraphics.forEach(function(a){m(a.symbol,b)});break;case "CIMSolidStroke":case "CIMSolidFill":t(b,e.color);break;case "CIMHatchFill":m(e.lineSymbol,b)}}}}function t(a,b){for(var d=0;d<a.length;d++)if(a[d].join(".")===b.join("."))return;a.push(b)}function n(a,b){var d;d="CIMTextSymbol"===a.type?a.symbol:
a;a="CIMPolygonSymbol"===a.type?!0:!1;if(d.symbolLayers){var c=0;for(d=d.symbolLayers;c<d.length;c++){var e=d[c];if(!(e.colorLocked||a&&(f.isCIMStroke(e)||f.isCIMMarker(e)&&e.markerPlacement&&f.isCIMMarkerStrokePlacement(e.markerPlacement)))){var g=b.toArray(0);switch(e.type){case "CIMVectorMarker":e.markerGraphics.forEach(function(a){n(a.symbol,b)});break;case "CIMSolidStroke":case "CIMSolidFill":e.color=g;break;case "CIMHatchFill":n(e.lineSymbol,b)}}}}}Object.defineProperty(g,"__esModule",{value:!0});
g.getCIMSymbolSize=p;g.scaleCIMSymbolTo=function(a,b){var d=f.toCIMSymbolJSON(a);a=p(a);if(0===a)if("CIMTextSymbol"===d.type)d.height=b;else{if(d.symbolLayers)for(a=0,d=d.symbolLayers;a<d.length;a++){var c=d[a];switch(c.type){case "CIMPictureMarker":case "CIMVectorMarker":c.size=b;break;case "CIMPictureStroke":case "CIMSolidStroke":c.width=b}}}else l(d,b/a,!1)};g.getCIMSymbolColor=function(a){a=f.toCIMSymbolJSON(a);var b=[];m(a,b);return b.length?new k(f.fromCIMColor(b[0])):null};g.applyCIMSymbolColor=
function(a,b){b instanceof k||(b=new k(b));a=f.toCIMSymbolJSON(a);n(a,b)};g.getCIMSymbolRotation=function(a){a=f.toCIMSymbolJSON(a);return"CIMTextSymbol"===a.type||"CIMPointSymbol"===a.type?a.angle||0:0};g.applyCIMSymbolRotation=function(a,b){a=f.toCIMSymbolJSON(a);if("CIMTextSymbol"===a.type)a.angle=b;else if("CIMPointSymbol"===a.type&&a.symbolLayers)for(var d=b-(a.angle||0),c=0,e=a.symbolLayers;c<e.length;c++){var g=e[c];if(f.isCIMMarker(g)){var h=g.rotation||0,h=g.rotateClockwise?h-d:h+d;g.rotation=
h}a.angle=b}}});