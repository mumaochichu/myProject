// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../symbols ../../core/arrayUtils ../../core/devEnvironmentUtils ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../portal/Portal ../../portal/PortalQueryParams ../../support/featureFlags ../../support/persistableUrlUtils ./jsonUtils ./StyleOrigin ./Thumbnail".split(" "),function(P,h,C,D,E,F,q,m,r,c,G,H,I,u,v,w,x){function J(a,b){return t(a,b).then(function(b){return{data:b.data,baseUrl:c.removeFile(a),styleUrl:a}})}function K(a,b,d){b=
b.portal||G.getDefault();var e,k=b.url+" - "+(b.user&&b.user.username)+" - "+a;l[k]||(l[k]=L(a,b,d).then(function(a){e=a;return a.fetchData()}).then(function(b){return{data:b,baseUrl:e.itemUrl,styleName:a}}));return l[k]}function L(a,b,d){return b.load(d).then(function(){var e=new H({disableExtraQuery:!0,query:"owner:"+n+" AND type:"+y+' AND typekeywords:"'+a+'"'});return b.queryItems(e,d)}).then(function(b){b=b.results;var e=null,f=a.toLowerCase();if(b&&Array.isArray(b))for(var c=0;c<b.length;c++){var g=
b[c];if(g.typeKeywords.some(function(a){return a.toLowerCase()===f})&&g.type===y&&g.owner===n){e=g;break}}if(!e)throw new m("symbolstyleutils:style-not-found","The style '"+a+"' could not be found",{styleName:a});return e.load(d)})}function z(a,b,d){return a.styleUrl?J(a.styleUrl,d):a.styleName?K(a.styleName,b,d):r.reject(new m("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function A(a,b,d,e,k){var f=a.data,h={portal:d.portal,url:c.urlToObject(a.baseUrl),
origin:"portal-item"},f=F.find(f.items,function(a){return a.name===b});if(!f)return r.reject(new m("symbolstyleutils:symbol-name-not-found","The symbol name '"+b+"' could not be found",{symbolName:b}));var g=u.fromJSON(M(f,e),h),p=f.thumbnail&&f.thumbnail.href,l=f.thumbnail&&f.thumbnail.imageData;q.isDevEnvironment()&&(g=q.adjustStaticAGOUrl(g),p=q.adjustStaticAGOUrl(p));var n={portal:d.portal,url:c.urlToObject(c.removeFile(g)),origin:"portal-item"};return t(g,k).then(function(c){c="cimRef"===e?B(c.data):
c.data;if((c=v.fromJSON(c,n))&&E.isSymbol3D(c)){if(p){var k=u.fromJSON(p,h);c.thumbnail=new x.default({url:k})}else l&&(c.thumbnail=new x.default({url:"data:image/png;base64,"+l}));a.styleUrl?c.styleOrigin=new w({portal:d.portal,styleUrl:a.styleUrl,name:b}):a.styleName&&(c.styleOrigin=new w({portal:d.portal,styleName:a.styleName,name:b}))}return c})}function B(a){return null===a||"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a}}function M(a,b){if("cimRef"===b)return a.cimRef;if(a.formatInfos&&
!I.enableWebStyleForceWOSR()){b=0;for(var d=a.formatInfos;b<d.length;b++){var c=d[b];if("gltf"===c.type)return c.href}}return a.webRef}function N(a,b,d){var e=O.replace(/\{SymbolName\}/gi,a.name);return t(e,d).then(function(a){a=B(a.data);return v.fromJSON(a,{portal:b.portal,url:c.urlToObject(c.removeFile(e)),origin:"portal-item"})})}function t(a,b){b=C.__assign({responseType:"json",query:{f:"json"}},b);return D(c.normalize(a),b)}Object.defineProperty(h,"__esModule",{value:!0});var l={};h.fetchStyle=
z;h.resolveWebStyleSymbol=function(a,b,c,e){return a.name?a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName?N(a,b,e):z(a,b,e).then(function(d){return A(d,a.name,b,c,e)}):r.reject(new m("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};h.fetchSymbolFromStyle=A;h.styleNameFromItem=function(a){var b=0;for(a=a.typeKeywords;b<a.length;b++){var c=a[b];if(/^Esri.*Style$/.test(c)&&"Esri Style"!==c)return c}};var n="esri_en",y="Style",O="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f\x3djson"});