// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/maybe ../../layers/support/fieldUtils ./support/utils ../support/utils".split(" "),function(B,C,d,e,y,p,q,h){function z(b){return d.__awaiter(this,void 0,void 0,function(){var f,r,g,c,a,t,l,m,u,k,v,w,x;return d.__generator(this,function(n){switch(n.label){case 0:if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))throw new e("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(b.valueExpression&&!b.sqlExpression&&!b.view)throw new e("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");f=[0,2,1,3,4];r=b.layer;g=d.__rest(b,["layer"]);c=h.createLayerAdapter(r,f);a=d.__assign({layerAdapter:c},g);a.normalizationType=h.getNormalizationType(a);if(!c)throw new e("summary-statistics:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(f).join(", "));t=y.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(t)];
case 1:return n.sent(),l=a.field,m=a.normalizationType,u=a.valueExpression||a.sqlExpression,k=l?c.getField(l):null,[4,h.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:v=n.sent();if(w=q.verifyBasicFieldValidity(c,v,"summary-statistics:invalid-parameters"))throw w;if(k){if(x=q.verifyFieldType(c,k,"summary-statistics:invalid-parameters",A))throw x;if(p.isDateField(k)&&m)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed for date fields");
}else if(u&&m)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");return[2,a]}})})}var A=d.__spreadArrays(p.numericTypes,["date"]);return function(b){return d.__awaiter(this,void 0,void 0,function(){var f,e,g;return d.__generator(this,function(c){switch(c.label){case 0:return[4,z(b)];case 1:return f=c.sent(),e=f.layerAdapter,g=d.__rest(f,["layerAdapter"]),[2,e.summaryStatistics(g)]}})})}});