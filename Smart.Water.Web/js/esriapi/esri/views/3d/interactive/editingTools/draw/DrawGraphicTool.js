// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../Graphic ../../../../../core/compilerUtils ../../../../../core/Evented ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../../layers/GraphicsLayer ../../../../../support/elevationInfoUtils ../settings ./DrawOperation ./drawSurfaces ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement ../../../../draw/support/createUtils ../../../../interactive/InteractiveToolBase".split(" "),function(h,m,f,
n,t,u,d,c,v,w,l,x,y,z,p,g,A){function B(d){switch(d){case "point":case "polyline":case "polygon":return d;case "circle":case "rectangle":return"segment";default:return t.neverReached(d),null}}Object.defineProperty(m,"__esModule",{value:!0});h=function(h){function b(a){a=h.call(this,a)||this;a.drawOperation=null;a._createGraphic=null;a._outlineVisualElement=null;a._verticesVisualElement=null;a._stagedVerticesVisualElement=null;a.hasZ=!0;a.defaultZ=0;a.elevationInfo=null;a.snapToScene=!1;a.mode="hybrid";
a.geometryType=null;a.type="draw-3d";return a}f.__extends(b,h);b.prototype.initialize=function(){var a=this,b=d.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new v({elevationInfo:b});this.view.map.layers.add(this._internalGraphicsLayer);this.drawOperation=new x.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:B(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snappingEnabled:this.snapToScene,
snappingDrawSurface:new y.SceneDrawSurface(this.view,b,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:b});this.drawOperation.on("vertex-add",function(b){return a.onVertexAdd(b)});this.drawOperation.on("vertex-remove",function(b){return a.onVertexRemove(b)});this.drawOperation.on("vertex-update",function(b){return a.onVertexUpdate(b)});this.drawOperation.on("cursor-update",function(b){return a.onCursorUpdate(b)});this.drawOperation.on("complete",function(b){return a.onComplete(b)})};b.prototype.destroy=
function(){this.drawOperation.destroy();this.drawOperation=null;this._destroyAllVisualisations();this.view.map.remove(this._internalGraphicsLayer);this._set("view",null)};b.prototype.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};b.prototype._getCreateGeometry=function(a,b){void 0===b&&(b=!1);if(null==this.drawOperation)return null;var e=d.isSome(a)?a:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null;a=this.drawOperation.vertices;if(0===a.length)return null;var f=
this.drawOperation.spatialReference,c=a.slice(),k=[];d.isSome(e)&&(c.splice(e,1),k.push(a[e]));var e={regularVertices:null,stagedVertices:null,full:null,outline:null},h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case "point":e.regularVertices=c;e.stagedVertices=k;e.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case "polyline":e.regularVertices=c;e.stagedVertices=k;1<a.length&&(e.full=g.createPolyline([a],f,h));break;case "polygon":e.regularVertices=
c;e.stagedVertices=k;2<a.length&&(e.full=g.createPolygon([a],f,h,!0));break;case "circle":0<a.length&&(c=g.createViewAlignedCoordinateSystem(this.view,a[0]),1===a.length&&b?(b=a[0],k=c.makeMapPoint(b[0]+r*this.view.resolution,b[1]),e.full=g.createCircle([b,k],c,!0)):2===a.length&&(e.full=this.forceUniformSize?g.createCircle(a,c,this.centered):g.createEllipse(a,c,this.centered)));break;case "rectangle":0<a.length&&(c=g.createViewAlignedCoordinateSystem(this.view,a[0]),1===a.length&&b?(b=a[0],k=c.makeMapPoint(b[0]+
r*this.view.resolution,b[1]),e.full=g.createSquare([b,k],c,!0)):2===a.length&&(e.full=this.forceUniformSize?g.createSquare(a,c,this.centered):g.createRectangle(a,c,this.centered)));break;default:return null}switch(this.geometryType){case "polyline":1<a.length&&(e.outline=g.createPolyline([a],f,h));break;case "polygon":if(1<a.length){var q=[a[a.length-1]];a.forEach(function(a){q.push(a)});e.outline=g.createPolyline([q],f,h)}break;case "circle":case "rectangle":d.isSome(e.full)&&"polygon"===e.full.type&&
(e.outline=g.createPolyline(e.full.rings,f,h))}return e};b.prototype._destroyAllVisualisations=function(){this._destroyCreateGraphic();this._destroyOutlineVisualElement();this._destroyVerticesVisualElement();this._destroyStagedVerticesVisualElement()};b.prototype._destroyCreateGraphic=function(){d.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)};b.prototype._destroyOutlineVisualElement=function(){d.isSome(this._outlineVisualElement)&&
(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)};b.prototype._destroyVerticesVisualElement=function(){d.isSome(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)};b.prototype._destroyStagedVerticesVisualElement=function(){d.isSome(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)};b.prototype._updateCreateGraphic=function(a){void 0===a&&(a=null);a=this._getCreateGeometry(a);
if(d.isNone(a))this._destroyAllVisualisations();else{var b=this._internalGraphicsLayer.elevationInfo,c="on-the-ground"===w.getEffectiveElevationMode(this.hasZ,b);d.isSome(a.outline)?d.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new z.OutlineVisualElement({view:this.view,geometry:a.outline,elevationInfo:d.unwrap(b),isDraped:c,attached:!1}),l.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),l.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),
this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=a.outline:this._destroyOutlineVisualElement();d.isSome(a.regularVertices)?d.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new p.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a.regularVertices,elevationInfo:d.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=
a.regularVertices:this._destroyVerticesVisualElement();d.isSome(a.stagedVertices)?d.isNone(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new p.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a.stagedVertices,elevationInfo:d.unwrap(this._internalGraphicsLayer.elevationInfo),attached:!1}),this._stagedVerticesVisualElement.color=l.settings.colorToVec4(l.settings.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=
!0):this._stagedVerticesVisualElement.vertices=a.stagedVertices:this._destroyStagedVerticesVisualElement();d.isSome(a.full)?d.isNone(this._createGraphic)?(this._createGraphic=new n({geometry:a.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic)):this._createGraphic.geometry=a.full:this._destroyCreateGraphic()}};Object.defineProperty(b.prototype,"createGraphic",{get:function(){return this._createGraphic},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"enabled",{set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"centered",{set:function(a){this._set("centered",a);this._updateCreateGraphic()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"forceUniformSize",{set:function(a){this._set("forceUniformSize",a);this._updateCreateGraphic()},enumerable:!0,configurable:!0});b.prototype.reset=function(){};
Object.defineProperty(b.prototype,"canRedo",{get:function(){return this.drawOperation.canRedo},enumerable:!0,configurable:!0});b.prototype.redo=function(){this.drawOperation.redo()};Object.defineProperty(b.prototype,"canUndo",{get:function(){return this.drawOperation.canUndo},enumerable:!0,configurable:!0});b.prototype.undo=function(){this.drawOperation.undo()};b.prototype.completeCreateOperation=function(){this.drawOperation.complete()};b.prototype.activate=function(){};b.prototype.deactivate=function(){this.drawOperation.isCompleted||
this.emit("complete",{graphic:null,type:"complete"})};b.prototype.getVertexCoords=function(){return this.drawOperation.vertices};b.prototype.onVertexAdd=function(a){this._updateCreateGraphic();this.emit("vertex-add",a)};b.prototype.onVertexRemove=function(a){this._updateCreateGraphic();this.emit("vertex-remove",a)};b.prototype.onVertexUpdate=function(a){this._updateCreateGraphic();this.emit("vertex-update",a)};b.prototype.onCursorUpdate=function(a){this._updateCreateGraphic(1===a.vertices.length?
a.vertices[0].vertexIndex:null);this.emit("cursor-update",a)};b.prototype.onComplete=function(a){this._updateCreateGraphic();a=null;if(this.drawOperation.isCompleted){var b=this._getCreateGeometry(null,!0);d.isSome(b)&&(a=new n({geometry:b.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:a,type:"complete"})};f.__decorate([c.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);f.__decorate([c.property()],b.prototype,"createGraphicSymbol",void 0);f.__decorate([c.property()],
b.prototype,"createGraphic",null);f.__decorate([c.property({value:!0})],b.prototype,"enabled",null);f.__decorate([c.property({value:!0})],b.prototype,"centered",null);f.__decorate([c.property({value:!0})],b.prototype,"forceUniformSize",null);f.__decorate([c.property({constructOnly:!0})],b.prototype,"hasZ",void 0);f.__decorate([c.property({nonNullable:!0})],b.prototype,"defaultZ",void 0);f.__decorate([c.property({constructOnly:!0})],b.prototype,"elevationInfo",void 0);f.__decorate([c.property()],b.prototype,
"snapToScene",void 0);f.__decorate([c.property({constructOnly:!0})],b.prototype,"mode",void 0);f.__decorate([c.property({constructOnly:!0})],b.prototype,"geometryType",void 0);f.__decorate([c.property({readOnly:!0})],b.prototype,"type",void 0);return b=f.__decorate([c.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],b)}(u.EventedMixin(A.InteractiveToolBase));m.DrawGraphicTool=h;var r=48});