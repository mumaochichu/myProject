// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../geometry","../../../../../core/arrayUtils","../coordinateHelper"],function(r,g,t,u,v){Object.defineProperty(g,"__esModule",{value:!0});var p=function(){function b(a){this.right=this.left=null;this.type="vertex";this.index=null;this.component=a}Object.defineProperty(b.prototype,"pos",{get:function(){return this._pos},set:function(a){this._pos=a;this.component.unnormalizeVertexPositions()},enumerable:!0,configurable:!0});return b}();g.Vertex=p;var n=function(){return function(b,
a,l){this.type="edge";this.component=b;this.left=a;this.right=l;a.right=this;l.left=this}}();g.Edge=n;var q=function(){function b(a){this.vertices=[];this.edges=[];this.data=a}b.prototype.unnormalizeVertexPositions=function(){1>=this.vertices.length||this.data.coordinateHelper.unnormalize(this.vertices)};b.prototype.updateVertexIndex=function(a,b){if(0!==this.vertices.length){var c=this.vertices[0],d=null;do d=a,d.index=b++,a=d.right?d.right.right:null;while(null!=a&&a!==c);d.left&&d!==this.vertices[this.vertices.length-
1]&&this.swapVertices(this.vertices.indexOf(d),this.vertices.length-1)}};b.prototype.findEndVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]};b.prototype.swapVertices=function(a,b){var c=this.vertices[a];this.vertices[a]=this.vertices[b];this.vertices[b]=c};return b}();g.Component=q;r=function(){function b(a){this.coordinateHelper=a;this.undoStack=[];this.redoStack=[];this.components=[]}b.prototype.apply=function(a){a.apply();this.undoStack.push(a);this.redoStack=
[]};b.prototype.undo=function(){if(0<this.undoStack.length){var a=this.undoStack.pop();a.undo();this.redoStack.push(a)}};Object.defineProperty(b.prototype,"canUndo",{get:function(){return 0<this.undoStack.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lastOperation",{get:function(){return 0<this.undoStack.length?this.undoStack[this.undoStack.length-1]:null},enumerable:!0,configurable:!0});b.prototype.redo=function(){if(0<this.redoStack.length){var a=this.redoStack.pop();
a.apply();this.undoStack.push(a)}};Object.defineProperty(b.prototype,"canRedo",{get:function(){return 0<this.redoStack.length},enumerable:!0,configurable:!0});b.prototype.toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)};b.prototype.toPolyline=function(){var a=[],b=this.coordinateHelper.toArray;this.components.forEach(function(c,d){d=[];var f=c=u.find(c.vertices,function(a){return null==
a.left});do d.push(b(c.pos)),c=c.right?c.right.right:null;while(c&&c!==f);a.push(d)});return new t.Polyline({paths:a,spatialReference:this.coordinateHelper.spatialReference})};b.prototype.toPolygon=function(){var a=[],b=this.coordinateHelper.toArray;this.components.forEach(function(c,d){d=[];var f=c=c.vertices[0],l=f;do d.push(b(f.pos)),f=f.right.right;while(f&&f!==l);d.push(b(c.pos));a.push(d)});return new t.Polygon({rings:a,spatialReference:this.coordinateHelper.spatialReference})};b.fromGeometry=
function(a,l){l=v.createCoordinateHelper(a.hasZ,a.hasM,a.spatialReference,l);var c=new b(l);switch(a.type){case "polygon":for(var d=a.rings,f=0;f<d.length;++f){var g=d[f];a=new q(c);for(var m=g.length-1,e=0;e<m;++e){var h=l.fromArray(g[e]),k=new p(a);a.vertices.push(k);k.pos=h;k.index=e}m=a.vertices.length-1;for(e=0;e<m;++e)h=a.vertices[e],k=a.vertices[e+1],h=new n(a,h,k),a.edges.push(h);m=new n(a,a.vertices[a.vertices.length-1],a.vertices[0]);a.edges.push(m);c.components.push(a)}break;case "polyline":for(d=
a.paths,f=0;f<d.length;++f){g=d[f];a=new q(c);m=g.length;for(e=0;e<m;++e)h=l.fromArray(g[e]),k=new p(a),a.vertices.push(k),k.pos=h,k.index=e;m=a.vertices.length-1;for(e=0;e<m;++e)h=a.vertices[e],k=a.vertices[e+1],h=new n(a,h,k),a.edges.push(h);c.components.push(a)}}return c};return b}();g.EditGeometry=r});