// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultTextureUnits ../lib/DefaultVertexAttributeLocations ../shaders/WaterSurface.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(h,g,d,k,l,m,n,p,q,r,f,c,t,u,v,w,e){Object.defineProperty(g,"__esModule",{value:!0});f=function(c){function b(a,b){b=c.call(this,a,b)||this;b.waterTextureRepository=a.waterTextureRepository;return b}d.__extends(b,c);b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,
ssrEnabled:d.useSSR,highStepCount:!0});return new w(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),u.Default3D)};b.prototype.ensureResource=function(a){this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(a);return this.waterTextureRepository.ready?2:1};b.prototype.bindPass=function(a,b,c){0===this.configuration.output&&n.ScreenSpaceReflections.bindUniforms(this.program,a,c);if(0===this.configuration.output||2===this.configuration.output)p.WaterDistortion.bindUniforms(this.program,
b),this.waterTextureRepository.bindRepo(a);0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",b.color)};b.prototype.bindDraw=function(a){l.Transform.bindUniforms(this.program,a);0===this.configuration.output&&(q.Camera.bindUniforms(this.program,a),k.Slice.bindUniformsWithOrigin(this.program,this.configuration,a),m.ReadShadowMap.bindUniforms(this.program,a,t.DefaultTextureUnits.SHADOW_MAP))};b.prototype.initializePipeline=function(){var a=this.configuration;
return 2===a.output?e.makePipelineState({depthTest:{func:513},depthWrite:a.writeDepth&&e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:a.transparent&&e.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:a.writeDepth&&e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams})};b.shader=new r.ReloadableShaderModule(v,function(){return new Promise(function(a,b){h(["../shaders/WaterSurface.glsl"],a,b)})});return b}(f.ShaderTechnique);
g.WaterTechnique=f;f=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.output=0;a.receiveShadows=!1;a.slicePlaneEnabled=!1;a.transparent=!1;a.writeDepth=!1;a.useSSR=!1;a.isDraped=!1;return a}d.__extends(b,e);d.__decorate([c.parameter({count:7})],b.prototype,"output",void 0);d.__decorate([c.parameter()],b.prototype,"receiveShadows",void 0);d.__decorate([c.parameter()],b.prototype,"slicePlaneEnabled",void 0);d.__decorate([c.parameter()],b.prototype,"transparent",void 0);d.__decorate([c.parameter()],
b.prototype,"writeDepth",void 0);d.__decorate([c.parameter()],b.prototype,"useSSR",void 0);d.__decorate([c.parameter()],b.prototype,"isDraped",void 0);return b}(c.ShaderTechniqueConfiguration);g.WaterTechniqueConfiguration=f});