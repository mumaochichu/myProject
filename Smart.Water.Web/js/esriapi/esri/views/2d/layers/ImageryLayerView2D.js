// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),function(t,e,b,d,f,c,a,k,n,x,u,v){Object.defineProperty(e,"__esModule",{value:!0});var r=d.ofType({key:"type",base:n,typeMap:{rect:x,path:v,geometry:u}});
e.LayerView2DMixin=function(d){return function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.clips=new r;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}b.__extends(g,d);g.prototype.initialize=function(){var a=this,b;this.container||(this.container=new k.Container);this.handles.add([c.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestUpdate()},!0),c.init(this,["layer.opacity","container"],
function(){var b,c;a.container&&(a.container.opacity=null!==(c=null===(b=a.layer)||void 0===b?void 0:b.opacity)&&void 0!==c?c:1)},!0),c.init(this,["layer.blendMode"],function(b){a.container&&(a.container.blendMode=b)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);this.container.clips=this.clips;(null===(b=this.view)||void 0===b?0:b.whenLayerView)?this.view.whenLayerView(this.layer).then(function(b){b!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),
a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};g.prototype.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(g.prototype,"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});g.prototype.isVisibleAtScale=
function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,q=!c;!b&&a<=d&&(b=!0);!q&&a>=c&&(q=!0);b=b&&q}return b};g.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};g.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};g.prototype.isUpdating=
function(){return!1};g.prototype.isRendering=function(){return!1};g.prototype.canResume=function(){return d.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};b.__decorate([a.property({type:r,set:function(a){a=f.referenceSetter(a,this._get("clips"),r);this._set("clips",a)}})],g.prototype,"clips",void 0);b.__decorate([a.property()],g.prototype,"moving",void 0);b.__decorate([a.property()],g.prototype,"attached",void 0);b.__decorate([a.property()],g.prototype,"container",void 0);
b.__decorate([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],g.prototype,"suspended",void 0);b.__decorate([a.property({readOnly:!0})],g.prototype,"updateParameters",void 0);b.__decorate([a.property()],g.prototype,"updateRequested",void 0);b.__decorate([a.property({dependsOn:["attached","updateRequested","suspended"]})],g.prototype,"updating",null);b.__decorate([a.property()],g.prototype,"view",void 0);return g=b.__decorate([a.subclass("esri.views.2d.layers.LayerView2D")],
g)}(d)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(t,e,b,d,f){return function(c){function a(){return null!==c&&c.apply(this,arguments)||this}b.__extends(a,c);return a=b.__decorate([f.subclass("esri.views.layers.support.ClipArea")],a)}(d.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators",
"./ClipArea"],function(t,e,b,d,f){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}b.__extends(a,c);f=a;a.prototype.clone=function(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var f;b.__decorate([d.property({type:[Number,String],json:{write:!0}})],
a.prototype,"left",void 0);b.__decorate([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",void 0);b.__decorate([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);b.__decorate([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);b.__decorate([d.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=f=b.__decorate([d.subclass("esri.views.layers.support.ClipRect")],a)}(f)})},
"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(t,e,b,d,f,c,a,k){var n={base:c,key:"type",typeMap:{extent:d.Extent,polygon:d.Polygon}};return function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}b.__extends(d,c);k=d;Object.defineProperty(d.prototype,"version",
{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new k({geometry:this.geometry.clone()})};var k;b.__decorate([f.property({types:n,json:{read:a.fromJSON,write:!0}})],d.prototype,"geometry",void 0);b.__decorate([f.property({readOnly:!0,dependsOn:["geometry"]})],d.prototype,"version",null);return d=k=b.__decorate([f.subclass("esri.views.layers.support.Geometry")],d)}(k)})},"esri/views/layers/support/Path":function(){define(["require",
"exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(t,e,b,d,f){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.type="path";a.path=[];return a}b.__extends(a,c);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});b.__decorate([d.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);b.__decorate([d.property({readOnly:!0,dependsOn:["path"]})],a.prototype,
"version",null);return a=b.__decorate([d.subclass("esri.views.layers.support.Path")],a)}(f)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(t,e,b,d,f,c,a,k,n,x,u,v,r,p){var m=k.create(),g=[0,0],l=new p(0,0,0,0);return function(d){function h(a){var c=d.call(this,a)||this;c._imagePromise=null;c.hidpi=!1;c.imageMaxWidth=2048;c.imageMaxHeight=2048;c.imageRotationSupported=!1;c.imageNormalizationSupported=!1;c.update=f.debounce(function(a,d){return b.__awaiter(c,void 0,void 0,function(){var c,q,f,y,h,k,w,z,m,l=this;return b.__generator(this,function(b){c=a.state;q=n.getInfo(c.spatialReference);f=this.hidpi?a.pixelRatio:1;if(!a.stationary||
this.destroyed)return[2];this.imageRotationSupported?(g[0]=c.size[0],g[1]=c.size[1]):v.getOuterSize(g,c);y=Math.floor(g[0]*f)>this.imageMaxWidth||Math.floor(g[1]*f)>this.imageMaxHeight;h=q&&(c.extent.xmin<q.valid[0]||c.extent.xmax>q.valid[1]);k=!this.imageNormalizationSupported&&h;w=!y&&!k;z=this.imageRotationSupported?c.rotation:0;w?this._imagePromise=this._singleExport(c,g,z,f,d):(m=Math.min(this.imageMaxWidth,this.imageMaxHeight),k&&(m=Math.min(c.worldScreenWidth,m)),this._imagePromise=this._tiledExport(c,
m,z,f,d));return[2,this._imagePromise.then(function(a){l._imagePromise=null;var c=l.container.children.slice();l.container.removeAllChildren();a.forEach(l.container.addChild,l.container);l.disposeSource&&c.forEach(function(a){l.disposeSource(a.source)},l)}).catch(function(a){l._imagePromise=null;throw a;})]})})},5E3);return c}b.__extends(h,d);h.prototype.destroy=function(){};Object.defineProperty(h.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});
h.prototype.updateExports=function(a){for(var c=0,b=this.container.children;c<b.length;c++){var d=b[c];if(!d.visible||!d.stage)break;a(d)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(d.invalidateTexture(),d.requestRender())}};h.prototype._export=function(a,c,b,d,h,k){var q=this;return f.resolve().then(function(){return q.fetchSource(a,Math.floor(c*h),Math.floor(b*h),{rotation:d,pixelRatio:h,signal:k})}).then(function(b){b=new u.Bitmap(b);b.x=a.xmin;b.y=a.ymax;b.resolution=
a.width/c;b.rotation=d;b.pixelRatio=h;return b})};h.prototype._singleExport=function(b,c,d,f,h){v.getBBox(m,b.center,b.resolution,c);b=new a(m[0],m[1],m[2],m[3],b.spatialReference);return this._export(b,c[0],c[1],d,f,h).then(function(a){return[a]})};h.prototype._tiledExport=function(b,c,d,h,k){var q=this,g=x.create({size:c,spatialReference:b.spatialReference,scales:[b.scale]}),w=new r(g),g=w.getTileCoverage(b);if(!g)return null;var y=[];g.forEach(function(f,g,e,n){l.set(f,g,e,n);w.getTileBounds(m,
l);f=new a(m[0],m[1],m[2],m[3],b.spatialReference);y.push(q._export(f,c,c,d,h,k))});return f.all(y)};b.__decorate([c.property()],h.prototype,"_imagePromise",void 0);b.__decorate([c.property()],h.prototype,"container",void 0);b.__decorate([c.property()],h.prototype,"disposeSource",void 0);b.__decorate([c.property()],h.prototype,"fetchSource",void 0);b.__decorate([c.property()],h.prototype,"hidpi",void 0);b.__decorate([c.property()],h.prototype,"imageMaxWidth",void 0);b.__decorate([c.property()],h.prototype,
"imageMaxHeight",void 0);b.__decorate([c.property()],h.prototype,"imageRotationSupported",void 0);b.__decorate([c.property()],h.prototype,"imageNormalizationSupported",void 0);b.__decorate([c.property()],h.prototype,"requestUpdate",void 0);b.__decorate([c.property({dependsOn:["_imagePromise"]})],h.prototype,"updating",null);return h=b.__decorate([c.subclass("esri.views.2d.layers.support.ExportStrategy")],h)}(d)})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(t,e){Object.defineProperty(e,
"__esModule",{value:!0});var b=Math.PI/180;e.snapToPixel=function(b,f,c){var a=c.resolution;c=c.size;b[0]=a*(Math.round(f[0]/a)+c[0]%2*.5);b[1]=a*(Math.round(f[1]/a)+c[1]%2*.5);return b};e.getOuterSize=function(d,f){var c=f.rotation*b,a=Math.abs(Math.cos(c)),c=Math.abs(Math.sin(c)),k=f.size;f=k[0];k=k[1];d[0]=Math.round(k*c+f*a);d[1]=Math.round(k*a+f*c);return d};e.getBBox=function(b,f,c,a){var d=f[0];f=f[1];var e=a[0];a=a[1];c*=.5;b[0]=d-c*e;b[1]=f-c*a;b[2]=d+c*e;b[3]=f+c*a;return b};e.bboxIntersects=
function(b,f){var c=b[1],a=b[2],d=b[3],e=f[0],x=f[1],u=f[3];return!(b[0]>f[2]||a<e||c>u||d<x)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports tslib ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),function(t,e,b,d,f,c,a,k,n,x,u){Object.defineProperty(e,"__esModule",{value:!0});e.ImageryLayerView=function(e){return function(e){function p(){var a=
null!==e&&e.apply(this,arguments)||this;a.view=null;return a}b.__extends(p,e);p.prototype.fetchPopupFeatures=function(a,g){return b.__awaiter(this,void 0,void 0,function(){var e,m,h,y,q,w,n,p,r,v,t;return b.__generator(this,function(b){switch(b.label){case 0:e=this.layer;if(!a)return[2,c.reject(new d("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:e}))];m=e.popupEnabled;h=u.getFetchPopupTemplate(e,g);if(!m||!f.isSome(h))throw new d("imagerylayerview:fetchPopupFeatures",
"Missing required popupTemplate or popupEnabled",{popupEnabled:m,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return y=b.sent(),q=new x,q.geometry=a,q.outFields=y,q.outSpatialReference=a.spatialReference,w=this.view.resolution,n="2d"===this.view.type?new k(w,w,this.view.spatialReference):new k(.5*w,.5*w,this.view.spatialReference),p=h.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},r=p.returnTopmostRaster,v=p.showNoDataRecords,t={returnDomainValues:!0,returnTopmostRaster:r,
pixelSize:n,showNoDataRecords:v},[2,e.queryVisibleRasters(q,t).then(function(a){return a})]}})})};p.prototype.canResume=function(){var a;return!e.prototype.canResume.call(this)||(null===(a=this.timeExtent)||void 0===a?0:a.isEmpty)?!1:!0};b.__decorate([a.property()],p.prototype,"layer",void 0);b.__decorate([a.property({dependsOn:["timeExtent"]})],p.prototype,"suspended",void 0);b.__decorate([a.property(n.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0);b.__decorate([a.property()],
p.prototype,"view",void 0);return p=b.__decorate([a.subclass("esri.views.layers.ImageryLayerView")],p)}(e)}})},"esri/views/layers/support/popupUtils":function(){define("require exports tslib @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(t,e,b,d,f,c){Object.defineProperty(e,"__esModule",{value:!0});e.getRequiredFields=function(a,e){void 0===e&&(e=a.popupTemplate);return b.__awaiter(this,void 0,void 0,function(){var k,t,u,v,r,p,m,g,l;return b.__generator(this,
function(n){switch(n.label){case 0:return f.isSome(e)?[4,e.getRequiredFields(a.fields)]:[2,[]];case 1:return k=n.sent(),t=e.lastEditInfoEnabled,u=a.objectIdField,v=a.typeIdField,r=a.globalIdField,p=a.relationships,d.includes(k,"*")?[2,["*"]]:t?[4,c.getFeatureEditFields(a)]:[3,3];case 2:return g=n.sent(),[3,4];case 3:g=[],n.label=4;case 4:return m=g,l=c.fixFields(a.fields,b.__spreadArrays(k,m)),v&&l.push(v),l&&u&&c.hasField(a.fields,u)&&-1===l.indexOf(u)&&l.push(u),l&&r&&c.hasField(a.fields,r)&&-1===
l.indexOf(r)&&l.push(r),p&&p.forEach(function(b){b=b.keyField;l&&b&&c.hasField(a.fields,b)&&-1===l.indexOf(b)&&l.push(b)}),[2,l]}})})};e.getFetchPopupTemplate=function(a,b){return a.popupTemplate?a.popupTemplate:f.isSome(b)&&b.defaultPopupTemplateEnabled&&f.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports tslib ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine ../engine/ImageryBitmapSource ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(t,e,b,d,f,c,a,k,n,x,u,v,r,p,m,g,l){var A=f.getLogger("esri.views.2d.layers.ImageryLayerView2D");
return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a._exportImageVersion=-1;a.container=new u.BitmapContainer;return a}b.__extends(e,f);Object.defineProperty(e.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=x.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});e.prototype.hitTest=function(b,e){if(this.suspended)return c.resolve(null);b=this.view.toMap(a.createScreenPoint(b,e));return c.resolve(new d({attributes:{},geometry:b,layer:this.layer}))};e.prototype.update=function(a){this.strategy.update(a).catch(function(a){c.isAbortError(a)||
A.error(a)})};e.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();this.strategy=new p({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([k.init(this,"layer.exportImageServiceParameters.version",
function(b){a._exportImageVersion!==b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(c){var d=b.source;d.pixelBlock=c.pixelBlock;d.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update");
this.container&&(this.container.blendMode=this.layer.blendMode)};e.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.strategy.destroy();this.container.removeAllChildren();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};e.prototype.moveStart=function(){};e.prototype.viewChange=function(){};e.prototype.moveEnd=function(){this.requestUpdate()};e.prototype.doRefresh=function(){return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,
function(a){this.requestUpdate();return[2]})})};e.prototype.isUpdating=function(){return this.strategy.updating||this.updateRequested};e.prototype.fetchImage=function(a,b,c,d){var e=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");d=d||{};d.timeExtent=this.timeExtent;d.requestAsImageElement=!0;return this.layer.fetchImage(a,b,c,d).then(function(a){return a.imageElement?a.imageElement:e.layer.applyRenderer(a.pixelData,{signal:d.signal}).then(function(b){b=new v.default(b.pixelBlock,
b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return e.layer.applyFilter(a)};return b})})};b.__decorate([n.property({dependsOn:["updating"]})],e.prototype,"pixelData",null);b.__decorate([n.property()],e.prototype,"strategy",void 0);b.__decorate([n.property({dependsOn:["strategy.updating"]})],e.prototype,"updating",void 0);return e=b.__decorate([n.subclass("esri.views.2d.layers.ImageryLayerView2D")],e)}(m.ImageryLayerView(l.RefreshableLayerView(r.LayerView2DMixin(g))))});