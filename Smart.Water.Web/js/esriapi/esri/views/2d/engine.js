// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/views/2d/engine/Bitmap":function(){define("require exports tslib ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(a,d,e,h,f,b,m,p,c){function g(c){var b=document.createElement("canvas");b.width=c.width;b.height=c.height;c.render(b.getContext("2d"));return b}function u(c,b,g){var a={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,
wrapMode:33071};b&&g&&(a.width=b,a.height=g);return new m.Texture(c,a)}Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(c,b){void 0===c&&(c=null);void 0===b&&(b=!0);var g=a.call(this)||this;g.requestRenderOnSourceChangedEnabled=b;g.stencilRef=0;g.coordScale=[1,1];g._height=void 0;g.pixelRatio=1;g.resolution=0;g.rotation=0;g._source=null;g._width=void 0;g.x=0;g.y=0;g.transforms={dvs:f.mat3f32.create()};g.source=c;g.requestRender=g.requestRender.bind(g);return g}e.__extends(d,
a);Object.defineProperty(d.prototype,"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(c){this._height=c},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"source",{get:function(){return this._source},set:function(c){this._source=c;this.invalidateTexture()},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},
set:function(c){this._width=c},enumerable:!0,configurable:!0});d.prototype.invalidateTexture=function(){this._updateTexture()};d.prototype.setTransform=function(c){var g=h.mat3.identity(this.transforms.dvs),a=c.toScreenNoRotation([0,0],this.x,this.y),e=this.resolution/this.pixelRatio/c.resolution,d=e*this.width,e=e*this.height,k=Math.PI*this.rotation/180;h.mat3.translate(g,g,b.vec2f32.fromValues(a[0],a[1]));h.mat3.translate(g,g,b.vec2f32.fromValues(d/2,e/2));h.mat3.rotate(g,g,-k);h.mat3.translate(g,
g,b.vec2f32.fromValues(-d/2,-e/2));h.mat3.scaleByVec2(g,g,b.vec2f32.fromValues(d,e));h.mat3.multiply(this.transforms.dvs,c.displayViewMat3,g)};d.prototype.setSamplingProfile=function(c){this._texture&&(c.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(c.samplingMode))};d.prototype.bind=function(c){this._texture&&this.stage.context.bindTexture(this._texture,c)};d.prototype.onAttach=function(){this.invalidateTexture()};d.prototype.onDetach=function(){this.invalidateTexture()};
d.prototype._updateTexture=function(){var b;this.stage?(this._texture||(this._texture=this.source?u(this.stage.context,this.sourceWidth,this.sourceHeight):u(this.stage.context)),(b=this.source)?(this._texture.resize(this.sourceWidth,this.sourceHeight),b&&"render"in b?b instanceof c.default?(b=b.getRenderedRasterPixels(),this._texture.setData(b.renderedRasterPixels)):this._texture.setData(g(b)):!b||"render"in b||this._texture.setData(b),this.ready(),this.requestRenderOnSourceChangedEnabled&&this.requestRender()):
this._texture.setData(null)):(null===(b=this._texture)||void 0===b?void 0:b.dispose(),this._texture=null)};return d}(p.DisplayObject);d.Bitmap=a})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","tslib","../../../core/Evented"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._clips=null;b._isReady=!1;b._opacity=1;b._stage=null;b._visible=!0;return b}e.__extends(b,a);Object.defineProperty(b.prototype,
"clips",{get:function(){return this._clips},set:function(b){this._clips=b;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isReady",{get:function(){return this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(b){this._opacity!==b&&(this._opacity=b,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stage",{get:function(){return this._stage},
set:function(b){if(this._stage!==b){var a=this._stage;(this._stage=b)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):a.trashDisplayObject(this)}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(b){this._visible!==b&&(this._visible=b,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.setTransform=function(b){};b.prototype.processRender=function(b){this.visible&&this.stage&&
this.doRender(b)};b.prototype.requestRender=function(){this.stage&&this.stage.requestRender()};b.prototype.processDetach=function(){this.onDetach();this.emit("detach")};b.prototype.onAttach=function(){};b.prototype.onDetach=function(){};b.prototype.doRender=function(b){};b.prototype.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};return b}(h);d.DisplayObject=a})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["require","exports"],function(a,
d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,e,b){this.pixelBlock=a;this.extent=e;this.originalPixelBlock=b}Object.defineProperty(a.prototype,"width",{get:function(){return this.pixelBlock?this.pixelBlock.width:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.pixelBlock?this.pixelBlock.height:0},enumerable:!0,configurable:!0});a.prototype.render=function(a){var e=this.pixelBlock;if(e){var b=this.filter({pixelBlock:e}),
e=b.pixelBlock.getAsRGBA(),b=a.createImageData(b.pixelBlock.width,b.pixelBlock.height);b.data.set(e);a.putImageData(b,0,0)}};a.prototype.getRenderedRasterPixels=function(){var a=this.filter({pixelBlock:this.pixelBlock});return{width:a.pixelBlock.width,height:a.pixelBlock.height,renderedRasterPixels:new Uint8Array(a.pixelBlock.getAsRGBA().buffer)}};return a}();d.default=a})},"esri/views/2d/engine/BitmapContainer":function(){define(["require","exports","tslib","../engine","./webgl/WGLContainer"],function(a,
d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});a=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}e.__extends(a,b);a.prototype.prepareRenderPasses=function(a){var c=this,g=a.registerRenderPass({name:"bitmap",brushes:[h.brushes.Bitmap],target:function(){return c.children}});return e.__spreadArrays(b.prototype.prepareRenderPasses.call(this,a),[g])};a.prototype.createRenderParams=function(a){return e.__assign(e.__assign({},b.prototype.createRenderParams.call(this,a)),
{blendMode:this.blendMode})};return a}(f.default);d.BitmapContainer=a})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("require exports tslib ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});a=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._lastTime=null;b.name=b.constructor.name;return b}e.__extends(b,c);Object.defineProperty(b.prototype,"clips",{set:function(c){this._clips=
c;this.children.forEach(function(b){return b.clips=c});this._updateClippingInfo()},enumerable:!0,configurable:!0});b.prototype.doRender=function(c){var b=this.createRenderParams(c),g=b.painter,a=b.globalOpacity,e=b.profiler,a=b.drawPhase===p.WGLDrawPhase.LABEL?1:a*this.opacity;e.recordContainerStart(this.name);g.beforeRenderLayer(b,this._clippingInfos?255:0,a);this.updateTransforms(c.state);this.renderChildren(b);g.compositeLayer(b,a);e.recordContainerEnd()};b.prototype.renderChildren=function(c){h.isNone(this._renderPasses)&&
(this._renderPasses=this.prepareRenderPasses(this.stage.painter));for(var b=0,g=this._renderPasses;b<g.length;b++)g[b].render(c)};b.prototype.createRenderParams=function(c){var b=Date.now(),g=(h.isSome(this._lastTime)?b-this._lastTime:0)/1E3;this._lastTime=b;return e.__assign(e.__assign({},c),{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,timeDelta:g,timeline:this.stage.timeline})};
b.prototype.prepareRenderPasses=function(c){var b=this;return[c.registerRenderPass({name:"clip",brushes:[f.brushes.Clip],target:function(){return b._clippingInfos},drawPhase:p.WGLDrawPhase.MAP|p.WGLDrawPhase.LABEL|p.WGLDrawPhase.LABEL_ALPHA|p.WGLDrawPhase.DEBUG})]};b.prototype.updateTransforms=function(c){for(var b=0,g=this.children;b<g.length;b++)g[b].setTransform(c)};b.prototype.onAttach=function(){c.prototype.onAttach.call(this);this._updateClippingInfo()};b.prototype.onDetach=function(){c.prototype.onDetach.call(this);
this._updateClippingInfo()};b.prototype._updateClippingInfo=function(){var c=this;h.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(c){return c.destroy()}),this._clippingInfos=null);if(this.stage){var b=this._clips;h.isSome(b)&&b.length&&(this._clippingInfos=b.items.map(function(b){return m.default.fromClipArea(c.stage,b)}));this.requestRender()}};return b}(b.Container);d.default=a})},"esri/views/2d/engine/Container":function(){define(["require","exports","tslib","./DisplayObject"],
function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._childrenSet=new Set;b.children=[];return b}e.__extends(b,a);Object.defineProperty(b.prototype,"blendMode",{get:function(){return this._blendMode},set:function(b){this._blendMode=b;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clips",{get:function(){return this._clips},set:function(b){this._clips=b;this.children.forEach(function(a){return a.clips=
b})},enumerable:!0,configurable:!0});b.prototype.doRender=function(b){b=this.createRenderParams(b);this.renderChildren(b)};b.prototype.addChild=function(b){return this.addChildAt(b,this.children.length)};b.prototype.addChildAt=function(b,a){void 0===a&&(a=this.children.length);if(!b||this.contains(b))return b;var c=b.parent;c&&c!==this&&c.removeChild(b);a>=this.children.length?this.children.push(b):this.children.splice(a,0,b);this._childrenSet.add(b);b.parent=this;b.stage=this.stage;this!==this.stage&&
(b.clips=this.clips);this.requestRender();return b};b.prototype.contains=function(b){return this._childrenSet.has(b)};b.prototype.removeAllChildren=function(){this._childrenSet.clear();for(var b=0,a=this.children;b<a.length;b++){var c=a[b];this!==this.stage&&(c.clips=null);c.stage=null;c.parent=null}this.children.length=0};b.prototype.removeChild=function(b){return this.contains(b)?this.removeChildAt(this.children.indexOf(b)):b};b.prototype.removeChildAt=function(b){if(0>b||b>=this.children.length)return null;
b=this.children.splice(b,1)[0];this._childrenSet.delete(b);this!==this.stage&&(b.clips=null);b.stage=null;b.parent=null;return b};b.prototype.sortChildren=function(b){return this.children.sort(b)};b.prototype.onAttach=function(){a.prototype.onAttach.call(this);for(var b=this.stage,e=0,c=this.children;e<c.length;e++)c[e].stage=b};b.prototype.onDetach=function(){a.prototype.onDetach.call(this);for(var b=0,e=this.children;b<e.length;b++)e[b].stage=null};b.prototype.renderChildren=function(b){for(var a=
this.children,c=a.length,g=0;g<c;g++)a[g].processRender(b)};b.prototype.createRenderParams=function(b){return e.__assign(e.__assign({},b),{blendMode:this.blendMode,globalOpacity:b.globalOpacity*this.opacity})};return b}(h.DisplayObject);d.Container=a})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("require exports tslib ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(a,d,e,h,f,b,m,
p,c){Object.defineProperty(d,"__esModule",{value:!0});var g=f.getLogger("esri.views.2d.engine.webgl.ClippingInfo");a=function(a){function d(c,b){var g=a.call(this)||this;g._clip=b;g._cache={};g.stage=c;g._handle=b.watch("version",function(){return g._invalidate()});g.ready();return g}e.__extends(d,a);d.fromClipArea=function(c,b){return new d(c,b)};d.prototype._destroyGL=function(){b.isSome(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null);b.isSome(this._cache.vao)&&(this._cache.vao.dispose(),
this._cache.vao=null)};d.prototype.destroy=function(){this._destroyGL();this._handle.remove()};d.prototype.getVAO=function(g,a,e,d){var n=a.size,l=n[0],n=n[1];if("geometry"===this._clip.type||this._lastWidth!==l||this._lastHeight!==n)this._lastWidth=l,this._lastHeight=n,this._destroyGL();b.isNone(this._cache.vao)&&(a=this._createMesh(a,this._clip),l=a.getIndexBuffer(g),n=a.getVertexBuffers(g),this._cache.mesh=a,this._cache.vao=new c(g,e,d,n,l));return this._cache.vao};d.prototype._invalidate=function(){this._destroyGL();
this.requestRender()};d.prototype._createScreenRect=function(c,b){var g=c.size;c=g[0];var g=g[1],a="string"===typeof b.left?parseFloat(b.left)/100*c:b.left,e="string"===typeof b.right?parseFloat(b.right)/100*c:b.right,d="string"===typeof b.top?parseFloat(b.top)/100*g:b.top;b="string"===typeof b.bottom?parseFloat(b.bottom)/100*g:b.bottom;return{x:a,y:d,width:Math.max(c-e-a,0),height:Math.max(g-b-d,0)}};d.prototype._createMesh=function(c,b){switch(b.type){case "rect":return p.default.fromRect(this._createScreenRect(c,
b));case "path":return p.default.fromPath(b);case "geometry":return p.default.fromGeometry(c,b);default:return g.error(new h("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),p.default.fromRect({x:0,y:0,width:1,height:1})}};return d}(m.DisplayObject);d.default=a})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("require exports tslib ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x){Object.defineProperty(d,"__esModule",{value:!0});var l=f.getLogger("esri.views.2d.engine.webgl.Mesh2D"),y=function(c,b){var g=c.coords;c=c.lengths;for(var a=[],e=0,d=0;e<c.length;d+=c[e],e+=1){for(var n=d,l=[];e<c.length-1;e+=1,d+=c[e]){for(var f=d+c[e],p=0,t=1;t<c[e+1];t++)p+=(g[2*(f+t)]-g[2*(f+t-1)])*(g[2*(f+t)+1]+g[2*(f+t-1)+1]);if(!(b?0<p:0>p))break;l.push(d+c[e]-n)}p=g.slice(2*n,2*(d+c[e]));f=0;for(l=m.earcut(p,l,2);f<l.length;f++)a.push(l[f]+n)}return a};
a=function(){function a(c,b,g,a){void 0===a&&(a=!1);this._cache={};this.vertices=c;this.indices=b;this.primitiveType=g;this.isMapSpace=a}a.fromRect=function(c){var b=c.x,g=c.y;return a.fromScreenExtent({xmin:b,ymin:g,xmax:b+c.width,ymax:g+c.height})};a.fromPath=function(c){var b=g.convertFromNestedArray(new u.default,c.path,!1,!1);c=b.coords;for(var b=new Uint32Array(y(b,!0)),e=new Uint32Array(c.length/2),d=0;d<e.length;d++)e[d]=v.i1616to32(Math.floor(c[2*d]),Math.floor(c[2*d+1]));return new a({geometry:e},
b,4)};a.fromGeometry=function(c,b){var g=b.geometry.type;switch(g){case "polygon":return a.fromPolygon(c,b.geometry);case "extent":return a.fromMapExtent(c,b.geometry);default:return l.error(new h("mapview-bad-type","Unable to create a mesh from type "+g,b)),a.fromRect({x:0,y:0,width:1,height:1})}};a.fromPolygon=function(b,e){var d=g.convertFromPolygon(new u.default,e,!1,!1);e=d.coords;for(var d=new Uint32Array(y(d,!1)),n=new Uint32Array(e.length/2),q=c.vec2f64.create(),f=c.vec2f64.create(),l=0;l<
n.length;l++)p.vec2.set(q,e[2*l],e[2*l+1]),b.toScreen(f,q),n[l]=v.i1616to32(Math.floor(f[0]),Math.floor(f[1]));return new a({geometry:n},d,4,!0)};a.fromScreenExtent=function(c){var b=c.xmin,g=c.xmax,e=c.ymin;c=c.ymax;b={geometry:new Uint32Array([v.i1616to32(b,e),v.i1616to32(g,e),v.i1616to32(b,c),v.i1616to32(b,c),v.i1616to32(g,e),v.i1616to32(g,c)])};g=new Uint32Array([0,1,2,3,4,5]);return new a(b,g,4)};a.fromMapExtent=function(c,b){var g=c.toScreen([0,0],[b.xmin,b.ymin]),e=g[0],g=g[1];b=c.toScreen([0,
0],[b.xmax,b.ymax]);c=b[0];b=b[1];e={geometry:new Uint32Array([v.i1616to32(e,g),v.i1616to32(c,g),v.i1616to32(e,b),v.i1616to32(e,b),v.i1616to32(c,g),v.i1616to32(c,b)])};g=new Uint32Array([0,1,2,3,4,5]);return new a(e,g,4)};a.prototype.destroy=function(){b.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var c in this._cache.vertexBuffers)b.isSome(this._cache.vertexBuffers[c])&&this._cache.vertexBuffers[c].dispose()};Object.defineProperty(a.prototype,"elementType",{get:function(){var c;
a:switch(this.indices.BYTES_PER_ELEMENT){case 1:c=5121;break a;case 2:c=5123;break a;case 4:c=5125;break a;default:throw new h("Cannot get DataType of array");}return c},enumerable:!0,configurable:!0});a.prototype.getIndexBuffer=function(c,b){void 0===b&&(b=35044);this._cache.indexBuffer||(this._cache.indexBuffer=x.createIndex(c,b,this.indices));return this._cache.indexBuffer};a.prototype.getVertexBuffers=function(c,b){var g=this;void 0===b&&(b=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=
Object.keys(this.vertices).reduce(function(a,d){var k;return e.__assign(e.__assign({},a),(k={},k[d]=x.createVertex(c,b,g.vertices[d]),k))},{}));return this._cache.vertexBuffers};return a}();d.default=a})},"esri/core/libs/earcut/earcut":function(){define(["require","exports"],function(a,d){function e(c,b,g,a,e){var d;if(e===0<l(c,b,g,a))for(e=b;e<g;e+=a)d=m(e,c[e],c[e+1],d);else for(e=g-a;e>=b;e-=a)d=m(e,c[e],c[e+1],d);d&&r(d,d.next)&&(p(d),d=d.next);return d}function h(c,b){void 0===b&&(b=c);if(!c)return c;
var g;do if(g=!1,c.steiner||!r(c,c.next)&&0!==v(c.prev,c,c.next))c=c.next;else{p(c);c=b=c.prev;if(c===c.next)break;g=!0}while(g||c!==b);return b}function f(c,g,a,e,d,k,q){void 0===q&&(q=0);if(c){!q&&k&&(c=u(c,e,d,k));for(var n=c;c.prev!==c.next;){var l=c.prev,m=c.next,z;if(k)z=b(c,e,d,k);else a:{z=c;var A=z.prev,E=z,B=z.next;if(0<=v(A,E,B))z=!1;else{for(var D=z.next.next,J=D,H=0;D!==z.prev&&(0===H||D!==J);){H++;if(y(A.x,A.y,E.x,E.y,B.x,B.y,D.x,D.y)&&0<=v(D.prev,D,D.next)){z=!1;break a}D=D.next}z=
!0}}if(z)g.push(l.index/a),g.push(c.index/a),g.push(m.index/a),p(c),n=c=m.next;else if(c=m,c===n){if(!q)f(h(c),g,a,e,d,k,1);else if(1===q){q=g;n=a;l=c;do m=l.prev,z=l.next.next,!r(m,z)&&x(m,l,l.next,z)&&t(m,z)&&t(z,m)&&(q.push(m.index/n),q.push(l.index/n),q.push(z.index/n),p(l),p(l.next),l=c=z),l=l.next;while(l!==c);c=l;f(c,g,a,e,d,k,2)}else if(2===q)a:{q=c;do{for(n=q.next.next;n!==q.prev;){if(l=q.index!==n.index){l=q;m=n;z=void 0;if(z=l.next.index!==m.index&&l.prev.index!==m.index){z=void 0;b:{z=
l;do{if(z.index!==l.index&&z.next.index!==l.index&&z.index!==m.index&&z.next.index!==m.index&&x(z,z.next,l,m)){z=!0;break b}z=z.next}while(z!==l);z=!1}z=!z}A=void 0;if(A=z&&t(l,m)&&t(m,l)){z=l;A=!1;E=(l.x+m.x)/2;m=(l.y+m.y)/2;do z.y>m!==z.next.y>m&&z.next.y!==z.y&&E<(z.next.x-z.x)*(m-z.y)/(z.next.y-z.y)+z.x&&(A=!A),z=z.next;while(z!==l)}l=A}if(l){c=w(q,n);q=h(q,q.next);c=h(c,c.next);f(q,g,a,e,d,k);f(c,g,a,e,d,k);break a}n=n.next}q=q.next}while(q!==c)}break}}}}function b(c,b,g,a){var e=c.prev,d=c.next;
if(0<=v(e,c,d))return!1;var k=e.x>c.x?e.x>d.x?e.x:d.x:c.x>d.x?c.x:d.x,q=e.y>c.y?e.y>d.y?e.y:d.y:c.y>d.y?c.y:d.y,l=n(e.x<c.x?e.x<d.x?e.x:d.x:c.x<d.x?c.x:d.x,e.y<c.y?e.y<d.y?e.y:d.y:c.y<d.y?c.y:d.y,b,g,a);b=n(k,q,b,g,a);g=c.prevZ;for(a=c.nextZ;g&&g.z>=l&&a&&a.z<=b;){if(g!==c.prev&&g!==c.next&&y(e.x,e.y,c.x,c.y,d.x,d.y,g.x,g.y)&&0<=v(g.prev,g,g.next))return!1;g=g.prevZ;if(a!==c.prev&&a!==c.next&&y(e.x,e.y,c.x,c.y,d.x,d.y,a.x,a.y)&&0<=v(a.prev,a,a.next))return!1;a=a.nextZ}for(;g&&g.z>=l;){if(g!==c.prev&&
g!==c.next&&y(e.x,e.y,c.x,c.y,d.x,d.y,g.x,g.y)&&0<=v(g.prev,g,g.next))return!1;g=g.prevZ}for(;a&&a.z<=b;){if(a!==c.prev&&a!==c.next&&y(e.x,e.y,c.x,c.y,d.x,d.y,a.x,a.y)&&0<=v(a.prev,a,a.next))return!1;a=a.nextZ}return!0}function m(c,b,g,a){c=new q(c,b,g);a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c);return c}function p(c){c.next.prev=c.prev;c.prev.next=c.next;c.prevZ&&(c.prevZ.nextZ=c.nextZ);c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function c(c){var b=c,g=c;do{if(b.x<g.x||b.x===g.x&&
b.y<g.y)g=b;b=b.next}while(b!==c);return g}function g(c,b){var g=b,a=c.x,e=c.y,d=-Infinity,k;do{if(e<=g.y&&e>=g.next.y&&g.next.y!==g.y){var q=g.x+(e-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(q<=a&&q>d){d=q;if(q===a){if(e===g.y)return g;if(e===g.next.y)return g.next}k=g.x<g.next.x?g:g.next}}g=g.next}while(g!==b);if(!k)return null;if(a===d)return k.prev;b=k;for(var q=k.x,l=k.y,n=Infinity,f,g=k.next;g!==b;)a>=g.x&&g.x>=q&&a!==g.x&&y(e<l?a:d,e,q,l,e<l?d:a,e,g.x,g.y)&&(f=Math.abs(e-g.y)/(a-g.x),(f<n||f===
n&&g.x>k.x)&&t(g,c)&&(k=g,n=f)),g=g.next;return k}function u(c,b,g,a){for(var e=void 0;e!==c;e=e.next){e=e||c;null===e.z&&(e.z=n(e.x,e.y,b,g,a));if(e.prev.next!==e||e.next.prev!==e)return e.prev.next=e,e.next.prev=e,u(c,b,g,a);e.prevZ=e.prev;e.nextZ=e.next}c.prevZ.nextZ=null;c.prevZ=null;a:for(g=1;;){a=c;e=void 0;b=c=null;for(var d=0;a;){d++;for(var e=a,k=0;k<g&&e;k++)e=e.nextZ;for(var q=g;0<k||0<q&&e;){var l=void 0;0===k?(l=e,e=e.nextZ,q--):0!==q&&e?a.z<=e.z?(l=a,a=a.nextZ,k--):(l=e,e=e.nextZ,q--):
(l=a,a=a.nextZ,k--);b?b.nextZ=l:c=l;l.prevZ=b;b=l}a=e}b.nextZ=null;g*=2;if(2>d)break a}return c}function v(c,b,g){return(b.y-c.y)*(g.x-b.x)-(b.x-c.x)*(g.y-b.y)}function x(c,b,g,a){return r(c,b)&&r(g,a)||r(c,a)&&r(g,b)?!0:0<v(c,b,g)!==0<v(c,b,a)&&0<v(g,a,c)!==0<v(g,a,b)}function l(c,b,g,a){for(var e=0,d=g-a;b<g;b+=a)e+=(c[d]-c[b])*(c[b+1]+c[d+1]),d=b;return e}function y(c,b,g,a,e,d,k,q){return 0<=(e-k)*(b-q)-(c-k)*(d-q)&&0<=(c-k)*(a-q)-(g-k)*(b-q)&&0<=(g-k)*(d-q)-(e-k)*(a-q)}function t(c,b){return 0>
v(c.prev,c,c.next)?0<=v(c,b,c.next)&&0<=v(c,c.prev,b):0>v(c,b,c.prev)||0>v(c,c.next,b)}function n(c,b,g,a,e){c=32767*(c-g)*e;b=32767*(b-a)*e;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(c|c<<1)&1431655765|((b|b<<1)&1431655765)<<1}function r(c,b){return c.x===b.x&&c.y===b.y}function k(c,b){return c.x-b.x}function w(c,b){var g=new q(c.index,c.x,c.y),a=new q(b.index,b.x,b.y),e=c.next,d=b.prev;c.next=b;b.prev=c;g.next=
e;e.prev=g;a.next=g;g.prev=a;d.next=a;a.prev=d;return a}Object.defineProperty(d,"__esModule",{value:!0});d.earcut=function(b,a,d){var q=a&&a.length,l=q?a[0]*d:b.length,n=e(b,0,l,d,!0),p=[];if(!n||n.next===n.prev)return p;var t,r,y;if(q){for(var q=[],m=0,v=a.length;m<v;m++){var u=e(b,a[m]*d,m<v-1?a[m+1]*d:b.length,d,!1);u===u.next&&(u.steiner=!0);q.push(c(u))}q.sort(k);for(a=0;a<q.length;a++){m=q[a];v=n;if(v=g(m,v))m=w(v,m),h(m,m.next);n=h(n,n.next)}}if(b.length>80*d){t=y=b[0];r=q=b[1];for(a=d;a<l;a+=
d)m=b[a],v=b[a+1],t=Math.min(t,m),r=Math.min(r,v),y=Math.max(y,m),q=Math.max(q,v);y=Math.max(y-t,q-r);y=0!==y?1/y:0}f(n,p,d,t,r,y);return p};d.deviation=function(c,b,g,a){var e=b&&b.length,d=Math.abs(l(c,0,e?b[0]*g:c.length,g));if(e)for(var e=0,k=b.length;e<k;e++)d-=Math.abs(l(c,b[e]*g,e<k-1?b[e+1]*g:c.length,g));for(e=b=0;e<a.length;e+=3){var k=a[e]*g,q=a[e+1]*g,n=a[e+2]*g;b+=Math.abs((c[k]-c[n])*(c[q+1]-c[k+1])-(c[k]-c[q])*(c[n+1]-c[k+1]))}return 0===d&&0===b?0:Math.abs((b-d)/d)};var q=function(){return function(c,
b,g){this.index=c;this.x=b;this.y=g;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}}()})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(a,d){function e(b,a,e){return Math.round(Math.max(Math.min(b,e),a))}Object.defineProperty(d,"__esModule",{value:!0});var h=new Float32Array(1),f=new Uint32Array(h.buffer);d.i8=function(b){return e(b,-128,127)};d.i16=function(b){return e(b,-32768,32767)};d.i32=function(b){return e(b,-2147483648,2147483647)};
d.u8=function(b){return e(b,0,255)};d.u16=function(b){return e(b,0,65535)};d.u32=function(b){return e(b,0,4294967295)};d.toUint32=function(b){h[0]=b;return f[0]};d.toFloat32=function(b){f[0]=b;return h[0]};d.u32to4Xu8=function(b){return[b&255,(b&65280)>>>8,(b&16711680)>>>16,(b&4278190080)>>>24]};d.i1616to32=function(b,a){return 65535&b|a<<16};d.i8888to32=function(b,a,e,c){return b&255|(a&255)<<8|(e&255)<<16|c<<24};d.i8816to32=function(b,a,e){return b&255|(a&255)<<8|e<<16};d.numTo32=function(b){return b|
0}})},"esri/views/2d/engine/webgl/enums":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});(function(a){a[a.FILL=0]="FILL";a[a.LINE=1]="LINE";a[a.MARKER=2]="MARKER";a[a.TEXT=3]="TEXT";a[a.LABEL=4]="LABEL"})(d.WGLGeometryType||(d.WGLGeometryType={}));(function(a){a[a.SUCCEEDED=0]="SUCCEEDED";a[a.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(d.WGLGeometryTransactionStatus||(d.WGLGeometryTransactionStatus={}));(function(a){a[a.NONE=0]="NONE";a[a.MAP=
1]="MAP";a[a.LABEL=2]="LABEL";a[a.LABEL_ALPHA=4]="LABEL_ALPHA";a[a.HITTEST=8]="HITTEST";a[a.HIGHLIGHT=16]="HIGHLIGHT";a[a.CLIP=32]="CLIP";a[a.DEBUG=64]="DEBUG";a[a.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(d.WGLDrawPhase||(d.WGLDrawPhase={}));(function(a){a[a.SIZE=0]="SIZE";a[a.COLOR=1]="COLOR";a[a.OPACITY=2]="OPACITY";a[a.ROTATION=3]="ROTATION"})(d.VVType||(d.VVType={}));(function(a){a[a.NONE=0]="NONE";a[a.OPACITY=1]="OPACITY";a[a.COLOR=2]="COLOR";a[a.ROTATION=4]="ROTATION";a[a.SIZE_MINMAX_VALUE=8]=
"SIZE_MINMAX_VALUE";a[a.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";a[a.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";a[a.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(d.WGLVVFlag||(d.WGLVVFlag={}));(function(a){a[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(d.WGLVVTarget||(d.WGLVVTarget={}));(function(a){a[a.SPRITE=0]="SPRITE";a[a.GLYPH=1]=
"GLYPH"})(d.MosaicType||(d.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define(["require","exports","tslib","./Bitmap","./webgl/TiledDisplayObject"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});a=function(b){function a(a,c,g,d){void 0===d&&(d=null);var e=b.call(this,a,c,g,g)||this;e.bitmap=new h.Bitmap(d);e.bitmap.coordScale=g;e.bitmap.once("isReady",function(){return e.ready()});return e}e.__extends(a,b);Object.defineProperty(a.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},
set:function(b){this.bitmap.stencilRef=b},enumerable:!0,configurable:!0});a.prototype.setTransform=function(a,c){b.prototype.setTransform.call(this,a,c);this.bitmap.transforms.dvs=this.transforms.dvs};a.prototype.onAttach=function(){this.bitmap.stage=this.stage};a.prototype.onDetach=function(){this.bitmap.stage=null};return a}(f.TiledDisplayObject);d.BitmapTile=a})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports tslib ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});a=function(c){function a(a,g,d,e){void 0===e&&(e=d);var l=c.call(this)||this;l.transforms={dvs:b.mat3f32.create(),tileMat3:b.mat3f32.create()};l.triangleCount=0;l.key=p.pool.acquire(a);l.bounds=g;l.size=d;l.coordRange=e;return l}e.__extends(a,c);a.prototype.destroy=function(){p.pool.release(this.key);this.key=null;this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(a.prototype,"coords",{get:function(){return this._coords},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bounds",{get:function(){return this._bounds},set:function(c){this._coords=[c[0],c[3]];this._bounds=c},enumerable:!0,configurable:!0});a.prototype.setTransform=function(c,b){b/=c.resolution*c.pixelRatio;var a=this.transforms.tileMat3,g=c.toScreenNoRotation([0,0],this.coords);f.mat3.set(a,this.size[0]/this.coordRange[0]*b,0,0,0,this.size[1]/this.coordRange[1]*b,0,g[0],g[1],1);f.mat3.multiply(this.transforms.dvs,c.displayViewMat3,a)};
return a}(m.DisplayObject);d.TiledDisplayObject=a})},"esri/views/2d/engine/webgl/TileContainer":function(){define("require exports tslib ./enums ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});d.sortByLevel=function(b,c){return 0!==b.key.level-c.key.level?b.key.level-c.key.level:0!==b.key.row-c.key.row?b.key.row-c.key.row:b.key.col-c.key.col};a=function(a){function c(c){var b=a.call(this)||this;b._tileInfoView=
c;return b}e.__extends(c,a);c.prototype.renderChildren=function(c){this.sortChildren(d.sortByLevel);this.setStencilReference();a.prototype.renderChildren.call(this,c)};c.prototype.createRenderParams=function(c){var b=c.state;return e.__assign(e.__assign({},a.prototype.createRenderParams.call(this,c)),{requiredLevel:this._tileInfoView.getClosestInfoForScale(b.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(b.scale)})};c.prototype.prepareRenderPasses=function(c){var g=this,d=c.registerRenderPass({name:"stencil",
brushes:[m.default],drawPhase:h.WGLDrawPhase.DEBUG|h.WGLDrawPhase.MAP,target:function(){return g.children}}),f=c.registerRenderPass({name:"tileInfo",brushes:[b.default],drawPhase:h.WGLDrawPhase.DEBUG,target:function(){return g.children},has:"esri-tiles-debug"});return e.__spreadArrays(a.prototype.prepareRenderPasses.call(this,c),[d,f])};c.prototype.updateTransforms=function(c){for(var b=0,a=this.children;b<a.length;b++){var g=a[b],d=this._tileInfoView.getTileResolution(g.key);g.setTransform(c,d)}};
c.prototype.setStencilReference=function(){for(var c=1,b=0,a=this.children;b<a.length;b++)a[b].stencilRef=c++};return c}(f.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});a=function(c){function b(){var b=null!==c&&c.apply(this,
arguments)||this;b._color=h.vec4f32.fromValues(1,0,0,1);return b}e.__extends(b,c);b.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);
this._canvas=null};b.prototype.prepareState=function(c){c=c.context;c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(1,771,1,771);c.setColorMask(!0,!0,!0,!0);c.setStencilWriteMask(0);c.setStencilTestEnabled(!1)};b.prototype.draw=function(c,b){c=c.context;if(b.isReady){this._loadWGLResources(c);c.bindVAO(this._outlineVertexArrayObject);c.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",b.coordRange[0],
b.coordRange[1]);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);c.drawArrays(3,0,4);c.bindVAO();var a=this._getTexture(c,b);a&&(c.bindVAO(this._tileInfoVertexArrayObject),c.bindProgram(this._tileInfoProgram),c.bindTexture(a,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",b.coordRange[0]/b.size[0],b.coordRange[1]/b.size[1]),
this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",a.descriptor.width,a.descriptor.height),c.drawArrays(5,0,4),c.bindVAO())}};b.prototype._loadWGLResources=function(c){if(!this._outlineProgram||!this._tileInfoProgram){var b=f.createProgram(c,m.background),a=f.createProgram(c,p.tileInfo),g={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},d=new Int8Array([0,0,1,0,1,1,0,1]),d=f.BufferObject.createVertex(c,35044,d),
d=new f.VertexArrayObject(c,m.background.attributes,g,{geometry:d}),e=new Int8Array([0,0,1,0,0,1,1,1]),e=f.BufferObject.createVertex(c,35044,e);c=new f.VertexArrayObject(c,p.tileInfo.attributes,g,{geometry:e});this._outlineProgram=b;this._tileInfoProgram=a;this._outlineVertexArrayObject=d;this._tileInfoVertexArrayObject=c}};b.prototype._getTexture=function(c,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width",
"300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var a=b.triangleCount,g=b.key.id;0<b.triangleCount&&(g+=", "+a);var d=this._canvas,e=d.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline="top";e.clearRect(0,0,300,32);1E5<a?(e.fillStyle="red",e.fillRect(0,0,300,32),e.fillStyle="black"):(e.clearRect(0,0,300,32),e.fillStyle="blue");e.fillText(g,0,0);b.texture=new f.Texture(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,
wrapMode:33071},d);return b.texture};return b}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this.name=this.constructor.name||"UnnamedBrush"}a.prototype.prepareState=function(a,d,b){};a.prototype.draw=function(a,d,b){};a.prototype.drawMany=function(a,d,b){for(var e=0;e<d.length;e++)this.draw(a,d[e],b)};return a}();d.default=a})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require",
"exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.background={name:"background",shaders:{vertexShader:e.resolveIncludes("background/background.vert"),fragmentShader:e.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","../../../../../webgl","./shaderRepository"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});var f=new e.ShaderCompiler(function(b){var a=
h.default;b.split("/").forEach(function(b){a&&(a=a[b])});return a});d.resolveIncludes=function(b){return f.resolveIncludes(b)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.default={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},
bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\n  return max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  float d \x3d q.x - min(q.w, q.y);\n  float e \x3d 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\n  float vIn \x3d rgb2v(Cb);\n  vec3 hsvTint \x3d rgb2hsv(Cs);\n  vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n  return hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\n  return (Cb \x3d\x3d 0.0) ? 0.0 : (Cs \x3d\x3d 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\n return (Cb \x3d\x3d 1.0) ? 1.0 : (Cs \x3d\x3d 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\n\treturn (Cs \x3d\x3d 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\n  if (Cs \x3c\x3d 0.5) {\n    return Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n  }\n  if (Cb \x3c\x3d 0.25) {\n    return Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n  }\n  return Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\n  return (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\n  return min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\n  return max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\n  return dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\n  return maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\n  float lum \x3d lumv3(color);\n  float mincol \x3d minv3(color);\n  float maxcol \x3d maxv3(color);\n  if (mincol \x3c 0.0) {\n    color \x3d lum + ((color - lum) * lum) / (lum - mincol);\n  }\n  if (maxcol \x3e 1.0) {\n    color \x3d lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n  }\n  return color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\n  float lbase \x3d lumv3(cbase);\n  float llum \x3d lumv3(clum);\n  float ldiff \x3d llum - lbase;\n  vec3 color \x3d cbase + vec3(ldiff);\n  return clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\n  float minbase \x3d minv3(cbase);\n  float sbase \x3d satv3(cbase);\n  float ssat \x3d satv3(csat);\n  vec3 color;\n  if (sbase \x3e 0.0) {\n    color \x3d (cbase - minbase) * ssat / sbase;\n  } else {\n    color \x3d vec3(0.0);\n  }\n  return setLum(color, clum);\n}\nvoid main() {\n  vec4 src \x3d texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\n  gl_FragColor \x3d src *  u_opacity;\n#else\n  vec4 dst \x3d texture2D(u_backbufferTexture, v_uv);\n  vec3 Cs \x3d src.a \x3d\x3d 0.0 ? src.rgb : vec3(src.rgb / src.a);\n  vec3 Cb \x3d dst.a \x3d\x3d 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\n  float as \x3d u_opacity * src.a;\n  float ab \x3d dst.a;\n  #ifdef DESTINATION_OVER\n    gl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n  #endif\n  #ifdef SOURCE_IN\n    gl_FragColor \x3d vec4(as * Cs * ab, as * ab);\n  #endif\n  #ifdef DESTINATION_IN\n    gl_FragColor \x3d vec4(ab * Cb * as, ab * as);\n  #endif\n  #ifdef SOURCE_OUT\n    gl_FragColor \x3d vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n  #endif\n  #ifdef DESTINATION_OUT\n    gl_FragColor \x3d vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n  #endif\n  #ifdef SOURCE_ATOP\n    gl_FragColor \x3d vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n  #endif\n  #ifdef DESTINATION_ATOP\n    gl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n  #endif\n  #ifdef XOR\n    gl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\n                        as * (1.0 - ab) + ab * (1.0 - as));\n  #endif\n  #ifdef MULTIPLY\n    gl_FragColor \x3d vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SCREEN\n    gl_FragColor \x3d vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef OVERLAY\n    vec3 f \x3d vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef DARKEN\n    gl_FragColor \x3d vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef LIGHTER\n    gl_FragColor \x3d vec4(as * Cs + ab * Cb, as + ab);\n  #endif\n  #ifdef LIGHTEN\n    gl_FragColor \x3d vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR_DODGE\n    vec3 f \x3d vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR_BURN\n    vec3 f \x3d vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef HARD_LIGHT\n    vec3 f \x3d vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SOFT_LIGHT\n    vec3 f \x3d vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef DIFFERENCE\n    gl_FragColor \x3d vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef EXCLUSION\n     vec3 f \x3d Cs + Cb - 2.0 * Cs * Cb;\n     gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef INVERT\n    gl_FragColor \x3d vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n  #endif\n  #ifdef VIVID_LIGHT\n    vec3 f \x3d vec3(vividLight(Cb.r, Cs.r),\n                  vividLight(Cb.g, Cs.g),\n                  vividLight(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef HUE\n    vec3 f \x3d setLumSat(Cs,Cb,Cb);\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef SATURATION\n    vec3 f \x3d setLumSat(Cb,Cs,Cb);\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef COLOR\n    vec3 f \x3d setLum(Cs,Cb);\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef LUMINOSITY\n    vec3 f \x3d setLum(Cb,Cs);\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef PLUS\n    gl_FragColor \x3d clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n  #endif\n  #ifdef MINUS\n     gl_FragColor \x3d vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n  #endif\n  #ifdef AVERAGE\n     vec3 f \x3d (Cb + Cs) / 2.0;\n     gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n  #ifdef REFLECT\n    vec3 f \x3d vec3(reflectBlend(Cb.r, Cs.r),\n                  reflectBlend(Cb.g, Cs.g),\n                  reflectBlend(Cb.b, Cs.b));\n    gl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\n                        as + ab * (1.0 - as));\n  #endif\n#endif\n}",
"blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position , 0.0, 1.0);\n  v_uv \x3d (a_position + 1.0) / 2.0;\n}"},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b \x3d 1.0 / 6.0;\n  float v2 \x3d v * v;\n  float v3 \x3d v2 * v;\n  float w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 \x3d b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w \x3d computeWeights(v);\n  float g0 \x3d w.x + w.y;\n  float g1 \x3d w.z + w.w;\n  float h0 \x3d 1.0 - (w.y / g0) + v;\n  float h1 \x3d 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\n  vec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\n  vec2 texel \x3d coords * texSize - 0.5;\n  vec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 \x3d coords + hgX.x * eX;\n  vec2 coords00 \x3d coords - hgX.y * eX;\n  vec2 coords11 \x3d coords10 + hgY.x * eY;\n  vec2 coords01 \x3d coords00 + hgY.x * eY;\n  coords10 \x3d coords10 - hgY.y * eY;\n  coords00 \x3d coords00 - hgY.y * eY;\n  vec4 color00 \x3d texture2D(sampler, coords00);\n  vec4 color10 \x3d texture2D(sampler, coords10);\n  vec4 color01 \x3d texture2D(sampler, coords01);\n  vec4 color11 \x3d texture2D(sampler, coords11);\n  color00 \x3d mix(color00, color01, hgY.z);\n  color10 \x3d mix(color10, color11, hgY.z);\n  color00 \x3d mix(color00, color10, hgX.z);\n  return color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart \x3d floor(coords * texSize);\n  vec2 coord0 \x3d texelStart / texSize;\n  vec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 \x3d texture2D(sampler, coord0);\n  vec4 color1 \x3d texture2D(sampler, coord1);\n  vec4 color2 \x3d texture2D(sampler, coord2);\n  vec4 color3 \x3d texture2D(sampler, coord3);\n  vec2 blend \x3d fract(coords * texSize);\n  vec4 color01 \x3d mix(color0, color1, blend.x);\n  vec4 color23 \x3d mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize \x3d 1.0 / texSize;\n  vec2 texel \x3d coords * texSize;\n  vec2 texel_i \x3d floor(texel);\n  vec2 texel_frac \x3d fract(texel);\n  vec4 colorP \x3d texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 \x3d vec4(colorP);\n  vec4 colorP2 \x3d vec4(colorP);\n  vec4 colorP3 \x3d vec4(colorP);\n  vec4 colorP4 \x3d vec4(colorP);\n  vec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\n    colorP1 \x3d colorA;\n  }\n  if (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\n    colorP2 \x3d colorB;\n  }\n  if (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\n    colorP3 \x3d colorC;\n  }\n  if (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\n    colorP4 \x3d colorD;\n  }\n  vec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\n  float flags \x3d data0.r * 255.0;\n  float groupMinZoom \x3d data0.g * 255.0;\n  float isVisible \x3d getFilterBit(flags, 0);\n  float wouldClip \x3d step(groupMinZoom, u_zoomLevel);\n  float direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState \x3d vec4(texel + direction * dt);\n  gl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  highp vec4 texel \x3d unpackLocalIdTexel(id);\n  highp float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256 + int(texel.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getFilterBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\n#include \x3cmaterials/effects.glsl\x3e\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor \x3d getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision highp float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color     \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity   \x3d getOpacity();\n  v_id        \x3d norm(a_id);\n  v_pos       \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.);\n  v_flags     \x3d getFilterFlags();\n#ifdef PATTERN\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  float width \x3d u_zoomFactor * a_aux1.x * aux2.x;\n  float height \x3d u_zoomFactor * a_aux1.y * aux2.y;\n  float angle \x3d C_256_TO_RAD * a_aux3.z;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  mat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n                           -sinA / width, cosA / height, 0,\n                            0,            0,             1);\n  vec2 symbolOffset \x3d (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED) / vec2(width, height);\n  v_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * POSITION_PRECISION, 1.0)).xy - symbolOffset;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos * POSITION_PRECISION + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},
icon:{"common.glsl":"uniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying highp float v_filters;\nvarying lowp float v_opacity;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  vec2 v_size \x3d v_sizeTex.xy;\n  vec2 v_tex  \x3d v_sizeTex.zw;\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\n  float a_bitSet \x3d a_bitSetAndDistRatio.z;\n  vec2 v_size \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0, a_bitSet);\n  vec2 v_tex      \x3d a_texCoords / u_mosaicSize;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity();\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0) + getOffset(a_offset, a_bitSet);\n  v_sizeTex  \x3d vec4(v_size.xy, v_tex.xy);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nuniform float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_glyphData.x;\n  float glyphMaxZoom    \x3d a_glyphData.y;\n  float glyphAngle      \x3d a_glyphData.z;\n  float a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\n  float a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\n  vec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\n  float a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize           \x3d a_texAndSize.z;\n  float haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\n  float z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  float animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\n  v_color     \x3d animation * ((1.0 - u_isHalo) * a_color + (u_isHalo * a_haloColor));\n  v_opacity   \x3d 1.0;\n  v_tex       \x3d a_texCoords / u_mosaicSize;\n  v_edgeDistanceOffset \x3d u_isHalo * haloSize / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\nvarying highp vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d v_lineHalfWidth;\n  mediump float adjustedPatternWidth \x3d v_patternSize.x * 2.0 * lineHalfWidth / v_patternSize.y;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / adjustedPatternWidth, 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexY, relativeTexX));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nconst float WIDTH_SCALE \x3d 1.0 / 1024.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * WIDTH_SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * WIDTH_SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity();\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  float SDF_CUTOFF \x3d (2.0 / 8.0);\n  float SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\n  edge /\x3d 2.0;\n#endif\n  lowp float aa \x3d v_antialiasingWidth;\n  lowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\n  gl_FragColor \x3d alpha * v_color * v_opacity;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio \x3d baseSize / referenceSize;\n   baseSize \x3d ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet      \x3d a_aux.w;\n  float a_fontSize    \x3d a_texFontSize.z;\n  vec2  a_offset      \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\n  float fontSize      \x3d getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor   \x3d fontSize / a_fontSize;\n  float fontScale     \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset        \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  mat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\n  v_color   \x3d u_isHalo * a_haloColor + (1.0 - u_isHalo) * getColor(a_color, a_bitSet, 1);\n  v_opacity \x3d getOpacity();\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texCoords / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\n  v_edgeDistanceOffset \x3d u_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nhighp vec4 unpackLocalIdTexel(in highp vec4 bitset) {\n  float isAggregate \x3d getBit(bitset.a, 7);\n  return (1.0 - isAggregate) * bitset + isAggregate * (vec4(bitset.rgba) - vec4(0.0, 0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\n  return (bytes - 127.0) / 127.0;\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData2(a_id);\n#else\n  vec4 data0 \x3d getAttributeData2(a_id);\n  vec4 data1 \x3d getAttributeData3(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\n  if (isNan(opacityValue)) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  float outSize \x3d getVVStopsSize(vvSize, size);\n  return isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_isFloatTexture;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\n  vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\n  targetLocation \x3d projectPixelLocation(targetLocation);\n#endif\n  return targetLocation;\n}\nbool isOutside(vec2 coords){\n   if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n     return true;\n   } else {\n     return false;\n   }\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#else\n  vec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\n  return color;\n}",
"contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\n  vec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\n  float maxI \x3d 255.0;\n  float mid \x3d 128.0;\n  float c \x3d u_contrastOffset;\n  float b \x3d u_brightnessOffset;\n  vec4 v;\n  if (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n  } else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n  } else if (c \x3d\x3d 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\n    v \x3d (sign(v) + 1.0) / 2.0;\n  } else if (c \x3d\x3d -100.0) {\n    v \x3d vec4(mid, mid, mid, currentPixel.a);\n  }\n  return vec4(v.r / 255.0, v.g / 255.0, v.b / 255.0, currentPixel.a);\n}",
"projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n  vec2 index_image \x3d floor(coords * u_targetImageSize);\n  vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n  vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n  vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n  vec2 srcLocation;\n  vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n  if (pos.s \x3c\x3d pos.t) {\n    vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n    vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n  } else {\n    vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n    vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n  }\n  return srcLocation;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include \x3craster/lut/colorize.glsl\x3e\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n  if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n    return 0.0;\n  }\n  else {\n    return e;\n  }\n}\nvec3 rgb2hsv(vec3 c) {\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  float d \x3d q.x - min(q.w, q.y);\n  float e \x3d 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n  val \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n  vec4 rgb \x3d colorize(vec4(val, val, val, 1.0), false);\n  vec3 hsv \x3d rgb2hsv(rgb.xyz);\n  hsv.z \x3d hillshade;\n  return vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  if (currentPixel.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec2 axy \x3d vec2(-1.0, -1.0);\n  vec2 bxy \x3d vec2(0.0, -1.0);\n  vec2 cxy \x3d vec2(1.0, -1.0);\n  vec2 dxy \x3d vec2(-1.0, 0.0);\n  vec2 fxy \x3d vec2(1.0, 0.0);\n  vec2 gxy \x3d vec2(-1.0, 1.0);\n  vec2 hxy \x3d vec2(0.0, 1.0);\n  vec2 ixy \x3d vec2(1.0, 1.0);\n  vec2 onePixel \x3d 1.0 / u_srcImageSize;\n  if (pixelLocation.s \x3c onePixel.s) {\n    axy[0] \x3d 1.0;\n    dxy[0] \x3d 1.0;\n    gxy[0] \x3d 1.0;\n  }\n  if (pixelLocation.t \x3c onePixel.t) {\n    axy[1] \x3d 1.0;\n    bxy[1] \x3d 1.0;\n    cxy[1] \x3d 1.0;\n  }\n  if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n    cxy[0] \x3d -1.0;\n    fxy[0] \x3d -1.0;\n    ixy[0] \x3d -1.0;\n  }\n  if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n    gxy[1] \x3d -1.0;\n    hxy[1] \x3d -1.0;\n    ixy[1] \x3d -1.0;\n  }\n  vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n  vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n  vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n  vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n  vec4 ve \x3d texture2D(u_image, pixelLocation);\n  vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n  vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n  vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n  vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n  float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n  float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n  float dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n  float hillshade \x3d 0.0;\n  if (u_hillshadeType \x3d\x3d 0){\n\t   float cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n     float z \x3d (u_cosZs[0] + cosDelta) / dzd;\n     if (z \x3c 0.0)  z \x3d 0.0;\n\t   hillshade \x3d z;\n  } else {\n\t  for (int k \x3d 0; k \x3c 6; k++) {\n\t\t float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n\t\t float z \x3d (u_cosZs[k] + cosDelta) / dzd;\n\t\t if (z \x3c 0.0) z \x3d 0.0;\n     hillshade \x3d hillshade + z * u_weights[k];\n\t\t if (k \x3d\x3d 5) break;\n    }\n  }\n  float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n#ifdef APPLY_COLORMAP\n  gl_FragColor \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\n#else\n  hillshade *\x3d alpha;\n  gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n#endif\n}",
"hillshade.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, bool isFloat) {\n  float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n  vec4 result;\n  if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n    result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n  } else {\n    vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n    vec4 color \x3d texture2D(u_colormap, clrPosition);\n    result \x3d vec4(color.rgb, 1.0) * color.a * u_opacity;\n  }\n  return result;\n}",
"lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  gl_FragColor \x3d colorize(currentPixel, true);\n}","lut.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos * u_scale + u_offset;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n  if (val \x3e\x3d maxCutOff) {\n    return maxOutput;\n  } else if (val \x3c\x3d minCutOff) {\n    return minOutput;\n  }\n  float stretchedVal;\n  if (useGamma) {\n  \tfloat tempf \x3d 1.0;\n\t  float outRange \x3d maxOutput - minOutput;\n\t  float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n\t  if (gamma \x3e 1.0) {\n      tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n    }\n    stretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n  } else {\n    stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n  }\n  return stretchedVal;\n}\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  if (currentPixel.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  if (u_bandCount \x3d\x3d 1) {\n    float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\n      gl_FragColor \x3d colorize(vec4(grayVal, grayVal, grayVal, currentPixel.a * u_opacity), !u_useGamma);\n#else\n      gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n  } else {\n    float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n    float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n    gl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n  }\n}",
"stretch.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos * u_scale + u_offset;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.tileInfo={name:"tileInfo",shaders:{vertexShader:e.resolveIncludes("tileInfo/tileInfo.vert"),
fragmentShader:e.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._color=h.vec4f32.fromValues(1,0,0,1);c._initialized=!1;return c}
e.__extends(c,b);c.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};c.prototype.prepareState=function(c,b){c=c.context;c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(7680,7680,7681);c.setStencilWriteMask(255);c.setStencilFunctionSeparate(1032,
516,b.stencilRef,255)};c.prototype.draw=function(c,b){c=c.context;this._initialized||this._initialize(c);c.bindVAO(this._solidVertexArrayObject);c.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._solidProgram.setUniform2fv("u_coord_range",b.coordRange);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);c.drawArrays(5,0,4);c.bindVAO()};c.prototype._initialize=function(c){if(this._initialized)return!0;
var b=f.createProgram(c,m.background);if(!b)return!1;var a=new Int8Array([0,0,1,0,0,1,1,1]),a=f.BufferObject.createVertex(c,35044,a);c=new f.VertexArrayObject(c,m.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:a});this._solidProgram=b;this._solidVertexArrayObject=c;return this._initialized=!0};return c}(b.default);d.default=a})},"esri/views/2d/engine/RasterTile":function(){define(["require","exports","tslib","./RasterBitmap",
"./webgl/TiledDisplayObject"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});a=function(b){function a(a,c,g,d){void 0===d&&(d=null);var e=b.call(this,a,c,g)||this;e.bitmap=new h.RasterBitmap(d,null,null);e.bitmap.coordScale=g;e.bitmap.once("isReady",function(){return e.ready()});return e}e.__extends(a,b);Object.defineProperty(a.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(b){this.bitmap.stencilRef=b},enumerable:!0,configurable:!0});a.prototype.getMemoryUsage=
function(){return this.bitmap.getMemoryUsage()};a.prototype.setTransform=function(a,c){b.prototype.setTransform.call(this,a,c);this.bitmap.transforms.dvs=this.transforms.dvs};a.prototype.release=function(){this.destroy();this.stage=this.bitmap=null;return!0};a.prototype.onAttach=function(){this.bitmap.stage=this.stage};a.prototype.onDetach=function(){this.bitmap.stage=null};return a}(f.TiledDisplayObject);d.RasterTile=a})},"esri/views/2d/engine/RasterBitmap":function(){define("require exports tslib ../../../core/maybe ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../../layers/support/rasterFunctions/pixelUtils ./DisplayObject ../../webgl/rasterUtils".split(" "),
function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});var u={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};a=function(c){function a(a,g,d){void 0===a&&(a=null);void 0===g&&(g=null);void 0===d&&(d=null);var e=c.call(this)||this;e._memoryUsed=null;e.stencilRef=0;e.coordScale=[1,1];e._symbolizerParameters=null;e.height=null;
e.pixelRatio=1;e.resolution=0;e.rotation=0;e._source=null;e.rawPixelData=null;e._suspended=!1;e._bandIds=null;e._interpolation=null;e._transformGrid=null;e.width=null;e.x=0;e.y=0;e.transforms={dvs:b.mat3f32.create()};e.source=a;e.transformGrid=g;e.interpolation=d;return e}e.__extends(a,c);Object.defineProperty(a.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||u},set:function(c){this._symbolizerParameters=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"source",{get:function(){return this._source},set:function(c){this._source=c;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"suspended",{get:function(){return this._suspended},set:function(c){this._suspended&&!c&&this.stage&&(this.ready(),this.requestRender());this._suspended=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bandIds",{get:function(){return this._bandIds},
set:function(c){this.stage&&this._updateRasterTexture(c);this._bandIds=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"interpolation",{get:function(){return this._interpolation},set:function(c){this._interpolation=c;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===c||"cubic"===c?9729:9728)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(c){this._transformGrid=c;this._transformGridTexture&&
(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)},enumerable:!0,configurable:!0});a.prototype.invalidateTexture=function(){this._updateTexture()};a.prototype.setTransform=function(c){var b=f.mat3.identity(this.transforms.dvs),a=c.toScreenNoRotation([0,0],this.x,this.y),g=this.resolution/this.pixelRatio/c.resolution,e=g*this.width,g=g*this.height,d=Math.PI*this.rotation/180;f.mat3.translate(b,b,m.vec2f32.fromValues(a[0],a[1]));f.mat3.translate(b,b,m.vec2f32.fromValues(e/
2,g/2));f.mat3.rotate(b,b,-d);f.mat3.translate(b,b,m.vec2f32.fromValues(-e/2,-g/2));f.mat3.scaleByVec2(b,b,m.vec2f32.fromValues(e,g));f.mat3.multiply(this.transforms.dvs,c.displayViewMat3,b)};a.prototype.getTextures=function(){if(!this._rasterTexture)return null;var c=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),c.push("u_transformGrid"));this._rasterTexture&&(b.push(this._rasterTexture),c.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),c.push("u_colormap"));
return{names:c,textures:b}};a.prototype.getMemoryUsage=function(){if(h.isNone(this._memoryUsed)){var c=this.getTextures();if(null==c)return 0;this._memoryUsed=c.textures.map(function(c){return c.descriptor.width*c.descriptor.height*4}).reduce(function(c,b){return c+b})}return this._memoryUsed};a.prototype.onAttach=function(){this.invalidateTexture()};a.prototype.onDetach=function(){this.invalidateTexture()};a.prototype._updateTexture=function(){var c,b,a;this.stage?(c=this.stage.context,b=(b=this.source)&&
b.pixels&&0<b.pixels.length,!this._rasterTexture&&b&&this._updateRasterTexture(this.bandIds),this._rasterTexture&&b&&(this._updateColormapTexture(),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=g.createTransformTexture(c,this.transformGrid))),this._rasterTexture&&!b&&this._rasterTexture.setData(null),this.suspended||(this.ready(),this.requestRender())):(null===(c=this._rasterTexture)||void 0===c?void 0:c.dispose(),null===(b=this._transformGridTexture)||void 0===b?void 0:
b.dispose(),null===(a=this._colormapTexture)||void 0===a?void 0:a.dispose(),this._colormapTexture=this._transformGridTexture=this._rasterTexture=null)};a.prototype._updateRasterTexture=function(c){var b=this.source?p.extractBands(this.source,c):null;if(b&&b.pixels&&0<b.pixels.length){c=null==c&&null==this.bandIds||c&&this.bandIds&&c.join("")===this.bandIds.join("");if(this._rasterTexture){if(c)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=g.createRasterTexture(this.stage.context,
b,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};a.prototype._updateColormapTexture=function(){var c=this._colormap,b=this.symbolizerParameters.colormap;if(b){var a=this.stage.context;if(!c)this._colormapTexture=g.createColormapTexture(a,b),this._colormap=b;else if(b.length!==c.length||b.some(function(b,a){return b!==c[a]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=g.createColormapTexture(a,
b),this._colormap=b}else this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null};return a}(c.DisplayObject);d.RasterBitmap=a})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(a,d,e){function h(b,c){b=Math.min(Math.max(b,-100),100);c=Math.min(Math.max(c,-100),100);var a,e,d=new Uint8Array(256);for(a=0;256>a;a++)0<b&&100>b?e=(200*a-25500+510*c)/(2*(100-b))+128:0>=b&&-100<b?e=(200*a-25500+
510*c)*(100+b)/2E4+128:100===b?(e=200*a-25500+256*(100-b)+510*c,e=0<e?255:0):-100===b&&(e=128),d[a]=255<e?255:0>e?0:e;return d}function f(b,c,a,e,d,f,l,h){return{xmin:d<=a*b?0:d<a*b+b?d-a*b:b,ymin:f<=e*c?0:f<e*c+c?f-e*c:c,xmax:d+l<=a*b?0:d+l<a*b+b?d+l-a*b:b,ymax:f+h<=e*c?0:f+h<e*c+c?f+h-e*c:c}}function b(b,c,a,d){var g=b.filter(function(c){return m(c)})[0];if(null==g)return null;var p=d?d.width:c.width;d=d?d.height:c.height;var l=g.width,h=g.height,t=c.width/l;c=c.height/h;var n=a?a.x:0;a=a?a.y:0;
var r=g.pixelType,k=e.getPixelArrayConstructor(r),w=g.pixels.length,g=[],q,u,B,A,D,E,H,J,F,C;for(D=0;D<w;D++){u=new k(p*d);for(E=0;E<c;E++)for(H=0;H<t;H++)if(B=b[E*t+H])for(q=B.pixels[D],C=f(l,h,H,E,n,a,p,d),J=C.ymin;J<C.ymax;J++)for(B=(E*h+J-a)*p+(H*l-n),A=J*l,F=C.xmin;F<C.xmax;F++)u[B+F]=q[A+F];g.push(u)}var G;if(b.some(function(c){return null==c||c.mask&&0<c.mask.length}))for(G=new Uint8Array(p*d),E=0;E<c;E++)for(H=0;H<t;H++)if(k=(B=b[E*t+H])?B.mask:null,C=f(l,h,H,E,n,a,p,d),k)for(J=C.ymin;J<C.ymax;J++)for(B=
(E*h+J-a)*p+(H*l-n),A=J*l,F=C.xmin;F<C.xmax;F++)G[B+F]=k[A+F];else if(B)for(J=C.ymin;J<C.ymax;J++)for(B=(E*h+J-a)*p+(H*l-n),A=J*l,F=C.xmin;F<C.xmax;F++)G[B+F]=1;else for(J=C.ymin;J<C.ymax;J++)for(B=(E*h+J-a)*p+(H*l-n),A=J*l,F=C.xmin;F<C.xmax;F++)G[B+F]=0;b=new e({width:p,height:d,pixels:g,pixelType:r,mask:G});b.updateStatistics();return b}Object.defineProperty(d,"__esModule",{value:!0});var m=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};d.extractBands=
function(b,c){if(!c||!m(b))return b;var a=b.pixels.length;return c&&c.some(function(c){return c>=a})||1===a&&1===c.length&&0===c[0]||a===c.length&&!c.some(function(c,b){return c!==b})?b:new e({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:c.map(function(c){return b.pixels[c]}),statistics:b.statistics&&c.map(function(c){return b.statistics[c]})})};d.createColormapLUT=function(b){if(b){var c=b.colormap;if(c&&0!==c.length){var c=
c.sort(function(c,b){return c[0]-b[0]}),a=0;0>c[0][0]&&(a=c[0][0]);var e=Math.max(256,c[c.length-1][0]-a+1),d=new Uint8Array(4*e),f=[],l=0,h=0,t=5===c[0].length;if(65536<e)return c.forEach(function(c){f[c[0]-a]=t?c.slice(1):c.slice(1).concat([255])}),{indexed2DColormap:f,offset:a,alphaSpecified:t};if(b.fillUnspecified)for(b=c[h],l=b[0]-a;l<e;l++)d[4*l]=b[1],d[4*l+1]=b[2],d[4*l+2]=b[3],d[4*l+3]=t?b[4]:255,l===b[0]-a&&(b=h===c.length-1?b:c[++h]);else for(l=0;l<c.length;l++)b=c[l],h=4*(b[0]-a),d[h]=
b[1],d[h+1]=b[2],d[h+2]=b[3],d[h+3]=t?b[4]:255;return{indexedColormap:d,offset:a,alphaSpecified:t}}}};d.colorize=function(b,c){if(!m(b)||!c&&(c.indexedColormap||c.indexed2DColormap))return b;var a=b.clone(),d=a.pixels,e=a.mask,f=a.width*a.height;if(1!==d.length)return b;var l=c.indexedColormap;b=c.indexed2DColormap;var h=c.offset;c=c.alphaSpecified;var t=l.length-1,n=0,d=d[0],r=new Uint8Array(d.length),k=new Uint8Array(d.length),p=new Uint8Array(d.length),q=0;if(l)if(e)for(n=0;n<f;n++)e[n]&&(q=4*
(d[n]-h),q<h||q>t?e[n]=0:(r[n]=l[q],k[n]=l[q+1],p[n]=l[q+2],e[n]=l[q+3]));else{e=new Uint8Array(f);for(n=0;n<f;n++)q=4*(d[n]-h),q<h||q>t?e[n]=0:(r[n]=l[q],k[n]=l[q+1],p[n]=l[q+2],e[n]=l[q+3]);a.mask=e}else if(e)for(n=0;n<f;n++)e[n]&&(l=b[d[n]],r[n]=l[0],k[n]=l[1],p[n]=l[2],e[n]=l[3]);else{e=new Uint8Array(f);for(n=0;n<f;n++)l=b[d[n]],r[n]=l[0],k[n]=l[1],p[n]=l[2],e[n]=l[3];a.mask=e}a.pixels=[r,k,p];a.statistics=null;a.pixelType="u8";a.maskIsAlpha=c;return a};d.estimateStatisticsHistograms=function(b){if(!m(b))return null;
b.statistics||b.updateStatistics();var c=b.pixels,a=b.mask,e=b.pixelType,d=b.statistics;b=b.width*b.height;var f=c.length,l,h,t,n,r,k=[],p=[],q,z,B;for(n=0;n<f;n++){q=new Uint32Array(256);B=c[n];if("u8"===e)if(l=-.5,h=255.5,a)for(r=0;r<b;r++)a[r]&&q[B[r]]++;else for(r=0;r<b;r++)q[B[r]]++;else{l=d[n].minValue;h=d[n].maxValue;t=(h-l)/256;z=new Uint32Array(257);if(a)for(r=0;r<b;r++)a[r]&&z[Math.floor((B[r]-l)/t)]++;else for(r=0;r<b;r++)z[Math.floor((B[r]-l)/t)]++;for(r=0;255>r;r++)q[r]=z[r];q[255]=z[255]+
z[256]}k.push({min:l,max:h,size:256,counts:q});for(r=B=z=t=0;256>r;r++)t+=q[r],z+=r*q[r];z/=t;for(r=0;256>r;r++)B+=q[r]*Math.pow(r-z,2);q=Math.sqrt(B/(t-1));t=(h-l)/256;r=(z+.5)*t+l;q*=t;p.push({min:l,max:h,avg:r,stddev:q})}return{statistics:p,histograms:k}};d.createStretchLUT=function(b){var c=b.minCutOff,a=b.maxCutOff,e=b.gamma,d=b.pixelType,f=b.outMin||0,l=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(d))return null;var m=c.length,t,n=0;"s8"===d?n=-127:"s16"===d&&(n=-32767);var r=256;-1<
["u16","s16"].indexOf(d)&&(r=65536);for(var k=[],p=l-f,d=0;d<m;d++)k[d]=a[d]-c[d];t=e&&e.length>=m;var q=[];if(t)for(d=0;d<m;d++)q[d]=1<e[d]?2<e[d]?6.5+Math.pow(e[d]-2,2.5):6.5+100*Math.pow(2-e[d],4):1;var z,B=[],A,D,E;if(t)for(d=0;d<m;d++){E=[];for(t=0;t<r;t++)A=t+n,z=(A-c[d])/k[d],D=1,1<e[d]&&(D-=Math.pow(1/p,z*q[d])),E[t]=A<a[d]&&A>c[d]?Math.floor(D*p*Math.pow(z,1/e[d]))+f:A>=a[d]?l:f;B[d]=E}else for(d=0;d<m;d++){E=[];for(t=0;t<r;t++)A=t+n,E[t]=A<=c[d]?f:A>=a[d]?l:Math.floor((A-c[d])/k[d]*p)+f;
B[d]=E}if(null!=b.contrastOffset)for(b=h(b.contrastOffset,b.brightnessOffset),d=0;d<m;d++)for(E=B[d],t=0;t<r;t++)E[t]=b[E[t]];return{lut:B,offset:n}};d.createContrastBrightnessLUT=h;d.stretch=function(b,c){if(!m(b))return null;b=b.clone();var a=b.pixels,d=b.mask,e=c.minCutOff,f=c.maxCutOff,l=c.gamma,h=c.outMin||0;c=c.outMax||255;var t=b.width*b.height,n=a.length,r,k,p,q,z,B=c-h,A=[];for(r=0;r<n;r++)A[r]=f[r]-e[r];k=l&&l.length>=n;var D=[];if(k)for(r=0;r<n;r++)D[r]=1<l[r]?2<l[r]?6.5+Math.pow(l[r]-
2,2.5):6.5+100*Math.pow(2-l[r],4):1;if(k)if(null!=d)for(k=0;k<t;k++){if(d[k])for(r=0;r<n;r++)p=a[r][k],z=(p-e[r])/A[r],q=1,1<l[r]&&(q-=Math.pow(1/B,z*D[r])),a[r][k]=p<f[r]&&p>e[r]?Math.floor(q*B*Math.pow(z,1/l[r]))+h:p>=f[r]?c:h}else for(k=0;k<t;k++)for(r=0;r<n;r++)p=a[r][k],z=(p-e[r])/A[r],q=1,1<l[r]&&(q-=Math.pow(1/B,z*D[r])),a[r][k]=p<f[r]&&p>e[r]?Math.floor(q*B*Math.pow(z,1/l[r]))+h:p>=f[r]?c:h;else if(null!=d)for(k=0;k<t;k++){if(d[k])for(r=0;r<n;r++)p=a[r][k],a[r][k]=p<f[r]&&p>e[r]?Math.floor((p-
e[r])/A[r]*B)+h:p>=f[r]?c:h}else for(k=0;k<t;k++)for(r=0;r<n;r++)p=a[r][k],a[r][k]=p<f[r]&&p>e[r]?Math.floor((p-e[r])/A[r]*B)+h:p>=f[r]?c:h;b.pixelType="u8";b.updateStatistics();return b};d.lookupPixels=function(b,c){if(!m(b))return null;var a=b.pixels,d=b.mask,f=b.width*b.height,h=a.length,l=c.lut;c=c.offset;var p,t;l&&1===l[0].length&&(l=a.map(function(){return l}));var n=[],r,k,w;if(c)if(null==d)for(p=0;p<h;p++){r=a[p];k=l[p];w=new Uint8Array(f);for(t=0;t<f;t++)w[t]=k[r[t]-c];n.push(w)}else for(p=
0;p<h;p++){r=a[p];k=l[p];w=new Uint8Array(f);for(t=0;t<f;t++)d[t]&&(w[t]=k[r[t]-c]);n.push(w)}else if(null==d)for(p=0;p<h;p++){r=a[p];k=l[p];w=new Uint8Array(f);for(t=0;t<f;t++)w[t]=k[r[t]];n.push(w)}else for(p=0;p<h;p++){r=a[p];k=l[p];w=new Uint8Array(f);for(t=0;t<f;t++)d[t]&&(w[t]=k[r[t]]);n.push(w)}b=new e({width:b.width,height:b.height,pixels:n,mask:d,pixelType:"u8"});b.updateStatistics();return b};d.remapColor=function(b,c){if(!m(b))return null;b=b.clone();var a=b.width*b.height,d=c.length,e=
Math.floor(d/2),f=c[Math.floor(e)],l=b.pixels[0],h,t,n,r,k,p,q=!1,z=new Uint8Array(a),B=new Uint8Array(a),A=new Uint8Array(a),D=b.mask,E=4===c[0].mappedColor.length;D||(D=new Uint8Array(a),D.fill(E?255:1),b.mask=D);for(k=0;k<a;k++)if(D[k]){h=l[k];q=!1;p=e;t=f;n=0;for(r=d-1;1<r-n;){if(h===t.value){q=!0;break}h>t.value?n=p:r=p;p=Math.floor((n+r)/2);t=c[Math.floor(p)]}q||(h===c[n].value?(t=c[n],q=!0):h===c[r].value?(t=c[r],q=!0):h<c[n].value?(q=!1,t=null):h>c[n].value&&(h<c[r].value?(t=c[n],q=!0):r===
d-1?(q=!1,t=null):(t=c[r],q=!0)));q?(z[k]=t.mappedColor[0],B[k]=t.mappedColor[1],A[k]=t.mappedColor[2],D[k]=t.mappedColor[3]):z[k]=B[k]=A[k]=D[k]=0}b.pixels=[z,B,A];b.mask=D;b.pixelType="u8";b.maskIsAlpha=E;return b};d.getClipBounds=f;d.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var d=a.filter(function(c){return c.pixelBlock})[0];if(!d)return null;var e=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width,f=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,h=.01*Math.min(e,f),l=a.sort(function(c,
b){return Math.abs(c.extent.ymax-b.extent.ymax)>h?b.extent.ymax-c.extent.ymax:Math.abs(c.extent.xmin-b.extent.xmin)>h?c.extent.xmin-b.extent.xmin:0}),m=Math.min.apply(null,l.map(function(c){return c.extent.xmin})),t=Math.min.apply(null,l.map(function(c){return c.extent.ymin})),n=Math.max.apply(null,l.map(function(c){return c.extent.xmax})),r=Math.max.apply(null,l.map(function(c){return c.extent.ymax}));a={x:Math.round((c.xmin-m)/e),y:Math.round((r-c.ymax)/f)};m={width:Math.round((n-m)/e),height:Math.round((r-
t)/f)};e={width:Math.round((c.xmax-c.xmin)/e),height:Math.round((c.ymax-c.ymin)/f)};if(Math.round(m.width/d.pixelBlock.width)*Math.round(m.height/d.pixelBlock.height)!==l.length||0>a.x||0>a.y||m.width<e.width||m.height<e.height)return null;d=l.map(function(c){return c.pixelBlock});d=b(d,m,a,e);return{extent:c,pixelBlock:d}};d.mosaic=b;d.setValidBoundary=function(b,c,a){if(!m(b))return null;var d=b.width,e=b.height,g=c.x;c=c.y;var f=a.width+g;a=a.height+c;if(0>g||0>c||f>d||a>e||0===g&&0===c&&f===d&&
a===e)return b;b.mask||(b.mask=new Uint8Array(d*e));for(var h=b.mask,t=0;t<e;t++)for(var n=t*d,r=0;r<d;r++)h[n+r]=t<c||t>=a||r<g||r>=f?0:1;b.updateStatistics();return b};d.clip=function(b,c,a){if(!m(b))return null;var d=c.x,g=c.y,f=c.x+a.width;c=c.x+a.height;if(c===b.height&&f===b.width)return b;for(var l=b.pixels,h=b.mask,t=b.width,n=t*b.height,r=l.length,k=[],p=0;p<r;p++){for(var q=l[p],z=e.createEmptyBand(b.pixelType,n),B=0,A=g;A<=c;A++)for(var D=A*t,E=d;E<=f;E++)z[B++]=q[D+E];k.push(z)}var H;
if(h)for(H=new Uint8Array(a.width*a.height),B=0,A=g;A<=c;A++)for(D=A*t,E=d;E<=f;E++)H[B++]=h[D+E];b=new e({width:a.width,height:a.height,pixels:k,mask:H});b.updateStatistics();return b};d.approximateTransform=function(b,c,a,d){if(!m(b))return null;var g=b.pixels,f=b.mask,l=b.pixelType,h=b.width,t=b.height;b=e.getPixelArrayConstructor(l);var n=g.length,r=c.width,k=c.height;c=d.cols;var p=d.rows,q=Math.ceil(r/c),u=Math.ceil(k/p),B=!1;for(d=0;d<a.length;d+=3)-1===a[d]&&-1===a[d+1]&&-1===a[d+2]&&(B=!0);
var A,D,E,H,J,F,C,G=new Float32Array(r*k),I=new Float32Array(r*k),K=0,M,N;for(d=0;d<u;d++)for(var L=0;L<q;L++){A=12*(d*q+L);D=a[A];E=a[A+1];H=a[A+2];J=a[A+3];F=a[A+4];C=a[A+5];for(var P=0;P<p;P++){K=(d*p+P)*r+L*c;N=(P+.5)/p;for(var O=0;O<P;O++)M=(O+.5)/c,G[K+O]=Math.round((D*M+E*N+H)*h-.5),I[K+O]=Math.round((J*M+F*N+C)*t-.5)}A+=6;D=a[A];E=a[A+1];H=a[A+2];J=a[A+3];F=a[A+4];C=a[A+5];for(P=0;P<p;P++)for(K=(d*p+P)*r+L*c,N=(P+.5)/p,O=P;O<c;O++)M=(O+.5)/c,G[K+O]=Math.round((D*M+E*N+H)*h-.5),I[K+O]=Math.round((J*
M+F*N+C)*t-.5)}a=function(c,b){for(var a=0;a<k;a++){A=a*r;for(var d=0;d<r;d++)c[A]=B&&(0>G[A]||0>I[A])?0:b[G[A]+I[A]*h],A++}};t=[];for(d=0;d<n;d++)c=new b(r*k),a(c,g[d]),t.push(c);g=new e({width:r,height:k,pixelType:l,pixels:t});if(f)g.mask=new Uint8Array(r*k),a(g.mask,f);else if(B)for(g.mask=new Uint8Array(r*k),d=0;d<r*k;d++)g.mask[d]=0>G[d]||0>I[d]?0:1;g.updateStatistics();return g}})},"esri/layers/support/PixelBlock":function(){define("require exports tslib ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators".split(" "),
function(a,d,e,h,f,b,m,p,c,g){var u=p.getLogger("esri.layers.support.PixelBlock");return function(b){function a(c){c=b.call(this,c)||this;c.width=null;c.height=null;c.pixelType="f32";c.validPixelCount=null;c.mask=null;c.maskIsAlpha=!1;c.pixels=null;c.statistics=null;return c}e.__extends(a,b);d=a;a.createEmptyBand=function(c,b){return new (d.getPixelArrayConstructor(c))(b)};a.getPixelArrayConstructor=function(c){var b;switch(c){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=
Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;case "u32":b=Uint32Array;break;case "f32":b=Float32Array;break;case "f64":b=Float64Array;break;case "c64":case "c128":case "unknown":b=Float32Array;break;default:h.neverReached(c)}return b};a.prototype.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();-1<["u1","u2","u4"].indexOf(c)?c="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(c)&&
(c="f32");return c};a.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};a.prototype.addData=function(c){if(!c.pixels||c.pixels.length!==this.width*this.height)throw new f("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics||{minValue:null,maxValue:null})};a.prototype.getAsRGBA=
function(){var c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};a.prototype.getAsRGBAFloat=function(){var c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};a.prototype.updateStatistics=function(){var c=this;this.statistics=this.pixels.map(function(b){return c._calculateBandStatistics(b,
c.mask)});var b=this.mask,a=0;if(b)for(var d=0;d<b.length;d++)b[d]&&a++;else a=this.width*this.height;this.validPixelCount=a};a.prototype.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c){var b;switch(c){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var a=b[0];b=b[1];for(var e=this.pixels,g=this.width*this.height,f=e.length,
q,l,h,m=[],p=0;p<f;p++){h=d.createEmptyBand(c,g);q=e[p];for(var y=0;y<g;y++)l=q[y],h[y]=l>b?b:l<a?a:l;m.push(h)}this.pixels=m;this.pixelType=c}};a.prototype.extractBands=function(b){var a=this;if(c.isNone(b)||0===b.length||null==this.pixels||0===this.pixels.length)return this;var e=this.pixels.length,g=b.some(function(c){return c>=a.pixels.length}),e=e===b.length&&!b.some(function(c,b){return c!==b});return g||e?this:new d({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,
validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:b.map(function(c){return a.pixels[c]}),statistics:this.statistics&&b.map(function(c){return a.statistics[c]})})};a.prototype.clone=function(){var c=new d({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,a=d.getPixelArrayConstructor(this.pixelType);
if(this.pixels&&0<this.pixels.length){c.pixels=[];var e=this.pixels[0].slice;for(b=0;b<this.pixels.length;b++)c.pixels[b]=e?this.pixels[b].slice(0,this.pixels[b].length):new a(this.pixels[b])}if(this.statistics)for(c.statistics=[],b=0;b<this.statistics.length;b++)c.statistics[b]=m.clone(this.statistics[b]);return c};a.prototype._fillFrom8Bit=function(c){var b=this.mask,a=this.maskIsAlpha,d=this.pixels;if(c&&d&&d.length){var e,g,q;e=g=q=d[0];3<=d.length?(g=d[1],q=d[2]):2===d.length&&(g=d[1]);c=new Uint32Array(c);
d=this.width*this.height;if(e.length!==d)u.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===d)if(a)for(a=0;a<d;a++)b[a]&&(c[a]=b[a]<<24|q[a]<<16|g[a]<<8|e[a]);else for(a=0;a<d;a++)b[a]&&(c[a]=-16777216|q[a]<<16|g[a]<<8|e[a]);else for(a=0;a<d;a++)c[a]=-16777216|q[a]<<16|g[a]<<8|e[a]}else u.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};a.prototype._fillFromNon8Bit=function(c){var b=this.pixels,a=this.mask,d=this.statistics;
if(c&&b&&b.length){var e=this.pixelType,g=1,q=0,g=1;d&&0<d.length?(q=d.map(function(c){return c.minValue}).reduce(function(c,b){return Math.min(c,b)}),g=d.map(function(c){return c.maxValue-c.minValue}).reduce(function(c,b){return Math.max(c,b)}),g=255/g):(g=255,"s8"===e?(q=-128,g=127):"u16"===e?g=65535:"s16"===e?(q=-32768,g=32767):"u32"===e?g=4294967295:"s32"===e?(q=-2147483648,g=2147483647):"f32"===e?(q=-3.4*1E39,g=3.4*1E39):"f64"===e&&(q=-Number.MAX_VALUE,g=Number.MAX_VALUE),g=255/(g-q));c=new Uint32Array(c);
var e=this.width*this.height,f,l,d=f=l=b[0];if(d.length!==e)return u.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(f=b[1],3<=b.length&&(l=b[2]),a&&a.length===e)for(b=0;b<e;b++)a[b]&&(c[b]=-16777216|(l[b]-q)*g<<16|(f[b]-q)*g<<8|(d[b]-q)*g);else for(b=0;b<e;b++)c[b]=-16777216|(l[b]-q)*g<<16|(f[b]-q)*g<<8|(d[b]-q)*g;else if(a&&a.length===e)for(b=0;b<e;b++)f=(d[b]-q)*g,a[b]&&(c[b]=-16777216|f<<16|f<<8|f);else for(b=0;b<e;b++)f=(d[b]-q)*g,c[b]=-16777216|
f<<16|f<<8|f}else u.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};a.prototype._fillFrom32Bit=function(c){var b=this.pixels,a=this.mask;if(!c||!b||!b.length)return u.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,e,g;d=e=g=b[0];3<=b.length?(e=b[1],g=b[2]):2===b.length&&(e=b[1]);var q=this.width*this.height;if(d.length!==q)return u.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var f=
0;if(a&&a.length===q)for(b=0;b<q;b++)c[f++]=d[b],c[f++]=e[b],c[f++]=g[b],c[f++]=a[b]&1;else for(b=0;b<q;b++)c[f++]=d[b],c[f++]=e[b],c[f++]=g[b],c[f++]=1};a.prototype._calculateBandStatistics=function(c,b){var a=Infinity,d=-Infinity,e=c.length,g,q=0;if(b)for(g=0;g<e;g++)b[g]&&(q=c[g],a=q<a?q:a,d=q>d?q:d);else for(g=0;g<e;g++)q=c[g],a=q<a?q:a,d=q>d?q:d;return{minValue:a,maxValue:d}};var d;e.__decorate([g.property({json:{write:!0}})],a.prototype,"width",void 0);e.__decorate([g.property({json:{write:!0}})],
a.prototype,"height",void 0);e.__decorate([g.property({json:{write:!0}})],a.prototype,"pixelType",void 0);e.__decorate([g.cast("pixelType")],a.prototype,"castPixelType",null);e.__decorate([g.property({json:{write:!0}})],a.prototype,"validPixelCount",void 0);e.__decorate([g.property({json:{write:!0}})],a.prototype,"mask",void 0);e.__decorate([g.property({json:{write:!0}})],a.prototype,"maskIsAlpha",void 0);e.__decorate([g.property({json:{write:!0}})],a.prototype,"pixels",void 0);e.__decorate([g.property({json:{write:!0}})],
a.prototype,"statistics",void 0);return a=d=e.__decorate([g.subclass("esri.layers.support.PixelBlock")],a)}(b.JSONSupport)})},"esri/views/webgl/rasterUtils":function(){define(["require","exports","../webgl"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.createRasterTexture=function(a,d,b,m){void 0===b&&(b="nearest");void 0===m&&(m=!1);var f=!(m&&"u8"===d.pixelType);m=f?5126:5121;f=null==d.pixels||0===d.pixels.length?null:f?d.getAsRGBAFloat():d.getAsRGBA();return new e.Texture(a,
{width:d.width,height:d.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===b||"cubic"===b?9729:9728,dataType:m,wrapMode:33071,flipped:!1},f)};d.createFrameBuffer=function(a,d,b,m){m=new e.Texture(a,{width:d,height:b,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:m?5121:5126,wrapMode:33071,flipped:!1});return new e.FramebufferObject(a,{colorTarget:0,depthStencilTarget:3,width:d,height:b},m)};d.createTransformTexture=function(a,d){for(var b=
4*d.size[0],f=d.size[1],h={width:b,height:f,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},b=new Float32Array(b*f*4),c=f=0;c<d.coefficients.length;c++)b[f++]=d.coefficients[c],2===c%3&&(b[f++]=1);return new e.Texture(a,h,b)};d.createColormapTexture=function(a,d){return new e.Texture(a,{width:d.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},d)};d.getCommonUniforms=
function(a,d,b,e,p,c){void 0===e&&(e=1);void 0===p&&(p=!0);void 0===c&&(c=!1);return{u_flipY:p,u_isFloatTexture:c,u_applyTransform:a?!0:!1,u_opacity:e,u_transformSpacing:a?a.spacing:null,u_transformGridSize:a?a.size:null,u_targetImageSize:d,u_srcImageSize:b}};d.getColormapUniforms=function(a,d){return{u_colormapOffset:d||0,u_colormapMaxIndex:a?a.length/4-1:null}};d.getBasicGridUniforms=function(a,d){return{u_scale:a,u_offset:d}};d.getStretchUniforms=function(a){return{u_bandCount:a.bandCount,u_minOutput:a.outMin,
u_maxOutput:a.outMax,u_minCutOff:a.minCutOff,u_maxCutOff:a.maxCutOff,u_factor:a.factor,u_useGamma:a.useGamma,u_gamma:a.gamma,u_gammaCorrection:a.gammaCorrection}};d.getShadedReliefUniforms=function(a){return{u_hillshadeType:a.hillshadeType,u_sinZcosAs:a.sinZcosAs,u_sinZsinAs:a.sinZsinAs,u_cosZs:a.cosZs,u_weights:a.weights,u_factor:a.factor,u_minValue:a.minValue,u_maxValue:a.maxValue}};d.getUniformLocationInfos=function(a,d){a=a.gl;d=d.glName;for(var b=a.getProgramParameter(d,a.ACTIVE_UNIFORMS),e=
new Map,f,c=0;c<b;c++)(f=a.getActiveUniform(d,c))&&e.set(f.name,{location:a.getUniformLocation(d,f.name),info:f});return e};d.setUniforms=function(a,d,b){Object.keys(b).forEach(function(e){var f=d.get(e)||d.get(e+"[0]");if(f){var c=b[e];if(null!==f&&null!=c)switch(f=f.info,f.type){case 5126:1<f.size?a.setUniform1fv(e,c):a.setUniform1f(e,c);break;case 35664:a.setUniform2fv(e,c);break;case 35665:a.setUniform3fv(e,c);break;case 35666:a.setUniform4fv(e,c);break;case 35675:a.setUniformMatrix3fv(e,c);break;
case 35676:a.setUniformMatrix4fv(e,c);break;case 5124:1<f.size?a.setUniform1iv(e,c):a.setUniform1i(e,c);break;case 35670:a.setUniform1i(e,c?1:0);break;case 35667:case 35671:a.setUniform2iv(e,c);break;case 35668:case 35672:a.setUniform3iv(e,c);break;case 35669:case 35673:a.setUniform4iv(e,c)}}})};d.setTextures=function(a,d,b,e){b.length===e.length&&(e.some(function(b){return null==b})||b.some(function(b){return null==b})||b.forEach(function(b,c){d.setUniform1i(b,c);a.bindTexture(e[c],c)}))}})},"esri/views/2d/engine/RasterTileContainer":function(){define("require exports tslib ../../../geometry/support/aaBoundingRect ../engine ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});a=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}e.__extends(a,c);a.prototype.createTile=function(c){var a=this._tileInfoView.getTileBounds(h.create(),c);return new b.RasterTile(c,a,this._tileInfoView.tileInfo.size)};a.prototype.destroyTile=function(){};a.prototype.prepareRenderPasses=function(b){var a=this,d=b.registerRenderPass({name:"bitmap (tile)",brushes:[f.brushes.Raster],target:function(){return a.children.map(function(c){return c.bitmap})},
drawPhase:m.WGLDrawPhase.MAP});return e.__spreadArrays(c.prototype.prepareRenderPasses.call(this,b),[d])};a.prototype.doRender=function(b){this.visible&&b.drawPhase===m.WGLDrawPhase.MAP&&c.prototype.doRender.call(this,b)};return a}(p.default);d.RasterTileContainer=a})},"esri/views/2d/engine/Stage":function(){define("require exports tslib ../../../core/Error ../../../core/events ../../../core/has ../../../core/promiseUtils ../../../core/scheduling ../../../core/SetUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/Profiler ./webgl/WebGLDriverTest ./webgl/shaders/StencilPrograms ../support/Timeline ../../support/screenshotUtils".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r,k,w,q,z,B,A,D){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(c,d){var e=a.call(this)||this;e._renderParameters={drawPhase:0,state:e.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null};e._trash=new Set;e._clipData=new Float32Array(8);e._upperLeft=y.vec2f64.create();e._upperRight=y.vec2f64.create();e._lowerLeft=y.vec2f64.create();e._lowerRight=y.vec2f64.create();e._mat2=x.mat2df64.create();e._clipRendererInitialized=
!1;e._supersampleScreenshots=!0;e.dataUploadCounter=0;e.renderRequested=!1;e.stage=e;e._stationary=!0;var g=d.canvas,g=void 0===g?document.createElement("canvas"):g,k=d.alpha,l=d.stencil,n=d.renderContext,r=d.supersampleScreenshots,r=void 0===r?!0:r,m=d.contextOptions,m=void 0===m?{}:m;e._canvas=g;k=t.createContextOrErrorHTML(g,{alpha:void 0===k?!0:k,antialias:!1,depth:!0,stencil:void 0===l?!0:l},void 0===n?"webgl":n);e.context=new t.RenderingContext(k,m);e.painter=new w.default(e.context,e);e._taskHandle=
p.addFrameTask({render:function(){return e.renderFrame()}});e._taskHandle.pause();e._supersampleScreenshots=r;e._lostWebGLContextHandle=f.on(g,"webglcontextlost",function(){e.emit("webgl-error",{error:new h("webgl-context-lost")})});b("esri-2d-profiler")&&(e._debugOutput=document.createElement("div"),e._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),c.appendChild(e._debugOutput));g.setAttribute("style","width: 100%; height:100%; display:block;");e.profiler=
new q.Profiler(e.context,e._debugOutput);e.renderingOptions=d.renderingOptions;e.timeline=d.timeline||new A.Timeline;e.driverTestResult=z.testWebGLDriver(e.context);c.appendChild(g);return e}e.__extends(d,a);d.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&
(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput);this.painter.dispose();this.context.dispose();this._canvas=null};Object.defineProperty(d.prototype,"background",{get:function(){return this._background},
set:function(c){this._background=c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(c){var b=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null);if(this._highlightOptions=c)this._highlightOptionsHandle=g.init(this._highlightOptions,"version",function(){b.painter.setHighlightOptions(c);b.requestRender()})},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"renderingOptions",{get:function(){return this._renderingOptions},set:function(c){this._renderingOptions=c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this._state},set:function(c){this._state=c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stationary",{get:function(){return this._stationary},set:function(c){this._stationary!==c&&(this._stationary=
c,this.requestRender())},enumerable:!0,configurable:!0});d.prototype.trashDisplayObject=function(c){this._trash.add(c);this.requestRender()};d.prototype.untrashDisplayObject=function(c){return this._trash.delete(c)};d.prototype.requestRender=function(){this._lastRenderRequestTime=Date.now();this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle&&this._taskHandle.resume())};d.prototype.renderFrame=function(){Date.now()-this._lastRenderRequestTime>=r.MAX_ANIMATION_TIME_MS&&
this._taskHandle.pause();this.renderRequested=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;for(this.processRender(this._renderParameters);0<this._trash.size;){var b=c.valuesOfSet(this._trash);this._trash.clear();for(var a=0;a<b.length;a++)b[a].processDetach()}this.emit("post-render")};d.prototype.renderChildren=function(c){var a=this.context,d=this.children,
d=c.children?c.children:d;this.profiler.recordStart("drawLayers");this.dataUploadCounter=0;this.beforeRenderChildren(c);c.drawPhase=k.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(a,this.background);for(var e=0;e<d.length;e++){var g=d[e];g.processRender(c)}this.painter.renderLayers(a);c.drawPhase=k.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(a);for(e=0;e<d.length;e++)g=d[e],g.processRender(c);this.painter.renderLayers(a);if(b("esri-tiles-debug")){c.drawPhase=k.WGLDrawPhase.DEBUG;this.painter.beforeRenderLayers(a);
for(e=0;e<d.length;e++)g=d[e],g.processRender(c);this.painter.renderLayers(a)}this.profiler.recordEnd("drawLayers");this.afterRenderChildren()};d.prototype.beforeRenderChildren=function(c){var b=this.context,a=c.state,d=c.pixelRatio;if(this.painter){b.enforceState();var e=a.size;c=a.rotation;var g=Math.round(e[0]*d),e=Math.round(e[1]*d);this._boundFBO=b.getBoundFramebufferObject();if(a.spatialReference&&(a.spatialReference._isWrappable?a.spatialReference._isWrappable():a.spatialReference.isWrappable)){var k=
u.common.toRadian(c),q=Math.abs(Math.cos(k)),f=Math.abs(Math.sin(k)),n=Math.round(a.worldScreenWidth);if(Math.round(g*q+e*f)<=n)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===g&&this._clipFBO.height===e||(this._clipFBO=new t.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:g,height:e}));var h=(this.state.padding.left-this.state.padding.right)/2,r=(this.state.padding.bottom-this.state.padding.top)/2,m=.5*g,p=.5*e,a=1/g,w=1/e,d=.5*n*d,y=.5*(g*f+e*q),g=this._upperLeft,q=this._upperRight,
f=this._lowerLeft,n=this._lowerRight;l.vec2.set(g,-d,-y);l.vec2.set(q,d,-y);l.vec2.set(f,-d,y);l.vec2.set(n,d,y);v.mat2d.identity(this._mat2);v.mat2d.translate(this._mat2,this._mat2,[m+h,p+r]);0!==c&&v.mat2d.rotate(this._mat2,this._mat2,k);l.vec2.transformMat2d(g,g,this._mat2);l.vec2.transformMat2d(q,q,this._mat2);l.vec2.transformMat2d(f,f,this._mat2);l.vec2.transformMat2d(n,n,this._mat2);c=this._clipData;c.set([2*f[0]*a-1,2*(e-f[1])*w-1,2*n[0]*a-1,2*(e-n[1])*w-1,2*g[0]*a-1,2*(e-g[1])*w-1,2*q[0]*
a-1,2*(e-q[1])*w-1]);this._clipRendererInitialized||this._initializeClipRenderer(b);this._clipVBO.setData(c);this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._clipFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};d.prototype.afterRenderChildren=function(){var c=
this.context;c.logIno();if(this._clipFrame&&this._clipRendererInitialized){c.bindFramebuffer(this._boundFBO);this._boundFBO=null;c.bindVAO(this._clipVAO);c.bindProgram(this._clipStencilProgram);c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(7680,7680,7681);c.setStencilWriteMask(255);c.setStencilFunction(519,1,255);c.drawElements(4,6,5123,0);c.bindVAO();c.setColorMask(!0,!0,!0,!0);if(null!=this.background){var b=
this.background.color,a=b.a;c.setClearColor(a*b.r/255,a*b.g/255,a*b.b/255,a)}else c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.setBlendingEnabled(!0);c.setStencilFunction(514,1,255);this.painter.blitTexture(c,this._clipFBO.colorTexture,9728,1);c.setStencilTestEnabled(!1)}};d.prototype.doRender=function(c){var b=this.context,d=c.state,e=c.pixelRatio;this._resizeCanvas(c);this.context.enforceState();b.setViewport(0,0,e*d.size[0],e*d.size[1]);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);
a.prototype.doRender.call(this,c)};d.prototype.takeScreenshot=function(c,b){var a=D.screenshotSuperSampleSettings(c,this._supersampleScreenshots,this._state.padding),d=a.framebufferWidth,e=a.framebufferHeight,g=this.context,k=c.layers,q={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:a.pixelRatio,blendMode:null};if(null!=c.rotation){var f=q.state.viewpoint;f.rotation=c.rotation;q.state.viewpoint=f}0<k.length&&(q.children=[],k.forEach(function(c){var a=
b.find(function(b){return b.layer.id===c.id});a&&"container"in a&&a.container&&q.children.push(a.container)}));var l=new t.FramebufferObject(g,{colorTarget:0,depthStencilTarget:3,width:d,height:e}),k=g.getBoundFramebufferObject(),f=g.getViewport();g.bindFramebuffer(l);g.setViewport(0,0,d,e);this.renderChildren(q);a=this._readbackScreenshot(a);g.bindFramebuffer(k);g.setViewport(f.x,f.y,f.width,f.height);this.requestRender();g=this._ensureScreenshotEncodeCanvas();c=D.encodeResult(a,c,g,{flipY:!0,premultipliedAlpha:!0});
return m.resolve(c)};d.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};d.prototype._readbackScreenshot=function(c){var b=c.framebufferWidth,a=c.framebufferHeight,d=c.region;c=c.resample;var e=this.context.gl;if(c){var g=D.createEmptyImageData(b,a,this._ensureScreenshotEncodeCanvas());e.readPixels(0,0,b,a,6408,5121,new Uint8Array(g.data.buffer));b=D.createEmptyImageData(d.width,
d.height,this._ensureScreenshotEncodeCanvas());return D.resampleHermite(g,b,!0,c.region.x,a-(c.region.y+c.region.height),c.region.width,c.region.height)}g=D.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());e.readPixels(d.x,a-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(g.data.buffer));return g};d.prototype._resizeCanvas=function(c){var b=this._canvas,a=b.style,d=c.state.size,e=c.pixelRatio;c=d[0];var d=d[1],g=Math.round(c*e),e=Math.round(d*e);if(b.width!==g||
b.height!==e)b.width=g,b.height=e;a.width=c+"px";a.height=d+"px"};d.prototype._initializeClipRenderer=function(c){if(this._clipRendererInitialized)return!0;var b=B.stencil.attributes,a=t.createProgram(c,B.stencil);if(!a)return!1;var d=t.BufferObject.createVertex(c,35040,32),e=new Uint16Array([0,1,2,2,1,3]),e=t.BufferObject.createIndex(c,35044,e);c=new t.VertexArrayObject(c,b,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:d},e);this._clipStencilProgram=
a;this._clipVBO=d;this._clipVAO=c;return this._clipRendererInitialized=!0};return d}(n.Container);d.Stage=a})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.WEBGL_MAX_STOPS=8;d.WEBGL_MAX_INNER_STOPS=d.WEBGL_MAX_STOPS-2;d.NAN_MAGIC_NUMBER=1E-30;d.EXTRUDE_SCALE=64;d.PICTURE_FILL_COLOR=4294967295;d.TILE_SIZE=512;d.RASTER_TILE_SIZE=256;d.ANGLE_FACTOR_256=256/360;d.DEBUG_LABELS=!1;d.COLLISION_BUCKET_SIZE=
128;d.DOT_DENSITY_MAX_FIELDS=8;d.MAGIC_LABEL_LINE_HEIGHT=29;d.COLLISION_MAX_ZOOM_DELTA=1;d.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;d.COLLISION_BOX_PADDING=16;d.COLLISION_TILE_BOX_SIZE=d.TILE_SIZE/d.COLLISION_BUCKET_SIZE;d.COLLISION_PLACEMENT_PADDING=8;d.HEURISTIC_GLYPHS_PER_LINE=50;d.HEURISTIC_GLYPHS_PER_FEATURE=10;d.GLYPH_SIZE=24;d.TEXT_PLACEMENT_PADDING=8;d.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};d.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;d.TEXTURE_BINDING_SPRITE_ATLAS=
0;d.TEXTURE_BINDING_GLYPH_ATLAS=0;d.TEXTURE_BINDING_BITMAP=0;d.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;d.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;d.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;d.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;d.TEXTURE_BINDING_HIGHLIGHT_0=5;d.TEXTURE_BINDING_HIGHLIGHT_1=6;d.TEXTURE_BINDING_RENDERER_0=5;d.TEXTURE_BINDING_RENDERER_1=6;d.ATTRIBUTE_DATA_FILTER_FLAGS=0;d.ATTRIBUTE_DATA_ANIMATION=1;d.ATTRIBUTE_DATA_VV=2;d.ATTRIBUTE_DATA_DD0=3;d.ATTRIBUTE_DATA_DD1=3;d.MAX_FILTERS=2;d.HIGHLIGHT_FLAG=1;d.FILTER_FLAG_0=
2;d.EFFECT_FLAG_0=4;d.THIN_LINE_THRESHOLD=2.5;d.HITTEST_SEARCH_SIZE=24;d.MAX_ANIMATION_TIME_MS=2E3;d.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;d.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;d.VTL_HIGH_RES_CUTOFF=1.15;d.MAX_GPU_UPLOADS_PER_FRAME=2})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/maybe ../../../webgl ../../engine ../vectorTiles/shaders/ProgramCache ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./effects/AnimationEffect ./effects/BlendEffect ./effects/HighlightEffect ./effects/HittestEffect ./painter/RenderPass".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y){function t(c,b){return 1!==b||e.isSome(c)&&"normal"!==c}Object.defineProperty(d,"__esModule",{value:!0});a=function(){return function(){}}();d.PainterOptions=a;a=function(){function a(a,d){this.context=a;this._blitRenderer=new m.BitBlitRenderer;this._brushCache=new Map;this._vtlProgramCache=null;this._blendEffect=new v.BlendEffect;this.brushNameToCtor={marker:f.brushes.Marker,line:f.brushes.Line,fill:f.brushes.Fill,text:f.brushes.Text,label:f.brushes.Label,
clip:f.brushes.Clip,stencil:f.brushes.Stencil,bitmap:f.brushes.Bitmap,tileInfo:f.brushes.TileInfo,vtlBackground:f.brushes.VTLBackground,vtlFill:f.brushes.VTLFill,vtlLine:f.brushes.VTLLine,vtlCircle:f.brushes.VTLCircle,vtlSymbol:f.brushes.VTLSymbol};this.effects={highlight:new x.default,hittest:new l.HittestEffect,integrate:new u.AnimationEffect};this.materialManager=new c(a);this._vtlProgramCache=new b.default(a);this.textureManager=new g(d)}a.prototype.getRenderTarget=function(){return this._renderTarget};
a.prototype.setRenderTarget=function(c){this._renderTarget=c};a.prototype.getFbos=function(c,b){if(c!==this._lastWidth||b!==this._lastHeight){this._lastWidth=c;this._lastHeight=b;if(this._fbos){for(var a in this._fbos)this._fbos[a].resize(c,b);return this._fbos}a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:c,height:b};var d={colorTarget:0,depthStencilTarget:3};this._stencilBuf=c=new h.Renderbuffer(this.context,{width:c,height:b,internalFormat:34041});this._fbos=
{output:new h.FramebufferObject(this.context,d,a,c),blend:new h.FramebufferObject(this.context,d,a,c),effect0:new h.FramebufferObject(this.context,d,a,c)}}return this._fbos};a.prototype.getSharedStencilBuffer=function(){return this._stencilBuf};a.prototype.beforeRenderLayers=function(c,b){void 0===b&&(b=null);var a=c.getViewport(),d=a.width,a=a.height;this._prevFBO=c.getBoundFramebufferObject();d=this.getFbos(d,a);c.bindFramebuffer(d.output);c.setDepthWriteEnabled(!0);e.isSome(b)?(b=b.color,d=b.a,
c.setClearColor(d*b.r/255,d*b.g/255,d*b.b/255,d)):c.setClearColor(0,0,0,0);c.setClearDepth(1);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT);c.setDepthWriteEnabled(!1)};a.prototype.beforeRenderLayer=function(c,b,a){var d=c.context;t(c.blendMode,a)?(d.bindFramebuffer(this._fbos.blend),d.setColorMask(!0,!0,!0,!0),d.setClearColor(0,0,0,0),d.clear(d.gl.COLOR_BUFFER_BIT)):(c=this._getOutputFBO(),d.bindFramebuffer(c));d.setDepthWriteEnabled(!1);d.setDepthTestEnabled(!1);d.setStencilTestEnabled(!0);
d.setClearStencil(b);d.setStencilWriteMask(255);d.clear(d.gl.STENCIL_BUFFER_BIT)};a.prototype.compositeLayer=function(c,b){var a=c.context,d=c.blendMode;if(t(d,b)){var g=this._getOutputFBO();a.bindFramebuffer(g);a.setStencilTestEnabled(!1);a.setStencilWriteMask(0);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a=e.isSome(d)?d:"normal";this._blendEffect.draw(c,this._fbos.blend.colorTexture,9728,a,b)}};a.prototype.renderLayers=function(c){c.bindFramebuffer(this._prevFBO);
if(this._fbos){var b=this._getOutputFBO();c.setStencilTestEnabled(!1);c.setStencilWriteMask(0);this.blitTexture(c,b.colorTexture,9728)}};a.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null);this._brushCache&&(this._brushCache.forEach(function(c){return c.dispose()}),this._brushCache.clear(),this._brushCache=
null);if(this._fbos)for(var c in this._fbos)this._fbos[c]&&this._fbos[c].dispose();if(this.effects)for(var b in this.effects)this.effects[b]&&this.effects[b].dispose();this._prevFBO=null};a.prototype.getGeometryBrush=function(c){var b;c=(b={},b[p.WGLGeometryType.FILL]=f.brushes.Fill,b[p.WGLGeometryType.LINE]=f.brushes.Line,b[p.WGLGeometryType.MARKER]=f.brushes.Marker,b[p.WGLGeometryType.TEXT]=f.brushes.Text,b)[c];b=this._brushCache.get(c);void 0===b&&(b=new c,this._brushCache.set(c,b));return this._brushCache.get(c)};
a.prototype.renderObject=function(c,b,a,d){a=this.brushNameToCtor[a];if(!a)return null;var e=this._brushCache.get(a);void 0===e&&(e=new a,this._brushCache.set(a,e));e.prepareState(c,b,d);e.draw(c,b,d)};a.prototype.renderObjects=function(c,b,a,d){a=this.brushNameToCtor[a];if(!a)return null;var e=this._brushCache.get(a);void 0===e&&(e=new a,this._brushCache.set(a,e));e.drawMany(c,b,d)};a.prototype.getVectorTileProgramCach=function(){return this._vtlProgramCache};a.prototype.registerRenderPass=function(c){var b=
this,a=c.brushes.map(function(c){b._brushCache.has(c)||b._brushCache.set(c,new c);return b._brushCache.get(c)});return new y.default(a,c)};a.prototype.setHighlightOptions=function(c){this.effects.highlight.setHighlightOptions(c)};a.prototype.blitTexture=function(c,b,a,d){void 0===d&&(d=1);c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(1,771,1,771);c.setColorMask(!0,!0,!0,!0);this._blitRenderer.render(c,b,a,d)};a.prototype._getOutputFBO=function(){return null!=this._renderTarget?this._renderTarget:
this._fbos.output};return a}();d.default=a})},"esri/views/2d/engine/vectorTiles/shaders/ProgramCache":function(){define(["require","exports","../../../../webgl","./Programs"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(b){this._cache=Array(8);for(var a=0;8>a;a++)this._cache[a]={};this._programRepo=new e.ProgramCache(b)}a.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)};a.prototype.getProgram=function(b,
a,d){var c=this._cache[b];c[a]||(b=this._programRepo.getProgram(this._getProgramTemplate(b),d),c[a]=b);return c[a]};a.prototype.getProgramAttributes=function(b){switch(b){case 0:return h.background.attributes;case 5:return h.circle.attributes;case 1:return h.fill.attributes;case 4:return h.icon.attributes;case 3:return h.line.attributes;case 2:return h.outline.attributes;case 6:return h.text.attributes;default:return null}};a.prototype._getProgramTemplate=function(b){switch(b){case 0:return h.background;
case 5:return h.circle;case 1:return h.fill;case 4:return h.icon;case 3:return h.line;case 2:return h.outline;case 6:return h.text;default:return null}};return a}();d.default=a})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});d.background={name:"background",shaders:function(b){return{vertexShader:e.glslifyDefineMap({ID:b.id,PATTERN:b.pattern})+h.resolveIncludes("background/background.vert"),
fragmentShader:e.glslifyDefineMap({ID:b.id,PATTERN:b.pattern})+h.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};d.circle={name:"circle",shaders:function(b){return{vertexShader:e.glslifyDefineMap({ID:b.id})+h.resolveIncludes("circle/circle.vert"),fragmentShader:e.glslifyDefineMap({ID:b.id})+h.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var f=function(b){return e.glslifyDefineMap({ID:b.id,DD:b.dd,PATTERN:b.pattern})};d.fill=
{name:"fill",shaders:function(b){return{vertexShader:f(b)+h.resolveIncludes("fill/fill.vert"),fragmentShader:f(b)+h.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};d.outline={name:"outline",shaders:function(b){return{vertexShader:e.glslifyDefineMap({ID:b.id,DD:b.dd})+h.resolveIncludes("outline/outline.vert"),fragmentShader:e.glslifyDefineMap({ID:b.id,DD:b.dd})+h.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};d.icon={name:"icon",
shaders:function(b){return{vertexShader:e.glslifyDefineMap({ID:b.id,DD:b.dd,SDF:b.sdf})+h.resolveIncludes("icon/icon.vert"),fragmentShader:e.glslifyDefineMap({ID:b.id,DD:b.dd,SDF:b.sdf})+h.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_visInfo:4,a_color:5,a_size:6}};var b=function(b){return e.glslifyDefineMap({ID:b.id,DD:b.dd,PATTERN:b.pattern})};d.line={name:"line",shaders:function(a){return{vertexShader:b(a)+h.resolveIncludes("line/line.vert"),fragmentShader:b(a)+
h.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};d.text={name:"text",shaders:function(b){return{vertexShader:e.glslifyDefineMap({ID:b.id,DD:b.dd})+h.resolveIncludes("text/text.vert"),fragmentShader:e.glslifyDefineMap({ID:b.id,DD:b.dd})+h.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_visInfo:4,a_color:5,a_size:6}}})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["require",
"exports","../../../../../webgl","./shaderRepository"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});var f=new e.ShaderCompiler(function(b){var a=h.default;b.split("/").forEach(function(b){a&&(a=a[b])});return a});d.resolveIncludes=function(b){return f.resolveIncludes(b)}})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.default={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n#else\n  gl_FragColor \x3d u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist \x3d length(v_offset);\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision \x3d 0.25;\nconst float blurPrecision \x3d 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color \x3d a_color * u_color;\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\n  v_radius \x3d a_data[2] * u_radius;\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset \x3d offset;\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_color[3] * color;\n#else\n  gl_FragColor \x3d v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio \x3d 0.248062016;\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * sofetEdgeRatio * size;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle         \x3d a_levelInfo[1];\n  mediump float a_minLevel      \x3d a_levelInfo[2];\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\n  v_size \x3d abs(offset);\n#ifdef SDF\n  offset \x3d (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size \x3d a_size * u_size;\n#else\n  mediump float icon_size \x3d u_size;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(icon_size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n  v_transparency *\x3d v_color.w;\n}"},
line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio \x3d 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d alpha * v_color[3] * color;\n#else\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\n  alpha *\x3d dashAlpha;\n  gl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth \x3d a_width * u_width;\n#else\n  v_lineHalfWidth \x3d u_width;\n#endif\n  v_lineHalfWidth +\x3d u_antialiasing;\n  v_lineHalfWidth *\x3d 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray \x3d u_dasharray * a_width;\n#else\n  v_dasharray \x3d u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist \x3d v_lineHalfWidth * scale * a_offsetAndNormal.xy;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) +  u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\n  v_blur \x3d u_blur + u_antialiasing;\n  #ifdef DD\n    v_color \x3d a_color * u_color;\n  #else\n    v_color \x3d u_color;\n  #endif\n  #ifdef ID\n    v_id \x3d u_id / 255.0;\n  #endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d abs(v_normal.y);\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_normal \x3d a_xnormal;\n  mediump vec2 dist \x3d u_outline_width * scale * a_offset;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nattribute vec4 a_visInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n  mediump float a_visMinAngle    \x3d a_visInfo[0];\n  mediump float a_visMaxAngle    \x3d a_visInfo[1];\n  mediump float delta_z \x3d 0.0;\n  mediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\n  if (a_visMinAngle \x3c a_visMaxAngle)\n  {\n    delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n  }\n  else\n  {\n    delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n  }\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo \x3e 0.5)\n  {\n    v_color \x3d u_color;\n  }\n  else\n  {\n    v_color \x3d a_color * u_color;\n  }\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef DD\n  v_size \x3d a_size * u_size;\n#else\n  v_size \x3d u_size;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * v_size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._initialized=
!1}a.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(b,a,d,c){b&&(this._initialized||this._initialize(b),b.setBlendFunctionSeparate(1,771,1,771),b.bindVAO(this._vertexArrayObject),b.bindProgram(this._program),a.setSamplingMode(d),b.bindTexture(a,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",c),b.drawArrays(5,
0,4),b.bindTexture(null,0),b.bindVAO())};a.prototype._initialize=function(b){if(this._initialized)return!0;var a=h.bitBlit.attributes,d=e.createProgram(b,h.bitBlit);if(!d)return!1;var c=new Int8Array(16);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=1;c[5]=-1;c[6]=1;c[7]=0;c[8]=-1;c[9]=1;c[10]=0;c[11]=1;c[12]=1;c[13]=1;c[14]=1;c[15]=1;b=new e.VertexArrayObject(b,a,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,
divisor:0}]},{geometry:e.BufferObject.createVertex(b,35044,c)});this._program=d;this._vertexArrayObject=b;return this._initialized=!0};return a}();d.BitBlitRenderer=a})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.bitBlit={name:"bitBlit",shaders:{vertexShader:e.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:e.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,
a_tex:1}}})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports tslib ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),function(a,d,e,h,f,b,m){var p=function(c){return c===b.WGLDrawPhase.HITTEST||c===b.WGLDrawPhase.LABEL_ALPHA},c=function(c,a,d,f){f=f.reduce(function(b,a){var d;return e.__assign(e.__assign({},b),(d={},d[a]=c.driverTestResult[a],d))},{});a=e.__assign(e.__assign(e.__assign(e.__assign({},a.getVariation()),c.rendererInfo.getVariation()),
{highlight:c.drawPhase===b.WGLDrawPhase.HIGHLIGHT,id:p(c.drawPhase)}),f);if(h.isSome(d))for(f=0;f<d.length;f++)a[d[f]]=!0;return a};return function(){function a(c){this._programByKey=new Map;this._programCache=new f.ProgramCache(c)}a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(c,b,a,d){void 0===a&&(a=[]);void 0===d&&(d=[]);var g=b.path+a.join(".")+d.join(".");if(this._programByKey.has(g))return this._programByKey.get(g);d=d.reduce(function(b,
a){var d;return e.__assign(e.__assign({},b),(d={},d[a]=c.driverTestResult[a],d))},{});a=e.__assign(e.__assign({},a.reduce(function(c,b){var a;return e.__assign(e.__assign({},c),(a={},a[b]=!0,a))},{})),d);b=this._programCache.getProgram(m.createProgramTemplate(b.path,b.attributes),a);if(!b)throw Error("Unable to get program for key: ${key}");this._programByKey.set(g,b);return b};a.prototype.getMaterialProgram=function(a,d,e,g,f,t){void 0===t&&(t=["ignoresSamplerPrecision"]);var l,r=t;l=a.rendererInfo;
var k=a.drawPhase,r=d.getVariationHash()+"-"+r.join(".")+"-",k=(p(k)?1:0)|(k===b.WGLDrawPhase.HIGHLIGHT?2:0);l=r+k+"-"+l.getVariationHash()+"-"+(h.isSome(f)&&f.join("."));if(this._programByKey.has(l))return this._programByKey.get(l);a=c(a,d,f,t);e=this._programCache.getProgram(m.createProgramTemplate(e,g),a);if(!e)throw Error("Unable to get program for key: ${key}");this._programByKey.set(l,e);return e};return a}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require",
"exports","../../../../webgl","./sources/resolver"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});var f=function(b){var a={},d;for(d in b){for(var c=d,g=void 0,g=""+c[0].toUpperCase(),f=1;f<c.length;f++){var h=c[f];h===h.toUpperCase()?(g+="_",g+=h):g+=h.toUpperCase()}a[g]=b[d]}return e.glslifyDefineMap(a)};d.createProgramTemplate=function(b,a){var d=b+b.substring(b.lastIndexOf("/"));return{name:name,attributes:a,shaders:function(c){return{vertexShader:f(c)+h.resolveIncludes(d+
".vert"),fragmentShader:f(c)+h.resolveIncludes(d+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports tslib ../../../../config ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./animatedFormats/apng ./animatedFormats/gif ./util/BidiText ./util/Result ./util/symbolUtils".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r,k,w,q,z,B,A,D){function E(c){switch(c.type){case "CIMSolidStroke":case "CIMSolidFill":return!0;case "esriSFS":return"esriSFSSolid"===c.style||"esriSFSNull"===c.style;case "esriSLS":return"esriSLSSolid"===c.style||"esriSLSNull"===c.style;default:return!1}}function H(c){switch(c.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!1;default:return!0}}function J(c){return e.__awaiter(this,
void 0,void 0,function(){var a,d;return e.__generator(this,function(e){switch(e.label){case 0:a=window.URL.createObjectURL(c),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,f(a,{responseType:"image"})];case 2:return d=e.sent().data,window.URL.revokeObjectURL(a),[2,d];case 3:return e.sent(),window.URL.revokeObjectURL(a),[2,new b("mapview-invalid-resource","Could not fetch requested resource at "+a)];case 4:return[2]}})})}function F(a,d){return e.__awaiter(this,void 0,void 0,function(){var g,k,q,
l,n,h,p,r,m;return e.__generator(this,function(t){switch(t.label){case 0:g=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;if(-1===g.indexOf(";base64,"))return[3,1];q=g.indexOf(";base64,")+8;l=g.substring(q);n=atob(l);h=new Uint8Array(n.length);for(p=0;p<n.length;p++)h[p]=n.charCodeAt(p);k=h.buffer;return[3,4];case 1:return t.trys.push([1,3,,4]),[4,f(g,e.__assign({responseType:"array-buffer"},d))];case 2:return k=r=t.sent().data,[3,4];case 3:return m=t.sent(),c.isAbortError(m)?[3,4]:
[2,new b("mapview-invalid-resource","Could not fetch requested resource at "+g)];case 4:return[2,k]}})})}var C=v.vec2f32.create(),G=m.getLogger("esri.views.2d.engine.webgl.TextureManager"),I=function(){function c(c,b,a){this.mosaicType=c;this.page=b;this.sdf=a}c.fromMosaic=function(b,a){return new c(b,a.page,a.sdf)};return c}();return function(){function a(c){this._invalidFontsMap=new Map;this._sdfConverter=new k.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._rasterizer=
new x.default;this._spriteMosaic=new w(c,2048,2048,500);this._glyphSource=new r(h.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new n(1024,1024,this._glyphSource)}a.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._rasterizer=this._glyphMosaic=this._spriteMosaic=null};Object.defineProperty(a.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glyphs",
{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});a.prototype.rasterizeItem=function(c,a,d){return e.__awaiter(this,void 0,void 0,function(){var g,k,f,q=this;return e.__generator(this,function(e){switch(e.label){case 0:if(p.isNone(c))return G.error(new b("mapview-null-resource","Unable to rasterize null resource",void 0)),[2,null];g=c.type;switch(g){case "CIMTextSymbol":return[3,1];case "esriTS":return[3,1]}return[3,3];case 1:return[4,this._rasterizeText(c,a,d)];case 2:return k=
e.sent(),k.forEach(function(c){return q._setTextureBinding(y.MosaicType.GLYPH,c)}),[2,{glyphMosaicItems:k}];case 3:return c.type&&-1!==c.type.toLowerCase().indexOf("3d")?(G.error(new b("mapview-invalid-type","MapView does not support symbol type: "+c.type,c)),[2,null]):[4,this._rasterizeSpriteSymbol(c,d)];case 4:return f=e.sent(),A.ok(f)&&f&&this._setTextureBinding(y.MosaicType.SPRITE,f),[2,{spriteMosaicItem:f}]}})})};a.prototype.bindTextures=function(c,b,a){if(0!==a.textureBinding){var d=this._bindingInfos[a.textureBinding-
1];a=d.page;switch(d.mosaicType){case y.MosaicType.SPRITE:var d=this.sprites.getWidth(a),e=this.sprites.getHeight(a),d=u.vec2.set(C,d,e);this._spriteMosaic.bind(c,9729,a,l.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform1i("u_texture",l.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform2fv("u_mosaicSize",d);break;case y.MosaicType.GLYPH:d=this.glyphs.width;e=this.glyphs.height;d=u.vec2.set(C,d,e);this._glyphMosaic.bind(c,9729,a,l.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform1i("u_texture",l.TEXTURE_BINDING_GLYPH_ATLAS);
b.setUniform2fv("u_mosaicSize",d);break;default:G.error("mapview-texture-manager","Cannot handle unknown type "+d.mosaicType)}}};a.prototype._hashMosaic=function(c,b){return 1|c<<1|(b.sdf?1:0)<<2|b.page<<3};a.prototype._setTextureBinding=function(c,b){var a=this._hashMosaic(c,b);this._hashToBindingIndex.has(a)||(c=I.fromMosaic(c,b),this._hashToBindingIndex.set(a,this._bindingInfos.length+1),this._bindingInfos.push(c));b.textureBinding=this._hashToBindingIndex.get(a)};a.prototype._rasterizeText=function(c,
a,d){return e.__awaiter(this,void 0,void 0,function(){var g,k,f;return e.__generator(this,function(e){switch(e.label){case 0:g=t.getFullyQualifiedFontName(c.font);k=this._invalidFontsMap.has(g);var q;if(a)q=a;else{q=B.bidiText(c.text)[0];for(var l=[],n=0;n<q.length;n++)l.push(q.charCodeAt(n));q=l}f=q;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._glyphMosaic.getGlyphItems(k?"arial-unicode-ms-regular":g,f,d)];case 2:return[2,e.sent()];case 3:return e.sent(),G.error(new b("mapview-invalid-resource",
"Couldn't find font "+g+". Falling back to Arial Unicode MS Regular",void 0)),this._invalidFontsMap.set(g,!0),[2,this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",f,d)];case 4:return[2]}})})};a.prototype._rasterizeSpriteSymbol=function(c,a){return e.__awaiter(this,void 0,void 0,function(){var d,g,k,f,q,l;return e.__generator(this,function(e){if(E(c))return[2,null];d=D.keyFromSymbol(c);return this._spriteMosaic.has(d)?[2,this._spriteMosaic.getSpriteItem(d)]:"esriSMS"===c.type&&c.path?[2,this._handleSVG(c,
d,a)]:c.url||c.imageData?[2,this._handleImage(c,d,a)]:(g=this._rasterizer.rasterizeJSONResource(c))?(k=g.size,f=g.image,q=g.sdf,l=g.simplePattern,[2,this._addItemToMosaic(d,k,{type:"static",data:f},H(c),q,l)]):[2,new b("TextureManager","unrecognized or null rasterized image")]})})};a.prototype._handleSVG=function(c,b,a){return e.__awaiter(this,void 0,void 0,function(){var d,g;return e.__generator(this,function(e){switch(e.label){case 0:return d=[126,126],[4,this._sdfConverter.draw(c.path,a)];case 1:return g=
e.sent(),[2,this._addItemToMosaic(b,d,{type:"static",data:new Uint32Array(g.buffer)},!1,!0,!0)]}})})};a.prototype._handleGIFOrPNG=function(a,d,g){return e.__awaiter(this,void 0,void 0,function(){var k,f,l,n,h,p,m,r,t,w,v,y;return e.__generator(this,function(e){switch(e.label){case 0:return[4,F(a,g)];case 1:k=e.sent();if(!A.ok(k))return[3,10];f=z.isGIF(k);l=q.isPNG(k);if(!f&&!l)return[2,new b("mapview-invalid-resource","Image data is neither GIF nor PNG!")];n=void 0;e.label=2;case 2:return e.trys.push([2,
7,,8]),f&&z.isAnimatedGIF(k)?[4,z.default.create(k,g)]:[3,4];case 3:return n=e.sent(),[3,6];case 4:return l&&q.isAnimatedPNG(k)?[4,q.default.create(k,g)]:[3,6];case 5:n=e.sent(),e.label=6;case 6:return[3,8];case 7:return h=e.sent(),c.isAbortError(h)?[3,8]:[2,new b("mapview-invalid-resource","Could not fetch requested resource!")];case 8:if(n&&A.ok(n))return[2,this._addItemToMosaic(d,[n.width,n.height],{type:"animated",data:n},H(a),!1,!1)];p=f?"image/gif":"image/png";m=new Blob([k],{type:p});return[4,
J(m)];case 9:if((r=e.sent())&&r instanceof HTMLImageElement)return t=this._rasterizer.rasterizeImageResource(r,a.colorSubstitutions),w=t.size,v=t.sdf,y=t.image,[2,this._addItemToMosaic(d,w,{type:"static",data:y},H(a),v,!1)];e.label=10;case 10:return[2,new b("mapview-invalid-resource","Could not handle resource!")]}})})};a.prototype._handleImage=function(a,d,k){return e.__awaiter(this,void 0,void 0,function(){var q,l,n,h,p,r,m;return e.__generator(this,function(t){switch(t.label){case 0:var w;(w=a.url&&
-1!==a.url.indexOf(".gif")||a.contentType&&"image/gif"===a.contentType||a.imageData&&-1!==a.imageData.indexOf("data:image/gif"))||(w=a.url&&-1!==a.url.indexOf(".png")||a.contentType&&"image/png"===a.contentType||a.imageData&&-1!==a.imageData.indexOf("data:image/png"));if(w)return[2,this._handleGIFOrPNG(a,d,k)];q=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;t.label=1;case 1:return t.trys.push([1,3,,4]),[4,f(q,e.__assign({responseType:"image"},k))];case 2:return l=t.sent().data,-1!==
q.indexOf("data:image/svg+xml")&&(l.width=g.pt2px(a.width),l.height=g.pt2px(a.height)),n=this._rasterizer.rasterizeImageResource(l,a.colorSubstitutions),h=n.size,p=n.sdf,r=n.image,[2,this._addItemToMosaic(d,h,{type:"static",data:r},H(a),p,!1)];case 3:return m=t.sent(),c.isAbortError(m)?[3,4]:[2,new b("mapview-invalid-resource","Could not fetch requested resource at "+q)];case 4:return[2,void 0]}})})};a.prototype._addItemToMosaic=function(c,b,a,d,e,g){return this._spriteMosaic.addSpriteItem(c,b,a,
d,e,g)};return a}()})},"esri/symbols/cim/Rasterizer":function(){define("require exports ./CIMSymbolHelper ./Rect ./SDFHelper ./utils".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){}a.prototype.dispose=function(){this._rasterizationCanvas=null};a.prototype.rasterizeJSONResource=function(b,c){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===b.type||"esriSFS"===b.type)return c=e.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,
b.style),{size:[c[1],c[2]],image:new Uint32Array(c[0].buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===b.type||"esriSLS"===b.type)return c=e.SymbolHelper.rasterizeSimpleLine(b.style,b.cap),{size:[c[1],c[2]],image:new Uint32Array(c[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var a,d;"simple-marker"===b.type||"esriSMS"===b.type||"line-marker"===b.type?(b=e.CIMSymbolHelper.fromSimpleMarker(b),d=f.getSDFInfo(b)):"CIMHatchFill"===b.type?(b=e.CIMSymbolHelper.fromCIMHatchFill(b),
a=new h.default(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-b.frame.ymin)):b.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===b.markerPlacement.type?(b=e.CIMSymbolHelper.fromCIMInsidePolygon(b),a=new h.default(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-b.frame.ymin)):d=f.getSDFInfo(b);if(d&&!c)return c=f.buildSDF(d),(a=c[0])?{size:[c[1],c[2]],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null;c=e.CIMSymbolHelper.rasterize(this._rasterizationCanvas,
b,a,!c);a=c[0];d=c[3];b=c[4];return a?{size:[c[1],c[2]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:d,anchorY:b}:null};a.prototype.rasterizeImageResource=function(a,c){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var d=this._rasterizationCanvas.getContext("2d");a instanceof ImageData?d.putImageData(a,0,0):(a.setAttribute("width",a.width.toString()),a.setAttribute("height",
a.height.toString()),d.drawImage(a,0,0,a.width,a.height));d=d.getImageData(0,0,a.width,a.height);d=new Uint8Array(d.data);if(c)for(var e=0;e<c.length;e++){var f=c[e];if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var h=f.oldColor,l=h[0],m=h[1],t=h[2],h=h[3],n=f.newColor,f=n[0],r=n[1],k=n[2],p=n[3];if(l!==f||m!==r||t!==k||h!==p)for(n=0;n<d.length;n+=4)l===d[n]&&m===d[n+1]&&t===d[n+2]&&h===d[n+3]&&(d[n]=f,d[n+1]=r,d[n+2]=k,d[n+3]=p)}}for(n=0;n<d.length;n+=4)c=d[n+3]/255,
d[n]*=c,d[n+1]*=c,d[n+2]*=c;c=a.width;e=a.height;l=d;if(512<=c||512<=e)l=a.width/a.height,1<l?(c=512,e=Math.round(512/l)):(e=512,c=Math.round(512*l)),l=new Uint8Array(4*c*e),b.resampleHermite(d,a.width,a.height,new Uint8ClampedArray(l.buffer),c,e,!1);return{size:[c,e],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return a}();d.default=a})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(a,d){function e(a){a=a.toLowerCase().split(" ").join("-");
switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}Object.defineProperty(d,"__esModule",{value:!0});d.getFullyQualifiedFontName=function(a){var d;a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":d="-bold";break a}d=""}var b;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":b="-italic";break a}b=""}d+=
b;return e(a.family)+(0<d.length?d:"-regular")};d.getFontDecorationTop=function(a){switch(a){case "underline":return-26;case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports tslib ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),function(a,d,e,h,f,b,m,p){function c(c){for(var b=new Set,a=0;a<c.length;a++)b.add(Math.floor(c[a]/256));return b}function g(c,b,a){c.has(b)||c.set(b,
a().then(function(){c.delete(b)}).catch(function(a){c.delete(b);f.throwIfNotAbortError(a)}));return c.get(b)}return function(){function a(c,b,a){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this.width=c;this.height=b;this._glyphSource=a;this._binPack=new p(c-4,b-4);this._glyphData.push(new Uint8Array(c*b));this._dirties.push(!0);this._textures.push(null);this._initDecorationGlyph()}a.prototype.dispose=
function(){this._binPack=null;for(var c=0,b=this._textures;c<b.length;c++){var a=b[c];a&&a.dispose()}this._textures.length=0;this._glyphData.length=0};a.prototype._initDecorationGlyph=function(){for(var c=[117,149,181,207,207,181,149,117],b=[],a=0;a<c.length;a++)for(var d=c[a],e=0;11>e;e++)b.push(d);c={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(b)};this._recordGlyph(c)};a.prototype.getGlyphItems=function(c,b,a){return e.__awaiter(this,void 0,void 0,function(){var d,g=
this;return e.__generator(this,function(e){switch(e.label){case 0:return d=this._getGlyphCache(c),[4,this._fetchRanges(c,b,a)];case 1:return e.sent(),[2,b.map(function(b){return g._getMosaicItem(d,c,b)})]}})})};a.prototype.bind=function(c,b,a,d){var e=this._getTexture(c,a);e.setSamplingMode(b);this._dirties[a]&&(e.setData(this._glyphData[a]),this._dirties[a]=!1);c.bindTexture(e,d)};a.prototype._getGlyphCache=function(c){this._glyphCache[c]||(this._glyphCache[c]={});return this._glyphCache[c]};a.prototype._getTexture=
function(c,a){this._textures[a]||(this._textures[a]=new b.Texture(c,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));return this._textures[a]};a.prototype._invalidate=function(){this._dirties[this._currentPage]=!0};a.prototype._fetchRanges=function(b,a,d){return e.__awaiter(this,void 0,void 0,function(){var g,l,n=this;return e.__generator(this,function(e){switch(e.label){case 0:return g=c(a),l=[],g.forEach(function(c){l.push(n._fetchRange(b,
c,d))}),[4,f.all(l)];case 1:return e.sent(),[2]}})})};a.prototype._fetchRange=function(c,b,a){return e.__awaiter(this,void 0,void 0,function(){var d,f=this;return e.__generator(this,function(e){if(256<b)return[2,null];d=c+b;return[2,g(this._rangePromises,d,function(){return f._glyphSource.getRange(c,b,a)})]})})};a.prototype._getMosaicItem=function(c,b,a){if(!c[a]){b=this._glyphSource.getGlyph(b,a);if(!b||!b.metrics)return{rect:new m.default(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,
top:0},code:a,sdf:!0};var d=this._recordGlyph(b);c[a]={rect:d,page:this._currentPage,metrics:b.metrics,code:a,sdf:!0};this._invalidate()}return c[a]};a.prototype._getMosaicItemsStable=function(c,b,a){var d=this,e=[],g=a.map(function(c){return c});a.map(function(c){return c}).sort().map(function(a){return d._getMosaicItem(c,b,a)}).forEach(function(c){var b=g.indexOf(c.code);e[b]=c;g[b]=null});return e};a.prototype._recordGlyph=function(c){var b=c.metrics;if(0===b.width)b=new m.default(0,0,0,0);else{var a=
b.width+6,d=b.height+6,b=this._binPack.allocate(a,d);b.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new p(this.width-4,this.height-4),b=this._binPack.allocate(a,d));var e=this._glyphData[this._currentPage];c=c.bitmap;var g=void 0,f=void 0;if(c)for(var k=0;k<d;k++)for(var g=
a*k,f=this.width*(b.y+k)+b.x,w=0;w<a;w++)e[f+w]=c[g+w];h("esri-glyph-debug")&&this._showDebugPage(e)}return b};a.prototype._showDebugPage=function(c){var b=document.createElement("canvas"),a=b.getContext("2d"),d=new ImageData(this.width,this.height),e=d.data;b.width=this.width;b.height=this.height;b.style.border="1px solid black";for(var g=0;g<c.length;++g)e[4*g+0]=c[g],e[4*g+1]=0,e[4*g+2]=0,e[4*g+3]=255;a.putImageData(d,0,0);document.body.appendChild(b)};return a}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require",
"exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,d,b,e){void 0===a&&(a=0);void 0===d&&(d=0);void 0===b&&(b=0);void 0===e&&(e=0);this.x=a;this.y=d;this.width=b;this.height=e}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});a.prototype.union=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,
a.height)};return a}();d.default=a})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(a,d,e){return function(){function a(a,b){this._height=this._width=0;this._free=[];this._width=a;this._height=b;this._free.push(new e.default(0,0,a,b))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});
a.prototype.allocate=function(a,b){if(a>this._width||b>this._height)return new e.default;for(var d=null,f=-1,c=0;c<this._free.length;++c){var g=this._free[c];a<=g.width&&b<=g.height&&(null===d||g.y<=d.y&&g.x<=d.x)&&(d=g,f=c)}if(null===d)return new e.default;this._free.splice(f,1);d.width<d.height?(d.width>a&&this._free.push(new e.default(d.x+a,d.y,d.width-a,b)),d.height>b&&this._free.push(new e.default(d.x,d.y+b,d.width,d.height-b))):(d.width>a&&this._free.push(new e.default(d.x+a,d.y,d.width-a,d.height)),
d.height>b&&this._free.push(new e.default(d.x,d.y+b,a,d.height-b)));return new e.default(d.x,d.y,a,b)};a.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var d=this._free[b];if(d.y===a.y&&d.height===a.height&&d.x+d.width===a.x)d.width+=a.width;else if(d.x===a.x&&d.width===a.width&&d.y+d.height===a.y)d.height+=a.height;else if(a.y===d.y&&a.height===d.height&&a.x+a.width===d.x)d.x=a.x,d.width+=a.width;else if(a.x===d.x&&a.width===d.width&&a.y+a.height===d.y)d.y=a.y,d.height+=a.height;
else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports tslib ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(a,d,e,h,f,b){var m=function(){function c(c){this._metrics=[];for(this._bitmaps=[];c.next();)switch(c.tag()){case 1:for(var b=c.getMessage();b.next();)switch(b.tag()){case 3:for(var a=b.getMessage(),d=void 0,e=void 0,g=void 0,f=void 0,n=void 0,
h=void 0,k=void 0;a.next();)switch(a.tag()){case 1:d=a.getUInt32();break;case 2:e=a.getBytes();break;case 3:g=a.getUInt32();break;case 4:f=a.getUInt32();break;case 5:n=a.getSInt32();break;case 6:h=a.getSInt32();break;case 7:k=a.getUInt32();break;default:a.skip()}a.release();d&&(this._metrics[d]={width:g,height:f,left:n,top:h,advance:k},this._bitmaps[d]=e);break;default:b.skip()}b.release();break;default:c.skip()}}c.prototype.getMetrics=function(c){return this._metrics[c]};c.prototype.getBitmap=function(c){return this._bitmaps[c]};
return c}(),p=function(){function c(){this._ranges=[]}c.prototype.getRange=function(c){return this._ranges[c]};c.prototype.addRange=function(c,b){this._ranges[c]=b};return c}();return function(){function c(c){this._glyphInfo={};this._baseURL=c}c.prototype.getRange=function(c,a,d){var g=this._getFontStack(c);if(g.getRange(a))return b.resolve();var l=256*a,p=l+255;c=this._baseURL.replace("{fontstack}",c).replace("{range}",l+"-"+p);return h(c,e.__assign({responseType:"array-buffer"},d)).then(function(c){g.addRange(a,
new m(new f(new Uint8Array(c.data),new DataView(c.data))))})};c.prototype.getGlyph=function(c,b){if(c=this._getFontStack(c)){var a=Math.floor(b/256);if(!(256<a)&&(c=c.getRange(a)))return{metrics:c.getMetrics(b),bitmap:c.getBitmap(b)}}};c.prototype._getFontStack=function(c){var b=this._glyphInfo[c];b||(b=this._glyphInfo[c]=new p);return b};return c}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils",
"./packingUtils"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function b(b){this.size=b;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=b;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b)}b.prototype.draw=function(b,a,c){var d=this;void 0===c&&(c=31);
this._initSVG();var p=this._createSVGString(b);return e.create(function(b,e){var g=new Image;g.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(p);g.onload=function(){d.context.clearRect(0,0,d.size,d.size);d.context.drawImage(g,0,0,d.size,d.size);for(var a=d.context.getImageData(0,0,d.size,d.size),e=new Uint8Array(d.size*d.size*4),l=0;l<d.size*d.size;l++){var k=a.data[4*l+3]/255;d._gridOuter[l]=1===k?0:0===k?1E20:Math.pow(Math.max(0,.5-k),2);d._gridInner[l]=1===k?1E20:0===k?0:Math.pow(Math.max(0,
k-.5),2)}d._edt(d._gridOuter,d.size,d.size);d._edt(d._gridInner,d.size,d.size);for(l=0;l<d.size*d.size;l++)f.packFloatRGBA(.5-(d._gridOuter[l]-d._gridInner[l])/(2*c),e,4*l);b(e)};var m=a&&a.signal;if(m)h.onAbort(m,function(){return e(h.createAbortError())})})};b.prototype._initSVG=function(){if(!this._svg){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");b.setAttribute("aria-hidden",
"true");b.setAttribute("role","presentation");document.body.appendChild(b);this._svg=b}};b.prototype._createSVGString=function(b){var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",b);this._svg.appendChild(a);b=a.getBBox();var c=b.width/b.height,d=this.size/2,e,f,h;1<c?(f=e=d/b.width,h=this.size/4,c=d-1/c*d/2):(e=f=d/b.height,h=d-d*c/2,c=this.size/4);a.setAttribute("style","transform: matrix("+e+", 0, 0, "+f+", "+(-b.x*e+h)+", "+(-b.y*f+c)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+
this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(a);return b};b.prototype._edt=function(b,a,c){for(var d=this._f,e=this._d,f=this._v,h=this._z,l=0;l<a;l++){for(var p=0;p<c;p++)d[p]=b[p*a+l];this._edt1d(d,e,f,h,c);for(p=0;p<c;p++)b[p*a+l]=e[p]}for(p=0;p<c;p++){for(l=0;l<a;l++)d[l]=b[p*a+l];this._edt1d(d,e,f,h,a);for(l=0;l<a;l++)b[p*a+l]=Math.sqrt(e[l])}};b.prototype._edt1d=function(b,a,c,d,e){c[0]=0;d[0]=-1E20;
d[1]=1E20;for(var g=1,f=0;g<e;g++){for(var l=(b[g]+g*g-(b[c[f]]+c[f]*c[f]))/(2*g-2*c[f]);l<=d[f];)f--,l=(b[g]+g*g-(b[c[f]]+c[f]*c[f]))/(2*g-2*c[f]);f++;c[f]=g;d[f]=l;d[f+1]=1E20}for(f=g=0;g<e;g++){for(;d[f+1]<g;)f++;a[g]=(g-c[f])*(g-c[f])+b[c[f]]}};return b}();d.default=a})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require","exports"],function(a,d){function e(b){return b-Math.floor(b)}Object.defineProperty(d,"__esModule",{value:!0});var h=[1,256,65536,16777216],f=[1/256,1/65536,
1/16777216,1/4294967296],b=function(b,a){void 0===a&&(a=0);for(var c=0,d=0;4>d;d++)c+=b[a+d]*f[d];return c}(new Uint8ClampedArray([255,255,255,255]));d.packFloatRGBA=function(a,d,c){void 0===c&&(c=0);a=0>a?0:a>b?b:a;for(var g=0;4>g;g++)d[c+g]=Math.floor(256*e(a*h[g]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),function(a,d,e,
h,f,b,m,p,c){function g(c){return c&&"static"===c.type}return function(){function a(b,a,d,e){void 0===e&&(e=0);this._mosaicPages=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=h("fix-sprite-locations");this._testId=h("test-id");this._pageHeight=this._pageWidth=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=d)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=d;this._requestRender=
b;0<e&&(this._maxItemSize=e);this.pixelRatio=window.devicePixelRatio||1;if(this._fixSpriteLocationsTable){b=[];for(var g in this._fixSpriteLocationsTable[this._testId])a=this._fixSpriteLocationsTable[this._testId][g],b[a.page]=a.pageSize;for(g=0;g<b.length;g++)a=b[g],this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(a[0]*a[1])},size:[a[0],a[1]],dirty:!0,texture:void 0})}this._binPack=new c(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*
Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}a.prototype.getWidth=function(c){return c>=this._mosaicPages.length?-1:this._mosaicPages[c].size[0]};a.prototype.getHeight=function(c){return c>=this._mosaicPages.length?-1:this._mosaicPages[c].size[1]};a.prototype.getPageTexture=function(c){return c<this._mosaicPages.length?this._mosaicPages[c].texture:null};a.prototype.has=function(c){return this._mosaicRects.has(c)};Object.defineProperty(a.prototype,
"itemCount",{get:function(){return this._mosaicRects.size},enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(c){return this._mosaicRects.get(c)};a.prototype.addSpriteItem=function(c,b,a,d,e,f){var l;if(this._mosaicRects.has(c))return this._mosaicRects.get(c);var k,n;g(a)?this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][c]?(l=this._fixSpriteLocationsTable[this._testId][c],k=l.rect,n=l.page,l=l.pageSize):(l=this._allocateImage(b[0],
b[1]),k=l[0],n=l[1],l=l[2]):(k=new p.default(0,0,b[0],b[1]),n=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:a,size:b,dirty:!0,texture:void 0}));if(0>=k.width||0>=k.height)return null;f={rect:k,width:b[0],height:b[1],sdf:e,simplePattern:f,pixelRatio:1,page:n};this._mosaicRects.set(c,f);g(a)&&this._copy({rect:k,spriteSize:b,spriteData:a.data,page:n,pageSize:l,repeat:d,sdf:e});return f};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=
function(){var c=this._spriteCopyQueue.pop();c&&this._copy(c)};a.prototype.getSpriteItems=function(c){for(var b={},a=0;a<c.length;a++){var d=c[a];b[d]=this.getSpriteItem(d)}return b};a.prototype.getMosaicItemPosition=function(c){var b=(c=this.getSpriteItem(c))&&c.rect;if(!b)return null;b.width=c.width;b.height=c.height;var a=this._mosaicPages[c.page];return{size:[c.width,c.height],tl:[(b.x+1)/a[0],(b.y+1)/a[1]],br:[(b.x+1+c.width)/a[0],(b.y+1+c.height)/a[1]],page:c.page}};a.prototype.bind=function(c,
a,d,e){void 0===d&&(d=0);void 0===e&&(e=0);d=this._mosaicPages[d];var l=d.mosaicsData,n=d.texture;n||(n=d.size,n=g(l)?new b.Texture(c,{pixelFormat:6408,dataType:5121,width:n[0],height:n[1]},new Uint8Array(l.data.buffer)):new b.Texture(c,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:n[0],height:n[1]},null),d.texture=n);n.setSamplingMode(a);g(l)?(c.bindTexture(n,e),d.dirty&&(n.setData(new Uint8Array(l.data.buffer)),n.generateMipmap())):(a=l.data,l=a.bindFrame(c,n,e),f.isSome(this._requestRender)&&
l&&0<a.frameCount&&this._requestRender.requestRender(),a.bindFrame(c,n,e));d.dirty=!1};a._copyBits=function(c,b,a,d,e,g,f,k,h,q,p){var l=d*b+a;f=k*g+f;if(p)for(f-=g,p=-1;p<=q;p++,l=((p+q)%q+d)*b+a,f+=g)for(k=-1;k<=h;k++)e[f+k]=c[l+(k+h)%h];else for(p=0;p<q;p++){for(k=0;k<h;k++)e[f+k]=c[l+k];l+=b;f+=g}};a.prototype._copy=function(c){if(!(c.page>=this._mosaicPages.length)){var b=this._mosaicPages[c.page],d=b.mosaicsData;if(!g(b.mosaicsData))throw new e("mapview-invalid-resource","unsuitable data type!");
var f=c.spriteData;(d=d.data)&&f||console.error("Source or target images are uninitialized!");a._copyBits(f,c.spriteSize[0],0,0,d,c.pageSize[0],c.rect.x+1,c.rect.y+1,c.spriteSize[0],c.spriteSize[1],c.repeat);b.dirty=!0}};a.prototype._allocateImage=function(b,a){b+=2;a+=2;var d=Math.max(b,a);if(this._maxItemSize&&this._maxItemSize<d){var d=Math.pow(2,Math.ceil(m.log2(b))),e=Math.pow(2,Math.ceil(m.log2(a)));b=new p.default(0,0,b,a);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(d*
e)},size:[d,e],dirty:!0,texture:void 0});return[b,this._mosaicPages.length-1,[d,e]]}d=this._binPack.allocate(b,a);return 0>=d.width?(d=this._mosaicPages[this._currentPage],!d.dirty&&g(d.mosaicsData)&&(d.mosaicsData=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new c(this._pageWidth,this._pageHeight),this._allocateImage(b,
a)):[d,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;for(var c=0,b=this._mosaicPages;c<b.length;c++){var a=b[c],d=a.texture;d&&d.dispose();a=a.mosaicsData;g(a)||a.data.pause()}this._mosaicPages=null;this._mosaicRects.clear()};return a}()})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(a,d){function e(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(d,"__esModule",{value:!0});d.C_INFINITY=Number.POSITIVE_INFINITY;
d.C_PI=Math.PI;d.C_2PI=2*d.C_PI;d.C_PI_BY_2=d.C_PI/2;d.C_RAD_TO_256=128/d.C_PI;d.C_256_TO_RAD=d.C_PI/128;d.C_DEG_TO_256=256/360;d.C_DEG_TO_RAD=d.C_PI/180;d.C_SQRT2=1.414213562;d.C_SQRT2_INV=1/d.C_SQRT2;var h=1/Math.LN2;d.positiveMod=e;d.radToByte=function(a){return e(a*d.C_RAD_TO_256,256)};d.degToByte=function(a){return e(a*d.C_DEG_TO_256,256)};d.log2=function(a){return Math.log(a)*h};d.sqr=function(a){return a*a};d.interpolate=function(a,b,d){return a*(1-d)+b*d};d.between=function(a,b,d){return a>=
b&&a<=d||a>=d&&a<=b}})},"esri/views/2d/engine/webgl/animatedFormats/apng":function(){define(["require","exports","tslib","../../../../../core/Error","../../../../../core/promiseUtils"],function(a,d,e,h,f){function b(c){var b=c.constructor===Uint8Array?c:new Uint8Array(c);return r.some(function(c,a){return c!==b[a]})?!1:!0}function m(c,b){var a=new Uint8Array(b);if(r.some(function(c,b){return c!==a[b]}))return t;var d=!1;p(a,function(c){return!(d="acTL"===c)});if(!d)return n;var e=[],f=[],q=null,l=
null,h=0;p(a,function(b,a,d,n){var p=new DataView(a.buffer);switch(b){case "IHDR":q=a.subarray(d+8,d+8+n);c.width=p.getUint32(d+8);c.height=p.getUint32(d+12);break;case "acTL":c.numPlays=p.getUint32(d+8+4);break;case "fcTL":l&&(c.frames.push(l),h++);l=new k;l.width=p.getUint32(d+8+4);l.height=p.getUint32(d+8+8);l.left=p.getUint32(d+8+12);l.top=p.getUint32(d+8+16);b=p.getUint16(d+8+20);a=p.getUint16(d+8+22);0===a&&(a=100);l.delay=1E3*b/a;10>=l.delay&&(l.delay=100);c.playTime+=l.delay;l.disposeOp=p.getUint8(d+
8+24);l.blendOp=p.getUint8(d+8+25);l.dataParts=[];0===h&&2===l.disposeOp&&(l.disposeOp=1);break;case "fdAT":l&&l.dataParts.push(a.subarray(d+8+4,d+8+n));break;case "IDAT":l&&l.dataParts.push(a.subarray(d+8,d+8+n));break;case "IEND":f.push(g(a,d,12+n));break;default:e.push(g(a,d,12+n))}});if(0===c.frames.length)return n;c.frameCount=c.frames.length;var m=new Blob(e),w=new Blob(f);c.frames.forEach(function(c){var b=[];b.push(r);q.set(v(c.width),0);q.set(v(c.height),4);b.push(u("IHDR",q));b.push(m);
c.dataParts.forEach(function(c){return b.push(u("IDAT",c))});b.push(w);c.data=new Blob(b,{type:"image/png"});delete c.dataParts;b=null});return c}function p(c,b){var a=new DataView(c.buffer),d=8,e,g,k;do g=a.getUint32(d),e=d+4,e=Array.prototype.slice.call(c.subarray(e,e+4)),e=String.fromCharCode.apply(String,e),k=b(e,c,d,g),d+=12+g;while(!1!==k&&"IEND"!==e&&d<c.length)}function c(c){for(var b=new Uint8Array(c.length),a=0;a<c.length;a++)b[a]=c.charCodeAt(a);return b}function g(c,b,a){var d=new Uint8Array(a);
d.set(c.subarray(b,b+a));return d}function u(b,a){var d=b.length+a.length,e=new Uint8Array(d+8),g=new DataView(e.buffer);g.setUint32(0,a.length);e.set(c(b),4);e.set(a,8);var k=4,f=d;void 0===k&&(k=0);void 0===f&&(f=e.length-k);b=-1;a=k;for(k+=f;a<k;a++)b=b>>>8^x[(b^e[a])&255];g.setUint32(d+4,b^-1);return e}function v(c){return new Uint8Array([c>>>24&255,c>>>16&255,c>>>8&255,c&255])}Object.defineProperty(d,"__esModule",{value:!0});var x=new Uint32Array(256);for(a=0;256>a;a++){for(var l=a,y=0;8>y;y++)l=
0!==(l&1)?3988292384^l>>>1:l>>>1;x[a]=l}var t=new h("Not a PNG"),n=new h("Not an animated PNG"),r=new Uint8Array([137,80,78,71,13,10,26,10]);d.isPNG=b;d.getPNGSize=function(c){c=new Uint8Array(c);var b,a;p(c,function(c,d,e){d=new DataView(d.buffer);"IHDR"===c&&(b=d.getUint32(e+8),a=d.getUint32(e+12))});return[b,a]};d.isAnimatedPNG=function(c){c=new Uint8Array(c);if(!b(c))return!1;var a=!1;p(c,function(c){return!(a="acTL"===c)});return a};a=function(){function c(){this.playTime=this.numPlays=this.height=
this.width=0;this.frames=[];this.playing=this.paused=!1;this.playSpeed=1;this.currentFrameNumber=0;this._lastUsedFrame=-1}c.create=function(b,a){return e.__awaiter(this,void 0,void 0,function(){var d,g;return e.__generator(this,function(e){switch(e.label){case 0:d=new c,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,d._load(b,a)];case 2:return e.sent(),[3,4];case 3:return g=e.sent(),f.isAbortError(g)?[3,4]:[2,new h("invalid-resource","Could not load PNG: "+g.message)];case 4:return[2,d]}})})};c.prototype.play=
function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};c.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};c.prototype.togglePlay=function(){this.paused||!this.playing?this.play():this.pause()};c.prototype.bindFrame=function(c,b,a){c.bindTexture(b,a);c=this.frameChanged();if(!c)return!1;a=this.currentFrame;var d=a.frameData,e=b.descriptor;(a.left||a.top||a.width!==e.width||a.height!==e.height)&&b.setData(null);b.updateData(0,a.left,a.top,a.width,
a.height,d);this.updateUsedFrame();return c};c.prototype.frameChanged=function(){return this._lastUsedFrame!==this.currentFrameNumber};c.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};c.prototype._load=function(c,b){return e.__awaiter(this,void 0,void 0,function(){var b,a,d=this;return e.__generator(this,function(e){switch(e.label){case 0:e.trys.push([0,2,,3]);b=m(this,c);if(b!==this)return[2,b];this._resizeCanvas=document.createElement("canvas");this._resizeCanvas.width=
this.width;this._resizeCanvas.height=this.height;return[4,f.all(this.frames.map(function(c){return c.createImage(d._resizeCanvas)}))];case 1:return e.sent(),[3,3];case 2:return a=e.sent(),f.isAbortError(a)?[3,3]:[2,new h("invalid-resource","Could not parse PNG")];case 3:return this.play(),[2]}})})};c.prototype._play=function(){var c=this,b;if(0===this.playSpeed)this.pause();else{0>this.playSpeed?(--this.currentFrameNumber,0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),b=
this.currentFrameNumber,--b,0>b&&(b=this.frames.length-1),b=1*-this.frames[b].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,b=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);var a=this.frames[this.currentFrameNumber];this.currentFrame={frameData:a.imageData,top:a.top,left:a.left,width:a.width,height:a.height};this.timerID=window.setTimeout(function(){return c._play()},b)}};return c}();d.default=a;var k=function(){function c(){this.blendOp=
this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageData=this.data=null}c.prototype.createImage=function(c){return e.__awaiter(this,void 0,void 0,function(){var b=this;return e.__generator(this,function(a){return null!==this.imageData?[2]:[2,f.create(function(a,d){var e=URL.createObjectURL(b.data),g=document.createElement("img");g.onload=function(){URL.revokeObjectURL(e);var d;c.width=g.width;c.height=g.height;d=c.getContext("2d");d.drawImage(g,0,0,g.width,g.height);d=
d.getImageData(0,0,g.width,g.height);d=new Uint8Array(d.data);for(var k,f=0;f<d.length;f+=4)k=d[f+3]/255,d[f]*=k,d[f+1]*=k,d[f+2]*=k;d=new ImageData(new Uint8ClampedArray(d.buffer),g.width,g.height);b.imageData=d;a()};g.onerror=function(){URL.revokeObjectURL(e);b.imageData=null;d(Error("Image creation error"))};g.src=e})]})})};return c}()})},"esri/views/2d/engine/webgl/animatedFormats/gif":function(){define(["require","exports","tslib","../../../../../core/Error","../../../../../core/promiseUtils"],
function(a,d,e,h,f){function b(b){if(!b||0===b.byteLength)return!1;b=b.constructor===Uint8Array?b:new Uint8Array(b);return 71===b[0]&&73===b[1]&&70===b[2]&&56===b[3]}Object.defineProperty(d,"__esModule",{value:!0});d.isGIF=b;d.getGIFSize=function(b){var c=new Uint8ClampedArray(b),a=6;b=c[a++]+(c[a++]<<8);c=c[a++]+(c[a++]<<8);return[b,c]};d.isAnimatedGIF=function(a){if(!a||0===a.byteLength)return!1;a=new Uint8Array(a);if(!b(a))return!1;for(var c=0,d=0,e=a.length-9;d<e&&(0!==a[d]||33!==a[d+1]||249!==
a[d+2]||4!==a[d+3]||0!==a[d+8]||44!==a[d+9]&&33!==a[d+9]||(c++,!(1<c)));++d);return 1<c};a=function(){function b(){this.playing=this.paused=!1;this.waitTillDone=!0;this.firstFrameOnly=this.loading=!1;this.frames=[];this.comment="";this.frameCount=this.currentFrameNumber=this.length=0;this.playSpeed=1;this.lastFrame=null;this.playOnLoad=!0;this.complete=!1;this.interlaceOffsets=[0,4,2,1];this.interlaceSteps=[8,8,4,2];this._lastUsedFrame=-1}b.create=function(c,a){return e.__awaiter(this,void 0,void 0,
function(){var d,g;return e.__generator(this,function(e){switch(e.label){case 0:d=new b,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,d._load(c,a)];case 2:return e.sent(),[3,4];case 3:return g=e.sent(),f.isAbortError(g)?[3,4]:[2,new h("invalid-resource","Could not load PNG: "+g.message)];case 4:return[2,d]}})})};b.prototype.play=function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};b.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};b.prototype.togglePlay=
function(){this.paused||!this.playing?this.play():this.pause()};b.prototype.bindFrame=function(c,b,a){c.bindTexture(b,a);if(c=this.frameChanged())a=this.currentFrame,b.updateData(0,0,0,a.width,a.height,a.frameData),this.updateUsedFrame();return c};b.prototype.seekFrame=function(c){clearTimeout(this.timerID);this.currentFrameNumber=c%this.frames.length;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};b.prototype.seek=function(c){clearTimeout(this.timerID);0>c&&(c=0);c=1E3*
c%this.length;for(var b=0;c>this.frames[b].time+this.frames[b].delay&&b<this.frames.length;)b+=1;this.currentFrameNumber=b;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};b.prototype.frameChanged=function(){return this._lastUsedFrame!==this.currentFrameNumber};b.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};b.prototype._load=function(c,b){return e.__awaiter(this,void 0,void 0,function(){var a;return e.__generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,
2,,3]),this.loading=!0,[4,this._parse(c,b)];case 1:return d.sent(),this.loading=!1,this.play(),[3,3];case 2:return a=d.sent(),f.isAbortError(a)?[3,3]:[2,new h("invalid-resource","Could not parse gif!")];case 3:return[2]}})})};b.prototype._parse=function(c,b){var a=this,d=new m(c);d.pos+=6;this.width=d.data[d.pos++]+(d.data[d.pos++]<<8);this.height=d.data[d.pos++]+(d.data[d.pos++]<<8);c=d.data[d.pos++];this.globalColourCount=1<<(c&7)+1;d.pos++;d.pos++;c&128&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,
d));return f.create(function(c,e){setTimeout(function(){return a._parseBlock(d,c,e,b)},0)})};b.prototype._parseBlock=function(c,b,a,d){return e.__awaiter(this,void 0,void 0,function(){var g,l=this;return e.__generator(this,function(e){if(d&&d.signal&&f.isAborted(d.signal))return a(f.createAbortError()),[2];g=c.data[c.pos++];if(44===g){if(this._parseImg(c),this.firstFrameOnly)return this._finishedLoading(),b(),[2]}else{if(59===g)return this._finishedLoading(),b(),[2];this._parseExt(c)}if("function"===
typeof this.onprogress)this.onprogress({bytesRead:c.pos,totalBytes:c.data.length,frame:this.frames.length});setTimeout(function(){return l._parseBlock(c,b,a,d)},0);return[2]})})};b.prototype._parseColourTable=function(c,b){for(var a=[],d=0;d<c;d++)a.push([b.data[b.pos++],b.data[b.pos++],b.data[b.pos++]]);return a};b.prototype._parseImg=function(c){var b={};this.frames.push(b);b.disposalMethod=this.disposalMethod;b.time=this.length;b.delay=10*this.delayTime;this.length+=b.delay;b.transparencyIndex=
this.transparencyGiven?this.transparencyIndex:void 0;b.leftPos=c.data[c.pos++]+(c.data[c.pos++]<<8);b.topPos=c.data[c.pos++]+(c.data[c.pos++]<<8);b.width=c.data[c.pos++]+(c.data[c.pos++]<<8);b.height=c.data[c.pos++]+(c.data[c.pos++]<<8);var a=c.data[c.pos++];b.localColourTableFlag=a&128?!0:!1;b.localColourTableFlag&&(b.localColourTable=this._parseColourTable(1<<(a&7)+1,c));this.pixelBufSize!==b.width*b.height&&(this.pixelBuf=new Uint8Array(b.width*b.height),this.pixelBufSize=b.width*b.height);this._lzwDecode(c.data[c.pos++],
c.readSubBlocksB());if(a&64){b.interlaced=!0;c=b.width;a=this.pixelBufSize/c;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);for(var d=0,e=0;4>e;e++)for(var f=this.interlaceOffsets[e];f<a;f+=this.interlaceSteps[e])this.deinterlaceBuf.set(this.pixelBuf.subarray(d,d+c),f*c),d+=c}else b.interlaced=!1;this._processFrame(b)};b.prototype._lzwDecode=function(c,b){var a,d,e,g,f,h,n,r,k,p;e=d=0;var q=[];g=1<<c;f=g+
1;h=c+1;for(p=!1;!p;){r=n;for(a=n=0;a<h;a++)b[e>>3]&1<<(e&7)&&(n|=1<<a),e++;if(n===g){q=[];h=c+1;for(a=0;a<g;a++)q[a]=[a];q[g]=[];q[f]=null}else{if(n===f){p=!0;break}n>=q.length?q.push(q[r].concat(q[r][0])):r!==g&&q.push(q[r].concat(q[n][0]));r=q[n];k=r.length;for(a=0;a<k;a++)this.pixelBuf[d++]=r[a];q.length===1<<h&&12>h&&h++}}};b.prototype._processFrame=function(c){c.image=document.createElement("canvas");c.image.width=this.width;c.image.height=this.height;c.ctx=c.image.getContext("2d");var b=c.localColourTableFlag?
c.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=c);var a=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod?!0:!1;a||c.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);for(var d=c.ctx.getImageData(c.leftPos,c.topPos,c.width,c.height),e=c.transparencyIndex,f=d.data,h=c.interlaced?this.deinterlaceBuf:this.pixelBuf,t=h.length,n=0,r,k,p=0;p<t;p++)r=h[p],k=b[r],e!==r?(f[n++]=k[0],f[n++]=k[1],f[n++]=k[2],f[n++]=255):(a&&(f[n+3]=0),n+=4);c.ctx.putImageData(d,
c.leftPos,c.topPos);this.lastFrame=c};b.prototype._parseExt=function(c){var b=c.data[c.pos++];249===b?this._parseGCExt(c):254===b?this.comment+=c.readSubBlocks():255===b?this._parseAppExt(c):(1===b&&(c.pos+=13),c.readSubBlocks())};b.prototype._parseAppExt=function(c){c.pos+=1;"NETSCAPE"===c.getString(8)?c.pos+=8:(c.pos+=3,c.readSubBlocks())};b.prototype._parseGCExt=function(c){var b;c.pos++;b=c.data[c.pos++];this.disposalMethod=(b&28)>>2;this.transparencyGiven=b&1?!0:!1;this.delayTime=c.data[c.pos++]+
(c.data[c.pos++]<<8);this.transparencyIndex=c.data[c.pos++];c.pos++};b.prototype._finishedLoading=function(){this.loading=!1;this.frameCount=this.frames.length;this.lastFrame=null;this.complete=!0;this.deinterlaceBuf=this.pixelBufSize=this.deinterlaceBuf=this.pixelBuf=this.waitTillDone=this.transparencyIndex=this.delayTime=this.transparencyGiven=this.disposalMethod=void 0;this.currentFrameNumber=0;0<this.frames.length&&this._setCurrentFrame(0);this.playOnLoad&&this.play()};b.prototype._play=function(){var c=
this,b;0===this.playSpeed?this.pause():(0>this.playSpeed?(--this.currentFrameNumber,0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),b=this.currentFrameNumber,--b,0>b&&(b=this.frames.length-1),b=1*-this.frames[b].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,b=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout(function(){return c._play()},
b))};b.prototype._setCurrentFrame=function(c){this.currentFrame={frameData:this.frames[c].image,top:0,left:0,width:this.width,height:this.height}};return b}();d.default=a;var m=function(){function b(c){this.pos=0;this.data=new Uint8ClampedArray(c);this.len=this.data.length}b.prototype.getString=function(c){for(var b="";c--;)b+=String.fromCharCode(this.data[this.pos++]);return b};b.prototype.readSubBlocks=function(){var c,b,a="";do for(b=c=this.data[this.pos++];b--;)a+=String.fromCharCode(this.data[this.pos++]);
while(0!==c&&this.pos<this.len);return a};b.prototype.readSubBlocksB=function(){var c,b,a=[];do for(b=c=this.data[this.pos++];b--;)a.push(this.data[this.pos++]);while(0!==c&&this.pos<this.len);return a};return b}()})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","../../../../../core/BidiEngine"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});var h=new e.default;d.bidiText=function(a){if(!h.hasBidiChar(a))return[a,!1];var b;b="rtl"===h.checkContextual(a)?
"IDNNN":"ICNNN";return[h.bidiTransform(a,b,"VLYSN"),!0]}})},"esri/core/BidiEngine":function(){define(["require","exports","./bidiEngineTables"],function(a,d,e){function h(c,a,d,e,g){var k=c;void 0===a&&(a=g.defInFormat);void 0===d&&(d=g.defOutFormat);void 0===e&&(e=g.defSwap);if(a!==d){var q=a.substring(0,1),l=d.substring(0,1),n;n=a.substring(1,4);var r=d.substring(1,4);"C"===n.charAt(0)&&(n=f(k),n="ltr"===n||"rtl"===n?n.toUpperCase():"L"===a.charAt(2)?"LTR":"RTL",a=q+n);"C"===r.charAt(0)&&(n=f(k),
"rtl"===n?r="RTL":"ltr"===n?(k=k.split(""),k.reverse(),n=f(k.join("")),r=n.toUpperCase()):r="L"===d.charAt(2)?"LTR":"RTL",d=l+r)}if(a===d)return c;l=a.substring(0,1);k=a.substring(1,4);q=d.substring(0,1);r=d.substring(1,4);g.inFormat=a;g.outFormat=d;g.swap=e;if("L"===l&&"VLTR"===d){if("LTR"===k)return g.dir=A,b(c,g);if("RTL"===k)return g.dir=D,b(c,g)}if("V"===l&&"V"===q)return g.dir="RTL"===k?D:A,p(c,g);if("L"===l&&"VRTL"===d)return g.dir="LTR"===k?A:D,c=b(c,g),p(c);if("VLTR"===a&&"LLTR"===d)return g.dir=
A,b(c,g);if("V"===l&&"L"===q&&k!==r)return c=p(c),"RTL"===k?h(c,"LLTR","VLTR",e,g):h(c,"LRTL","VRTL",e,g);if("VRTL"===a&&"LRTL"===d)return h(c,"LRTL","VRTL",e,g);"L"===l&&"L"===q&&(a=g.swap,g.swap=a.substr(0,1)+"N","RTL"===k?(g.dir=D,c=b(c,g),g.swap="N"+a.substr(1,2),g.dir=A,c=b(c,g)):(g.dir=A,c=b(c,g),g.swap="N"+a.substr(1,2),c=h(c,"VLTR","LRTL",g.swap,g)));return c}function f(c){return(c=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(c))?"z">=c[0]?"ltr":"rtl":""}
function b(c,b){c=c.split("");var a=[];m(c,a,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,2))for(var d=0;d<c.length;d++)if(1===a[d]){var g=d,k;b:{k=c[d];for(var f=void 0,q=0,l=e.SwapTable.length-1;q<=l;)if(f=Math.floor((q+l)/2),k<e.SwapTable[f][0])l=f-1;else if(k>e.SwapTable[f][0])q=f+1;else{k=e.SwapTable[f][1];break b}}c[g]=k}u(2,c,a,b);u(1,c,a,b);w=a;return c.join("")}function m(c,b,a){var d=c.length,g=a.dir?e.impTabRtl:e.impTabLtr,k=null,f=null,q=null,k=0,f=f=null,l=-1,n=f=null,h=
[],r=[];a.hiLevel=a.dir;a.lastArabic=!1;a.hasUbatAl=!1;a.hasUbatB=!1;a.hasUbatS=!1;for(f=0;f<d;f++){var n=f,q=c[f].charCodeAt(0),t=e.MasterTable[q>>8];h[n]=t<e.TBBASE?t:e.UnicodeTable[t-e.TBBASE][q&255]}for(n=0;n<d;n++){r[n]=f=v(c,h,r,n,a);k=g[k][f];f=k&240;k&=15;b[n]=q=g[k][z];if(0<f){if(16===f)for(f=l;f<n;f++)b[f]=1;l=-1}if(f=g[k][B])-1===l&&(l=n);else if(-1<l){for(f=l;f<n;f++)b[f]=q;l=-1}h[n]===e.UBAT_B&&(b[n]=0);a.hiLevel|=q}if(a.hasUbatS)for(c=0;c<d;c++)if(h[c]===e.UBAT_S)for(b[c]=a.dir,g=c-
1;0<=g;g--)if(h[g]===e.UBAT_WS)b[g]=a.dir;else break}function p(c,b){c=c.split("");if(b){var a=[];m(c,a,b);w=a}c.reverse();r.reverse();return c.join("")}function c(c){for(var b=0;b<e.ArabicAlefBetIntervalsBegine.length;b++)if(c>=e.ArabicAlefBetIntervalsBegine[b]&&c<=e.ArabicAlefBetIntervalsEnd[b])return!0;return!1}function g(b,a,d,e){for(;a*d<e&&l(b[a]);)a+=d;return a*d<e&&c(b[a])?!0:!1}function u(c,b,a,d){if(!(d.hiLevel<c))if(1!==c||d.dir!==D||d.hasUbatB){d=b.length;for(var e=0,g,k,f;e<d;){if(a[e]>=
c){for(g=e+1;g<d&&a[g]>=c;)g++;for(k=g-1;e<k;e++,k--)f=b[e],b[e]=b[k],b[k]=f,f=r[e],r[e]=r[k],r[k]=f;e=g}e++}}else b.reverse(),r.reverse()}function v(c,b,a,d,g){return{UBAT_L:function(){g.lastArabic=!1;return e.UBAT_L},UBAT_R:function(){g.lastArabic=!1;return e.UBAT_R},UBAT_ON:function(){return e.UBAT_ON},UBAT_AN:function(){return e.UBAT_AN},UBAT_EN:function(){return g.lastArabic?e.UBAT_AN:e.UBAT_EN},UBAT_AL:function(){g.lastArabic=!0;g.hasUbatAl=!0;return e.UBAT_R},UBAT_WS:function(){return e.UBAT_ON},
UBAT_CS:function(){var c,k;if(1>d||d+1>=b.length||(c=a[d-1])!==e.UBAT_EN&&c!==e.UBAT_AN||(k=b[d+1])!==e.UBAT_EN&&k!==e.UBAT_AN)return e.UBAT_ON;g.lastArabic&&(k=e.UBAT_AN);return k===c?k:e.UBAT_ON},UBAT_ES:function(){return(0<d?a[d-1]:e.UBAT_B)===e.UBAT_EN&&d+1<b.length&&b[d+1]===e.UBAT_EN?e.UBAT_EN:e.UBAT_ON},UBAT_ET:function(){if(0<d&&a[d-1]===e.UBAT_EN)return e.UBAT_EN;if(g.lastArabic)return e.UBAT_ON;for(var c=d+1,k=b.length;c<k&&b[c]===e.UBAT_ET;)c++;return c<k&&b[c]===e.UBAT_EN?e.UBAT_EN:e.UBAT_ON},
UBAT_NSM:function(){if("VLTR"===g.inFormat){for(var k=b.length,f=d+1;f<k&&b[f]===e.UBAT_NSM;)f++;if(f<k&&(k=c[d].charCodeAt[0],f=b[f],(1425<=k&&2303>=k||64286===k)&&(f===e.UBAT_R||f===e.UBAT_AL)))return e.UBAT_R}return 1>d||b[d-1]===e.UBAT_B?e.UBAT_ON:a[d-1]},UBAT_B:function(){g.lastArabic=!0;g.hasUbatB=!0;return g.dir},UBAT_S:function(){g.hasUbatS=!0;return e.UBAT_ON},UBAT_LRE:function(){g.lastArabic=!1;return e.UBAT_ON},UBAT_RLE:function(){g.lastArabic=!1;return e.UBAT_ON},UBAT_LRO:function(){g.lastArabic=
!1;return e.UBAT_ON},UBAT_RLO:function(){g.lastArabic=!1;return e.UBAT_ON},UBAT_PDF:function(){g.lastArabic=!1;return e.UBAT_ON},UBAT_BN:function(){return e.UBAT_ON}}[e.TYPES_NAMES[b[d]]]()}function x(c,b){for(var a=0;a<e.BaseForm.length;a++)if(c===e.BaseForm[a])return b[a];return c}function l(c){return"\u064b"<=c&&"\u0655">=c?!0:!1}function y(c){return"L"===c?"LTR":"R"===c?"RTL":"C"===c?"CLR":"D"===c?"CRL":""}function t(c,b){for(var a=0;a<e.AlefTable.length;a++)if(c===e.AlefTable[a])return b[a];
return c}function n(c,b,a,d){for(var e=0;e<c.length;e++)if(c[e]>b||!a&&c[e]===b)c[e]+=d}Object.defineProperty(d,"__esModule",{value:!0});a=function(){function b(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}b.prototype.bidiTransform=function(b,a,d){this.sourceToTarget=[];this.targetToSource=[];if(!b)return"";var f=this.sourceToTarget,p=this.targetToSource,m=b.length;r=[];w=[];for(var u=0;u<m;u++)f[u]=u,p[u]=u,r[u]=u;if(!this.checkParameters(a,
d))return b;a=this.inputFormat;d=this.outputFormat;var f=b,f=q,u=y(a.charAt(1)),p=y(d.charAt(1)),z="I"===a.charAt(0)?"L":a.charAt(0),m="I"===d.charAt(0)?"L":d.charAt(0),u=z+u,p=m+p,m=a.charAt(2)+d.charAt(2);f.defInFormat=u;f.defOutFormat=p;f.defSwap=m;b=h(b,u,p,m,f);f=!1;if("R"===d.charAt(1))f=!0;else if("C"===d.charAt(1)||"D"===d.charAt(1))f="rtl"===this.checkContextual(b);p=this.sourceToTarget=r;m=Array(p.length);for(u=0;u<p.length;u++)m[p[u]]=u;k=this.targetToSource=m;if(a.charAt(3)===d.charAt(3))f=
b;else if("S"===d.charAt(3))if(a=f,d=!0,0===b.length)f="";else{void 0===a&&(a=!0);void 0===d&&(d=!0);b=String(b);b=b.split("");var v=0,p=1,f=b.length;a||(v=b.length-1,p=-1,f=1);for(var m=f,u=d,E=0,f=[],z=0;v*p<m;v+=p)if(c(b[v])||l(b[v])){var A;if(A="\u0644"===b[v])b:{for(var B=b,D=v+p,H=p,J=m;D*H<J&&l(B[D]);)D+=H;A=" ";if(D*H<J)for(A=B[D],B=0;B<e.AlefTable.length;B++)if(e.AlefTable[B]===A){A=!0;break b}A=!1}if(A){b[v]=0===E?t(b[v+p],e.LamAlefInialTableFE):t(b[v+p],e.LamAlefMedialTableFE);v+=p;E=b;
A=v;B=p;for(D=m;A*B<D&&l(E[A]);)A+=B;A*B<D&&(E[A]=" ");u&&(f[z]=v,z++);E=0}else{A=b[v];if(1===E){B=v;if(g(b,v+p,p,m))b:for(D=b[v],H=0;H<e.BaseForm.length;H++){if(D===e.BaseForm[H]){D=e.MedialForm[H];break b}}else D=x(b[v],e.FinalForm);b[B]=D}else!0===g(b,v+p,p,m)?b[v]=x(b[v],e.InitialForm):b[v]=x(b[v],e.IsolatedForm);l(A)||(E=1);b:{for(B=0;B<e.StandAlonForm.length;B++)if(e.StandAlonForm[B]===A){A=!0;break b}A=!1}!0===A&&(E=0)}}else E=0;p="";for(m=0;m<b.length;m++){if(u=d){b:{for(u=0;u<f.length;u++)if(f[u]===
m)break b;u=-1}u=-1<u}u?(n(k,m,!a,-1),r.splice(m,1)):p+=b[m]}f=p}else if(a=b,d=f,b=!0,0===a.length)f="";else for(void 0===b&&(b=!0),void 0===d&&(d=!0),a=String(a),f="",p=a.split(""),m=0;m<a.length;m++)u=!1,"\ufe70"<=p[m]&&"\ufeff">p[m]?(z=a.charCodeAt(m),"\ufef5"<=p[m]&&"\ufefc">=p[m]?(d?(0<m&&b&&" "===p[m-1]?f=f.substring(0,f.length-1)+"\u0644":(f+="\u0644",u=!0),f+=e.AlefTable[(z-65269)/2]):(f+=e.AlefTable[(z-65269)/2],f+="\u0644",m+1<a.length&&b&&" "===p[m+1]?m++:u=!0),u&&(n(k,m,!0,1),r.splice(m,
0,r[m]))):f+=e.FETo06Table[z-65136]):f+=p[m];this.sourceToTarget=r;this.targetToSource=k;this.levels=w;return f};b.prototype._inputFormatSetter=function(c){if(!E.test(c))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=c};b.prototype._outputFormatSetter=function(c){if(!E.test(c))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=c};b.prototype.checkParameters=function(c,b){c?this._inputFormatSetter(c):c=this.inputFormat;
b?this._outputFormatSetter(b):b=this.outputFormat;return c===b?!1:!0};b.prototype.checkContextual=function(c){c=f(c);if("ltr"!==c&&"rtl"!==c){try{c=document.dir.toLowerCase()}catch(C){}"ltr"!==c&&"rtl"!==c&&(c="ltr")}return c};b.prototype.hasBidiChar=function(c){return H.test(c)};return b}();d.default=a;var r=[],k=[],w=[],q={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},
z=5,B=6,A=0,D=1,E=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,H=/[\u0591-\u06ff\ufb1d-\ufefc]/})},"esri/core/bidiEngineTables":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.SwapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264",
"\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];d.AlefTable=["\u0622","\u0623","\u0625","\u0627"];d.LamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];d.LamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];d.BaseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");
d.IsolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");d.FinalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");
d.MedialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");d.InitialForm="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");
d.StandAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");d.FETo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
d.ArabicAlefBetIntervalsBegine=["\u0621","\u0641"];d.ArabicAlefBetIntervalsEnd=["\u063a","\u064a"];d.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];d.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];d.UBAT_L=0;d.UBAT_R=1;d.UBAT_EN=2;d.UBAT_AN=3;d.UBAT_ON=4;d.UBAT_B=5;d.UBAT_S=6;d.UBAT_AL=7;d.UBAT_WS=8;d.UBAT_CS=9;d.UBAT_ES=10;d.UBAT_ET=11;d.UBAT_NSM=12;d.UBAT_LRE=13;d.UBAT_RLE=14;d.UBAT_PDF=15;d.UBAT_LRO=16;
d.UBAT_RLO=17;d.UBAT_BN=18;d.TYPES_NAMES="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");d.TBBASE=100;a=d.UBAT_L;var e=d.UBAT_R,h=d.UBAT_EN,f=d.UBAT_AN,b=d.UBAT_ON,m=d.UBAT_B,p=d.UBAT_S,c=d.UBAT_AL,g=d.UBAT_WS,u=d.UBAT_CS,v=d.UBAT_ES,x=d.UBAT_ET,l=d.UBAT_NSM,y=d.UBAT_LRE,t=d.UBAT_RLE,n=d.UBAT_PDF,r=d.UBAT_LRO,k=d.UBAT_RLO,w=d.UBAT_BN;d.MasterTable=[d.TBBASE+0,a,a,a,a,d.TBBASE+1,d.TBBASE+
2,d.TBBASE+3,e,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,d.TBBASE+4,b,b,b,a,b,a,b,a,b,b,b,a,a,b,b,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,b,b,a,a,b,b,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,
a,a,a,d.TBBASE+5,c,c,d.TBBASE+6,d.TBBASE+7];d.UnicodeTable=[[w,w,w,w,w,w,w,w,w,p,m,p,g,m,w,w,w,w,w,w,w,w,w,w,w,w,w,w,m,m,m,p,g,b,b,x,x,x,b,b,b,b,b,v,u,v,u,u,h,h,h,h,h,h,h,h,h,h,u,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,w,w,w,w,w,w,m,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,u,b,x,x,x,x,b,b,b,b,a,b,b,w,b,b,x,x,h,h,b,a,b,b,b,h,a,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,a,a,a,a,a,a,a,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,b,b,b,b,b,b,b,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,e,l,e,l,l,e,l,l,e,l,b,b,b,b,b,b,b,b,e,e,e,e,e,e,
e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,b,b,b,b,b,e,e,e,e,e,b,b,b,b,b,b,b,b,b,b,b],[f,f,f,f,b,b,b,b,c,x,x,c,u,c,b,b,l,l,l,l,l,l,l,l,l,l,l,c,b,b,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,f,f,f,f,f,f,f,f,f,f,x,f,f,c,c,c,l,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,c,c,l,l,l,l,l,l,l,f,b,l,l,l,l,l,l,c,c,l,l,b,l,l,l,l,c,c,h,h,h,h,h,h,h,h,h,h,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,b,c,c,l,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,b,b,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,l,l,l,l,l,l,l,l,l,l,l,c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,e,e,e,e,e,e,e,e,e,e,
e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,l,l,l,l,l,l,l,l,l,e,e,b,b,b,b,e,b,b,b,b,b],[g,g,g,g,g,g,g,g,g,g,g,w,w,w,a,e,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,g,m,y,t,n,r,k,u,x,x,x,x,x,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,u,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,g,w,w,w,w,w,b,b,b,b,b,w,w,w,w,w,w,h,a,b,b,h,h,h,h,h,h,v,v,b,b,b,a,h,h,h,h,h,h,h,h,h,h,v,v,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,b,b,b,b,b,b,b,b,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,b,b,b,b,b,e,l,e,e,e,e,e,e,e,e,e,e,v,e,e,e,e,e,e,e,e,e,e,e,e,e,b,e,e,e,e,e,b,e,b,e,e,b,e,e,b,e,e,e,e,e,e,e,e,e,e,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,l,l,l,l,l,l,l,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,u,b,u,b,b,u,b,b,b,b,b,b,b,b,b,x,b,b,v,v,b,b,b,b,b,x,x,b,b,b,b,b,c,c,c,c,c,b,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,b,b,w],[b,b,b,x,x,x,b,b,b,b,b,v,u,v,u,u,h,h,h,h,h,h,h,h,h,h,u,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,a,a,a,a,a,a,b,b,a,a,a,a,a,a,b,b,a,a,a,a,a,a,b,b,a,a,a,b,b,b,x,x,b,b,b,x,x,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]]})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.ok=function(a,d){return a&&"name"in a?(d&&d.error(new e(a.name,a.message,a.details)),!1):!0}})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["require",
"exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.keyFromSymbol=function(a){switch(a.type){case "esriSMS":return a.style+"."+a.path;case "esriSLS":return a.style+"."+a.cap;case "esriSFS":return""+a.style;case "esriPFS":case "esriPMS":return a.imageData?a.imageData:""+a.url+a.width+a.height;default:return a.mosaicHash?a.mosaicHash:JSON.stringify(a)}}})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("require exports tslib ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),
function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.defines=[];c._desc={path:"fx/integrate",attributes:{a_position:0}};return c}e.__extends(c,a);c.prototype.dispose=function(){this._quad&&this._quad.dispose()};c.prototype.bind=function(){};c.prototype.unbind=function(){};c.prototype.draw=function(c,a){if(a.size){var d=c.context,e=c.renderingOptions;this._quad||(this._quad=new b(d,[0,0,1,0,0,1,1,1]));var g=
d.getBoundFramebufferObject(),p=d.getViewport(),t=p.x,n=p.y,r=p.width,p=p.height;a.bindTextures(d);var k=a.getBlock(f.ATTRIBUTE_DATA_ANIMATION);if(!h.isNone(k)){var m=k.getFBO(d),k=k.getFBO(d,1);d.setViewport(0,0,a.size,a.size);this._computeDelta(c,k,e.labelsAnimationTime);this._updateAnimationState(c,k,m);d.bindFramebuffer(g);d.setViewport(t,n,r,p)}}};c.prototype._computeDelta=function(c,b,a){var d=c.context,e=c.displayLevel,g=c.painter.materialManager.getProgram(c,this._desc,["delta"]);d.bindFramebuffer(b);
d.setClearColor(0,0,0,0);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(g);g.setUniform1i("u_maskTexture",f.TEXTURE_BINDING_ATTRIBUTE_DATA_0);g.setUniform1i("u_sourceTexture",f.TEXTURE_BINDING_ATTRIBUTE_DATA_1);g.setUniform1f("u_timeDelta",c.timeDelta);g.setUniform1f("u_animationTime",a/1E3);g.setUniform1f("u_zoomLevel",Math.round(10*e));this._quad.draw()};c.prototype._updateAnimationState=function(c,b,a){var d=c.context;c=c.painter.materialManager.getProgram(c,this._desc,["update"]);d.bindTexture(b.colorTexture,
1);d.bindProgram(c);c.setUniform1i("u_sourceTexture",1);d.bindFramebuffer(a);d.setClearColor(0,0,0,0);d.clear(d.gl.COLOR_BUFFER_BIT);this._quad.draw()};return c}(m.Effect);d.AnimationEffect=a})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports","../../../webgl"],function(a,d,e){return function(){function a(a,b){this.rctx=a;this._vertexBuffer=e.BufferObject.createVertex(a,35044,new Uint16Array(b));this._vao=new e.VertexArrayObject(a,{a_position:0},{geometry:[{name:"a_position",
count:2,type:5122,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};a.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose()};a.prototype.draw=function(){this.rctx.bindVAO(this._vao);this.rctx.drawArrays(5,0,4)};return a}()})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});
a=function(){return function(){this.name=this.constructor.name}}();d.Effect=a})},"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define("require exports ../../../../../core/Error ../../../../../core/Logger ../../../../webgl ../VertexStream ../shaders/BlendPrograms".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});var p=h.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");a=function(){function c(){this._size=[0,0]}c.prototype.dispose=
function(c){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null);this._programCache&&(this._programCache.dispose(),this._programCache=null);this._quad&&(this._quad.dispose(),this._quad=null)};c.prototype.draw=function(c,b,a,d,f){var g=c.context;this._setupShader(g);d&&"normal"!==d?this._drawBlended(c,b,a,d,f):(c=this._programCache.getProgram(m.blend,"normal"))?(g.bindProgram(c),b.setSamplingMode(a),g.bindTexture(b,0),c.setUniform1i("u_layerTexture",0),c.setUniform1f("u_opacity",
f),g.setBlendingEnabled(!0),g.setBlendFunction(1,771),b=this._quad,b.draw(),b.unbind()):p.error(new e("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))};c.prototype._drawBlended=function(c,b,a,d,f){var g=c.context,l=c.pixelRatio,n=c.state.size;this._createOrResizeTexture(c);c=l*n[0];var n=l*n[1],h=g.getBoundFramebufferObject(),l=this._backBufferTexture;h.copyToTexture(0,0,c,n,0,0,l);g.setStencilTestEnabled(!1);g.setStencilWriteMask(0);g.setBlendingEnabled(!0);g.setDepthTestEnabled(!1);
g.setDepthWriteEnabled(!1);(c=this._programCache.getProgram(m.blend,d))?(g.bindProgram(c),l.setSamplingMode(a),g.bindTexture(l,0),c.setUniform1i("u_backbufferTexture",0),b.setSamplingMode(a),g.bindTexture(b,1),c.setUniform1i("u_layerTexture",1),c.setUniform1f("u_opacity",f),g.setBlendFunction(1,0),b=this._quad,b.draw(),b.unbind(),g.setBlendFunction(1,771)):p.error(new e("mapview-BlendEffect","Error creating shader program for blend mode "+d))};c.prototype._setupShader=function(c){this._programCache||
(this._programCache=new f.ProgramCache(c),this._quad||(this._quad=new b(c,[-1,-1,1,-1,-1,1,1,1])))};c.prototype._createOrResizeTexture=function(c){var b=c.context,a=c.pixelRatio,d=c.state.size;c=a*d[0];a*=d[1];if(null===this._backBufferTexture||c!==this._size[0]||a!==this._size[1])this._backBufferTexture?this._backBufferTexture.resize(c,a):this._backBufferTexture=new f.Texture(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:c,height:a}),
this._size[0]=c,this._size[1]=a};return c}();d.BlendEffect=a})},"esri/views/2d/engine/webgl/shaders/BlendPrograms":function(){define(["require","exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.blend={name:"blend",attributes:{a_pos:0,a_tex:1},shaders:function(a){return{vertexShader:"#define "+a.replace("-","_").toUpperCase()+"\n"+e.resolveIncludes("blend/blend.vert"),fragmentShader:"#define "+a.replace("-","_").toUpperCase()+"\n"+e.resolveIncludes("blend/blend.frag")}}}})},
"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("require exports tslib ../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),function(a,d,e,h,f,b,m,p,c){Object.defineProperty(d,"__esModule",{value:!0});a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.defines=["highlight"];a._hlRenderer=new p.default;a._hlGradient=new m.default;a._width=void 0;a._height=
void 0;a._hlSurfaces=new c.default;a._adjustedWidth=void 0;a._adjustedHeight=void 0;a._blitRenderer=new f.BitBlitRenderer;return a}e.__extends(a,b);a.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};a.prototype.bind=function(c){var b=c.context,a=c.painter,d=b.getViewport(),e=d.width,d=d.height,a=a.getFbos(e,d).effect0;this.setup(c,e,d);b.bindFramebuffer(a);b.setClearColor(0,
0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};a.prototype.unbind=function(){};a.prototype.setup=function(c,b,a){c=c.context;this._width=b;this._height=a;var d=b%4,e=a%4;b+=2>d?-d:4-d;a+=2>e?-e:4-e;this._adjustedWidth=b;this._adjustedHeight=a;this._boundFBO=c.getBoundFramebufferObject();b=Math.round(.75*b);a=Math.round(.75*a);this._hlRenderer.setup(c,b,a);this._hlSurfaces.setup(c,b,a)};a.prototype.draw=function(c){c=c.context;var b=c.getBoundFramebufferObject();c.setViewport(0,0,.75*this._adjustedWidth,.75*
this._adjustedHeight);c.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);c.setStencilTestEnabled(!1);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(c,b.colorTexture,9728,1);c.setStencilTestEnabled(!1);c.setBlendingEnabled(!1);c.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(c,this._hlSurfaces.sharedBlur1Tex);c.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);c.setClearColor(0,0,0,
0);c.clear(c.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(c,this._hlSurfaces.sharedBlur2Tex);c.bindFramebuffer(this._boundFBO);c.setBlendingEnabled(!0);c.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(c,this._hlSurfaces.sharedBlur1Tex,this._hlGradient);this._boundFBO=null};a.prototype.setHighlightOptions=function(c){this._hlGradient.setHighlightOptions(c)};return a}(b.Effect);d.default=a})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),
function(a,d,e,h,f,b){function m(c,a){a.fillColor[0]=c.color.r/255;a.fillColor[1]=c.color.g/255;a.fillColor[2]=c.color.b/255;a.fillColor[3]=c.color.a;c.haloColor?(a.outlineColor[0]=c.haloColor.r/255,a.outlineColor[1]=c.haloColor.g/255,a.outlineColor[2]=c.haloColor.b/255,a.outlineColor[3]=c.haloColor.a):(a.outlineColor[0]=a.fillColor[0],a.outlineColor[1]=a.fillColor[1],a.outlineColor[2]=a.fillColor[2],a.outlineColor[3]=a.fillColor[3]);a.fillColor[3]*=c.fillOpacity;a.outlineColor[3]*=c.haloOpacity;
a.fillColor[0]*=a.fillColor[3];a.fillColor[1]*=a.fillColor[3];a.fillColor[2]*=a.fillColor[3];a.outlineColor[0]*=a.outlineColor[3];a.outlineColor[1]*=a.outlineColor[3];a.outlineColor[2]*=a.outlineColor[3];a.outlineWidth=b.HIGHLIGHT_SIZING.outlineWidth;a.outerHaloWidth=b.HIGHLIGHT_SIZING.outerHaloWidth;a.innerHaloWidth=b.HIGHLIGHT_SIZING.innerHaloWidth;a.outlinePosition=b.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(d,"__esModule",{value:!0});var p=e.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),
c=[0,0,0,0];a=function(){function a(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:b.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:b.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:b.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:b.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*b.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}a.prototype.setHighlightOptions=function(a){function d(c,b,a){w[0]=
(1-a)*c[0]+a*b[0];w[1]=(1-a)*c[1]+a*b[1];w[2]=(1-a)*c[2]+a*b[2];w[3]=(1-a)*c[3]+a*b[3]}var e,g=this._convertedHighlightOptions;m(a,g);a=g.outlinePosition-g.outlineWidth/2-g.outerHaloWidth;var f=g.outlinePosition-g.outlineWidth/2,h=g.outlinePosition+g.outlineWidth/2,n=g.outlinePosition+g.outlineWidth/2+g.innerHaloWidth,r=Math.sqrt(Math.PI/2)*b.SIGMAS[3],k=Math.abs(a)>r?Math.round(10*(Math.abs(a)-r))/10:0,r=Math.abs(n)>r?Math.round(10*(Math.abs(n)-r))/10:0;k&&!r?p.error("The outer rim of the highlight is "+
k+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!k&&r?p.error("The inner rim of the highlight is "+r+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):k&&r&&p.error("The highlight is "+Math.max(k,r)+"px away from the edge of the feature; consider reducing some width values.");for(var w=[void 0,void 0,void 0,
void 0],k=this.texelData,r=0;r<b.SHADE_TEXTURE_SIZE;++r)e=a+r/(b.SHADE_TEXTURE_SIZE-1)*(n-a),e<a?(w[4*r+0]=0,w[4*r+1]=0,w[4*r+2]=0,w[4*r+3]=0):e<f?d(c,g.outlineColor,(e-a)/(f-a)):e<h?(e=g.outlineColor,w[0]=e[0],w[1]=e[1],w[2]=e[2],w[3]=e[3]):e<n?d(g.outlineColor,g.fillColor,(e-h)/(n-h)):(e=g.fillColor,w[4*r+0]=e[0],w[4*r+1]=e[1],w[4*r+2]=e[2],w[4*r+3]=e[3]),k[4*r+0]=255*w[0],k[4*r+1]=255*w[1],k[4*r+2]=255*w[2],k[4*r+3]=255*w[3];this.minMaxDistance[0]=a;this.minMaxDistance[1]=n;this.shadeTexChanged=
!0};a.prototype.applyHighlightOptions=function(c,a){this.shadeTex||(this.shadeTex=new h.Texture(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:b.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,b.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);c.bindTexture(this.shadeTex,f.TEXTURE_BINDING_HIGHLIGHT_1);a.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};a.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),
this.shadeTex=null)};return a}();d.default=a})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.SIGMAS=[void 0,void 0,void 0,1];d.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];d.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];d.SHADE_TEXTURE_SIZE=256;d.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},
"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),
this._resources.blurProgram.dispose(),this._resources=null)};a.prototype.preBlur=function(b,c){b.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);b.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",f.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);b.bindVAO(this._resources.quadVAO);b.drawArrays(5,0,4);b.bindVAO()};a.prototype.finalBlur=function(b,c){b.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);
b.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",f.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);b.bindVAO(this._resources.quadVAO);b.drawArrays(5,0,4);b.bindVAO()};a.prototype.renderHighlight=function(b,c,a){b.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);b.bindProgram(this._resources.highlightProgram);a.applyHighlightOptions(b,this._resources.highlightProgram);b.bindVAO(this._resources.quadVAO);
b.setBlendingEnabled(!0);b.setBlendFunction(1,771);b.drawArrays(5,0,4);b.bindVAO()};a.prototype._initialize=function(a,c,d){this._width=c;this._height=d;c=new e.BufferObject(a,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);d=new e.VertexArrayObject(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:c});var g=e.createProgram(a,b.highlight);
a=e.createProgram(a,b.blur);g.setUniform1i("u_texture",h.TEXTURE_BINDING_HIGHLIGHT_0);g.setUniform1i("u_shade",h.TEXTURE_BINDING_HIGHLIGHT_1);g.setUniform4fv("u_sigmas",f.SIGMAS);a.setUniform1i("u_texture",h.TEXTURE_BINDING_HIGHLIGHT_0);a.setUniform4fv("u_sigmas",f.SIGMAS);this._resources={quadGeometry:c,quadVAO:d,highlightProgram:g,blurProgram:a}};a.prototype.setup=function(b,c,a){this._resources?(this._width=c,this._height=a):this._initialize(b,c,a)};return a}();d.default=a})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require",
"exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.highlight={name:"highlight",shaders:{vertexShader:e.resolveIncludes("highlight/textured.vert"),fragmentShader:e.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}};d.blur={name:"blur",shaders:{vertexShader:e.resolveIncludes("highlight/textured.vert"),fragmentShader:e.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["require",
"exports","../../../../../webgl"],function(a,d,e){function h(a,b,d){b=new e.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:b,height:d,samplingMode:9729});a=new e.FramebufferObject(a,{colorTarget:0,depthStencilTarget:2},b);return[b,a]}Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),
this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=function(b,a,d){this._width=a;this._height=d;var c=h(b,a,d),e=c[0],c=c[1];b=h(b,a,d);this._resources={sharedBlur1Tex:e,sharedBlur1Fbo:c,sharedBlur2Tex:b[0],sharedBlur2Fbo:b[1]}};a.prototype.setup=function(b,a,d){!this._resources||this._width===a&&this._height===d||this.dispose();this._resources||this._initialize(b,a,d)};Object.defineProperty(a.prototype,"sharedBlur1Tex",
{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});
return a}();d.default=a})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define("require exports tslib ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.name=c.constructor.name;c.defines=["id"];c._lastSize=0;return c}e.__extends(c,a);c.prototype.dispose=function(){f.isSome(this._fbo)&&this._fbo.dispose()};
c.prototype.bind=function(c){var b=c.context;c=c.painter;var a=b.getViewport();c=c.getFbos(a.width,a.height).effect0;b.bindFramebuffer(c);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};c.prototype.unbind=function(){};c.prototype.draw=function(c,a,d){var e=this,g=c.context,f=c.state,t=c.pixelRatio;void 0===d&&(d=b.HITTEST_SEARCH_SIZE);var n=g.getBoundFramebufferObject(),r=f.size[1]*t,k=Math.round(d*t),p=k/2,q=k/2;this._ensureBuffer(k);a.forEach(function(c,b){var d=new Map;n.readPixels(Math.floor(b[0]*
t-k/2),Math.floor(r-b[1]*t-k/2),k,k,6408,5121,e._buf);for(var g=0;g<e._buf32.length;g++){var f=e._buf32[g];if(4294967295!==f&&0!==f){var l=g%k,m=k-Math.floor(g/k),l=(p-l)*(p-l)+(q-m)*(q-m),m=d.has(f)?d.get(f):4294967295;d.set(f,Math.min(l,m))}}d=h.pairsOfMap(d).sort(function(c,b){return c[1]-b[1]}).map(function(c){return c[0]});c.resolve(d);a.delete(b)})};c.prototype._ensureBuffer=function(c){this._lastSize!==c&&(this._lastSize=c,this._buf=new Uint8Array(4*c*c),this._buf32=new Uint32Array(this._buf.buffer))};
return c}(m.Effect);d.HittestEffect=a})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define("require exports @dojo/framework/shim/iterator ../../../../../core/has ../../../../../core/maybe ../enums".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,c){this.brushes=a;this.name=c.name;this.drawPhase=c.drawPhase||b.WGLDrawPhase.MAP;this._targetFn=c.target;this.effects=c.effects||[];this.has=c.has}a.prototype.render=function(b){var c=
b.context,a=b.profiler,d=this._targetFn(),e=this.drawPhase&b.drawPhase;a.recordPassStart(this.name);if(e&&(!this.has||h(this.has))){this._doRender(b,d);a.recordPassEnd();for(var e=0,f=this.effects;e<f.length;e++){var l=f[e];if(l.enable()){var m=l.apply;a.recordPassStart(this.name+"."+m.name);a.recordBrushStart(m.name);var l=l.args&&l.args(),t=c.getViewport(),n=t.x,r=t.y,k=t.width,t=t.height,p=c.getBoundFramebufferObject();m.bind(b,l);this._doRender(b,d,m.defines);m.draw(b,l);m.unbind(b,l);c.bindFramebuffer(p);
c.setViewport(n,r,k,t);a.recordBrushEnd();a.recordPassEnd()}}}};a.prototype._doRender=function(b,c,a){if(!f.isNone(c))if(e.isArrayLike(c))for(var d=0;d<c.length;d++){var g=c[d];if(g.isReady&&g.visible)for(var h=0,l=this.brushes;h<l.length;h++){var m=l[h];b.profiler.recordBrushStart(m.name);m.prepareState(b,g,a);m.draw(b,g,a);b.profiler.recordBrushEnd()}}else for(d=0,g=this.brushes;d<g.length;d++)m=g[d],b.profiler.recordBrushStart(m.name),m.prepareState(b,c,a),m.draw(b,c,a),b.profiler.recordBrushEnd()};
return a}();d.default=a})},"esri/views/2d/engine/webgl/Profiler":function(){define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});var p=f("esri-2d-profiler");a=function(){function c(c,b){var a=this;this._events=new h;this._entries=new Map;this._timings=new e.default(10);if(p){this._ext=m.load(c.gl,
{});this._debugOutput=b;var d=c.gl;if(this.enableCommandLogging){c=function(c){if("function"===typeof d[c]){var b=d[c],e=-1!==c.indexOf("draw");d[c]=function(){for(var g=[],f=0;f<arguments.length;f++)g[f]=arguments[f];a._events.emit("command",{container:a._currentContainer,pass:a._currentPass,brush:a._currentBrush,method:c,args:g,isDrawCommand:e});a._currentSummary&&(a._currentSummary.commands++,e&&a._currentSummary.drawCommands++);return b.apply(d,g)}}};for(var g in d)c(g)}}}Object.defineProperty(c.prototype,
"enableCommandLogging",{get:function(){return!("object"===typeof p&&p.disableCommands)},enumerable:!0,configurable:!0});c.prototype.recordContainerStart=function(c){p&&(this._currentContainer=c)};c.prototype.recordContainerEnd=function(){p&&(this._currentContainer=null)};c.prototype.recordPassStart=function(c){p&&(this._currentPass=c,this._initSummary())};c.prototype.recordPassEnd=function(){p&&(this._currentPass=null,this._emitSummary())};c.prototype.recordBrushStart=function(c){p&&(this._currentBrush=
c)};c.prototype.recordBrushEnd=function(){p&&(this._currentBrush=null)};c.prototype.recordStart=function(c){if(p&&b.isSome(this._ext)){if(this._entries.has(c)){var a=this._entries.get(c),d=this._ext.resultAvailable(a.query),e=this._ext.disjoint();if(d&&!e){d=this._ext.getResult(a.query)/1E6;e=0;if(b.isSome(this._timings.enqueue(d))){for(var e=this._timings.entries,g=e.length,f=0,h=0;h<e.length;h++)f+=e[h];e=f/g}d=d.toFixed(2);e=e?e.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+
c+", "+d+" ms ("+e+" last 10 avg)\n"+a.commandsLen+" Commands ("+a.drawCommands+" draw)"),console.log("RenderPass breakdown: "),console.table(a.summaries),console.log("Commands: ",a.commands),console.groupEnd()):console.log("Frame report for "+c+", "+d+" ms ("+e+" last 10 avg)");this._debugOutput.innerHTML=d+" ("+e+")"}d=0;for(a=a.handles;d<a.length;d++)a[d].remove();this._entries.delete(c)}var n={name:c,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};
this.enableCommandLogging&&(n.handles.push(this._events.on("command",function(c){n.commandsLen++;n.commands.push(c);c.isDrawCommand&&n.drawCommands++})),n.handles.push(this._events.on("summary",function(c){n.summaries.push(c)})));this._ext.beginTimeElapsed(n.query);this._entries.set(c,n)}};c.prototype.recordEnd=function(c){p&&b.isSome(this._ext)&&this._entries.has(c)&&this._ext.endTimeElapsed()};c.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,
pass:this._currentPass,drawCommands:0,commands:0})};c.prototype._emitSummary=function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return c}();d.Profiler=a})},"esri/core/CircularArray":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a){void 0===a&&(a=Number.POSITIVE_INFINITY);this._start=this.size=0;this.maxSize=a;this._buffer=isFinite(a)?Array(a):[]}Object.defineProperty(a.prototype,
"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0});a.prototype.enqueue=function(a){if(this.size===this.maxSize){var d=this._buffer[this._start];this._buffer[this._start]=a;this._start=(this._start+1)%this.maxSize;return d}isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=a:this._buffer[this._start+this.size++]=a;return null};a.prototype.dequeue=function(){if(0===this.size)return null;var a=this._buffer[this._start];this._buffer[this._start]=null;
this.size--;this._start=(this._start+1)%this.maxSize;return a};return a}();d.default=a})},"esri/views/2d/engine/webgl/WebGLDriverTest":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});var m=e.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),p=function(){function c(c){this._ignoresSamplerPrecision=null;this._context=c}Object.defineProperty(c.prototype,
"ignoresSamplerPrecision",{get:function(){h.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=d.testSamplerPrecision(this._context));return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return c}();d.testWebGLDriver=function(c){return new p(c)};d.testSamplerPrecision=function(c){var a=new f.FramebufferObject(c,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),d=new Uint8Array(4),
e=new b(c,[0,0,1,0,0,1,1,1]),h=new f.Program(c,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),l=new f.Texture(c,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));h.setUniform1i("u_texture",0);c.bindTexture(l,0);c.bindFramebuffer(a);c.bindProgram(h);var p=c.getViewport(),l=p.x,t=p.y,n=p.width,p=p.height;c.setViewport(0,0,1,1);e.draw();c.setViewport(l,t,n,p);a.readPixels(0,0,1,1,6408,5121,d);h.dispose();e.dispose();
a.dispose();(c=255!==d[0]||255!==d[1]||255!==d[2]||255!==d[3])&&m.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+d[0]+"."+d[1]+"."+d[2]+"."+d[3]+"]");return c}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});d.stencil={name:"stencil",shaders:{vertexShader:e.resolveIncludes("stencil/stencil.vert"),fragmentShader:e.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports tslib ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug ../../../webgl/FramebufferObject".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x){Object.defineProperty(d,"__esModule",{value:!0});var l=b.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),y=v.createDebugLogger(v.DEBUG_ATTR_UPDATES,l),t=function(){function b(c,b,a){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;var d=c.buffer,e=c.pixelType;c=c.textureOnly;var g=u.getPixelArrayCtor(e);this.shared=a;this.pixelType=e;this.size=b;this.textureOnly=c;c||(this.data=new g(m.unwrap(d)));this._resetRange()}b.prototype.destroy=
function(){m.andThen(this._texture,function(c){return c.dispose()});var c=function(c){m.andThen(b._fbos[c],function(b){"0"===c&&b.detachColorTexture();b.dispose()});b._fbos[c]=null},b=this,a;for(a in this._fbos)c(a);this._texture=null};Object.defineProperty(b.prototype,"_textureDesc",{get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}},enumerable:!0,configurable:!0});b.prototype.setData=function(c,b,a){c&=2147483647;
var d=m.unwrap(this.data);b=c*this.texelSize+b;!d||b>=d.length||(d[b]=a,this.dirtyStart=Math.min(this.dirtyStart,c),this.dirtyEnd=Math.max(this.dirtyEnd,c))};b.prototype.getData=function(c,b){if(m.isNone(this.data))return null;c=(c&2147483647)*this.texelSize+b;return!this.data||c>=this.data.length?null:this.data[c]};b.prototype.getTexture=function(c){var b=this;return m.unwrapOr(this._texture,function(){return b._initTexture(c)})};b.prototype.getFBO=function(c,b){void 0===b&&(b=0);if(m.isNone(this._fbos[b])){var a=
0===b?this.getTexture(c):this._textureDesc;this._fbos[b]=new x(c,{colorTarget:0,depthStencilTarget:0},a)}return this._fbos[b]};Object.defineProperty(b.prototype,"locked",{get:function(){return 5121===this.pixelType&&this.shared&&!this.textureOnly&&f("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1},enumerable:!0,configurable:!0});b.prototype.updateTexture=function(c){if(!this.locked)try{var b=this.dirtyStart,a=this.dirtyEnd;if(!(b>a)){this._resetRange();var d=m.unwrap(this.data).buffer,
e=this.getTexture(c),g=(b-b%this.size)/this.size,f=(a-a%this.size)/this.size,n=g*this.size*4,r=4*(this.size+f*this.size)-n,t=u.getPixelArrayCtor(this.pixelType),p=t.BYTES_PER_ELEMENT;try{new t(d,n*p,r)}catch(G){console.debug(G)}var y=new t(d,n*p,r),x=this.size;c=f-g+1;c>this.size?l.error(new h("mapview-webgl","Out-of-bounds index when updating AttributeData")):e.updateData(0,0,g,x,c,y)}}catch(G){console.debug(G)}};b.prototype.update=function(c){var b=c.data,a=c.start,d=c.end;if(m.isSome(b))for(var e=
this.data,g=a*this.texelSize,f=0;f<b.length;f++)c.layout&1<<f%this.texelSize&&(e[g+f]=b[f]);this.dirtyStart=Math.min(this.dirtyStart,a);this.dirtyEnd=Math.max(this.dirtyEnd,d)};b.prototype.resize=function(c,b){var a=this.size;this.size=b;this.textureOnly?a!==this.size&&(this._lastTexture=this._texture,this._texture=null):(b=u.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new b(m.unwrap(c.buffer)))};b.prototype._resetRange=function(){this.dirtyStart=2147483647;this.dirtyEnd=0};b.prototype._initTexture=
function(b){var a=new c.Texture(b,this._textureDesc,m.unwrapOr(this.data,void 0));if(m.isSome(this._lastTexture)&&this._fbos[0]){var d=this._lastTexture.descriptor.width,e=this._lastTexture.descriptor.height,g=this._lastTexture.descriptor.dataType,f=this._lastTexture.descriptor.pixelFormat,n=this.getFBO(b),l=u.getPixelBytes(g),h=u.getPixelArrayCtor(g),l=new ArrayBuffer(d*e*l*this.texelSize),h=new h(l),l=b.getBoundFramebufferObject(),t=b.getViewport(),r=t.x,p=t.y,y=t.width,t=t.height;b.bindFramebuffer(n);
n.readPixels(0,0,d,e,f,g,h);a.updateData(0,0,0,2*d,e/2,h);b.setViewport(r,p,y,t);b.bindFramebuffer(l)}this.destroy();return this._texture=a};return b}();a=function(){function b(){this._locked=this._forceNextUpload=this._initialized=!1}b.prototype.initialize=function(c){var b=c.blocks,a=c.shared,d=c.size;this.shared=a;this.size=d;y("Initializing AttributeStoreView",c);if(m.isNone(this._data))this._data=m.mapMany(b,function(c){return new t(c,d,a)});else for(c=0;c<this._data.length;c++){var e=this._data[c],
g=b[c];m.isSome(g)&&(m.isNone(e)?this._data[c]=new t(g,d,a):e.resize(g,d))}this._initialized=!0};b.prototype.destroy=function(){m.andThen(this._data,function(c){return m.mapMany(c,function(c){return c.destroy()})});m.andThen(this._defaultTexture,function(c){return c.dispose()})};b.prototype.getBlock=function(c){return m.isNone(this._data)?null:this._data[c]};b.prototype.setLabelMinZoom=function(c,b){this.setData(c,0,1,b)};b.prototype.getLabelMinZoom=function(c){return this.getData(c,0,1,255)};b.prototype.getFilterFlags=
function(c){return this.getData(c,0,0,0)};b.prototype.getVVSize=function(c){return this.getData(c,g.ATTRIBUTE_DATA_VV,0,0)};b.prototype.getData=function(c,b,a,d){if(!this._data)return 0;b=m.unwrap(this._data)[b];if(m.isNone(b))return 0;c=b.getData(c,a);return m.isSome(c)?c:d};b.prototype.setData=function(c,b,a,d){b=m.unwrap(this._data)[b];m.unwrap(b).setData(c,a,d)};b.prototype.lockTextureUpload=function(){this._locked=!0};b.prototype.unlockTextureUpload=function(){this._locked=!1};b.prototype.forceTextureUpload=
function(){this._forceNextUpload=!0};b.prototype.requestUpdate=function(c){return e.__awaiter(this,void 0,void 0,function(){var b;return e.__generator(this,function(a){if(this._pendingAttributeUpdate)return l.error(new h("mapview-webgl","Tried to update attribute data with a pending update")),[2];b=p.createResolver();y("AttributeStoreView Update Requested",c);this._pendingAttributeUpdate={data:c,resolver:b};return[2,b.promise]})})};b.prototype.update=function(){if(this._initialized&&m.isSome(this._pendingAttributeUpdate)){for(var c=
this._pendingAttributeUpdate,b=c.data,c=c.resolver,a=m.unwrap(this._data),d=function(c){var d=b.blocks[c];m.andThen(a[c],function(b){return m.andThen(d,function(a){y("Updating block "+c,a);b.update(a)})})},e=0;e<b.blocks.length;e++)d(e);this._pendingAttributeUpdate=null;c()}};b.prototype.bindTextures=function(c){this.update();var b=this._getDefaultTexture(c);if(this._initialized){var a=m.unwrap(this._data);if(!this._locked||this._forceNextUpload)m.forEachSome(a,function(b){return b.updateTexture(c)}),
this._forceNextUpload=!1;c.bindTexture(m.mapOr(a[0],b,function(b){return b.getTexture(c)}),g.TEXTURE_BINDING_ATTRIBUTE_DATA_0);c.bindTexture(m.mapOr(a[1],b,function(b){return b.getTexture(c)}),g.TEXTURE_BINDING_ATTRIBUTE_DATA_1);c.bindTexture(m.mapOr(a[2],b,function(b){return b.getTexture(c)}),g.TEXTURE_BINDING_ATTRIBUTE_DATA_2);c.bindTexture(m.mapOr(a[3],b,function(b){return b.getTexture(c)}),g.TEXTURE_BINDING_ATTRIBUTE_DATA_3)}else c.bindTexture(b,g.TEXTURE_BINDING_ATTRIBUTE_DATA_0),c.bindTexture(b,
g.TEXTURE_BINDING_ATTRIBUTE_DATA_1),c.bindTexture(b,g.TEXTURE_BINDING_ATTRIBUTE_DATA_2),c.bindTexture(b,g.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};b.prototype._getDefaultTexture=function(b){m.isNone(this._defaultTexture)&&(this._defaultTexture=new c.Texture(b,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return b}();d.AttributeStoreView=a})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports tslib ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../webgl ./color ./enums ./SymbolProperties".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u){function v(c){for(var b={},a=0;a<c.length;a++){var d=c[a];b[d.name]=d.strideInBytes}return b}function x(c){switch(c){case g.WGLGeometryType.MARKER:return w;case g.WGLGeometryType.FILL:return q;case g.WGLGeometryType.LINE:return z;case g.WGLGeometryType.TEXT:return B;case g.WGLGeometryType.LABEL:return A}}function l(c){switch(c%4){case 0:case 2:return 4;case 1:case 3:return 1}}function y(c){return"string"===typeof c}function t(c){switch(c){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function n(c){var b={},a=function(a){var d=0;b[a]=c[a].map(function(c){var b=e.__assign(e.__assign({},c),{normalized:c.normalized||!1,divisor:c.divisor||0,offset:d,stride:0});d+=c.count*t(c.type);return b});b[a].forEach(function(c){return c.stride=d})},d;for(d in c)a(d);return b}var r;Object.defineProperty(d,"__esModule",{value:!0});var k=f.getLogger("esri.views.2d.engine.webgl.Utils");d.C_VBO_GEOMETRY="geometry";d.C_VBO_PERINSTANCE=
"per_instance";d.C_VBO_PERINSTANCE_VV="per_instance_vv";d.C_ICON_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_FILL_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_FILL_VERTEX_DEF_DD=[{name:d.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];d.C_LINE_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];d.C_TEXT_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_LABEL_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];d.C_ICON_STRIDE_SPEC=
v(d.C_ICON_VERTEX_DEF);d.C_FILL_STRIDE_SPEC=v(d.C_FILL_VERTEX_DEF);d.C_FILL_STRIDE_SPEC_DD=v(d.C_FILL_VERTEX_DEF_DD);d.C_LINE_STRIDE_SPEC=v(d.C_LINE_VERTEX_DEF);d.C_TEXT_STRIDE_SPEC=v(d.C_TEXT_VERTEX_DEF);d.C_LABEL_STRIDE_SPEC=v(d.C_LABEL_VERTEX_DEF);d.getStrides=function(c,b){switch(c){case g.WGLGeometryType.MARKER:return d.C_ICON_STRIDE_SPEC;case g.WGLGeometryType.FILL:return b?d.C_FILL_STRIDE_SPEC_DD:d.C_FILL_STRIDE_SPEC;case g.WGLGeometryType.LINE:return d.C_LINE_STRIDE_SPEC;case g.WGLGeometryType.TEXT:return d.C_TEXT_STRIDE_SPEC;
case g.WGLGeometryType.LABEL:return d.C_LABEL_STRIDE_SPEC}};var w=[d.C_VBO_GEOMETRY],q=[d.C_VBO_GEOMETRY],z=[d.C_VBO_GEOMETRY],B=[d.C_VBO_GEOMETRY],A=[d.C_VBO_GEOMETRY];d.getNamedBuffers=x;d.strideToPackingFactor=l;d.allocateTypedArrayBuffer=function(c,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(c*b/4));case 1:case 3:return new Uint8Array(c*b)}};d.allocateTypedArrayBufferwithData=function(c,b){switch(b%4){case 0:case 2:return new Uint32Array(c);case 1:case 3:return new Uint8Array(c)}};
d.getTextProperties=function(b){return u.TextProperties.pool.acquire(b.color?c.copyAndPremultiply(b.color):[255,255,255,255],b.haloColor?c.copyAndPremultiply(b.haloColor):[255,255,255,255],m.pt2px(b.haloSize),m.pt2px(b.font.size),b.angle*Math.PI/180,b.xoffset/b.font.size,b.yoffset/b.font.size,"left"===b.horizontalAlignment?0:"right"===b.horizontalAlignment?1:.5,"top"===b.verticalAlignment?0:"bottom"===b.verticalAlignment?1:.5)};d.isDefined=function(c){return null!=c};d.isNumber=function(c){return"number"===
typeof c};d.isString=y;d.isStringOrNull=function(c){return null==c||y(c)};d.getCapType=function(c,b){switch(c){case "butt":return 0;case "round":return b?2:1;case "square":return 2;default:return k.error(new h("mapview-invalid-type","Cap type "+c+" is not a valid option. Defaulting to round")),1}};d.getJoinType=function(c){switch(c){case "miter":return 2;case "bevel":return 0;case "round":return 1;default:return k.error(new h("mapview-invalid-type","Join type "+c+" is not a valid option. Defaulting to round")),
1}};d.getVVType=function(c){switch(c){case "opacity":return g.VVType.OPACITY;case "color":return g.VVType.COLOR;case "rotation":return g.VVType.ROTATION;case "size":return g.VVType.SIZE;default:return k.error("Cannot interpret unknown vv: "+c),null}};d.getTransformParams=function(c){return{transform:c.transform,hasZ:c.hasZ,hasM:c.hasM}};d.copyMeshData=function(c,b,a,d,e,g,f){for(var k in g)for(var q=g[k].stride,n=l(q),h=g[k].data,m=a[k].data,t=q*e.vertexCount/n,p=q*c/n,n=q*e.vertexFrom/n,q=0;q<t;++q)m[q+
p]=h[q+n];a=e.indexCount;for(q=0;q<a;++q)d[q+b]=f[q+e.indexFrom]-e.vertexFrom+c};d.C_VBO_INFO=(r={},r[d.C_VBO_GEOMETRY]=35044,r);d.createGeometryData=function(c,b){for(var a=[],d=0;5>d;++d){for(var e={},g=0,f=x(d);g<f.length;g++){var k=f[g];e[k]={data:b(d,k)}}a.push({data:c(d),buffers:e})}return a};d.createTextureFromTexelData=function(c,a){var d,e;b.isPowerOfTwo(a.width)&&b.isPowerOfTwo(a.height)?(d=!0,e=9987):(d=!1,e=9729);return new p.Texture(c,{target:3553,pixelFormat:6408,internalFormat:6408,
dataType:5121,hasMipmap:d,samplingMode:e,wrapMode:33071,flipped:!0},a)};d.geometryToMappedGeometry=function(c){return{vertexFrom:void 0,vertexTo:void 0,geometry:c}};d.getBytes=t;d.getPixelBytes=function(c){switch(c){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:k.error(new h("webgl-utils","Unable to handle type "+c))}};d.getPixelArrayCtor=function(c){switch(c){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:k.error(new h("webgl-utils",
"Unable to handle type "+c))}};var D=new Map;d.createProgramDescriptor=function(c,b){if(!D.has(c)){var a=n(b),d={},e;for(e in a){var g=a[e];d[e]=g.length?g[0].stride:0}e={};for(var f in b)for(var g=0,k=b[f];g<k.length;g++){var q=k[g];e[q.name]=q.location}D.set(c,{strides:d,bufferLayouts:a,attributes:e})}return D.get(c)}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(a,d,e){function h(b,a){Array.isArray(a)?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):
(b[0]=a.r,b[1]=a.g,b[2]=a.b,b[3]=a.a);return b}function f(b,a,c){void 0===a&&(a=0);void 0===c&&(c=!1);var d=b[a+3];b[a+0]*=d;b[a+1]*=d;b[a+2]*=d;c||(b[a+3]*=255);return b}Object.defineProperty(d,"__esModule",{value:!0});d.white=[255,255,255,1];var b=[0,0,0,0];d.premultiplyAlpha=f;d.copyAndPremultiply=function(b){return f(h([],b))};d.premultiplyAlphaUint32=function(a){f(h(b,a));return e.i8888to32(b[0],b[1],b[2],b[3])};d.premultiplyAlphaRGBA=function(b){if(!b)return 0;var a=b.a;return e.i8888to32(b.r*
a,b.g*a,b.b*a,255*a)}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,b,d,e,c,g,h,v,x){this.color=a;this.haloColor=b;this.haloSize=d;this.size=e;this.angle=c;this.offsetX=
g;this.offsetY=h;this.hAnchor=v;this.vAnchor=x};a.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new e(a);return a}();d.TextProperties=a})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require","exports","tslib"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});
d.createDebugLogger=function(a,d){return a&&function(){for(var b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];return d.warn.apply(d,e.__spreadArrays(["DEBUG:"],b))}||function(){return null}};d.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,b){void 0===b&&(b=2);this._bucketSize=a;this._rowsLength=e.TILE_SIZE/a;this._colsLength=
e.TILE_SIZE/a;this._elementsPerBucket=b;this._grid=this._initGrid()}a.prototype.checkOverlap=function(a,b){a=Math.floor(a/this._bucketSize);b=Math.floor(b/this._bucketSize);return 0>a||a>=this._rowsLength||0>b||b>=this._colsLength?!0:this._grid[b*this._colsLength+a]>=this._elementsPerBucket};a.prototype.markUsed=function(a,b){this._grid[Math.floor(b/this._bucketSize)*this._colsLength+Math.floor(a/this._bucketSize)]+=1};a.prototype.reset=function(){this._grid=this._initGrid()};a.prototype._initGrid=
function(){return new Uint8Array(this._rowsLength*this._colsLength)};return a}();d.CollisionGrid=a})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/MapUtils ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo".split(" "),function(a,d,e,h,f,b,m,p,c){Object.defineProperty(d,"__esModule",{value:!0});var g=m.TILE_SIZE/m.COLLISION_BUCKET_SIZE,u=h.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");
a=function(){function a(c){this._layers=new Map;this._collisionBuckets=new Map;this._didError=!1;this._tilingScheme=c}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){return f.valuesOfMap(this._layers)},enumerable:!0,configurable:!0});a.prototype.registerLayerView=function(b,a){if(!this._layers.has(b)){var d=c.default.create(b,a,this.collisionInfos,this._tilingScheme);this._layers.set(b,d);this._collisionBuckets.forEach(function(c){return c.onRegisterLayer(d.index)})}};a.prototype.unregisterLayerView=
function(b){var a=this;if(this._layers.has(b)){var d=this._layers.get(b);c.default.delete(d.index,this.collisionInfos);this._layers.delete(b);this._collisionBuckets.forEach(function(c,b){var e=c.getTile(d.index);e&&(c.onUnregisterLayer(d.index),c.canDelete()&&a._collisionBuckets.delete(b),e.reference&&(e.reference.isDirty=!1))})}};a.prototype.addTile=function(c,b){var a=b.key.id;this._layers.has(c)&&(this._collisionBuckets.has(a)||this._collisionBuckets.set(a,new p.default(b.key,this._layers.size)),
c=this._getIndex(c),this._collisionBuckets.get(a).getTile(c).reference=b)};a.prototype.removeTile=function(c,b){this._layers.has(c)&&this._collisionBuckets.has(b)&&(c=this._getIndex(c),b=this._collisionBuckets.get(b).getTile(c),b.dirty=!1,b.reference=null)};a.prototype.run=function(b,a){var d=f.valuesOfMap(this._collisionBuckets).sort(function(c,b){return c.key.compareRowMajor(b.key)}),g=!0,n=b.renderingOptions.labelCollisionsEnabled&&!this._didError,l=this.collisionInfos;try{for(var k=0;k<d.length;k++){var h=
d[k],g=g||h.isDirty;h.computeNeighbors(this._collisionBuckets);for(var q=0;q<this._layers.size;q++){var m=c.default.find(q,l);h.reset(b,g,m)}}for(b=0;b<this._layers.size;b++)for(m=c.default.find(b,l),g=0,k=d;g<k.length;g++)h=k[g],this._run(n,h,m,a)}catch(B){u.error(new e("mapview-labeling","Encountered an error during decluttering. Disabling collisions",B)),this._didError=!0}for(a=0;a<d.length;a++)h=d[a],h.ready()};a.prototype._run=function(c,b,a,d){var e=b.getReference(a.index);e&&e.hasData&&(e.key.level!==
d?this._resetLabelsMinZoom(b,a):this._runVisibility(c,b,e,a,d))};a.prototype._resetLabelsMinZoom=function(c,b){if(c&&"polyline"!==b.geometryType&&(c=c.getReference(b.index))&&c.hasData){b=b.layerView.tileRenderer.featuresView.attributeView;var a=0;for(c=c.displayObjects;a<c.length;a++)b.setLabelMinZoom(c[a].id,255)}};a.prototype._checkLabelsVisible=function(c,b){var a=!b.effect||b.effect.excludedLabelsVisible||!!(c&m.EFFECT_FLAG_0);return(!b.filter||!!(c&m.FILTER_FLAG_0))&&a};a.prototype._runVisibility=
function(c,b,a,d,e){var g=d.layerView.tileRenderer.featuresView.attributeView;a=a.displayObjects.sort(function(c,b){c=g.getLabelMinZoom(c.id);b=g.getLabelMinZoom(b.id);return c-b});for(var f=d.zoomRanges.some(function(c){return"none"===c.deconflictionStrategy}),n=0;n<a.length;n++){var q=a[n];if(q.metrics.length){var l="polyline"===d.geometryType?0:10*(e-1),h=g.getFilterFlags(q.id),t=this._checkLabelsVisible(h,d.layerView);if(c&&!f)for(var m=0;m<q.metrics.length;m++)h=q.metrics[m],h=t?-1!==h.minZoom?
h.minZoom:this._computeLabelVisibility(q,h,d.index,b,h.baseZoom,e):255,l=Math.max(h,l);l=Math.max(l,0);g.setLabelMinZoom(q.id,l);t=0;for(q=q.metrics;t<q.length;t++)h=q[t],h.minZoom=l}}};a.prototype._computeLabelVisibility=function(c,b,a,d,e,f){for(var k=b.xBucket,n=b.yBucket,q=b.xOverflow,l=b.yOverflow,h=k-q,k=k+q+1,q=n+l+1,n=n-l;n<q;n++)for(l=h;l<k;l++)if(!(l<-g||n<-g||l>g||n>g))for(var t=0;t<=a;t++){var m=this._getRelativeSubBucket(t,d,l,n);if(m)for(var p=0;p<m.length;p++){var r=m[p];if(t!==a||
r.id!==c.id)r=this._compareLabels(b,r,e,f),e=Math.max(r,e)}}return e};a.prototype._compareLabels=function(c,a,d,e){if(-1===a.minZoom||a.minZoom>10*(e+1))return d;c=c.findCollisionDelta(a);e=b.clamp(Math.ceil(10*(c+e)),0,255);return a.minZoom>=e?d:Math.max(d,e)};a.prototype._getNeighboringTile=function(c,b,a,d){return(b=b.neighbors[3*(1+d)+(1+a)])&&b.getTile(c)};a.prototype._getRelativeSubBucket=function(c,a,d,e){var g=b.sign(Math.floor(d/4)),f=b.sign(Math.floor(e/4));return(c=this._getNeighboringTile(c,
a,g,f))&&c.reference&&c.index&&c.reference.hasData?c.index[e-4*f][d-4*g]:null};a.prototype._getIndex=function(c){return this._layers.get(c).index};return a}();d.CollisionEngine=a})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(b,a){this.neighbors=Array(9);this._tiles=Array(a);for(var d=0;d<a;d++)this._tiles[d]=new h.default;
this.key=b}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var b=0,a=this._tiles;b<a.length;b++)if(a[b].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});a.prototype.getTile=function(b){return this._tiles[b]};a.prototype.getReference=function(b){return(b=this._tiles[b])&&b.reference};a.prototype.onRegisterLayer=function(b){this.invalidateRange(b);this._add(b)};
a.prototype.onUnregisterLayer=function(b){this.invalidateRange(b);this._remove(b)};a.prototype.onLabelsRendered=function(){};a.prototype.invalidateRange=function(b){for(;b<this._tiles.length;b++)this._tiles[b].dirty=!0};a.prototype.add=function(b){this._add(b)};a.prototype.remove=function(b){this._remove(b)};a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var b=0,a=this._tiles;b<a.length;b++)a[b].dirty=!1};a.prototype.computeNeighbors=function(b){this.neighbors[0]=
this._getNeighbor(b,-1,-1);this.neighbors[1]=this._getNeighbor(b,0,-1);this.neighbors[2]=this._getNeighbor(b,1,-1);this.neighbors[3]=this._getNeighbor(b,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(b,1,0);this.neighbors[6]=this._getNeighbor(b,-1,1);this.neighbors[7]=this._getNeighbor(b,0,1);this.neighbors[8]=this._getNeighbor(b,1,1)};a.prototype.reset=function(b,a,d){var c=this._tiles[d.index];c&&c.reset(b,a,d)};a.prototype._add=function(b){var a=[];if(b>=this._tiles.length)this._tiles.push(new h.default);
else{for(var d=0;d<this._tiles.length;d++)d===b&&a.push(new h.default),a.push(this._tiles[d]);this._tiles=a}};a.prototype._remove=function(b){for(var a=[],d=0;d<this._tiles.length;d++)d!==b&&a.push(this._tiles[d]);this._tiles=a};a.prototype._getNeighbor=function(b,a,d){var c=this.key;a=e.TileKey.getId(c.level,c.row+d,c.col+a,c.world);return b.has(a)?b.get(a):null};return a}();d.default=a})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],
function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(a){this.reference&&this.reference.hasData&&(a||this.reference.isDirty)&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"reference",{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,b,d){a=a.state;var f=d.layerView.tileRenderer,c=this.reference;if(!c||!c.hasData)return!1;b&&(c.isDirty=!0);b=c.transforms.labelMat2d;for(var g=b[4],h=b[5],m=0,x=c.displayObjects;m<x.length;m++)for(var l=x[m],y=f.featuresView.attributeView,y=d.hasVV()?y.getVVSize(l.id):0,t=0,l=l.metrics;t<l.length;t++){var n=l[t];d.hasVV()&&
n.computeVVOffset(y,d.vvEval);var r=n.bounds.center,k=n.bounds.centerT;c.isDirty&&(n.minZoom=-1);var w=e.vec2.copy(k,n.anchor);a.rotation?e.vec2.transformMat2d(w,w,b):(k[0]=w[0]+g,k[1]=w[1]+h);e.vec2.add(k,w,r);k[0]+=n.offsetX;k[1]+=n.offsetY;if(n.boxes)for(r=0,k=n.boxes;r<k.length;r++){var w=k[r],q=w.centerT;e.vec2.add(q,n.anchor,w.center);a.rotation?e.vec2.transformMat2d(q,q,b):(q[0]+=g,q[1]+=h)}}return!0};return a}();d.default=a})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports tslib ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),
function(a,d,e,h,f,b,m){function p(c,b){var a=!!c.maxScale,d=!!c.minScale&&b.scaleToZoom(c.minScale)||0;b=a&&b.scaleToZoom(c.maxScale)||255;return{deconflictionStrategy:c.deconflictionStrategy,minZoom:f.clamp(Math.floor(10*d),0,255),maxZoom:f.clamp(Math.floor(10*b),0,255)}}function c(c){return function(a){return b.pt2px(m.getSizeForValueSimple(a,c))}}function g(b){if(!b)return null;for(var a=0;a<b.length;a++){var d=b[a];if("size"===d.type)return c(d)}return null}Object.defineProperty(d,"__esModule",
{value:!0});var u=function(c,b){return c.order-b.order},v=function(c,b){return c.index-b.index},x=h.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");d.createLabelVVEvaluator=g;a=function(){function c(c,b,a,d){var f=this;this._vvHandle=null;var n=c.layer,q=n.geometryType,h=n.labelingInfo,l=n.renderer;l&&(this.vvEval=g("visualVariables"in l&&l.visualVariables));this._vvHandle=n.watch("renderer",function(c){c&&(f.vvEval=g("visualVariables"in c&&c.visualVariables))});n=(n=n.featureReduction)&&
"cluster"===n.type&&n.labelingInfo;h=(h||[]).map(function(c){return p(c,d)});n=(n||[]).map(function(c){return p(c,d)});this.layerView=c;this.geometryType=q;this.index=b;this.order=a;this.zoomRanges=e.__spreadArrays(h,n);this.layerView=c}c.prototype.hasVV=function(){return!!this.vvEval};c.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};c.prototype.destroy=function(){this._vvHandle.remove()};c.create=function(b,a,d,e){d=d.sort(u);for(var g=!1,f=-1,q=0;q<d.length;q++){var n=d[q];
!g&&n.order>a&&(f=n.index,g=!0);g&&n.index++}g||(f=d.length);return new c(b,f,a,e)};c.delete=function(c,b){for(var a=b.sort(v),d=c+1;d<a.length;d++)b[d].index--;b[c].destroy();b.splice(c,1)};c.find=function(c,b){for(var a=0;a<b.length;a++){var d=b[a];if(d.index===c)return d}x.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return c}();d.default=a})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils",
"../../../../../renderers/support/utils"],function(a,d,e,h){function f(c,a){switch(a.transformationType){case "additive":var d=b(a.minSize,c);return c+(d||a.minDataValue);case "constant":return d=(d=a.stops)&&d.length&&d[0].size,null==d&&(d=a.minSize),b(d,c);case "clamped-linear":var d=(c-a.minDataValue)/(a.maxDataValue-a.minDataValue),g=b(a.minSize,c),f=b(a.maxSize,c);c=c<=a.minDataValue?g:c>=a.maxDataValue?f:g+d*(f-g);return c;case "proportional":return d=c/a.minDataValue,g=b(a.minSize,c),c=b(a.maxSize,
c),e.clamp(d*g,g,c);case "stops":return g=m(c,a.cache.ipData),f=g[0],d=g[1],g=g[2],f===d?c=b(a.stops[f].size,c):(f=b(a.stops[f].size,c),c=b(a.stops[d].size,c),c=f+(c-f)*g),c;case "real-world-size":d=h.meterIn[a.valueUnit];g=b(a.minSize,c);f=b(a.maxSize,c);a=a.valueRepresentation;var l=null,l="area"===a?2*Math.sqrt(c/p)/d:"radius"===a||"distance"===a?2*c/d:c/d;return e.clamp(l,g,f);case "identity":return c;case "unknown":return null}}function b(c,b){return"number"===typeof c?c:f(b,c)}function m(c,
b){if(b){var a=0,d=b.length-1;b.some(function(b,e){if(c<b)return d=e,!0;a=e;return!1});return[a,d,(c-b[a])/(b[d]-b[a])]}}Object.defineProperty(d,"__esModule",{value:!0});var p=Math.PI;d.getSizeForValueSimple=f})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require","exports","../../../../../core/Error","../../../../../core/Logger"],function(a,d,e,h){function f(b){return"esri.views.2d.layers.FeatureLayerView2D"===b.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===
b.declaredClass}Object.defineProperty(d,"__esModule",{value:!0});var b=h.getLogger("esri.views.2d.engine.collisions.LayerViewSorter");a=function(){function a(b,c){this.registerLayer=b;this.unregisterLayer=c;this._layerViewState=new Map}a.prototype.findIndex=function(b){return b.view.allLayerViews.findIndex(function(c){return c.uid===b.uid})};a.prototype.update=function(a){for(var c=a.added,d=0,h=a.removed;d<h.length;d++)a=h[d],f(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(d=0;d<c.length;d++){a=
c[d];if(h=f(a))a:if(a.layer&&a.layer.renderer)switch(a.layer.renderer.type){case "class-breaks":case "simple":case "unique-value":case "dictionary":case "dot-density":h=!0;break a;default:b.error(new e("mapview-labeling","Renderer of type "+a.layer.renderer.type+" does not currently support labeling")),h=!1}else h=!1;h&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};a.prototype.destroy=function(){this._layerViewState.forEach(function(b){return b.handles.forEach(function(c){return c.remove()})})};
a.prototype._createState=function(b){var c={priority:-1,handles:null};c.handles=[b.layer.watch("visible",this._recomputeOrder.bind(this)),b.layer.watch("labelsVisible",this._recomputeOrder.bind(this)),b.layer.watch("labelingInfo",this._recomputeOrder.bind(this)),b.layer.watch("featureReduction",this._recomputeOrder.bind(this))];this._layerViewState.set(b,c);return c};a.prototype._deleteState=function(b){if(this._layerViewState.has(b)){var c=this._layerViewState.get(b);c.handles.forEach(function(c){return c.remove()});
-1!==c.priority&&this.unregisterLayer(b);this._layerViewState.delete(b)}};a.prototype._recomputeOrder=function(){var b=this;this._layerViewState.forEach(function(c,a){var d=a.view.map.allLayers.findIndex(function(c){return c.uid===a.layer.uid}),e=a.layer,g=e.featureReduction,g=g&&"cluster"===g.type&&g.labelsVisible&&g.labelingInfo&&g.labelingInfo.length,g=e.labelingInfo&&e.labelingInfo.length||g,d=e.visible&&e.labelsVisible&&g?4294967295-d:-1;d!==c.priority&&(c.priority=d,b.unregisterLayer(a),-1!==
d&&b.registerLayer(a,d))})};return a}();d.LayerViewSorter=a})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,d){this.x=a;this.y=d}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,d){return a===this.x&&d===this.y};a.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};a.prototype.setCoords=function(a,d){this.x=a;this.y=d};a.prototype.normalize=
function(){var a=this.x,d=this.y,a=Math.sqrt(a*a+d*d);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,d){this.x+=a;this.y+=d};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,d){this.x=a.x+d.x;this.y=a.y+d.y};a.prototype.assignSub=function(a,d){this.x=a.x-d.x;this.y=a.y-d.y};a.prototype.rotate=function(a,d){var b=this.x,e=this.y;this.x=b*a-e*d;this.y=b*d+e*a};a.prototype.scale=function(a){this.x*=
a;this.y*=a};a.prototype.length=function(){var a=this.x,d=this.y;return Math.sqrt(a*a+d*d)};a.distance=function(a,d){var b=d.x-a.x;a=d.y-a.y;return Math.sqrt(b*b+a*a)};a.add=function(d,e){return new a(d.x+e.x,d.y+e.y)};a.sub=function(d,e){return new a(d.x-e.x,d.y-e.y)};return a}();d.Point=a})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});var e;(function(a){a[a.Left=-1]="Left";a[a.Center=0]="Center";
a[a.Right=1]="Right"})(e=d.HAlign||(d.HAlign={}));var h;(function(a){a[a.Top=1]="Top";a[a.Center=0]="Center";a[a.Bottom=-1]="Bottom";a[a.Baseline=2]="Baseline"})(h=d.VAlign||(d.VAlign={}));d.getXAnchorDirection=function(a){switch(a){case "left":return e.Left;case "right":return e.Right;case "center":case "justify":return e.Center}};d.getYAnchorDirection=function(a){switch(a){case "top":return h.Top;case "middle":return h.Center;case "baseline":return h.Baseline;case "bottom":return h.Bottom}};d.getAlignmentFromPlacement=
function(a){switch(a){case "above-left":return[e.Right,h.Bottom];case "above-center":case "above-along":return[e.Center,h.Bottom];case "above-right":return[e.Left,h.Bottom];case "center-left":return[e.Right,h.Center];case "center-center":case "center-along":return[e.Center,h.Center];case "center-right":return[e.Left,h.Center];case "below-left":return[e.Right,h.Top];case "below-center":case "below-along":return[e.Center,h.Top];case "below-right":return[e.Left,h.Top];case "always-horizontal":return[e.Center,
h.Baseline];default:return console.debug("Found invalid placement type "+a),[e.Center,h.Center]}};d.getXDirection=function(a){switch(a){case e.Right:return-1;case e.Center:return 0;case e.Left:return 1;default:return console.debug("Found invalid horizontal alignment "+a),0}};d.getYDirection=function(a){switch(a){case h.Top:return 1;case h.Center:return 0;case h.Bottom:case h.Baseline:return-1;default:return console.debug("Found invalid vertical alignment "+a),0}};d.getJustification=function(a){switch(a){case "left":return e.Left;
case "right":return e.Right;case "center":case "justify":return e.Center}}})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define("require exports tslib ../definitions ../VertexStream ./WGLBrush".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});var m={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}};
a=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._desc={path:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}};return c}e.__extends(c,a);c.prototype.dispose=function(){this._quad&&this._quad.dispose()};c.prototype.prepareState=function(c,a){c=c.context;c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(1,771,1,771);c.setColorMask(!0,!0,!0,!0);c.setStencilWriteMask(0);c.setStencilTestEnabled(!0);c.setStencilFunction(514,a.stencilRef,255)};c.prototype.draw=function(c,
a){var b=c.context,d=c.renderingOptions,e=c.painter;if(a.source){c.timeline.begin(this.name);this._quad||(this._quad=new f(b,[0,0,1,0,0,1,1,1]));if("dynamic"===d.samplingMode)var d=c.state,g=a.resolution/a.pixelRatio/d.resolution,t=Math.round(c.pixelRatio)!==c.pixelRatio,d=d.rotation||1.05<g||.95>g||t||a.isSourceScaled||a.rotation?m.bilinear:m.nearest;else d=m[d.samplingMode];e=e.materialManager.getProgram(c,this._desc,d.defines);a.setSamplingProfile(d);a.bind(h.TEXTURE_BINDING_BITMAP);b.bindProgram(e);
e.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);e.setUniform1i("u_texture",h.TEXTURE_BINDING_BITMAP);e.setUniform2fv("u_coordScale",a.coordScale);this._quad.draw();c.timeline.end(this.name)}};return c}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/programUtils".split(" "),function(a,d,e,h,f,b,m,p){Object.defineProperty(d,
"__esModule",{value:!0});a=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._color=h.vec4f32.fromValues(0,1,0,1);return a}e.__extends(a,c);a.prototype.dispose=function(){this._program&&this._program.dispose()};a.prototype.prepareState=function(c){c=c.context;c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setFaceCullingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(7680,7680,7681);c.setStencilWriteMask(255);c.setStencilFunction(519,0,255)};a.prototype.draw=function(c,
a){var b=c.context;c=c.state;this._program||(this._program=p.createProgram(b,m.background));var d=this._program,e=f.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]});a=a.getVAO(b,c,e.attributes,e.bufferLayouts);b.bindProgram(this._program);d.setUniform2fv("u_coord_range",[1,1]);d.setUniform4fv("u_color",this._color);d.setUniformMatrix3fv("u_dvsMat3",c.displayMat3);b.bindVAO(a);b.drawElements(4,a.indexBuffer.size,5125,0);b.bindVAO()};return a}(b.default);d.default=
a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../vectorTiles/shaders/Programs ../definitions ../enums ../number ./WGLBrush".split(" "),function(a,d,e,h,f,b,m,p,c,g,u){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._color=f.vec4f32.fromValues(1,0,0,1);c._patternMatrix=
h.mat3f32.create();c._programOptions={id:!1,pattern:!1};return c}e.__extends(d,a);d.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};d.prototype.drawMany=function(a,b){var d=a.context,e=a.styleLayerId;this._loadWGLResources(d);var f=a.displayLevel,k=a.styleLayer,h=a.painter.getVectorTileProgramCach(),q=k.getPaintValue("background-color",f),l=k.getPaintValue("background-opacity",f),m=k.getPaintValue("background-pattern",
f),y=void 0!==m,u=q[3]*l,E=a.spriteMosaic,v,x=(window.devicePixelRatio|1)>p.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===c.WGLDrawPhase.HITTEST;var F=this._programOptions;F.id=a;F.pattern=y;h=h.getProgram(0,(a?1:0)<<1|(y?1:0),F);d.bindVAO(this._vao);d.bindProgram(h);if(y){v=E.getMosaicItemPosition(m,!0);if(!v)return;h.setUniform1f("u_opacity",l);h.setUniform2f("u_pattern_tl",v.tl[0],v.tl[1]);h.setUniform2f("u_pattern_br",v.br[0],v.br[1]);h.setUniform1i("u_texture",p.VTL_TEXTURE_BINDING_UNIT_SPRITES);E.bind(d,
9729,v.page,p.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=u*q[0],this._color[1]=u*q[1],this._color[2]=u*q[2],this._color[3]=u,h.setUniform4fv("u_color",this._color);h.setUniform1f("u_depth",k.z||0);a&&(e=g.u32to4Xu8(e+1),h.setUniform4fv("u_id",e));for(e=0;e<b.length;e++)k=b[e],h.setUniform1f("u_coord_range",k.coordRange[0]),h.setUniformMatrix3fv("u_dvsMat3",k.transforms.dvs),y&&(q=x*k.size[0]*Math.max(Math.pow(2,Math.round(f)-k.key.level),1),l=q/v.size[1],this._patternMatrix[0]=q/v.size[0],
this._patternMatrix[4]=l,h.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),d.setStencilFunction(514,k.stencilRef,255),d.drawArrays(5,0,4)};d.prototype._loadWGLResources=function(c){if(!this._program||!this._vao){var a=b.createProgram(c,m.background);if(a){var d=new Int8Array([0,0,1,0,0,1,1,1]),d=b.BufferObject.createVertex(c,35044,d);c=new b.VertexArrayObject(c,m.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:d});
this._program=a;this._vao=c}}};return d}(u.default);d.WGLBrushVTLBackground=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../enums ../number ./WGLBrush".split(" "),function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});var c=[1,1,1,1];a=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._color=h.vec4f32.create();c._strokeColor=h.vec4f32.create();
c._programOptions={id:!1};c._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return c}e.__extends(d,a);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,d){var e=a.context,g=a.state,f=a.drawPhase,
n=a.styleLayerId,h=a.displayLevel,k=a.styleLayer;a=a.painter.getVectorTileProgramCach();var p=k.hasDataDrivenRadius?1:k.getPaintValue("circle-radius",h),q=k.hasDataDrivenColor?c:k.getPaintValue("circle-color",h),z=k.hasDataDrivenOpacity?1:k.getPaintValue("circle-opacity",h),B=k.hasDataDrivenStrokeWidth?1:k.getPaintValue("circle-stroke-width",h),A=k.hasDataDrivenStrokeColor?c:k.getPaintValue("circle-stroke-color",h),u=k.hasDataDrivenStrokeOpacity?1:k.getPaintValue("circle-stroke-opacity",h),E=k.hasDataDrivenBlur?
0:k.getPaintValue("circle-blur",h),z=z*q[3];this._color[0]=z*q[0];this._color[1]=z*q[1];this._color[2]=z*q[2];this._color[3]=z;z=u*A[3];this._strokeColor[0]=z*A[0];this._strokeColor[1]=z*A[1];this._strokeColor[2]=z*A[2];this._strokeColor[3]=z;q=k.getPaintValue("circle-translate",h);h=k.getPaintValue("circle-translate-anchor",h);A=f===b.WGLDrawPhase.HITTEST;f=this._programOptions;f.id=A;f=a.getProgram(5,A?1:0,f);e.bindProgram(f);f.setUniformMatrix3fv("u_displayMat3",1===h?g.displayMat3:g.displayViewMat3);
f.setUniform2fv("u_circleTranslation",q);f.setUniform1f("u_depth",k.z);f.setUniform1f("u_radius",p);f.setUniform4fv("u_color",this._color);f.setUniform1f("u_blur",E);f.setUniform1f("u_stroke_width",B);f.setUniform4fv("u_stroke_color",this._strokeColor);f.setUniform1f("u_antialiasingWidth",1.2);A&&(g=m.u32to4Xu8(n+1),f.setUniform4fv("u_id",g));for(g=0;g<d.length;g++)if(k=d[g],k.layerData[n]&&(p=k.layerData[n],B=this._getCircleVAO(e,k,a)))e.bindVAO(B),f.setUniformMatrix3fv("u_dvsMat3",k.transforms.dvs),
e.setStencilFunction(514,k.stencilRef,255),e.drawElements(4,p.triangleElementCount,5125,12*p.triangleElementStart),k.triangleCount+=p.triangleElementCount/3};d.prototype._getCircleVAO=function(c,a,b){if(a.circleVertexArrayObject)return a.circleVertexArrayObject;var d=a.circleVertexBuffer,e=a.circleIndexBuffer;if(!d||!e)return null;a.circleVertexArrayObject=new f.VertexArrayObject(c,b.getProgramAttributes(5),this._vertexAttributes,{geometry:d},e);return a.circleVertexArrayObject};return d}(p.default);
d.WGLBrushVTLCircle=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});var u=1/65536,v=[1,1,1,1];a=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._fillVertexAttributes={geometry:[{name:"a_pos",
count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};c._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};c._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,
divisor:0}]};c._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};c._color=f.vec4f32.create();c._outlineColor=f.vec4f32.create();c._fillProgramOptions={id:!1,dd:!1,pattern:!1};c._outlineProgramOptions=
{id:!1,dd:!1};c._patternMatrix=h.mat3f32.create();return c}e.__extends(d,a);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,b){var d=a.displayLevel,e=a.drawPhase,g=a.renderPass,f=a.styleLayerId,q=a.styleLayer,h=q.getPaintValue("fill-pattern",d),l=q.hasDataDrivenColor?v:q.getPaintValue("fill-color",d),m=q.hasDataDrivenOpacity?1:q.getPaintValue("fill-opacity",d),t=m*l[3],y=void 0!==h||1>t||q.hasDataDrivenFill;if(!y||"opaque"!==g){this._color[0]=t*l[0];this._color[1]=t*l[1];this._color[2]=
t*l[2];this._color[3]=t;var u;e===p.WGLDrawPhase.HITTEST&&(u=c.u32to4Xu8(f+1));e=q.getPaintValue("fill-translate",d);d=q.getPaintValue("fill-translate-anchor",d);this._drawFill(a,f,q,b,e,d,h,y,u);this._drawOutline(a,f,q,b,e,d,h,u,m)}};d.prototype._drawFill=function(a,c,b,d,e,g,f,h,l){var k=a.context,q=a.displayLevel,n=a.drawPhase,t=a.renderPass,r=a.spriteMosaic,w=a.state;if(h||"translucent"!==t){h=void 0!==f;var t=a.pixelRatio>m.VTL_HIGH_RES_CUTOFF?2:1,z=b.hasDataDrivenFill;a=a.painter.getVectorTileProgramCach();
var y,B=n===p.WGLDrawPhase.HITTEST,n=this._fillProgramOptions;n.id=B;n.dd=z;n.pattern=h;n=a.getProgram(1,(B?1:0)<<2|(z?1:0)<<1|(h?1:0),n);k.bindProgram(n);if(h){y=r.getMosaicItemPosition(f,!0);if(!y){k.bindProgram();return}n.setUniform2f("u_pattern_tl",y.tl[0],y.tl[1]);n.setUniform2f("u_pattern_br",y.br[0],y.br[1]);n.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES);r.bind(k,9729,y.page,m.VTL_TEXTURE_BINDING_UNIT_SPRITES)}n.setUniformMatrix3fv("u_displayMat3",1===g?w.displayMat3:w.displayViewMat3);
n.setUniform2fv("u_fillTranslation",e);n.setUniform1f("u_depth",b.z+u);n.setUniform4fv("u_color",this._color);B&&n.setUniform4fv("u_id",l);for(b=0;b<d.length;b++)if(e=d[b],e.layerData[c]&&(f=this._getFillVAO(k,e,z,a)))g=e.layerData[c],k.bindVAO(f),n.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),h&&(f=e.coordRange[0]/(t*e.size[0]*Math.max(Math.pow(2,Math.round(q)-e.key.level),1)),l=1/(y.size[1]*f),this._patternMatrix[0]=1/(y.size[0]*f),this._patternMatrix[4]=l,n.setUniformMatrix3fv("u_pattern_matrix",
this._patternMatrix)),k.setStencilFunction(514,e.stencilRef,255),k.drawElements(4,g.triangleElementCount,5125,12*g.triangleElementStart),e.triangleCount+=g.triangleElementCount/3}};d.prototype._drawOutline=function(a,c,b,d,e,g,f,h,l){var k=a.context,q=a.displayLevel,n=a.drawPhase,m=a.pixelRatio,t=a.state;if("opaque"!==a.renderPass&&(f=void 0!==f,b.getPaintValue("fill-antialias",q)&&!f||b.hasDataDrivenOutlineColor)){a=a.painter.getVectorTileProgramCach();f=b.hasDataDrivenOutline;if(b.outlineUsesFillColor){if(1!==
this._color[3])return;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else q=b.hasDataDrivenOutlineColor?v:b.getPaintValue("fill-outline-color",q),l*=q[3],this._outlineColor[0]=l*q[0],this._outlineColor[1]=l*q[1],this._outlineColor[2]=l*q[2],this._outlineColor[3]=l;m=.75/m;l=n===p.WGLDrawPhase.HITTEST;n=this._outlineProgramOptions;n.id=l;n.dd=f;n=a.getProgram(2,(l?1:0)<<1|(f?1:0),n);k.bindProgram(n);
n.setUniformMatrix3fv("u_displayMat3",1===g?t.displayMat3:t.displayViewMat3);n.setUniform2fv("u_fillTranslation",e);n.setUniform1f("u_depth",b.z+u);n.setUniform1f("u_outline_width",m);n.setUniform4fv("u_color",this._outlineColor);l&&n.setUniform4fv("u_id",h);for(b=0;b<d.length;b++)if(e=d[b],e.layerData[c]&&(g=e.layerData[c],h=this._getOutlineVAO(k,e,f,a)))k.bindVAO(h),n.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),k.setStencilFunction(514,e.stencilRef,255),k.drawElements(4,g.outlineElementCount,
5125,12*g.outlineElementStart),e.triangleCount+=g.outlineElementCount/3}};d.prototype._getFillVAO=function(a,c,d,e){if(d){if(c.fillDDVertexArrayObject)return c.fillDDVertexArrayObject;d=c.fillDDVertexBuffer;var g=c.fillIndexBuffer;if(!d||!g)return null;c.fillDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:d},g);return c.fillDDVertexArrayObject}if(c.fillVertexArrayObject)return c.fillVertexArrayObject;d=c.fillVertexBuffer;g=c.fillIndexBuffer;
if(!d||!g)return null;c.fillVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(1),this._fillVertexAttributes,{geometry:d},g);return c.fillVertexArrayObject};d.prototype._getOutlineVAO=function(a,c,d,e){if(d){if(c.outlineDDVertexArrayObject)return c.outlineDDVertexArrayObject;d=c.outlineDDVertexBuffer;var g=c.outlineIndexBuffer;if(!d||!g)return null;c.outlineDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:d},g);return c.outlineDDVertexArrayObject}if(c.outlineVertexArrayObject)return c.outlineVertexArrayObject;
d=c.outlineVertexBuffer;g=c.outlineIndexBuffer;if(!d||!g)return null;c.outlineVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:d},g);return c.outlineVertexArrayObject};return d}(g.default);d.WGLBrushVTLFill=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),
function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});d.C_DEG_TO_RAD=Math.PI/180;var u=[1,1,1,1];a=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._color=f.vec4f32.create();c._dashArray=h.vec2f32.create();c._programOptions={id:!1,dd:!1,pattern:!1};c._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",
count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};c._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};
return c}e.__extends(d,a);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,b){var d=a.context,e=a.displayLevel,g=a.state,f=a.drawPhase,h=a.styleLayerId,q=a.styleLayer,l=a.painter.getVectorTileProgramCach(),y=q.getPaintValue("line-translate",e),A=q.getPaintValue("line-translate-anchor",e),v=q.getPaintValue("line-pattern",e),E=void 0!==v,x=1/a.pixelRatio,J=q.getPaintValue("line-blur",e),F=q.hasDataDrivenColor?u:q.getPaintValue("line-color",e),C=q.hasDataDrivenOpacity?1:q.getPaintValue("line-opacity",
e),G=q.hasDataDrivenWidth?1:q.getPaintValue("line-width",e),C=C*F[3];this._color[0]=C*F[0];this._color[1]=C*F[1];this._color[2]=C*F[2];this._color[3]=C;var F=q.hasDataDrivenLine,C=f===p.WGLDrawPhase.HITTEST,I;C&&(I=c.u32to4Xu8(h+1));f=this._programOptions;f.id=C;f.dd=F;f.pattern=E;f=l.getProgram(3,(C?1:0)<<2|(F?1:0)<<1|(E?1:0),f);d.bindProgram(f);f.setUniformMatrix3fv("u_displayViewMat3",g.displayViewMat3);f.setUniformMatrix3fv("u_displayMat3",1===A?g.displayMat3:g.displayViewMat3);f.setUniform2fv("u_lineTranslation",
y);f.setUniform1f("u_depth",q.z);f.setUniform1f("u_blur",J);f.setUniform1f("u_antialiasing",x);f.setUniform4fv("u_color",this._color);f.setUniform1f("u_width",G);C&&f.setUniform4fv("u_id",I);if(E){if(a=a.spriteMosaic,v=a.getMosaicItemPosition(v,!0))a.bind(d,9729,v.page,m.VTL_TEXTURE_BINDING_UNIT_SPRITES),f.setUniform2f("u_pattern_tl",v.tl[0],v.br[1]),f.setUniform2f("u_pattern_br",v.br[0],v.tl[1]),f.setUniform2f("u_spriteSize",8*v.size[0],v.size[1]),f.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else v=
q.getPaintValue("line-dasharray",e),2>v.length&&(v=[1,-1]),this._dashArray[0]=8*v[0],this._dashArray[1]=8*v[1],f.setUniform2fv("u_dasharray",this._dashArray);for(v=0;v<b.length;v++)if(a=b[v],a.layerData[h]&&(e=a.layerData[h],g=this._getLineVAO(d,a,F,l)))d.bindVAO(g),f.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs),d.setStencilFunction(514,a.stencilRef,255),d.drawElements(4,e.triangleElementCount,5125,12*e.triangleElementStart),a.triangleCount+=e.triangleElementCount/3};d.prototype._getLineVAO=
function(a,c,d,e){if(d){if(c.lineDDVertexArrayObject)return c.lineDDVertexArrayObject;d=c.lineDDVertexBuffer;var g=c.lineIndexBuffer;if(!d||!g)return null;c.lineDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(3),this._vertexAttributesDD,{geometry:d},g);return c.lineDDVertexArrayObject}if(c.lineVertexArrayObject)return c.lineVertexArrayObject;d=c.lineVertexBuffer;g=c.lineIndexBuffer;if(!d||!g)return null;c.lineVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(3),
this._vertexAttributes,{geometry:d},g);return c.lineVertexArrayObject};return d}(g.default);d.WGLBrushVTLLine=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../GeometryUtils ../number ./WGLBrush".split(" "),function(a,d,e,h,f,b,m,p,c,g,u){Object.defineProperty(d,"__esModule",{value:!0});var v=1/65536,x=[1,1,1,1];a=
function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_visInfo",count:4,type:5121,offset:16,stride:20,normalized:!1,divisor:0}]};
c._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:28,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:28,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:28,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:28,normalized:!1,divisor:0},{name:"a_visInfo",count:4,type:5121,offset:16,stride:28,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:20,stride:28,normalized:!0,
divisor:0},{name:"a_size",count:1,type:5126,offset:24,stride:28,normalized:!1,divisor:0}]};c._iconProgramOptions={id:!1,dd:!1,sdf:!1};c._sdfProgramOptions={id:!1,dd:!1};c._spritesTextureSize=h.vec2f32.create();c._haloColor=f.vec4f32.create();c._sdfColor=f.vec4f32.create();c._color=f.vec4f32.create();return c}e.__extends(d,a);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,c){var b=a.drawPhase,d=a.styleLayerId,e=a.styleLayer,f=a.fadeRecorder.getFadeValues(),h;b===p.WGLDrawPhase.HITTEST&&
(h=g.u32to4Xu8(d+1));this._drawIcons(a,e,c,f,h);this._drawText(a,e,c,f,h)};d.prototype._drawIcons=function(a,b,d,e,g){for(var f=this,k=a.context,h=a.displayLevel,n=a.drawPhase,l=a.painter,t=a.state,r=a.styleLayerId,w,y=!1,u=0;u<d.length;u++){var v=d[u];if(v.layerData[r]&&(w=v.layerData[r],0<w.iconPerPageElementsMap.size)){y=!0;break}}if(y){var v=b.hasDataDrivenIconSize?1:b.getLayoutValue("icon-size",h),I=b.hasDataDrivenIconColor?x:b.getPaintValue("icon-color",h),K=b.hasDataDrivenIconOpacity?1:b.getPaintValue("icon-opacity",
h),y=b.getPaintValue("icon-translate",h),u=b.getPaintValue("icon-translate-anchor",h),M=l.getVectorTileProgramCach(),l=I[3]*K;this._color[0]=l*I[0];this._color[1]=l*I[1];this._color[2]=l*I[2];this._color[3]=l;l=b.getLayoutValue("icon-rotation-alignment",h);2===l&&(l=1===b.getLayoutValue("symbol-placement",h)?0:1);var I=w.isSDF,N=b.hasDataDrivenIcon,n=n===p.WGLDrawPhase.HITTEST,K=this._iconProgramOptions;K.id=n;K.dd=N;K.sdf=I;var L=M.getProgram(4,(n?1:0)<<2|(N?1:0)<<1|(I?1:0),K);k.bindProgram(L);I&&
(I=b.getPaintValue("icon-halo-color",h),K=b.getPaintValue("icon-halo-width",h),L.setUniform4f("u_outlineColor",I[0],I[1],I[2],I[3]),L.setUniform1f("u_outlineSize",K));L.setUniformMatrix3fv("u_displayViewMat3",0===l?t.displayViewMat3:t.displayMat3);L.setUniformMatrix3fv("u_displayMat3",1===u?t.displayMat3:t.displayViewMat3);L.setUniform2fv("u_iconTranslation",y);L.setUniform1f("u_depth",b.z);L.setUniform1f("u_mapRotation",c.degToByte(t.rotation));L.setUniform1f("u_keepUpright",0);L.setUniform1f("u_level",
10*h);L.setUniform1f("u_fadeSpeed",10*e.fadeSpeed);L.setUniform1f("u_minfadeLevel",10*e.minfadeLevel);L.setUniform1f("u_maxfadeLevel",10*e.maxfadeLevel);L.setUniform1f("u_fadeChange",10*(h+e.fadeChange));L.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES);L.setUniform1f("u_size",v);L.setUniform4fv("u_color",this._color);n&&L.setUniform4fv("u_id",g);b=function(c){if(!c.layerData[r])return"continue";w=c.layerData[r];if(0===w.iconPerPageElementsMap.size)return"continue";var b=P._getIconVAO(k,
c,N,M);if(!b)return"continue";k.bindVAO(b);L.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);w.iconPerPageElementsMap.forEach(function(b,d){f._renderIconRange(a,L,b,d,c)})};var P=this;for(e=0;e<d.length;e++)v=d[e],b(v)}};d.prototype._renderIconRange=function(a,c,b,d,e){var g=a.context,f=a.hasClipping,k=a.requiredLevel;a=a.spriteMosaic;this._spritesTextureSize[0]=a.getWidth(d)/4;this._spritesTextureSize[1]=a.getHeight(d)/4;c.setUniform2fv("u_mosaicSize",this._spritesTextureSize);a.bind(g,9729,d,
m.VTL_TEXTURE_BINDING_UNIT_SPRITES);c=!0;k!==e.key.level||f?g.setStencilFunction(514,e.stencilRef,255):c=!1;g.setStencilTestEnabled(c);g.drawElements(4,b[1],5125,12*b[0]);e.triangleCount+=b[1]/3};d.prototype._drawText=function(a,b,d,e,g){for(var f=this,k=a.context,n=a.displayLevel,l=a.drawPhase,r=a.glyphMosaic,t=a.hasClipping,w=a.painter,y=a.pixelRatio,u=a.requiredLevel,C=a.state,G=a.styleLayerId,I,K=!1,M=0;M<d.length;M++)if(a=d[M],a.layerData[G]&&(I=a.layerData[G],0<I.glyphPerPageElementsMap.size)){K=
!0;break}if(K){a=b.getLayoutValue("text-rotation-alignment",n);2===a&&(a=1===b.getLayoutValue("symbol-placement",n)?0:1);var K=0===a,K=b.getLayoutValue("text-keep-upright",n)&&K,l=l===p.WGLDrawPhase.HITTEST,y=.8*3/y,M=b.hasDataDrivenTextSize?1:b.getLayoutValue("text-size",n),N=b.hasDataDrivenTextColor?x:b.getPaintValue("text-color",n),L=b.hasDataDrivenTextOpacity?1:b.getPaintValue("text-opacity",n),P=b.getPaintValue("text-halo-color",n),O=b.getPaintValue("text-halo-width",n),U=3*b.getPaintValue("text-halo-blur",
n),S=3*O,T=w.getVectorTileProgramCach(),w=N[3]*L;this._sdfColor[0]=w*N[0];this._sdfColor[1]=w*N[1];this._sdfColor[2]=w*N[2];this._sdfColor[3]=w;w=P[3]*L;this._haloColor[0]=w*P[0];this._haloColor[1]=w*P[1];this._haloColor[2]=w*P[2];this._haloColor[3]=w;this._glyphTextureSize||(this._glyphTextureSize=h.vec2f32.fromValues(r.width/4,r.height/4));var w=b.getPaintValue("text-translate",n),N=b.getPaintValue("text-translate-anchor",n),R=b.hasDataDrivenText,L=this._sdfProgramOptions;L.id=l;L.dd=R;var Q=T.getProgram(6,
(l?1:0)<<1|(R?1:0),L);k.bindProgram(Q);Q.setUniformMatrix3fv("u_displayViewMat3",0===a?C.displayViewMat3:C.displayMat3);Q.setUniformMatrix3fv("u_displayMat3",1===N?C.displayMat3:C.displayViewMat3);Q.setUniform2fv("u_textTranslation",w);Q.setUniform1f("u_depth",b.z+v);Q.setUniform2fv("u_mosaicSize",this._glyphTextureSize);Q.setUniform1f("u_mapRotation",c.degToByte(C.rotation));Q.setUniform1f("u_keepUpright",K?1:0);Q.setUniform1f("u_level",10*n);Q.setUniform1f("u_fadeSpeed",10*e.fadeSpeed);Q.setUniform1f("u_minfadeLevel",
10*e.minfadeLevel);Q.setUniform1f("u_maxfadeLevel",10*e.maxfadeLevel);Q.setUniform1f("u_fadeChange",10*(n+e.fadeChange));Q.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_GLYPHS);Q.setUniform1f("u_size",M);Q.setUniform1f("u_antialiasingWidth",y);l&&Q.setUniform4fv("u_id",g);b=function(a){if(!a.layerData[G])return"continue";I=a.layerData[G];if(0===I.glyphPerPageElementsMap.size)return"continue";var c=V._getSDFVAO(k,a,R,T);if(!c)return"continue";k.bindVAO(c);Q.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);
c=!0;u!==a.key.level||t?k.setStencilFunction(514,a.stencilRef,255):c=!1;k.setStencilTestEnabled(c);I.glyphPerPageElementsMap.forEach(function(c,b){f._renderGlyphRange(k,c,b,r,Q,P[3],O,U,S,a)})};var V=this;for(e=0;e<d.length;e++)a=d[e],b(a)}};d.prototype._renderGlyphRange=function(a,c,b,d,e,g,f,h,l,p){d.bind(a,9729,b,m.VTL_TEXTURE_BINDING_UNIT_GLYPHS);0<g&&0<f&&(e.setUniform4fv("u_color",this._haloColor),e.setUniform1f("u_halo",1),e.setUniform1f("u_edgeDistance",l),e.setUniform1f("u_edgeBlur",h),a.drawElements(4,
c[1],5125,12*c[0]),p.triangleCount+=c[1]/3);0<this._sdfColor[3]&&(e.setUniform4fv("u_color",this._sdfColor),e.setUniform1f("u_halo",0),e.setUniform1f("u_edgeDistance",0),e.setUniform1f("u_edgeBlur",0),a.drawElements(4,c[1],5125,12*c[0]),p.triangleCount+=c[1]/3)};d.prototype._getIconVAO=function(a,c,d,e){if(d){if(c.iconDDVertexArrayObject)return c.iconDDVertexArrayObject;d=c.iconDDVertexBuffer;var g=c.iconIndexBuffer;if(!d||!g)return null;c.iconDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(4),
this._vertexAttributesDD,{geometry:d},g);return c.iconDDVertexArrayObject}if(c.iconVertexArrayObject)return c.iconVertexArrayObject;d=c.iconVertexBuffer;g=c.iconIndexBuffer;if(!d||!g)return null;c.iconVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(4),this._vertexAttributes,{geometry:d},g);return c.iconVertexArrayObject};d.prototype._getSDFVAO=function(a,c,d,e){if(d){if(c.textDDVertexArrayObject)return c.textDDVertexArrayObject;d=c.textDDVertexBuffer;var g=c.textIndexBuffer;if(!d||
!g)return null;c.textDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(6),this._vertexAttributesDD,{geometry:d},g);return c.textDDVertexArrayObject}if(c.textVertexArrayObject)return c.textVertexArrayObject;d=c.textVertexBuffer;g=c.textIndexBuffer;if(!d||!g)return null;c.textVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(6),this._vertexAttributes,{geometry:d},g);return c.textVertexArrayObject};return d}(u.default);d.WGLBrushVTLSymbol=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports tslib ../../../../webgl ../definitions ./WGLBrush".split(" "),
function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}e.__extends(b,a);b.prototype.prepareState=function(a,b,d){a=a.context;d=d&&-1!==d.indexOf("id");a.setBlendingEnabled(!d);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};b.prototype.draw=function(a,b,d){var c=this;if(b.isReady&&b.hasData){b.commitChanges();
var e=this.getGeometryType(),g=b.getDisplayList(),f=b.getGeometry(e);f&&g&&(a.timeline.begin(this.name),g.byType(e,function(e){c.drawGeometry(a,b,e,f,d)}),a.timeline.end(this.name))}};b.prototype._getVAO=function(a,b,d,e){e.vao||(e.vao=new h.VertexArrayObject(a,d,b,e.vertexBufferMap,e.indexBuffer));return e.vao};b.prototype._setSharedUniforms=function(a,b,d){a.setUniform1f("u_pixelRatio",b.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",d.transforms.dvs);a.setUniformMatrix3fv("u_displayViewMat3",b.state.displayViewMat3);
a.setUniformMatrix4fv("u_insideEffectMat4",b.rendererInfo.insideEffect);a.setUniformMatrix4fv("u_outsideEffectMat4",b.rendererInfo.outsideEffect);a.setUniform1fv("u_insideOpacities",b.rendererInfo.insideOpacities);a.setUniform1fv("u_outsideOpacities",b.rendererInfo.outsideOpacities);a.setUniform1i("u_attributeTextureSize",b.attributeView.size);a.setUniform1i("u_attributeData0",f.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.setUniform1i("u_attributeData1",f.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.setUniform1i("u_attributeData2",
f.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.setUniform1i("u_attributeData3",f.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};return b}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports tslib ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){var c=null!==a&&
a.apply(this,arguments)||this;c._dotTextureSize=0;c._dotTextures=null;c._dotSamplers=new Int32Array([b.TEXTURE_BINDING_RENDERER_0,b.TEXTURE_BINDING_RENDERER_1]);return c}e.__extends(c,a);c.prototype.dispose=function(){this._disposeTextures()};c.prototype.getGeometryType=function(){return m.WGLGeometryType.FILL};c.prototype.drawGeometry=function(a,c,d,f,h){var l=a.context,k=a.painter,n=a.rendererInfo,q=a.requiredLevel,m=d.indexCount,t=d.indexFrom;d=g.FillMaterialKey.load(d.materialKey);var A=p.createProgramDescriptor(d.data,
{geometry:e.__spreadArrays([{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}],d.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],d.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),y=A.bufferLayouts,A=A.attributes;h=k.materialManager.getMaterialProgram(a,
d,"materials/fill",A,h);f=this._getVAO(l,y,A,f);l.bindProgram(h);l.bindVAO(f);this._setSharedUniforms(h,a,c);d.textureBinding&&(k.textureManager.bindTextures(l,h,d),k=1/Math.pow(2,q-c.key.level)/a.pixelRatio,h.setUniform1f("u_zoomFactor",k));d.vvColor&&(h.setUniform1fv("u_vvColorValues",n.vvColorValues),h.setUniform4fv("u_vvColors",n.vvColors));d.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),h.setUniform1fv("u_vvOpacities",n.vvOpacities));d.dotDensity&&(d=b.TILE_SIZE/n.ddDotSize,
f=d*window.devicePixelRatio*d*window.devicePixelRatio,k=1/Math.pow(2,q-c.key.level),c=1/k*(1/k),a=n.ddDotScale?a.state.scale/n.ddDotScale:1,h.setUniform1f("u_tileZoomFactor",k),h.setUniform1f("u_tileDotsOverArea",f/(b.TILE_SIZE*window.devicePixelRatio*b.TILE_SIZE*window.devicePixelRatio)),h.setUniformMatrix4fv("u_dotColors",n.ddColors),h.setUniform4fv("u_isActive",n.ddActiveDots),h.setUniform4fv("u_dotBackgroundColor",n.ddBackgroundColor),h.setUniform1f("u_dotValue",Math.max(1,n.ddDotValue*a*c)),
this._bindDotDensityTextures(l,h,n,d));l.drawElements(4,m,5125,4*t);l.bindVAO(null)};c.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};c.prototype._bindDotDensityTextures=function(a,c,b,d){b=this._createDotDensityTextures(a,d,b.ddSeed);c.setUniform1iv("u_dotTextures",this._dotSamplers);for(c=0;c<b.length;c++)a.bindTexture(b[c],this._dotSamplers[c])};c.prototype._createDotDensityTextures=
function(a,c,b){if(this._dotTextureSize!==c||this._seed!==b)this._disposeTextures(),this._dotTextureSize=c,this._seed=b;null===this._dotTextures&&(b=new h(b),this._dotTextures=[this._allocDotDensityTexture(a,c,b),this._allocDotDensityTexture(a,c,b)]);return this._dotTextures};c.prototype._allocDotDensityTexture=function(a,c,b){for(var d=new Float32Array(c*c*4),e=0;e<d.length;e++)d[e]=b.getFloat();return new f.Texture(a,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:c,height:c},
d)};return c}(c.default);d.default=a})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports tslib ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(a,d,e,h,f,b,m,p,c){Object.defineProperty(d,"__esModule",{value:!0});d.createMaterialKey=function(a,c,d,e){if(b.isSome(c)){a:{if("heatmap"===c.type)throw Error("Symbol processor does not support heatmap renderer");
switch(a){case m.WGLGeometryType.FILL:a=l.from(c);break a;case m.WGLGeometryType.LINE:a=t.from(c,d);break a;case m.WGLGeometryType.MARKER:if("dot-density"===c.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=y.from(c);break a;case m.WGLGeometryType.TEXT:a=n.from(c);break a;case m.WGLGeometryType.LABEL:a=r.from(c,e);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}}return a}switch(a){case m.WGLGeometryType.FILL:return l.from(null);
case m.WGLGeometryType.LINE:return t.from(null,d);case m.WGLGeometryType.MARKER:return y.from(null);case m.WGLGeometryType.TEXT:return n.from(null);case m.WGLGeometryType.LABEL:return r.from(null,e);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};a=function(){function a(a){this._data=0;this._data=a}a.load=function(a){var c=this.shared;c.data=a;return c};Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.bits(8,11)},set:function(a){this.setBits(a,8,11)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mapAligned",{get:function(){return!!this.bit(20)},set:function(a){this.setBit(20,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sdf",{get:function(){return!!this.bit(11)},set:function(a){this.setBit(11,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"pattern",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this.bits(0,8)},set:function(a){this.setBits(a,0,8)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryTypeString",{get:function(){switch(this.geometryType){case m.WGLGeometryType.FILL:return"fill";case m.WGLGeometryType.MARKER:return"marker";case m.WGLGeometryType.LINE:return"line";case m.WGLGeometryType.TEXT:return"text";
case m.WGLGeometryType.LABEL:return"label";default:throw new f("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});a.prototype.setBit=function(a,c){a=1<<a;this._data=c?this._data|a:this._data&~a};a.prototype.bit=function(a){return(this._data&1<<a)>>a};a.prototype.setBits=function(a,c,b){for(var d=0;c<b;c++,d++)this.setBit(c,0!==(a&1<<d))};a.prototype.bits=function(a,c){for(var b=0,d=0;a<c;a++,d++)b|=this.bit(a)<<d;return b};a.prototype.hasVV=function(){return!1};
a.prototype.setVV=function(a,c){};a.prototype.getVariation=function(){var a={},c;for(c in this)"boolean"===typeof this[c]&&(a[c]=this[c]);return a};a.prototype.getVariationHash=function(){return this._data&~(7&this.textureBinding)};a.shared=new a(0);return a}();d.MaterialKeyBase=a;var g=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}e.__extends(b,a);Object.defineProperty(b.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeFieldStops",{get:function(){return 0!==this.bit(18)},set:function(a){this.setBit(18,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(19)},set:function(a){this.setBit(19,a)},enumerable:!0,configurable:!0});
b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,d){a.prototype.setVV.call(this,b,d);b&=c.getSizeFlagsMask(b,d);this.vvSizeMinMaxValue=!!(b&m.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&m.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&m.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(b&m.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)},u=function(a){return function(a){function c(){return null!==
a&&a.apply(this,arguments)||this}e.__extends(c,a);Object.defineProperty(c.prototype,"vvRotation",{get:function(){return 0!==this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvRotation};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvRotation=!b&&!!(c&m.WGLVVFlag.ROTATION)};return c}(a)},v=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||
this}e.__extends(c,a);Object.defineProperty(c.prototype,"vvColor",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvColor};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvColor=!b&&!!(c&m.WGLVVFlag.COLOR)};return c}(a)},x=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e.__extends(c,a);Object.defineProperty(c.prototype,
"vvOpacity",{get:function(){return 0!==this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvOpacity};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvOpacity=!b&&!!(c&m.WGLVVFlag.OPACITY)};return c}(a)},l=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}e.__extends(d,a);d.load=function(a){var c=this.shared;c.data=a;return c};d.from=function(a){var d=this.load(0);
d.geometryType=m.WGLGeometryType.FILL;b.isSome(a)&&(a instanceof h.DotDensityRenderer?d.dotDensity=!0:(a=c.getVVFlags(a.visualVariables),d.setVV(a,!1)));return d.data};d.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};Object.defineProperty(d.prototype,"dotDensity",{get:function(){return!!this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});d.shared=new d(0);return d}(v(x(a)));d.FillMaterialKey=l;var y=function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}e.__extends(d,a);d.load=function(a){var c=this.shared;c.data=a;return c};d.from=function(a){var d=this.load(0);d.geometryType=m.WGLGeometryType.MARKER;b.isSome(a)&&(a=c.getVVFlags(a.visualVariables),d.setVV(a,!1));return d.data};d.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};d.shared=new d(0);return d}(v(x(u(g(a)))));d.MarkerMaterialKey=y;var t=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}e.__extends(d,a);
d.load=function(a){var c=this.shared;c.data=a;return c};d.from=function(a,d){var e=this.load(0);e.geometryType=m.WGLGeometryType.LINE;b.isSome(a)&&(a=c.getVVFlags(a.visualVariables),e.setVV(a,d));return e.data};d.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};d.shared=new d(0);return d}(v(x(g(a))));d.LineMaterialKey=t;var n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}e.__extends(d,a);d.load=function(a){var c=this.shared;c.data=a;return c};
d.from=function(a){var d=this.load(0);d.geometryType=m.WGLGeometryType.TEXT;b.isSome(a)&&(a=c.getVVFlags(a.visualVariables),d.setVV(a,!1));return d.data};d.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};d.shared=new d(0);return d}(v(x(u(g(a)))));d.TextMaterialKey=n;var r=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}e.__extends(d,a);d.load=function(a){var c=this.shared;c.data=a;return c};d.from=function(a,d){var e=this.load(0);e.geometryType=
m.WGLGeometryType.LABEL;b.isSome(a)&&(a=c.getVVFlags(a.visualVariables),e.setVV(a,!1));e.mapAligned=!!p.isMapAligned(d.labelPlacement);return e.data};d.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};d.shared=new d(0);return d}(g(a));d.LabelMaterialKey=r})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../engine ../../color ../../definitions ../../enums ../../number ../../WGLDisplayRecord ../../collisions/Metric ../../materialKey/MaterialKey ./segmentUtils ./WGLTextTemplate".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r,k){function w(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}}Object.defineProperty(d,"__esModule",{value:!0});var q=f.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");d.isMapAligned=w;var z=function(a){var c=new Map;return function(b){c.has(b)||c.set(b,a(b));return c.get(b)}}(function(a){var c=0;if(0===a)return Infinity;for(;!(a%2);)c++,a/=2;return c}),B=function(a,c){return l.i1616to32(Math.round(8*
a),Math.round(8*c))};a=function(a){function d(d,e,f,k){var h=a.call(this,d,f.font.size,f.haloSize||0,f.color&&u.premultiplyAlphaRGBA(f.color)||0,f.haloColor&&u.premultiplyAlphaRGBA(f.haloColor)||0,f.horizontalAlignment,f.verticalAlignment,w(e.labelPlacement)?1:0,f.font.decoration,!1,f.angle||0,f.xoffset,f.yoffset,f.id,f.lineWidth,f.lineHeight,null,null)||this;h._outLineLabelAngle=0;h._refPlacementPadding=0;h._refPlacementDirX=0;h._refPlacementDirY=0;h._refOffsetX=0;h._refOffsetY=0;h.geometryType=
x.WGLGeometryType.LABEL;var q;q=!!e.minScale&&k.scaleToZoom(e.minScale)||0;q=b.clamp(q,0,25.5);k=!!e.maxScale&&k.scaleToZoom(e.maxScale)||255;k=b.clamp(k,0,25.5);var l=g.alignmentUtils.getAlignmentFromPlacement(e.labelPlacement),m=l[1];h._xAlignD=l[0];h._yAlignD=m;h._minZoom=q;h._maxZoom=k;h._refPlacementPadding=c.pt2px(f.haloSize)+v.TEXT_PLACEMENT_PADDING;d=n.LabelMaterialKey.load(n.createMaterialKey(h.geometryType,d,!1,e));d.sdf=!0;h._materialKey=d.data;return h}e.__extends(d,a);d.fromLabelClass=
function(a,c,b){if("center-along"===c.labelPlacement){var e=c.symbol;e.xoffset=0;e.yoffset=0;e.angle=0;e.font.decoration="none"}return new d(a,c,c.symbol,b)};Object.defineProperty(d.prototype,"_shapedBox",{get:function(){return p.unwrap(this._shapingInfo).bounds},enumerable:!0,configurable:!0});d.prototype.bindReferenceTemplate=function(a){var c=g.alignmentUtils.getXDirection(this._xAlignD),b=g.alignmentUtils.getYDirection(this._yAlignD);this._refOffsetY=this._refOffsetX=0;if(p.isNone(a))this._refSymbolAndPlacementOffset=
l.i8888to32(0,0,Math.floor(127*c+127),Math.floor(127*b+127));else{if("circle"===a.boundsType&&(c||b))var d=Math.sqrt(c*c+b*b),c=c/d,b=b/d;d=Math.max(a.height,a.width);this._refSymbolAndPlacementOffset=l.i8888to32(4*this._refPlacementPadding,d,Math.floor(127*c+127),Math.floor(127*b+127));this._referenceSize=d;this._refPlacementDirX=c;this._refPlacementDirY=b;this._refOffsetX=a.xOffset;this._refOffsetY=a.yOffset}};d.prototype.writeMesh=function(a,c,b,d,e,g,f){if(!p.isNone(this._shapingInfo))switch(this.current=
{outRecords:a,outVecs:c,outMetrics:f,inId:d,inShaping:this._shapingInfo,zoomLevel:g},b){case "esriGeometryPolyline":return this._placeLineLabels(e.geometry);case "esriGeometryPoint":return this._placePointLabels(e.geometry);case "esriGeometryPolygon":return this._placePointLabels(e.centroid);default:a="Geometry of type "+b+" is not supported",void 0===a&&(a="mapview-labeling"),q.error(new h(a,"mapview-labeling"))}};d.prototype._isVisible=function(a,c){var b=Math.floor(10*this.current.zoomLevel);return Math.floor(10*
a)<=b&&b<=Math.floor(10*c)};d.prototype._placePointLabels=function(a){var c=this.current;this._writeGlyphs(c.outRecords,c.outVecs,c.inId,a,c.outMetrics)};d.prototype._placeLineLabels=function(a){a=r.smoothPaths(a.paths,this.current.inShaping.bounds.width);for(var c=this._placeSubdivGlyphs.bind(this),b=(this._shapedBox.width+128)/4,d=0;d<a.length;d++)r.pathDivide(a[d],b,c)};d.prototype._placeSubdivGlyphs=function(a,c,b,d){var e=z(c);b=m.log2(Math.min(b,d-b)/(4+this._shapedBox.width/4/2));e=Math.max(this._minZoom,
this.current.zoomLevel+2-(0===c?b:Math.min(e,b)));b=this._shapedBox.width/2*Math.pow(2,this.current.zoomLevel-e);this.current.inShaping.isMultiline?0===c&&this._placeStraight(a,e):this._placeCurved(a,e,b)};d.prototype._placeStraight=function(a,c){var b=this.current;this._writeGlyphs(b.outRecords,b.outVecs,b.inId,a,b.outMetrics,c)};d.prototype._placeCurved=function(a,c,b){var d=new t.default(this.current.inId,{from:this.current.outRecords.length,count:-1},a.x,a.y,c),e=a.clone(),g=(180/Math.PI*a.angle+
180)%360;this._outLineLabelAngle=Math.round(180/Math.PI*a.angle%360*(254/360));this._placeFirst(e,d,c,1);this._placeBack(a,e,d,c,b,1);this._placeForward(a,e,d,c,b,1);this._outLineLabelAngle=Math.round(254/360*g);this._placeFirst(e,d,c,0);this._placeBack(a,e,d,c,b,0);this._placeForward(a,e,d,c,b,0);d.range.count=this.current.outRecords.length-d.range.from;d.bounds&&this.current.outMetrics.push(d)};d.prototype._placeBack=function(a,c,b,d,e,g){var f=a.clone();for(a=a.backwardLength+0;f.prev()&&!(a>=
e);)this._placeOnSegment(f,c,b,a,d,-1,g),a+=f.length+0};d.prototype._placeForward=function(a,c,b,d,e,g){var f=a.clone();for(a=a.remainingLength+0;f.next()&&!(a>=e);)this._placeOnSegment(f,c,b,a,d,1,g),a+=f.length+0};d.prototype._placeFirst=function(a,c,b,d){for(var e=this.current.inShaping,g=e.glyphs,f=this.current.zoomLevel,k=this.current,h=k.outRecords,q=k.outVecs,k=k.inId,n=B(a.x,a.y),l=0;l<g.length;l++){var p=g[l],r=p.x>e.bounds.x?d:1-d,r=Math.max(0,f+m.log2(Math.abs(p.x+p.width/2-e.bounds.x)/
(r*a.remainingLength+(1-r)*a.backwardLength+0))),r=Math.max(b,r);p.maxZoom=25;p.angle=a.angle+(1-d)*Math.PI;p.minZoom=r;this._writeGlyph(h,q,p,k,n);d&&this._isVisible(p.minZoom,p.maxZoom)&&c.add(p.bounds,0,0)}};d.prototype._placeOnSegment=function(a,c,b,d,e,g,f){for(var k=this.current.inShaping.glyphs,h=this.current,q=h.outRecords,n=h.outVecs,h=h.inId,l=this.current.inShaping,p=this.current.zoomLevel,r=B(a.x+a.dx/a.length*-g*d,a.y+a.dy/a.length*-g*d),t=0;t<k.length;t++){var w=k[t],A=w.x>l.bounds.x?
f:1-f;if(A&&1===g||!A&&-1===g){var y=Math.abs(w.x+w.width/2-l.bounds.x),A=Math.max(0,p+m.log2(y/d)-.1),y=Math.max(e,p+m.log2(y/(d+a.length+0)));0!==A&&(w.angle=a.angle+(1-f)*Math.PI,w.minZoom=y,w.maxZoom=A,this._writeGlyph(q,n,w,h,r),f&&this._isVisible(w.minZoom,w.maxZoom)&&b.add(w.bounds,a.x-c.x,a.y-c.y))}}};d.prototype._writeGlyphs=function(a,c,b,d,e,g){void 0===g&&(g=this._minZoom);var f=this._shapingInfo;if(!(p.isNone(f)||0>d.x||512<=d.x||0>d.y||512<=d.y)){var k=B(d.x+this._refOffsetX,d.y-this._refOffsetY);
d=new t.default(b,{from:a.length,count:-1},d.x+this._refOffsetX,d.y-this._refOffsetY,g);for(var h=0,q=f.glyphs;h<q.length;h++){var l=q[h];l.minZoom=g;l.maxZoom=this._maxZoom;this._writeGlyph(a,c,l,b,k)}d.range.count=a.length-d.range.from;d.bounds=f.boundsT;a=n.LabelMaterialKey.load(this._materialKey);d.setPlacementOffset(a.vvSizeFieldStops||a.vvSizeMinMaxValue||a.vvSizeScaleStops||a.vvSizeUnitValue,this._referenceSize,this._refPlacementPadding,this._refPlacementDirX,this._refPlacementDirY);e.push(d)}};
d.prototype._writeGlyph=function(a,c,b,d,e){var g=n.MaterialKeyBase.load(this._materialKey),f=new y(d,this.geometryType,g.data,0,0);g.textureBinding=b.textureBinding;f.materialKey=g.data;f.indexFrom=c.indexVector.length;f.indexCount=this._writeIndices(c);f.vertexFrom=c.getVector("geometry").vertexCount;f.vertexCount=this._writeVertex(c,d,e,b);a.push(f)};d.prototype._writeVertexCommon=function(a,c,b,d){var e=this._color,g=this._haloColor,f=l.i8888to32(0,0,this._size,this._haloSize);d=l.i8888to32(Math.floor(10*
Math.max(d.minZoom,this._minZoom)),Math.floor(10*Math.min(d.maxZoom,this._maxZoom)),this._outLineLabelAngle,0);a.push(b);a.push(c);a.push(e);a.push(g);a.push(f);a.push(this._refSymbolAndPlacementOffset);a.push(d)};return d}(k.default);d.default=a})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require","exports","./MeshData","./Utils"],function(a,d,e,h){return function(){function a(a,d,e,c,g){void 0===c&&(c=0);void 0===g&&(g=0);this.id=a;this.geometryType=d;this.materialKey=e;
this.minZoom=c;this.maxZoom=g;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});a.prototype.clone=function(){return this.copy()};a.prototype.copy=function(){var b=new a(this.id,this.geometryType,this.materialKey);b.vertexFrom=this.vertexFrom;b.vertexCount=this.vertexCount;b.indexFrom=
this.indexFrom;b.indexCount=this.indexCount;b.zOrder=this.zOrder;b.symbolLevel=this.symbolLevel;b.meshData=this.meshData;b.minZoom=this.minZoom;b.maxZoom=this.maxZoom;return b};a.prototype.setMeshDataFromBuffers=function(a,d,f){var c=new e,b;for(b in d){for(var m=d[b].stride,p=d[b].data,x=[],l=h.strideToPackingFactor(m),y=0;y<m*a.vertexCount/l;++y)x[y]=p[y+m*a.vertexFrom/l];c.vertexData.set(b,x)}for(y=c.indexData.length=0;y<a.indexCount;++y)c.indexData[y]=f[y+a.indexFrom]-a.vertexFrom;c.vertexCount=
a.vertexCount;this.meshData=c};a.prototype.readMeshDataFromBuffers=function(a,d){this.meshData?this.meshData.clear():this.meshData=new e;for(var b in a){for(var c=a[b].stride,g=a[b].data,f=[],m=h.strideToPackingFactor(c),x=0;x<c*this.vertexCount/m;++x)f[x]=g[x+c*this.vertexFrom/m];this.meshData.vertexData.set(b,f)}for(x=this.meshData.indexData.length=0;x<this.indexCount;++x)this.meshData.indexData[x]=d[x+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};a.prototype.writeMeshDataToBuffers=
function(a,d,e,c){for(var b in d)for(var f=d[b].stride,m=this.meshData.vertexData.get(b),p=d[b].data,l=h.strideToPackingFactor(f),y=0;y<f*this.meshData.vertexCount/l;++y)p[y+f*a/l]=m[y];for(y=0;y<this.meshData.indexData.length;++y)c[y+e]=this.meshData.indexData[y]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=e;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(a,d,e){for(var c=0,b=0,f=0;f<a.length;f++){var h=a[f];h.writeMeshDataToBuffers(c,
d,b,e);c+=h.vertexCount;b+=h.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};a.deserialize=function(b,d){var e=b.readInt32(),c=b.readInt32();
d=new a(d.id,e,c);d.symbolLevel=b.readInt32();d.zOrder=b.readInt32();d.vertexFrom=b.readInt32();d.vertexCount=b.readInt32();d.indexFrom=b.readInt32();d.indexCount=b.readInt32();d.minZoom=b.readInt32();d.maxZoom=b.readInt32();return d};return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(a,d){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=function(){this.vertexData.clear();this.vertexCount=
0;this.indexData=[]};a.prototype.update=function(a,d,b){for(var e in a)this.vertexData.set(e,a[e]);for(e in this.vertexData)null===a[e]&&this.vertexData.delete(e);this.vertexCount=d;this.indexData=b};return a}()})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});
var p=e.getLogger("esri/views/2d/engine/webgl/collisions/Metric");a=function(){function a(a,c,b,d,e){this.id=a;this.range=c;this.boxes=null;this.minZoom=-1;this.placementPadding=this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=h.vec2f32.fromValues(b,d);this.baseZoom=e}a.prototype.add=function(a,c,b){a.x+=c;a.y+=b;this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):this.bounds=a};a.prototype.computeIndex=
function(){var a=Math.floor(this.anchor[1]/f.COLLISION_BUCKET_SIZE);this.xBucket=Math.floor(this.anchor[0]/f.COLLISION_BUCKET_SIZE);this.yBucket=a;a=f.TILE_SIZE/f.COLLISION_BUCKET_SIZE;this.hasVV?this.yOverflow=this.xOverflow=a:(this.xOverflow=Math.min(a,Math.ceil(2*this.bounds.width/f.COLLISION_BUCKET_SIZE)),this.yOverflow=Math.min(a,Math.ceil(2*this.bounds.height/f.COLLISION_BUCKET_SIZE)))};a.prototype.findCollisionDelta=function(a){var c=this.bounds.findCollisionDelta(a.bounds),b=this.boxes&&this.boxes.length,
d=a.boxes&&a.boxes.length;return Math.abs(c)>f.COLLISION_MAX_ZOOM_DELTA||!b&&!d?c:b&&d?this._boxesToBoxes(a):b?this._boxesToBox(a):this._boxToBoxes(a)};a.prototype.computeVVOffset=function(a,c){c||p.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+c);var b=this.size;this.hasVV&&(a=c(a),b=isNaN(a)||null==a||Infinity===a?this.size:a);this._computeOffset(b)};a.prototype.setPlacementOffset=function(a,c,b,d,e){this.hasVV=a;this.size=c;this.placementPadding=
Math.round(b);this.directionX=d;this.directionY=e};a.prototype.clone=function(){var c=new a(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);c.minZoom=this.minZoom;this.bounds&&(c.bounds=this.bounds.clone());this.boxes&&(c.boxes=this.boxes.map(function(a){return a.clone()}));c.xBucket=this.xBucket;c.yBucket=this.yBucket;c.xOverflow=this.xOverflow;c.yOverflow=this.yOverflow;c.hasVV=this.hasVV;c.size=this.size;c.directionX=this.directionX;c.directionY=this.directionY;c.offsetX=this.offsetX;
c.offsetY=this.offsetY;return c};a.prototype._boxToBoxes=function(a){var c=-Infinity,b=0;for(a=a.boxes;b<a.length;b++)var d=this.bounds.findCollisionDelta(a[b]),c=Math.max(d,c);return c};a.prototype._boxesToBox=function(a){for(var c=this.boxes[0].findCollisionDelta(a.bounds),b=1;b<this.boxes.length;b++)var d=this.boxes[b].findCollisionDelta(a.bounds),c=Math.max(d,c);return c};a.prototype._boxesToBoxes=function(a){for(var c=-Infinity,b=0;b<this.boxes.length;b++)for(var d=this.boxes[b],e=0,g=a.boxes;e<
g.length;e++)var f=d.findCollisionDelta(g[e]),c=Math.max(f,c);return c};a.prototype._computeOffset=function(a){this.offsetX=this.directionX*(a/2+this.placementPadding);this.offsetY=this.directionY*(a/2+this.placementPadding)};a.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.push(this.hasVV?1:0);a.push(this.size);a.writeF32(this.directionX);a.writeF32(this.directionY);
a.push(this.offsetX);a.push(this.offsetY);a.push(this.placementPadding);m.serializeList(a,this.boxes);return a};a.deserialize=function(c){var d=c.readInt32(),e=b.default.deserialize(c),f=c.readInt32(),g=c.readInt32(),h={from:f,count:g},p=c.readInt32(),n=c.readInt32(),r=c.readInt32(),f=c.readInt32(),g=c.readInt32(),k=c.readF32(),w=c.readF32(),q=c.readInt32(),z=c.readInt32(),B=c.readInt32();c=m.deserializeList(c,b.default);d=new a(d,h,p,n,r);d.bounds=e;d.boxes=c;d.setPlacementOffset(!!f,g,B,k,w);d.offsetX=
q;d.offsetY=z;d.computeIndex();f||d._computeOffset(g);return d};return a}();d.default=a})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/vec2f32"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,d,e,c){this.center=h.vec2f32.fromValues(a,d);this.centerT=h.vec2f32.create();this.halfWidth=e/2;this.halfHeight=c/2;this.width=e;this.height=c}Object.defineProperty(a.prototype,
"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"trX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xmin",{get:function(){return this.x-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xmax",{get:function(){return this.x+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"ymin",{get:function(){return this.y-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ymax",{get:function(){return this.y+this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};a.prototype.findCollisionDelta=function(a,d){void 0===d&&(d=4);return e.log2(Math.min((a.halfWidth+
this.halfWidth+d)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight+d)/Math.abs(a.centerT[1]-this.centerT[1])))};a.prototype.extend=function(a){var b=Math.min(this.xmin,a.xmin),d=Math.min(this.ymin,a.ymin),c=Math.max(this.xmax,a.xmax)-b;a=Math.max(this.ymax,a.ymax)-d;this.width=c;this.height=a;this.halfWidth=c/2;this.halfHeight=a/2;this.x=b+c/2;this.y=d+a/2};a.deserialize=function(b){var d=b.readF32(),e=b.readF32(),c=b.readInt32();b=b.readInt32();return new a(d,e,c,b)};return a}();
d.default=a})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.serializeList=function(a,d){if(null===d)a.push(0);else{a.push(d.length);for(var e=0;e<d.length;e++)d[e].serialize(a);return a}};d.deserializeList=function(a,d,f){for(var b=a.readInt32(),b=Array(b),e=0;e<b.length;e++)b[e]=d.deserialize(a,f);return b}})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["require",
"exports","../../../../../../core/maybe","./util"],function(a,d,e,h){function f(a){return a.length-1}function b(a){for(var c=0,b=0;b<f(a);b++)c+=m(a,b);return c}function m(a,c,b){void 0===b&&(b=1);c=a[c+1];a=c[0];c=c[1];return Math.sqrt(a*a+c*c)*b}function p(a,c,b,d,f){if(!(b<c)){var g=d.clone().seek(b/2);e.isNone(g)||(a(g.clone(),b,f),b=(b-c)/2,g=e.unwrap(g.seek(c/2)),p(a,c,b,d,f+1),p(a,c,b,g,f+1))}}Object.defineProperty(d,"__esModule",{value:!0});d.segmentAt=function(a,c){return a[c+1]};d.segmentCount=
f;d.pathLength=b;d.segmentLength=m;var c=function(){function a(a,c,b,d,e){this._segments=a;this._index=c;this._distance=b;this._xStart=d;this._yStart=e;this._done=!1}a.create=function(c){return new a(c,0,0,c[0][0],c[0][1])};a.prototype.clone=function(){return new a(this._segments,this._index,this._distance,this.xStart,this.yStart)};a.prototype.equals=function(a){return this._index===a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+1&&(1===this._distance||
0===a._distance)};a.prototype.leq=function(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance};a.prototype.geq=function(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance};Object.defineProperty(a.prototype,"_segment",{get:function(){return this._segments[this._index+1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"angle",{get:function(){var a=this.dy,c=Math.acos((0*a+-1*-this.dx)/(1*this.length));0<a&&(c=2*Math.PI-
c);return c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xStart",{get:function(){return this._xStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yStart",{get:function(){return this._yStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this.xStart+this.distance*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.yStart+this.distance*this.dy},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"dx",{get:function(){return this._segment[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dy",{get:function(){return this._segment[1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xMidpoint",{get:function(){return this.xStart+.5*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yMidpoint",{get:function(){return this.yStart+.5*this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"xEnd",{get:function(){return this.xStart+this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yEnd",{get:function(){return this.yStart+this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"length",{get:function(){var a=this.dx,c=this.dy;return Math.sqrt(a*a+c*c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"remainingLength",{get:function(){return this.length*(1-this._distance)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"backwardLength",{get:function(){return this.length*this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"done",{get:function(){return this._done},enumerable:!0,configurable:!0});a.prototype.hasPrev=function(){return 0<=this._index-1};a.prototype.hasNext=function(){return this._index+1<f(this._segments)};a.prototype.next=function(){if(!this.hasNext())return null;
this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this};a.prototype.prev=function(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this};a.prototype._seekBackwards=function(a,c){var b=this.backwardLength;if(a<=b)return this._distance=(b-a)/this.length,this;for(b=this.backwardLength;this.prev();){if(b+this.length>a)return this._seekBackwards(a-b);b+=this.length}this._distance=0;return c?
this:null};a.prototype.seek=function(a,c){void 0===c&&(c=!1);if(0>a)return this._seekBackwards(Math.abs(a),c);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;for(var b=this.remainingLength;this.next();){if(b+this.length>a)return this.seek(a-b,c);b+=this.length}this._distance=1;return c?this:null};return a}();d.SegmentCursor=c;d.pathDivide=function(a,d,e){var f=b(a);a=c.create(a);var g=f/2,h=Math.floor((f-d)/2/d);a.seek(g-h*d);for(var m=-h;m<=h;m++)512>a.x&&
0<=a.x&&512>a.y&&0<=a.y&&e(a.clone(),m,g+m*d,f),a.seek(d)};d.pathSubdivide=function(a,d,e){p(e,d,b(a),c.create(a),0)};d.smoothPaths=function(a,c){for(var b=0;b<a.length;b++){var d=a[b],e=[];e.push(d[0]);for(var f=1;f<d.length;f++){var g=e[f-1],n=g[0],g=g[1],n=n+d[f][0],g=g+d[f][1];e.push([n,g])}n=e;g=c;if(!(0>=g||(d=n.length,3>d))){var f=[],m=0;f.push(0);for(var k=1;k<d;k++)m+=h.dist(n[k],n[k-1]),f.push(m);g=Math.min(g,.2*m);m=[];m.push(n[0][0]);m.push(n[0][1]);var p=n[d-1][0],q=n[d-1][1],k=h.sub([0,
0],n[0],n[1]);h.normalize(k);n[0][0]+=g*k[0];n[0][1]+=g*k[1];h.sub(k,n[d-1],n[d-2]);h.normalize(k);n[d-1][0]+=g*k[0];n[d-1][1]+=g*k[1];for(k=1;k<d;k++)f[k]+=g;f[d-1]+=g;for(var z=.5*g,k=1;k<d-1;k++){for(var B=0,A=0,D=0,u=k-1;0<=u&&!(f[u+1]<f[k]-z);u--){var H=z+f[u+1]-f[k],J=f[u+1]-f[u],F=f[k]-f[u]<z?1:H/J;if(1E-6>Math.abs(F))break;var C=F*F,G=F*H-.5*C*J,I=F*J/g,K=n[u+1],M=n[u][0]-K[0],N=n[u][1]-K[1],B=B+I/G*(K[0]*F*H+.5*C*(H*M-J*K[0])-C*F*J*M/3),A=A+I/G*(K[1]*F*H+.5*C*(H*N-J*K[1])-C*F*J*N/3),D=D+
I}for(u=k+1;u<d&&!(f[u-1]>f[k]+z);u++){H=z-f[u-1]+f[k];J=f[u]-f[u-1];F=f[u]-f[k]<z?1:H/J;if(1E-6>Math.abs(F))break;C=F*F;G=F*H-.5*C*J;I=F*J/g;K=n[u-1];M=n[u][0]-K[0];N=n[u][1]-K[1];B+=I/G*(K[0]*F*H+.5*C*(H*M-J*K[0])-C*F*J*M/3);A+=I/G*(K[1]*F*H+.5*C*(H*N-J*K[1])-C*F*J*N/3);D+=I}m.push(B/D);m.push(A/D)}m.push(p);m.push(q);for(u=k=0;k<d;k++)n[k][0]=m[u++],n[k][1]=m[u++]}d=[];d.push(e[0]);for(f=1;f<e.length;f++)n=e[f-1],k=n[0],m=n[1],g=e[f],n=g[0],g=g[1],d.push([Math.round(n-k),Math.round(g-m)]);a[b]=
d}return a}})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(a,d){function e(a,d){return Math.sqrt(a*a+d*d)}Object.defineProperty(d,"__esModule",{value:!0});d.sub=function(a,d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];return a};d.len=e;d.normalize=function(a){var d=e(a[0],a[1]);a[0]/=d;a[1]/=d};d.dist=function(a,d){return e(a[0]-d[0],a[1]-d[1])};d.isFunction=function(a){return"function"===typeof a};d.getLimitCosine=function(a){return 1/Math.max(a,1)};d.isExtent=
function(a){return void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax};d.isMultipoint=function(a){return void 0!==a.points};d.isPoint=function(a){return void 0!==a.x&&void 0!==a.y};d.isPolyline=function(a){return void 0!==a.paths};d.isPolygon=function(a){return void 0!==a.rings}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports tslib ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),
function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(c,b,d,e,g,p,k,w,q,z,B,A,u,v,H,J,F,C,G){void 0===G&&(G=!1);var n=a.call(this)||this;n._xOffset=h.pt2px(A);n._yOffset=h.pt2px(u);n._decoration=q||"none";n._color=e;n._haloColor=g;n._haloSize=Math.min(Math.floor(5*h.pt2px(h.toPt(d))),127);n._size=Math.min(Math.round(h.pt2px(b)),127);b=Math.min(Math.round(h.pt2px(b)),127);n._referenceSize=Math.round(Math.sqrt(256*b));n._scale=n._size/24;n._angle=B;
n._justify=f.getJustification(p||"center");n._xAlignD=f.getXAnchorDirection(p||"center");n._yAlignD=f.getYAnchorDirection(k||"baseline");n._baseline="baseline"===(k||"baseline");n._bitset=(1===w?1:0)|(z?1:0)<<1;c=m.MaterialKeyBase.load(m.createMaterialKey(n.geometryType,c,!1));c.sdf=!0;n._materialKey=c.data;n.symbolId=v;n._lineWidth=h.pt2px(H)||512;n._lineHeight=J||1;n._textPlacement=F;n.effects=C;n._isCIM=G;return n}e.__extends(c,a);c.fromText=function(a,d,e){a=new c(a,d.font.size,d.haloSize||0,
d.color&&b.premultiplyAlphaRGBA(d.color)||0,d.haloColor&&b.premultiplyAlphaRGBA(d.haloColor)||0,d.horizontalAlignment,d.verticalAlignment,0,d.font.decoration,!1,d.angle||0,d.xoffset,d.yoffset,d.id,d.lineWidth,d.lineHeight,null,null,!1);d=g.bidiText(d.text)[1];a.bindTextInfo(e,d);return a};c.fromCIMText=function(a,d,e){var f=d.scaleFactor||1;a=new c(a,d.size*d.sizeRatio*f,d.outlineSize*d.sizeRatio,b.premultiplyAlphaRGBA(d.color),b.premultiplyAlphaRGBA(d.outlineColor),d.horizontalAlignment,d.verticalAlignment,
d.alignment,d.decoration,d.colorLocked,d.angle,d.offsetX*d.sizeRatio*f,d.offsetY*d.sizeRatio*f,d.materialHash,512,1,d.markerPlacement,d.effects,!0);d=g.bidiText(d.text)[1];a.bindTextInfo(e,d);return a};return c}(p.default(c.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../../engine ../../definitions ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey ./util".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y){Object.defineProperty(d,"__esModule",{value:!0});var t=f.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),n=function(a,c){void 0===c&&(c="mapview-processing");return t.error(new h(c,a))};d.default=function(a){return function(a){function d(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];c=a.apply(this,c)||this;c._isCIM=!1;c.geometryType=u.WGLGeometryType.TEXT;c._aux=v.i8888to32(0,0,c._referenceSize,c._bitset);return c}e.__extends(d,a);d.prototype.bindTextInfo=
function(a,d){var e=this;this._shapingInfo=a&&a.length?b.andThen(a,function(a){return c.shapeGlyphs(a,d,{scale:e._scale,angle:e._angle,xOffset:e._xOffset,yOffset:e._yOffset,hAlign:e._xAlignD,vAlign:e._yAlignD,maxLineWidth:Math.max(32,Math.min(e._lineWidth,512)),lineHeight:g.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(e._lineHeight,4)),decoration:e._decoration,isCIM:e._isCIM})}):null};d.prototype.writeMeshWithGeometry=function(a,c,d,e,f,g){var k=this;if(b.isSome(this._textPlacement))this._writePlacedText(a,
c,e,f,g);else if(y.isPoint(g))this._writeGlyphs(a,c,e,g);else if(y.isPolygon(g))b.andThen(f.centroid,function(b){return k._writeGlyphs(a,c,e,b)});else if(y.isMultipoint(g)){var h=f=d=0;for(g=g.points;h<g.length;h++){var q=g[h],l=q[1];d+=q[0];f+=l;this._writeGlyphs(a,c,e,{x:d,y:f})}}else n("Unable to handle geometryType: "+d)};d.prototype._writePlacedText=function(a,c,d,e,f){e=this._shapingInfo;if(!b.isNone(e)){var g=l.MaterialKeyBase.load(this._materialKey);if(f=p.CIMMarkerPlacementHelper.getPlacement(f,
b.unwrap(this._textPlacement),m.pt2px(1))){var k,h;for(k=f.next();null!=k;){h=v.i1616to32(Math.round(8*k.tx),Math.round(8*k.ty));k=k.getAngle();e.setRotation(k);for(var q=0,n=e.glyphs;q<n.length;q++){var r=n[q],t=new x(d,this.geometryType,g.data,0,0);g.textureBinding=r.textureBinding;t.materialKey=g.data;t.indexFrom=c.indexVector.length;t.indexCount=this._writeIndices(c);t.vertexFrom=c.getVector("geometry").vertexCount;t.vertexCount=this._writeVertex(c,d,h,r);a.push(t)}e.setRotation(-k);k=f.next()}}}};
d.prototype._writeGlyphs=function(a,c,d,e){var f=this._shapingInfo;if(!b.isNone(f)){var g=l.MaterialKeyBase.load(this._materialKey);e=v.i1616to32(Math.round(8*e.x),Math.round(8*e.y));for(var k=0,f=f.glyphs;k<f.length;k++){var h=f[k],q=new x(d,this.geometryType,g.data,0,0);g.textureBinding=h.textureBinding;q.materialKey=g.data;q.indexFrom=c.indexVector.length;q.indexCount=this._writeIndices(c);q.vertexFrom=c.getVector("geometry").vertexCount;q.vertexCount=this._writeVertex(c,d,e,h);a.push(q)}}};d.prototype._writeVertexCommon=
function(a,c,b,d){d=this._color;var e=this._haloColor,f=v.i8888to32(0,0,this._referenceSize,this._bitset),g=v.i8888to32(0,0,this._size,this._haloSize);a.push(b);a.push(c);a.push(d);a.push(e);a.push(g);a.push(f)};d.prototype._writeVertex=function(a,c,b,d){a=a.get("geometry");this._writeVertexCommon(a,c,b,d);a.push(d.offsets.upperLeft);a.push(d.texcoords.upperLeft);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.upperRight);a.push(d.texcoords.upperRight);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.lowerLeft);
a.push(d.texcoords.lowerLeft);this._writeVertexCommon(a,c,b,d);a.push(d.offsets.lowerRight);a.push(d.texcoords.lowerRight);return 4};d.prototype._writeIndices=function(a){var c=a.getVector("geometry").vertexCount;a=a.indexVector;a.push(c+0);a.push(c+1);a.push(c+2);a.push(c+1);a.push(c+3);a.push(c+2);return 6};return d}(a)}})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["require","exports","../CIMCursor","../CIMOperators"],function(a,d,e,h){Object.defineProperty(d,"__esModule",
{value:!0});a=function(){function a(){}a.getPlacement=function(a,d,f){var c=h.getPlacementOperator(d);if(!c)return null;a=e.cloneAndDecodeGeometry(a);return c.execute(a,d,f)};return a}();d.CIMMarkerPlacementHelper=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/maybe","../../../../../../geometry/support/jsonUtils","../../../../../../symbols/cim/effects/CIMEffectHelper"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",
{value:!0});a=function(){function a(){}a.prototype.writeMesh=function(a,b,c,d,u){if(e.isSome(this.effects)){var g=f.CIMEffectHelper.executeEffects(this.effects,u.geometry),m=f.CIMEffectHelper.next(g);for(c=h.getJsonType(m);m;)this.writeMeshWithGeometry(a,b,c,d,u,m),m=f.CIMEffectHelper.next(g),c=h.getJsonType(m)}else this.writeMeshWithGeometry(a,b,c,d,u,u.geometry)};a.prototype.writeMeshWithGeometry=function(a,b,c,d,e,f){};a.prototype.bindFeature=function(a,b,c){};return a}();d.default=a})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define(["require",
"exports","../CIMCursor","../CIMEffects","../CIMOperators"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});var b=96/72;a=function(){function a(){}a.executeEffects=function(a,c){c=e.cloneAndDecodeGeometry(c);c=new h.SimpleGeometryCursor(c);for(var d=0;d<a.length;d++){var m=a[d],p=f.getEffectOperator(m);p&&(c=p.execute(c,m,b))}return c};a.next=function(a){a=a.next();e.deltaEncodeGeometry(a);return a};return a}();d.CIMEffectHelper=a})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require",
"exports","../enums","../visualVariablesUtils"],function(a,d,e,h){function f(a,b){void 0===b&&(b=!1);var c=e.WGLVVFlag.SIZE_FIELD_STOPS|e.WGLVVFlag.SIZE_MINMAX_VALUE|e.WGLVVFlag.SIZE_SCALE_STOPS|e.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(e.WGLVVTarget.FIELD_TARGETS_OUTLINE|e.WGLVVTarget.MINMAX_TARGETS_OUTLINE|e.WGLVVTarget.SCALE_TARGETS_OUTLINE|e.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?c&a:c&~a}function b(a){var b=f(a,!1);return a&(e.WGLVVFlag.COLOR|e.WGLVVFlag.OPACITY|e.WGLVVFlag.ROTATION|b)}Object.defineProperty(d,
"__esModule",{value:!0});d.getVVFlags=function(a){if(!a)return e.WGLVVFlag.NONE;for(var b=0,c=0;c<a.length;c++){var d=a[c];if("size"===d.type){var f=h.getTypeOfSizeVisualVariable(d),b=b|f;"outline"===d.target&&(b|=f<<4)}else"color"===d.type?b|=e.WGLVVFlag.COLOR:"opacity"===d.type?b|=e.WGLVVFlag.OPACITY:"rotation"===d.type&&(b|=e.WGLVVFlag.ROTATION)}return b};d.getSizeFlagsMask=f;d.getMarkerVVFlags=b;d.getFillVVFlags=function(a){return a&(e.WGLVVFlag.COLOR|e.WGLVVFlag.OPACITY)};d.getLineVVFlags=function(a,
b){if(b)return b=f(a,!0),a&b;b=f(a,!1);return a&(e.WGLVVFlag.COLOR|e.WGLVVFlag.OPACITY|b)};d.getTextVVFlags=function(a){return b(a)};d.getLabelVVFlags=function(a){var b=f(a,!1);return a&b}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});var m=h.getLogger("esri.views.2d.engine.webgl");d.getTypeOfSizeVisualVariable=
function(a){if(b.isNumber(a.minDataValue)&&b.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize)return f.WGLVVFlag.SIZE_MINMAX_VALUE;if((a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops))return f.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&(Array.isArray(a.stops)||"levels"in a&&a.levels))return f.WGLVVFlag.SIZE_FIELD_STOPS;
if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit)return f.WGLVVFlag.SIZE_UNIT_VALUE;m.error(new e("mapview-bad-type","Found invalid size VisualVariable",a));return f.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports tslib ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",
{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e.__extends(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.LABEL};c.prototype.drawGeometry=function(a,c,b,d,e){var g=a.context,h=a.painter,n=a.state,l=a.rendererInfo,k=b.indexCount,p=b.indexFrom;b=m.LabelMaterialKey.load(b.materialKey);var q=b.mapAligned?1:0;if(q||!(1<=Math.abs(c.key.level-Math.round(100*a.displayLevel)/100))){var z=f.createProgramDescriptor(b.data,
{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_glyphData",count:4,type:5121},{location:7,name:"a_vertexOffset",count:2,type:5122},{location:8,name:"a_texCoords",count:2,type:5123}]}),B=z.bufferLayouts,
z=z.attributes;e=h.materialManager.getMaterialProgram(a,b,"materials/label",z,e);d=this._getVAO(g,B,z,d);a.context.setStencilFunction(514,0,255);g.bindProgram(e);g.bindVAO(d);this._setSharedUniforms(e,a,c);h.textureManager.bindTextures(g,e,b);h=1===q?n.displayViewMat3:n.displayMat3;b.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);b.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(c=l.getSizeVVFieldStops(c.key.level),
e.setUniform1fv("u_vvSizeFieldStopsValues",c.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",c.sizes));b.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);e.setUniform1f("u_mapRotation",Math.floor(n.rotation/360*254));e.setUniform1f("u_mapAligned",q);e.setUniformMatrix3fv("u_displayMat3",h);e.setUniform1f("u_opacity",1);e.setUniform1f("u_zoomLevel",Math.round(10*a.displayLevel));e.setUniform2fv("u_screenSize",a.state.size);e.setUniform1f("u_isHalo",
1);g.drawElements(4,k,5125,4*p);e.setUniform1f("u_isHalo",0);g.drawElements(4,k,5125,4*p);g.bindVAO(null);g.setStencilTestEnabled(!0);g.setBlendingEnabled(!0)}};return c}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports tslib ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,
arguments)||this}e.__extends(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.LINE};c.prototype.drawGeometry=function(a,c,b,d,e){var g=a.context,h=a.painter,n=a.rendererInfo,l=a.requiredLevel,k=b.indexFrom,p=b.indexCount;b=m.LineMaterialKey.load(b.materialKey);var q=f.createProgramDescriptor(b.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},
{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),z=q.bufferLayouts,q=q.attributes;e=h.materialManager.getMaterialProgram(a,b,"materials/line",q,e);d=this._getVAO(g,z,q,d);z=1/a.pixelRatio;g.bindProgram(e);g.bindVAO(d);this._setSharedUniforms(e,a,c);b.textureBinding&&h.textureManager.bindTextures(g,
e,b);e.setUniform1f("u_zoomFactor",Math.pow(2,l-c.key.level)/a.pixelRatio);e.setUniform1f("u_blur",0+z);e.setUniform1f("u_antialiasing",z);b.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",n.vvSizeMinMaxValue);b.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",n.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(a=n.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",a.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));b.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",
n.vvSizeUnitValueToPixelsRatio);b.vvColor&&(e.setUniform1fv("u_vvColorValues",n.vvColorValues),e.setUniform4fv("u_vvColors",n.vvColors));b.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("u_vvOpacities",n.vvOpacities));g.setFaceCullingEnabled(!0);g.setFrontFace(2305);g.setCullFace(1029);g.drawElements(4,p,5125,4*k);g.setFaceCullingEnabled(!1);g.bindVAO(null)};return c}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports tslib ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e.__extends(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.MARKER};c.prototype.drawGeometry=function(a,c,b,d,e){var g=a.context,h=a.painter,n=a.rendererInfo,l=a.state,k=b.indexCount,p=b.indexFrom;b=m.MarkerMaterialKey.load(b.materialKey);var q=f.createProgramDescriptor(b.data,{geometry:[{location:0,
name:"a_pos",count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),z=q.bufferLayouts,q=q.attributes;e=h.materialManager.getMaterialProgram(a,
b,"materials/icon",q,e);d=this._getVAO(g,z,q,d);g.bindProgram(e);g.bindVAO(d);b.textureBinding&&h.textureManager.bindTextures(g,e,b);this._setSharedUniforms(e,a,c);e.setUniformMatrix3fv("u_displayMat3",b.vvRotation?l.displayViewMat3:l.displayMat3);b.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",n.vvSizeMinMaxValue);b.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",n.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(a=n.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",
a.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));b.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",n.vvSizeUnitValueToPixelsRatio);b.vvColor&&(e.setUniform1fv("u_vvColorValues",n.vvColorValues),e.setUniform4fv("u_vvColors",n.vvColors));b.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("u_vvOpacities",n.vvOpacities));b.vvRotation&&e.setUniform1f("u_vvRotationType","geographic"===n.vvMaterialParameters.vvRotationType?0:1);g.drawElements(4,
k,5125,4*p);g.bindVAO(null)};return c}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports tslib ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e.__extends(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.TEXT};
c.prototype.drawGeometry=function(a,c,b,d,e){var g=a.context,h=a.painter,n=a.rendererInfo,l=a.state,k=b.indexCount,p=b.indexFrom;b=m.TextMaterialKey.load(b.materialKey);var q=f.createProgramDescriptor(b.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:5121},{location:5,name:"a_aux",
count:4,type:5120},{location:6,name:"a_vertexOffset",count:2,type:5122},{location:7,name:"a_texCoords",count:2,type:5123}]}),z=q.bufferLayouts,q=q.attributes;e=h.materialManager.getMaterialProgram(a,b,"materials/text",q,e);d=this._getVAO(g,z,q,d);g.bindProgram(e);g.bindVAO(d);this._setSharedUniforms(e,a,c);h.textureManager.bindTextures(g,e,b);e.setUniformMatrix3fv("u_displayMat3",l.displayMat3);e.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3);b.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",
n.vvSizeMinMaxValue);b.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",n.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(a=n.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",a.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));b.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",n.vvSizeUnitValueToPixelsRatio);b.vvColor&&(e.setUniform1fv("u_vvColorValues",n.vvColorValues),e.setUniform4fv("u_vvColors",n.vvColors));b.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",
n.vvOpacityValues),e.setUniform1fv("u_vvOpacities",n.vvOpacities));b.vvRotation&&e.setUniform1f("u_vvRotationType","geographic"===n.vvMaterialParameters.vvRotationType?0:1);e.setUniform1f("u_isHalo",1);g.drawElements(4,k,5125,4*p);e.setUniform1f("u_isHalo",0);g.drawElements(4,k,5125,4*p);g.bindVAO(null)};return c}(b.default);d.default=a})},"esri/views/2d/engine/webgl/brushes/raster/BrushRasterBitmap":function(){define("require exports tslib ../../VertexStream ../WGLBrush ../../../../../webgl/rasterUtils".split(" "),
function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._desc={lut:{path:"raster/lut",attributes:{a_position:0,a_texcoord:1}},stretch:{path:"raster/stretch",attributes:{a_position:0,a_texcoord:1}},hillshade:{path:"raster/hillshade",attributes:{a_position:0,a_texcoord:1}}};c._rendererUniformInfos=new Map;return c}e.__extends(d,a);d.prototype.dispose=function(){this._quad&&this._quad.dispose()};d.prototype.prepareState=
function(a,b){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};d.prototype.draw=function(a,b){if(b.source&&!b.suspended){a.timeline.begin(this.name);var c=a.context,d=this.getShaderVariations(b),d=a.painter.materialManager.getProgram(a,this._desc[b.symbolizerParameters.type],d);this.drawWithProgram(c,d,b);a.timeline.end(this.name)}};d.prototype.drawWithProgram=
function(a,d,f,m,p,l){void 0===m&&(m=1);void 0===p&&(p=[0,0]);void 0===l&&(l=!1);this._quad||(this._quad=new h(a,[0,0,1,0,0,1,1,1]));var c=f.symbolizerParameters,g=f.transformGrid,n=f.width,r=f.height,k=f.opacity,w=c.type;a.bindProgram(d);var q=this.getShaderVariations(f),w=this.getUniformInfos(w,a,d,q),q=f.getTextures();b.setTextures(a,d,q.names,q.textures);a=b.getBasicGridUniforms(m,p);l=b.getCommonUniforms(g,[n,r],[f.source.width,f.source.height],k,l);b.setUniforms(d,w,e.__assign(e.__assign({u_coordScale:f.coordScale,
u_dvsMat3:f.transforms.dvs},a),l));c.colormap&&(f=b.getColormapUniforms(c.colormap,c.colormapOffset),b.setUniforms(d,w,f));"stretch"===c.type?(c=b.getStretchUniforms(c),b.setUniforms(d,w,c)):"hillshade"===c.type&&(c=b.getShadedReliefUniforms(c),b.setUniforms(d,w,c));this._quad.draw()};d.prototype.getUniformInfos=function(a,d,e,f){a=0<f.length?a+"-"+f.join("-"):a;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);d=b.getUniformLocationInfos(d,e);this._rendererUniformInfos.set(a,
d);return d};d.prototype.getShaderVariations=function(a){var c=[];"cubic"===a.interpolation&&c.push("bicubic");a.symbolizerParameters.colormap&&c.push("applyColormap");a.transformGrid&&c.push("applyProjection");return c};return d}(f.default);d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../.. ../../alignmentUtils ../../number ../../collisions/BoundingBox".split(" "),
function(a,d,e,h,f,b,m,p,c,g){Object.defineProperty(d,"__esModule",{value:!0});var u=Math.PI/180,v=function(){function a(a,c,b,d){this._rotationT=h.mat2df32.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;var e=b.rect,f=new Float32Array(8);a*=d;c*=d;var g=b.code?e.width*d:b.metrics.width,k=b.code?e.height*d:b.metrics.height;f[0]=a;f[1]=c;f[2]=a+g;f[3]=c;f[4]=a;f[5]=c+k;f[6]=a+g;f[7]=c+k;this._data=f;this._setTextureCoords(e);this._scale=d;this._mosaic=b;this.x=a;this.y=c}Object.defineProperty(a.prototype,
"width",{get:function(){return this._mosaic.metrics.width*this._scale},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mosaic",{get:function(){return this._mosaic},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;e.mat2d.identity(this._rotationT);e.mat2d.rotate(this._rotationT,this._rotationT,-a);this._setOffsets(this._data)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"xTopLeft",{get:function(){return this._data[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yTopLeft",{get:function(){return this._data[1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xBottomRight",{get:function(){return this._data[6]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yBottomRight",{get:function(){return this._data[7]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texcoords",{get:function(){return this._texcoords},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this._mosaic.textureBinding},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"offsets",{get:function(){this._offsets||this._setOffsets(this._data);return this._offsets},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"char",{get:function(){return String.fromCharCode(this._mosaic.code)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"code",
{get:function(){return this._mosaic.code},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bounds",{get:function(){var a=this._mosaic.metrics,c=a.width*this._scale,b=Math.abs(a.height)*this._scale,a=new Float32Array(8);a[0]=this.x;a[1]=this.y;a[2]=this.x+c;a[3]=this.y;a[4]=this.x;a[5]=this.y+b;a[6]=this.x+c;a[7]=this.y+b;c=e.mat2d.multiply(h.mat2df32.create(),this._rotationT,this._T);h.mat2df32.transformMany(a,a,c);for(var b=c=Infinity,d=0,f=0,l=0;4>l;l++)var m=a[2*l],p=a[2*l+1],
c=Math.min(c,m),b=Math.min(b,p),d=Math.max(d,m),f=Math.max(f,p);a=d-c;f-=b;return new g.default(c+a/2,b+f/2,a,f)},enumerable:!0,configurable:!0});a.prototype.setTransform=function(a){this._T=a;this._offsets=null};a.prototype._setOffsets=function(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var b=this._offsets,d=new Float32Array(8),f=e.mat2d.multiply(h.mat2df32.create(),this._rotationT,this._T);h.mat2df32.transformMany(d,a,f);b.upperLeft=c.i1616to32(8*d[0],
8*d[1]);b.upperRight=c.i1616to32(8*d[2],8*d[3]);b.lowerLeft=c.i1616to32(8*d[4],8*d[5]);b.lowerRight=c.i1616to32(8*d[6],8*d[7])};a.prototype._setTextureCoords=function(a){var b=a.x,d=a.y,e=a.width;a=a.height;this._texcoords={upperLeft:c.i1616to32(b,d),upperRight:c.i1616to32(b+e,d),lowerLeft:c.i1616to32(b,d+a),lowerRight:c.i1616to32(b+e,d+a)}};return a}();d.ShapedGlyph=v;var x=function(a,c){return{code:0,page:0,sdf:!0,rect:new m.Rect(0,0,11,8),textureBinding:c,metrics:{advance:0,height:4,width:a,left:0,
top:0}}},l=function(){function a(a,c,b){this._rotation=0;this._decorate(a,c,b);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<c.length;this._hasRotation=0!==b.angle;this._T=this._createGlyphTransform(this.bounds,b);for(c=0;c<a.length;c++)a[c].setTransform(this._T)}a.prototype.setRotation=function(a){if(0!==a||0!==this._rotation){this._rotation=a;var c=this._T;e.mat2d.rotate(c,c,a);a=0;for(c=this.glyphs;a<c.length;a++)c[a].setTransform(this._T)}};a.prototype._decorate=function(a,
c,b){if(b.decoration&&"none"!==b.decoration&&a.length){var d=b.scale;b="underline"===b.decoration?30:20;for(var e=a[0].textureBinding,f=0;f<c.length;f++){var g=c[f];a.push(new v(g.startX*d,g.startY*d+b*d,x((g.width+g.glyphWidthEnd)*d,e),1))}}};Object.defineProperty(a.prototype,"boundsT",{get:function(){var a=this.bounds,c=f.vec2.set(b.vec2f32.create(),a.x,a.y);f.vec2.transformMat2d(c,c,this._T);return this._hasRotation?(a=Math.max(a.width,a.height),new g.default(c[0],c[1],a,a)):new g.default(c[0],
c[1],a.width,a.height)},enumerable:!0,configurable:!0});a.prototype._createBounds=function(a){for(var c=Infinity,b=Infinity,d=0,e=0,f=0;f<a.length;f++)var h=a[f],c=Math.min(c,h.xTopLeft),b=Math.min(b,h.yTopLeft),d=Math.max(d,h.xTopLeft+h.width),e=Math.max(e,h.yBottomRight);a=d-c;e-=b;return new g.default(c+a/2,b+e/2,a,e)};a.prototype._createGlyphTransform=function(a,c){var d=u*c.angle,g=h.mat2df32.create(),q=b.vec2f32.create();e.mat2d.translate(g,g,f.vec2.set(q,c.xOffset,-c.yOffset));c.isCIM?e.mat2d.rotate(g,
g,d):(e.mat2d.translate(g,g,f.vec2.set(q,a.x,a.y)),e.mat2d.rotate(g,g,d),e.mat2d.translate(g,g,f.vec2.set(q,-a.x,-a.y)));return g};return a}();d.ShapingInfo=l;var y=function(){return function(a,c,b,d,e,f){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(c,b));this.end=Math.max(0,Math.max(c,b));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=e;this.yMax=f}}();d.shapeGlyphs=function(a,c,b){var d=b.scale,e=[],f=[],g=1/b.scale*b.maxLineWidth,
h=c?a.length-1:0,n=c?-1:a.length;c=c?-1:1;for(var m=h,r=0,t=0,u=m,x=u,C=0,G=Infinity,I=0;m!==n;){var K=a[m],M=K.code,K=K.metrics,N=Math.abs(K.top);10!==M&&32!==M&&(G=Math.min(G,N),I=Math.max(I,N+K.height));10===M?(m!==h&&(f.push(new y(a,u,m-c,r,G,I)),G=Infinity,I=0),r=0,u=m+c,x=m+c,t=0):32===M?(x=m+c,t=0,C=K.advance,r+=K.advance):(r>g&&(x!==u?(M=x-2*c,r-=C,f.push(new y(a,u,M,r-t,G,I)),G=Infinity,I=0,u=x,r=t):(f.push(new y(a,u,m-c,r,G,I)),G=Infinity,I=0,x=u=m,r=0)),r+=K.advance,t+=K.advance);m+=c}g=
new y(a,u,m-c,r,G,I);0<=g.start&&g.end<a.length&&f.push(g);for(g=0;g<f.length;g++);h=f[0].yMin;n=b.vAlign;g=b.hAlign;c=n===p.VAlign.Baseline?1:0;h=(1-c)*-h+(f[f.length-1].yMax+b.lineHeight*(f.length-1)+("underline"===b.decoration?4:0)-h)/2*(c?0:n-1)+-26*(c?1:0);for(n=0;n<f.length;n++)for(m=f[n],t=m.start,c=m.end,m=m.width/2*(g+1)*-1-3,r=n*b.lineHeight+h-3,f[n].startX=m,f[n].startY=r;t<=c;t++)u=a[t],10!==u.code&&(x=new v(m+u.metrics.left,r-u.metrics.top,u,d),m+=u.metrics.advance,e.push(x));return new l(e,
f,b)}})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});var b=function(){return function(a,c,b){this.ratio=a;this.x=c;this.y=b}}();a=function(){function a(a,b,d,f,h){void 0===f&&(f=8);void 0===h&&(h=8);this.lines=[];this.starts=[];this.pixelRatio=f;this.pixelMargin=h;this.tileSize=e.TILE_SIZE*f;this.dz=a;this.yPos=b;this.xPos=d}a.prototype.setExtent=
function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var c=this.pixelRatio*this.pixelMargin,c=c/this.finalRatio;a>>=this.dz;c>a&&(c=a);this.margin=c;this.xmin=a*this.xPos-c;this.ymin=a*this.yPos-c;this.xmax=this.xmin+a+2*c;this.ymax=this.ymin+a+2*c};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new h.Point(a,b);this._firstPt=
new h.Point(a,b);this._dist=0};a.prototype.lineTo=function(a,d){var c=this._isIn(a,d),e=new h.Point(a,d),f=h.Point.distance(this._prevPt,e),g,m,p;if(c)this._prevIsIn?this._lineTo(a,d,!0):(g=this._prevPt,m=e,a=this._intersect(m,g),this.start=this._dist+f*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(m.x,m.y,!0));else if(this._prevIsIn)m=this._prevPt,g=e,a=this._intersect(m,g),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!1);else{var n=this._prevPt;if(!(n.x<=this.xmin&&e.x<=this.xmin||n.x>=this.xmax&&
e.x>=this.xmax||n.y<=this.ymin&&e.y<=this.ymin||n.y>=this.ymax&&e.y>=this.ymax)){a=[];if(n.x<this.xmin&&e.x>this.xmin||n.x>this.xmin&&e.x<this.xmin)d=(this.xmin-n.x)/(e.x-n.x),p=n.y+d*(e.y-n.y),p<=this.ymin?m=!1:p>=this.ymax?m=!0:a.push(new b(d,this.xmin,p));if(n.x<this.xmax&&e.x>this.xmax||n.x>this.xmax&&e.x<this.xmax)d=(this.xmax-n.x)/(e.x-n.x),p=n.y+d*(e.y-n.y),p<=this.ymin?m=!1:p>=this.ymax?m=!0:a.push(new b(d,this.xmax,p));if(n.y<this.ymin&&e.y>this.ymin||n.y>this.ymin&&e.y<this.ymin)d=(this.ymin-
n.y)/(e.y-n.y),p=n.x+d*(e.x-n.x),p<=this.xmin?g=!1:p>=this.xmax?g=!0:a.push(new b(d,p,this.ymin));if(n.y<this.ymax&&e.y>this.ymax||n.y>this.ymax&&e.y<this.ymax)d=(this.ymax-n.y)/(e.y-n.y),p=n.x+d*(e.x-n.x),p<=this.xmin?g=!1:p>=this.xmax?g=!0:a.push(new b(d,p,this.ymax));if(0===a.length)g?m?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):m?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+
f*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+f*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(e.x,e.y,!1)}this._dist+=f;this._prevIsIn=c;this._prevPt=e};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,
a[0].y=a[b-2].y,--b;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&m.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var d=[],e=0;e<b;e++)d.push({line:a[e],start:this.starts[e]||0});return d};a.prototype._isIn=function(a,
b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};a.prototype._intersect=function(a,b){var c,d,e;if(b.x>=this.xmin&&b.x<=this.xmax)d=b.y<=this.ymin?this.ymin:this.ymax,e=(d-a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),d=a.y+e*(b.y-a.y);else{d=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?this.xmin:this.xmax;var f=(c-a.x)/(b.x-a.x),g=(d-a.y)/(b.y-a.y);f<g?(e=f,d=a.y+f*(b.y-a.y)):(e=g,c=a.x+g*(b.x-
a.x))}this._r=e;return new h.Point(c,d)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};a.prototype._moveTo=function(a,b,d){3!==this.type?d&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),
b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b))):(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b)),this._is_v=this._is_h=!1)};a.prototype._lineTo=function(a,b,d){if(3!==this.type)if(d){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=
Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(d=this.line[this.line.length-1],d.equals(a,b)))return;this.line.push(new h.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){d=this.line[this.line.length-
1];var c=d.x===a,e=d.y===b;c&&e||(this._is_h&&c?(d.x=a,d.y=b,d=this.line[this.line.length-2],d.x===a&&d.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(d=this.line[this.line.length-2],this._is_h=d.x===a,this._is_v=d.y===b)):(this._is_h=d.x===a,this._is_v=d.y===b)):this._is_v&&e?(d.x=a,d.y=b,d=this.line[this.line.length-2],d.x===a&&d.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(d=this.line[this.line.length-2],this._is_h=d.x===a,this._is_v=d.y===b)):(this._is_h=
d.x===a,this._is_v=d.y===b)):(this.line.push(new h.Point(a,b)),this._is_h=c,this._is_v=e))}else this.line.push(new h.Point(a,b))};return a}();d.TileClipper=a;a=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new h.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.lineTo=
function(a,b){var c=this._ratio;this.line.push(new h.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&m.simplify(4096,64,this.lines);return this.lines};return a}();d.SimpleBuilder=a;var m=function(){function a(){}a.simplify=function(c,b,d){if(d){var e=-b,f=c+b,g=-b,h=c+b;c=[];b=[];
for(var m=d.length,n=0;n<m;++n){var p=d[n];if(p&&!(2>p.length))for(var k=p[0],w=void 0,q=p.length,z=1;z<q;++z)w=p[z],k.x===w.x&&(k.x<=e&&(k.y>w.y?(c.push(n),c.push(z),c.push(0),c.push(-1)):(b.push(n),b.push(z),b.push(0),b.push(-1))),k.x>=f&&(k.y<w.y?(c.push(n),c.push(z),c.push(1),c.push(-1)):(b.push(n),b.push(z),b.push(1),b.push(-1)))),k.y===w.y&&(k.y<=g&&(k.x<w.x?(c.push(n),c.push(z),c.push(2),c.push(-1)):(b.push(n),b.push(z),b.push(2),b.push(-1))),k.y>=h&&(k.x>w.x?(c.push(n),c.push(z),c.push(3),
c.push(-1)):(b.push(n),b.push(z),b.push(3),b.push(-1)))),k=w}0!==c.length&&0!==b.length&&(a.fillParent(d,b,c),a.fillParent(d,c,b),e=[],a.calcDeltas(e,b,c),a.calcDeltas(e,c,b),a.addDeltas(e,d))}};a.fillParent=function(a,b,d){for(var c=d.length,e=b.length,g=0;g<e;g+=4){for(var h=b[g],m=b[g+1],n=b[g+2],p=a[h][m-1],h=a[h][m],m=8092,k=-1,w=0;w<c;w+=4)if(d[w+2]===n){var q=d[w],z=d[w+1],B=a[q][z-1],q=a[q][z];switch(n){case 0:case 1:f.between(p.y,B.y,q.y)&&f.between(h.y,B.y,q.y)&&(B=Math.abs(q.y-B.y),B<m&&
(m=B,k=w));break;case 2:case 3:f.between(p.x,B.x,q.x)&&f.between(h.x,B.x,q.x)&&(B=Math.abs(q.x-B.x),B<m&&(m=B,k=w))}}b[g+3]=k}};a.calcDeltas=function(b,d,e){for(var c=d.length,f=0;f<c;f+=4){var g=a.calcDelta(f,d,e,[]);b.push(d[f]);b.push(d[f+1]);b.push(d[f+2]);b.push(g)}};a.calcDelta=function(b,d,e,f){b=d[b+3];if(-1===b)return 0;var c=f.length;if(1<c&&f[c-2]===b)return 0;f.push(b);return a.calcDelta(b,e,d,f)+1};a.addDeltas=function(a,b){for(var c=a.length,d=0,e=0;e<c;e+=4){var f=a[e+3];f>d&&(d=f)}for(e=
0;e<c;e+=4){var g=b[a[e]],h=a[e+1],f=d-a[e+3];switch(a[e+2]){case 0:g[h-1].x-=f;g[h].x-=f;1===h&&(g[g.length-1].x-=f);h===g.length-1&&(g[0].x-=f);break;case 1:g[h-1].x+=f;g[h].x+=f;1===h&&(g[g.length-1].x+=f);h===g.length-1&&(g[0].x+=f);break;case 2:g[h-1].y-=f;g[h].y-=f;1===h&&(g[g.length-1].y-=f);h===g.length-1&&(g[0].y-=f);break;case 3:g[h-1].y+=f,g[h].y+=f,1===h&&(g[g.length-1].y+=f),h===g.length-1&&(g[0].y+=f)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require",
"exports","./mesh/templates/util"],function(a,d,e){function h(){if(k.cosine<u.innerBisectorAutoSplitThreshold){k.splitInner=!0;k.gapInner=!0;var a=Math.max(u.innerBisectorAutoSplitThreshold,k.cosine),a=Math.sqrt(1-a*a)/a;k.leftInner.x=k.nextNormal.x+k.sign*a*k.outbound.x;k.leftInner.y=k.nextNormal.y+k.sign*a*k.outbound.y;k.rightInner.x=k.prevNormal.x-k.sign*a*k.inbound.x;k.rightInner.y=k.prevNormal.y-k.sign*a*k.inbound.y}else u.enableInnerBisectorSplit&&(k.splitInner=!0,k.gapInner=!1,k.leftInner.x=
k.rightInner.x=k.bisector.x/k.cosine,k.leftInner.y=k.rightInner.y=k.bisector.y/k.cosine);k.cosine<u.outerBisectorAutoSplitThreshold?(k.splitOuter=!0,k.gapOuter=!0,a=Math.max(u.outerBisectorAutoSplitThreshold,k.cosine),a=Math.sqrt(1-a*a)/a,k.leftOuter.x=k.prevNormal.x-k.sign*a*k.inbound.x,k.leftOuter.y=k.prevNormal.y-k.sign*a*k.inbound.y,k.rightOuter.x=k.nextNormal.x+k.sign*a*k.outbound.x,k.rightOuter.y=k.nextNormal.y+k.sign*a*k.outbound.y):u.enableOuterBisectorSplit&&(k.splitOuter=!0,k.gapOuter=!1,
k.leftOuter.x=k.rightOuter.x=k.bisector.x/k.cosine,k.leftOuter.y=k.rightOuter.y=k.bisector.y/k.cosine)}function f(){if(t)k.distance=0,t=k.isCap=k.isFirstVertex=k.isLastVertex=!1;else{if(0===l)if(k.isFirstVertex=0===x,r=g[x],0===x){if(l=0,k.closed){k.inbound.x=r.x-g[g.length-2].x;k.inbound.y=r.y-g[g.length-2].y;var a=Math.sqrt(k.inbound.x*k.inbound.x+k.inbound.y*k.inbound.y);k.inbound.x/=a;k.inbound.y/=a}}else k.inbound.x=r.x-n.x,k.inbound.y=r.y-n.y,l=Math.sqrt(k.inbound.x*k.inbound.x+k.inbound.y*
k.inbound.y),k.inbound.x/=l,k.inbound.y/=l;k.distance+l-y<=u.wrapDistance?(x<g.length-1?(k.outbound.x=g[x+1].x-r.x,k.outbound.y=g[x+1].y-r.y,a=Math.sqrt(k.outbound.x*k.outbound.x+k.outbound.y*k.outbound.y),k.outbound.x/=a,k.outbound.y/=a):k.closed?(k.outbound.x=g[1].x-r.x,k.outbound.y=g[1].y-r.y,a=Math.sqrt(k.outbound.x*k.outbound.x+k.outbound.y*k.outbound.y),k.outbound.x/=a,k.outbound.y/=a):(k.outbound.x=k.inbound.x,k.outbound.y=k.inbound.y),0!==x||k.closed||(k.inbound.x=k.outbound.x,k.inbound.y=
k.outbound.y),++x,k.isLastVertex=x===g.length,k.isCap=!k.closed&&(k.isFirstVertex||k.isLastVertex),k.distance+=l-y,y=l=0,t=k.distance+l-y===u.wrapDistance,k.currentVertex.x=r.x,k.currentVertex.y=r.y,n=r,r=null):(k.outbound.x=k.inbound.x,k.outbound.y=k.inbound.y,y+=u.wrapDistance-k.distance,k.distance=u.wrapDistance,t=!0,a=y/l,k.currentVertex.x=(1-a)*n.x+a*r.x,k.currentVertex.y=(1-a)*n.y+a*r.y)}}function b(){k.prevNormal.x=-k.inbound.y;k.prevNormal.y=k.inbound.x;k.nextNormal.x=-k.outbound.y;k.nextNormal.y=
k.outbound.x}function m(){b();k.bisector.x=k.prevNormal.x+k.nextNormal.x;k.bisector.y=k.prevNormal.y+k.nextNormal.y;var a=Math.sqrt(k.bisector.x*k.bisector.x+k.bisector.y*k.bisector.y);.001>a?(k.bisector.x=void 0,k.bisector.y=void 0,k.cosine=0,k.sign=void 0):(k.bisector.x/=a,k.bisector.y/=a,k.cosine=k.bisector.x*k.nextNormal.x+k.bisector.y*k.nextNormal.y,k.sign=0<=k.prevNormal.x*k.nextNormal.y-k.prevNormal.y*k.nextNormal.x?1:-1)}function p(a){v.vertex(k);1===a?(k.leftEntry0=k.entry0,k.leftEntry1=
k.entry1,k.leftEntry2=k.entry2,k.leftExit0=k.exit0,k.leftExit1=k.exit1,k.leftExit2=k.exit2):2===a&&(k.rightEntry0=k.entry0,k.rightEntry1=k.entry1,k.rightEntry2=k.entry2,k.rightExit0=k.exit0,k.rightExit1=k.exit1,k.rightExit2=k.exit2)}function c(a){v.vertex(k);1===a?(k.leftEntry0=k.entry0,k.leftEntry2=k.entry2,k.leftExit0=k.exit0,k.leftExit2=k.exit2):2===a&&(k.rightEntry0=k.entry0,k.rightEntry2=k.entry2,k.rightExit0=k.exit0,k.rightExit2=k.exit2)}Object.defineProperty(d,"__esModule",{value:!0});a=function(){return function(){this.isCap=
this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();d.TessellationState=a;d.tessellate=function(a,d,e){u.trackDistance=null!=d.trackDistance?
d.trackDistance:!1;u.wrapDistance=null!=d.wrapDistance?d.wrapDistance:65535;u.thin=null!=d.thin?d.thin:!1;u.initialDistance=null!=d.initialDistance?d.initialDistance:0;u.enableOuterBisectorSplit=null!=d.enableOuterBisectorSplit?d.enableOuterBisectorSplit:!1;u.outerBisectorAutoSplitThreshold=null!=d.outerBisectorAutoSplitThreshold?d.outerBisectorAutoSplitThreshold:0;u.enableInnerBisectorSplit=null!=d.enableOuterBisectorSplit?d.enableOuterBisectorSplit:!1;u.innerBisectorAutoSplitThreshold=null!=d.innerBisectorAutoSplitThreshold?
d.innerBisectorAutoSplitThreshold:0;g=a;v=e;y=l=x=0;t=!1;r=n=null;k.currentVertex.x=null;k.currentVertex.y=null;k.distance=u.initialDistance;a=g[0];d=g[g.length-1];k.canSplit=!1;k.closed=a.x===d.x&&a.y===d.y;if(!(2>g.length||2===g.length&&k.closed))if(u.thin)if(u.trackDistance)for(f(),b(),c(1);l-y>u.wrapDistance||x<g.length;)f(),b(),c(2),v.bridge(k),k.leftExit0=k.rightExit0,k.leftExit2=k.rightExit2;else for(;x<g.length;)0<x&&(k.inbound.x=k.outbound.x,k.inbound.y=k.outbound.y),x<g.length-1?(k.outbound.x=
g[x+1].x-g[x].x,k.outbound.y=g[x+1].y-g[x].y,a=Math.sqrt(k.outbound.x*k.outbound.x+k.outbound.y*k.outbound.y),k.distance+=a,k.outbound.x/=a,k.outbound.y/=a):(k.outbound.x=k.inbound.x,k.outbound.y=k.inbound.y),0===x&&(k.inbound.x=k.outbound.x,k.inbound.y=k.outbound.y),k.currentVertex.x=g[x].x,k.currentVertex.y=g[x].y,k.prevNormal.x=-k.inbound.y,k.prevNormal.y=k.inbound.x,k.nextNormal.x=-k.outbound.y,k.nextNormal.y=k.outbound.x,0===x?(v.vertex(k),k.leftEntry0=k.entry0,k.leftEntry2=k.entry2,k.leftExit0=
k.exit0,k.leftExit2=k.exit2):(v.vertex(k),k.rightEntry0=k.entry0,k.rightEntry2=k.entry2,k.rightExit0=k.exit0,k.rightExit2=k.exit2,v.bridge(k),k.leftExit0=k.rightExit0,k.leftExit2=k.rightExit2),++x;else{if(u.enableOuterBisectorSplit||0<u.outerBisectorAutoSplitThreshold||u.enableInnerBisectorSplit||0<u.innerBisectorAutoSplitThreshold)for(k.canSplit=!0,f(),m(),k.splitInner=k.gapInner=k.splitOuter=k.gapOuter=!1,p(1),k.closure0=k.leftEntry0,k.closure1=k.leftEntry1,k.closure2=k.leftEntry2;l-y>u.wrapDistance||
x<g.length-1||x<g.length&&(!k.closed||u.trackDistance);)f(),m(),k.splitInner=k.gapInner=k.splitOuter=k.gapOuter=!1,p(2),v.bridge(k),k.leftExit0=k.rightExit0,k.leftExit1=k.rightExit1,k.leftExit2=k.rightExit2;else for(f(),m(),p(1),k.closure0=k.leftEntry0,k.closure1=k.leftEntry1,k.closure2=k.leftEntry2;l-y>u.wrapDistance||x<g.length-1||x<g.length&&(!k.closed||u.trackDistance);)f(),m(),p(2),v.bridge(k),k.leftExit0=k.rightExit0,k.leftExit1=k.rightExit1,k.leftExit2=k.rightExit2;k.closed&&!u.trackDistance&&
(k.rightEntry0=k.closure0,k.rightEntry1=k.closure1,k.rightEntry2=k.closure2,v.bridge(k),k.leftExit0=k.rightExit0,k.leftExit1=k.rightExit1,k.leftExit2=k.rightExit2)}};d.cleanup=function(){v=g=null};d.splitVertex=h;var g,u={},v,x=void 0,l,y,t,n,r,k=new a;a=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=0;this.joinType=2;this.miterLimitCosine=e.getLimitCosine(2);this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=
this.textured=!1}a.prototype.vertex=function(a){var b=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,c=a.isCap&&0!==this.capType,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&
this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(h(),0<a.sign?(a.splitInner?
(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),
a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,
a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&1!==this.joinType)this.writeTriangle(b,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&1===this.capType||d&&
1===this.joinType){var e=d=c=void 0,f=void 0,g=void 0,k=void 0;if(a.isCap){var n=Math.PI,g=Math.ceil(n/this.radsPerSlice),k=n/g;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,e=a.entry0,f=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,e=a.exit2,f=a.exit0)}else n=2*Math.acos(a.cosine),g=Math.ceil(n/this.radsPerSlice),k=n/g,c=0<a.sign?-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,e=0<a.sign?a.entry2:a.exit0,f=0<a.sign?a.exit2:a.entry0;for(var n=Math.cos(k),
k=Math.sin(k),l=k*c+n*d,c=n*c-k*d,d=l,m,l=void 0,p=0;p<g;++p)m=l,p<g-1&&(l=a.isCap?this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===p?e:m,b,p===g-1?f:l),m=k*c+n*d,c=n*c-k*d,d=m}else c&&2===this.capType&&(c=a.isFirstVertex?1:-1,e=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-
c*a.inbound.y,-c,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),0<c?(this.writeTriangle(b,a.entry2,e),this.writeTriangle(b,e,
d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,e,a.exit2),this.writeTriangle(b,d,e),this.writeTriangle(b,a.exit0,d)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,
a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();d.StandardTessellationCallbacks=a;a=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,a.rightEntry2,a.leftExit2)};return a}();d.ThinTessellationCallbacks=a})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),
function(a,d,e,h,f,b){Object.defineProperty(d,"__esModule",{value:!0});var m=f.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");d.createMatcher=function(a,c,d){return e.__awaiter(this,void 0,void 0,function(){return e.__generator(this,function(e){if(!d)return[2,new b.GraphicMatcher(a)];switch(d.type){case "simple":case "dot-density":return[2,b.FeatureMatcher.fromBasicRenderer(d,a,c)];case "unique-value":return[2,b.MapMatcher.fromUVRenderer(d,a,c)];case "class-breaks":return[2,b.IntervalMatcher.fromCBRenderer(d,
a,c)];case "dictionary":return[2,b.DictionaryMatcher.fromDictionaryRenderer(d,a,c)];default:return m.error(new h("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),[2,null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports tslib ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/cim/cimSymbolUtils ../../../../../symbols/cim/utils ../../../arcade/utils".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u){function v(a,b){return e.__awaiter(this,void 0,void 0,function(){var c,d;return e.__generator(this,function(e){switch(e.label){case 0:return c=a||1,"number"===typeof c?[2,function(a,b,d){return c}]:[4,p.createRendererExpression(c,b.spatialReference,b.fields)];case 1:return d=e.sent(),[2,function(a,c,e){return u.callWithFeature(d,a,{$view:e},b.geometryType,c)||1}]}})})}Object.defineProperty(d,"__esModule",{value:!0});var x=f.getLogger("esri/views/2d/engine/webgl/util/Matcher");
a=function(){function a(){this._defaultResult=null}a.fromBasicRenderer=function(b,d,f){return e.__awaiter(this,void 0,void 0,function(){var g,h,n;return e.__generator(this,function(e){switch(e.label){case 0:return[4,c.expandSymbols(b.getSymbols(),f)];case 1:return g=e.sent(),h=new a,g.length?[4,d.createTemplateGroup(g[0],null,b)]:[3,3];case 2:n=e.sent(),h.setDefault(n),e.label=3;case 3:return[2,h]}})})};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};
a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=function(a,b,c,d,e){return this.getDefault()};a.prototype.analyze=function(a,b,c,d,f){return e.__awaiter(this,void 0,void 0,function(){return e.__generator(this,function(a){return[2]})})};return a}();d.FeatureMatcher=a;f=function(a){function b(b,c,d,e){var f=a.call(this)||this;f._intervals=[];f._isMaxInclusive=c;e?f._getValue=u.callWithFeature.bind(null,e):b&&b.length?"function"===typeof b?(f._field=null,f._getValue=b):(f._field=
b,f._normalizationInfo=d,f._getValue=f._getValueFromField.bind(f)):f._field=null;return f}e.__extends(b,a);b.fromCBRenderer=function(a,d,f){return e.__awaiter(this,void 0,void 0,function(){var g,h,n,l,r,t,y,E,u,x,v,C,G,I=this;return e.__generator(this,function(k){switch(k.label){case 0:return g=a.isMaxInclusive,h=a.normalizationField,n=a.normalizationTotal,l=a.normalizationType,r=a.field,t={normalizationField:h,normalizationTotal:n,normalizationType:l},(u=y=a.valueExpression)?[4,p.createRendererExpression(y,
f.spatialReference,f.fields)]:[3,2];case 1:u=k.sent(),k.label=2;case 2:return E=u,x=new b(r,g,t,E),[4,c.expandSymbol(a.backgroundFillSymbol,f)];case 3:return v=k.sent(),[4,m.all(a.classBreakInfos.map(function(b){return e.__awaiter(I,void 0,void 0,function(){var g,h,k;return e.__generator(this,function(e){switch(e.label){case 0:return[4,c.expandSymbol(b.symbol,f)];case 1:return g=e.sent(),[4,d.createTemplateGroup(g,v,a)];case 2:return h=e.sent(),k={min:b.minValue,max:b.maxValue},x.add(k,h),[2]}})})}))];
case 4:return k.sent(),[4,c.expandSymbol(a.defaultSymbol,f)];case 5:return(C=k.sent())?[4,d.createTemplateGroup(C,v,a)]:[3,7];case 6:G=k.sent(),x.setDefault(G),k.label=7;case 7:return[2,x]}})})};b.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};b.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();
a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++)if(d=this._intervals[b],c=d.interval,d=d.result,e=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&e)return d;return this.getDefault()};b.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};b.prototype._getValueFromField=function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;
var c=this._normalizationInfo,d=c.normalizationField,e=c.normalizationTotal,c=c.normalizationType;a=!!d&&a.attributes[d];if(c)switch(c){case "field":return(a||void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/e*100;default:x.error("Found unknown normalization type: "+c)}else x.error("Normalization is required, but no type was set!")};return b}(a);d.IntervalMatcher=f;f=function(a){function b(b,c,d){var e=a.call(this)||this;e._nullResult=null;e._resultsMap=new Map;
d?e._getValue=u.callWithFeature.bind(null,d):b&&b.length?"function"===typeof b[0]?(e._fields=null,e._getValue=b[0]):(e._fields=b,e._seperator=c||"",e._getValue=e._getValueFromFields.bind(e)):e._fields=null;return e}e.__extends(b,a);b.fromUVRenderer=function(a,d,f){return e.__awaiter(this,void 0,void 0,function(){var g,h,n,l,r,t,y,u,x,v,F=this;return e.__generator(this,function(k){switch(k.label){case 0:return g=a.uniqueValueInfos,h=a.fieldDelimiter,n=[a.field],l=a.valueExpression,a.field2&&n.push(a.field2),
a.field3&&n.push(a.field3),[4,c.expandSymbol(a.backgroundFillSymbol,f)];case 1:return r=k.sent(),(y=l)?[4,p.createRendererExpression(l,f.spatialReference,f.fields)]:[3,3];case 2:y=k.sent(),k.label=3;case 3:return t=y,u=new b(n,h,t),[4,m.all(g.map(function(b){return e.__awaiter(F,void 0,void 0,function(){var g,h;return e.__generator(this,function(e){switch(e.label){case 0:return[4,c.expandSymbol(b.symbol,f)];case 1:return g=e.sent(),[4,d.createTemplateGroup(g,r,a)];case 2:return h=e.sent(),"\x3cNull\x3e"===
b.value?u.setNullResult(h):u.add(b.value,h),[2]}})})}))];case 4:return k.sent(),[4,c.expandSymbol(a.defaultSymbol,f)];case 5:return(x=k.sent())?[4,d.createTemplateGroup(x,r,a)]:[3,7];case 6:v=k.sent(),u.setDefault(v),k.label=7;case 7:return[2,u]}})})};b.prototype.setNullResult=function(a){this._nullResult=a};b.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();
a=this._getValue(b,{$view:e},c,d);if(null!==this._nullResult&&(null==a||""===a||"\x3cNull\x3e"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=function(a){for(var b=[],c=0,d=this._fields;c<d.length;c++)b.push(a.attributes[d[c]]);return b.join(this._seperator)};return b}(a);d.MapMatcher=f;f=function(a){function b(b,c,d,e){var f=a.call(this)||this;f._fidToAttributeHash=
new Map;f._attributeHashToGroup=new Map;f._renderer=b;f._fieldMap=b.fieldMap;f._templates=c;f._info=d;f._scaleFn=e;return f}e.__extends(b,a);b.fromDictionaryRenderer=function(a,c,d){return e.__awaiter(this,void 0,void 0,function(){var f;return e.__generator(this,function(e){switch(e.label){case 0:return a.fetchResources({spatialReference:d.spatialReference,fields:d.fields}),[4,v(a.scaleExpression,d)];case 1:return f=e.sent(),[2,new b(a,c,d,f)]}})})};b.prototype._analyzeFeature=function(a,b,d,f,m){return e.__awaiter(this,
void 0,void 0,function(){var k,n,l,p,r,t,w,y,u,v,G,I;return e.__generator(this,function(q){switch(q.label){case 0:k=a.attributes[b];n=this._fidToAttributeHash.get(k);l=this._hashAttributes(a);if(n===l)return[2];if(p=this._attributeHashToGroup.has(l))return[3,4];r=e.__assign(e.__assign({},f),{spatialReference:this._info.spatialReference,abortOptions:m,fields:this._info.fields});t=this._scaleFn(a,d,f);return[4,this._renderer.getSymbolAsync(a,r)];case 1:return w=q.sent(),[4,c.expandSymbol(w,this._info,
m)];case 2:y=q.sent();if("expanded-cim"!==y.type)return x.error(new h("mapview-bad-type","Found unexpected type "+y.type+" in dictionary response")),[2];u=0;for(v=y.layers;u<v.length;u++)G=v[u],G.scaleFactor=t,G.templateHash+="-"+t,"text"===G.type&&"string"===typeof G.text&&-1<G.text.indexOf("[")&&(G.text=g.createLabelOverrideFunction(this._fieldMap,G.text,G.cim.textCase));return[4,this._templates.createTemplateGroup(y,null,this._renderer)];case 3:I=q.sent(),this._attributeHashToGroup.set(l,I),q.label=
4;case 4:return this._fidToAttributeHash.set(k,l),[2]}})})};b.prototype.analyze=function(a,b,c,d,f){return e.__awaiter(this,void 0,void 0,function(){var g,h=this;return e.__generator(this,function(e){switch(e.label){case 0:return g=b.map(function(b){return h._analyzeFeature(b,a,c,d,f)}),[4,m.all(g)];case 1:return e.sent(),[2]}})})};b.prototype.match=function(a,b){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};b.prototype._hashAttributes=function(a){var b=
"",c;for(c in this._fieldMap)b+=". "+a.attributes[this._fieldMap[c]];return b};return b}(a);d.DictionaryMatcher=f;a=function(a){function c(b){var c=a.call(this)||this;c._templates=b;return c}e.__extends(c,a);c.prototype.match=function(a,c){return b.isNone(c.symbol)?0:c.groupId?c.groupId:this._templates.createTemplateGroup(c.symbol,null,null)};return c}(a);d.GraphicMatcher=a})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r,k){Object.defineProperty(d,"__esModule",{value:!0});var w=b.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),q={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};a=function(){function a(a,b,c,d){this._isDD=!1;this._labelsDebugTemplate=
null;this._isDD=m.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._templateStore=d}a.prototype.update=function(a,b,c){this._isDD=m.isSome(b)&&"dot-density"===b.type;this._setLabelTemplates(a,b,c)};a.prototype._setLabelTemplates=function(a,b,c){a&&this._validateLabelingInfo(a)&&(this._labelTemplates=a.map(function(a){return t.default.fromLabelClass(b,a.labelClass,c)}))};Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,
configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?u.HEURISTIC_GLYPHS_PER_LINE:u.HEURISTIC_GLYPHS_PER_FEATURE;b[v.WGLGeometryType.MARKER]=new y.VertexVectors(v.WGLGeometryType.MARKER,a);b[v.WGLGeometryType.FILL]=new y.VertexVectors(v.WGLGeometryType.FILL,a,this._isDD);b[v.WGLGeometryType.LINE]=new y.VertexVectors(v.WGLGeometryType.LINE,a);b[v.WGLGeometryType.TEXT]=new y.VertexVectors(v.WGLGeometryType.TEXT,
a);b[v.WGLGeometryType.LABEL]=new y.VertexVectors(v.WGLGeometryType.LABEL,c?d:0);return new l.MeshData([],b)};a.prototype.analyze=function(a,b,c,d,f){return e.__awaiter(this,void 0,void 0,function(){var g,h,n,l,q,r,t,w,A;return e.__generator(this,function(e){switch(e.label){case 0:return g=a,p.isAborted(f)?[2,[]]:m.isSome(b)?[4,b.analyze(this._idField,a,c,d,f)]:[3,2];case 1:e.sent(),e.label=2;case 2:h=0;for(n=g;h<n.length;h++){l=n[h];q=l.groupId;if(null==q||-1===q)q=b.match(this._idField,l,this._geometryType,
c,d);if(k.isDynamicId(q))for(r=this._templateStore.getDynamicTemplateGroup(q),t=0,w=r;t<w.length;t++)(A=w[t])&&A.analyze&&A.analyze(this._templateStore,l,c,d);l.groupId=q}return[2,this._templateStore.finalize(f).then(function(){return g})]}})})};a.prototype.write=function(a,b,d,e,f,g){var h=this._templateStore.getTemplateGroup(b.groupId),n=b.localId;if(null!=n){var l=new x(n);if(k.isDynamicId(b.groupId))for(var p=0;p<h.length;p++){var q=h[p];q&&q.bindFeature(b,d,e)}if(h&&(b.geometry||b.centroid)){d=
l.displayRecords;q=b.insertAfter;void 0!==q&&(l.insertAfter=q);(e=this._geometryType)||(e=null!=b.centroid?"esriGeometryPolygon":c.getJsonType(b.geometry));for(p=0;p<h.length;p++)if(q=h[p]){var r=a.get(q.geometryType);q.writeMesh(d,r,e,n,b)}q=l.displayRecords.length;m.isSome(g)&&q&&(h=g&&this._findLabelRef(h),this._writeLabels(l,a,n,b,g,h,f));a.pushDisplayObject(l)}}};a.prototype._hasBadLabelClass=function(a,b){var c=a.labelPlacement,d=q[b];if(!a.symbol)return w.warn("No LabelClass symbol specified."),
!0;if(!d)return w.error(new h("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+b+" is not supported")),!0;d.some(function(a){return a===c})||(d=d[0],c&&w.warn("Found invalid label placement type "+c+" for "+b+". Defaulting to "+d),a.labelPlacement=d);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a.labelClass,b._geometryType)})};a.prototype._findLabelRef=function(a){for(var b=0;b<a.length;b++){var c=
a[b];if(c instanceof r.default)return c}return null};a.prototype._writeLabels=function(a,b,c,d,e,f,g){for(var h=a.displayRecords,k=[],n=0;n<e.length;n++){var l=e[n];if(m.isSome(l)){var p=l.glyphs,q=l.rtl,l=this._labelTemplates[l.classIndex],r=b.get(l.geometryType);l.bindReferenceTemplate(f);l.bindTextInfo(p,q);l.writeMesh(h,r,this._geometryType,c,d,g,k)}}a.metrics=k;u.DEBUG_LABELS&&this._debugLabels(a,b)};a.prototype._debugLabels=function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var f=
a[e],g=0,h=f.boxes?f.boxes.concat([f.bounds]):[f.bounds];g<h.length;g++){var k=h[g],k={geometry:{paths:[[[f.anchor[0]+f.offsetX+k.center[0]-k.width/2,f.anchor[1]+f.offsetY+k.center[1]+k.height/2],[0,-k.height],[k.width,0],[0,k.height],[-k.width,0]]]},attributes:{}},n=this._getLabelDebugTemplate(),l=b.get(n.geometryType);n.writeMesh(c,l,"esriGeometryPolyline",d,k)}};a.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());
return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new g({style:"solid",width:1,color:[255,0,0,1]});return n.default.fromSimpleLine(null,!1,a,null,!1)};return a}();d.WGLMeshFactory=a})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(a,d,e,h,f){return function(){function a(a){this.insertAfter=null;this.id=a;this.displayRecords=[];this.metrics=
[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.clone=function(){var b=new a(this.id);b.displayRecords=this.displayRecords.map(function(a){return a.clone()});b.metrics=this.metrics.map(function(a){return a.clone()});b.insertAfter=this.insertAfter;return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=function(a){a.push(this.id);f.serializeList(a,this.metrics);
f.serializeList(a,this.displayRecords);return a};a.deserialize=function(b){var d=b.readInt32(),c=new a(d),d={id:d},g=f.deserializeList(b,h.default);g.length&&(c.metrics=g);c.displayRecords=f.deserializeList(b,e,d);return c};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,d){this.displayObjects=a;this.vertexVectorsMap=
d}Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};a.prototype.encode=function(a,d){var b=e.serializeList(new h.default(Uint32Array,
this._guessSize()),this.displayObjects).buffer(),c={};d.push(b);for(var f=0;f<this.vertexVectorsMap.length;f++){var m=this.vertexVectorsMap[f];c[f]={};m.transfer(c[f],d)}a.displayObjects=b;a.vertexBuffersMap=c;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,d=Math.min(a.length,4),e=0,c=0;c<d;c++)e=Math.max(e,a[c].displayRecords.length);return 2*(12*a.length+a.length*e*40)};return a}();d.MeshData=
a})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a,d){this._pos=0;d=d?this._roundToNearest(d,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(d);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});a.prototype._roundToNearest=function(a,d){a=Math.round(a);return a+(d-a%d)};
a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=this._roundToNearest(1.5*(this._array.byteLength+a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var d=new this._ctor(a);d.set(this._buffer,0);this._array=a;this._buffer=d}};a.prototype.writeF32=function(a){this._ensureSize(1);var d=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return d};a.prototype.push=function(a){this._ensureSize(1);var d=this._pos;this._buffer[this._pos++]=
a;return d};a.prototype.writeRegion=function(a){this._ensureSize(a.length);var d=this._pos;this._buffer.set(a,this._pos);this._pos+=a.length;return d};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.seek=function(a){this._pos=a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();d.default=a})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils","./VertexBuffer","../util/Writer"],
function(a,d,e,h,f){Object.defineProperty(d,"__esModule",{value:!0});var b=function(){function a(a,b){this.data=a;this.stride=b}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,b){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;b.push(c)};return a}();d.default=b;a=function(){function a(a,c,d){void 0===d&&(d=!1);this.geometryType=a;this.indexVector=
new f.default(Uint32Array,c);this.namedVectors={};a=e.getStrides(a,d);for(var g in a){d=a[g];var h=void 0;switch(d%4){case 0:case 2:h=new f.default(Uint32Array,d/4*c);break;case 1:case 3:h=new f.default(Uint8Array,d*c)}this.namedVectors[g]=new b(h,d)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.getVector=function(a){return this.namedVectors[a]};a.prototype.transfer=function(a,b){var c=this.indexVector.buffer(),d={};b.push(c);for(var e in this.namedVectors){var f=this.namedVectors[e];
d[e]={};f.transfer(d[e],b)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=d;this.destroy()};a.prototype.intoBuffers=function(){var a=h.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();d.VertexVectors=a})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});var h=function(){function a(a,
d,e){this.data=a;this.stride=d;this.vertexCount=e}a.decode=function(b){var d=e.allocateTypedArrayBufferwithData(b.data,b.stride);return new a(d,b.stride,b.vertexCount)};a.fromVertexVector=function(b){var d=e.allocateTypedArrayBufferwithData(b.data.buffer(),b.stride);return new a(d,b.stride,b.vertexCount)};return a}();d.default=h;a=function(){function a(a,d,e){this.geometryType=a;this.indexBuffer=new Uint32Array(d);this.namedBuffers=e}a.decode=function(b){var d=b.geometryType,e=b.indexBuffer,c={},
f;for(f in b.namedBuffers)c[f]=h.decode(b.namedBuffers[f]);return new a(d,e,c)};a.fromVertexVectors=function(b){var d=b.geometryType,e=b.indexVector.buffer(),c={},f;for(f in b.namedVectors)c[f]=h.fromVertexVector(b.namedVectors[f]);return new a(d,e,c)};return a}();d.VertexBuffers=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports tslib ../../../../../../core/Logger ../../../../../../core/screenUtils ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v){Object.defineProperty(d,"__esModule",{value:!0});var x=h.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");a=function(a){function d(b,d,e,f,h,l,m,p,A,y,u,x,v,F,C,G,I){var k=a.call(this)||this;b=c.LineMaterialKey.load(c.createMaterialKey(k.geometryType,b,v));d&&(b.sdf=d.sdf,b.pattern=!0,b.textureBinding=d.textureBinding);k._capType=f;k._joinType=h;k._miterLimitCosine=g.getLimitCosine(l);k.tessellationProperties._fillColor=m;k.tessellationProperties._tl=p;k.tessellationProperties._br=
A;k._hasPattern=y;k._isDashed=u;k._joinOnUTurn=G;k._isColorLocked=x;k._isOutline=v;k._zOrder=C;k.effects=I;k._materialKey=b.data;k.tessellationProperties._bitset=x?1:0;k.tessellationProperties._halfWidth=.5*e;k.tessellationProperties._halfReferenceWidth=.5*F;k._initializeTessellator(!1);return k}e.__extends(d,a);d.fromCIMLine=function(a,c,e,g,h){var k=c.color,n=c.scaleFactor||1,l=c.isDashed,p=c.cap;l&&1===p&&(p=2);var r=c.join,n=f.pt2px(c.width)*n,t=f.pt2px(c.referenceWidth),w=f.pt2px(c.miterLimit),
k=k&&b.premultiplyAlphaRGBA(k)||0;if(!e)return new d(a,e,n,p,r,w,k,0,0,!1,l,c.colorLocked,g,t,c.zOrder,h,c.effects);var y=e.rect,u=y.x+1+e.width,x=y.y+1+e.height,y=m.i1616to32(y.x+1,y.y+1),u=m.i1616to32(u,x);return new d(a,e,n,p,r,w,k,y,u,!0,l,c.colorLocked,g,t,c.zOrder,h,c.effects)};d.fromSimpleLine=function(a,c,e,g,h){var k=e.color,n="solid"!==e.style&&"none"!==e.style,l=p.getCapType(e.cap||"round",n),r=p.getJoinType(e.join||"round"),k=k&&"none"!==e.style&&b.premultiplyAlphaRGBA(k)||0;"none"===
e.style&&(k=0);var t=f.pt2px(e.width);e=e.miterLimit;if(!g)return new d(a,g,t,l,r,e,k,0,0,!1,n,!1,c,t,0,h,null);var w=g.rect,y=w.x+1+g.width,u=w.y+1+g.height,w=m.i1616to32(w.x+1,w.y+1),y=m.i1616to32(y,u);return new d(a,g,t,l,r,e,k,w,y,!0,n,!1,c,t,0,h,null)};d.fromPictureLineSymbol=function(a,b,c,d){x.error("PictureLineSymbol support does not exist!");return null};return d}(u.default(v.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports tslib ../../../../../../core/has ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey ./util".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v){Object.defineProperty(d,"__esModule",{value:!0});var x=f.TILE_SIZE+16,l=1/3.8,y=new p.TileClipper(0,0,0,1,16);y.setExtent(f.TILE_SIZE);var t=new Uint32Array(9),n=new Uint32Array(36),r=new Uint32Array(3),k=new Uint32Array(6),w=function(a){return function(b){var c=Math.ceil(1024*a._halfWidth),d=Math.ceil(1024*a._halfReferenceWidth);b.entry0=a.offset+a.vertexCount++;var e=m.i1616to32(b.distance,c),f=m.i8888to32(Math.round(31*b.prevNormal.x),Math.round(31*b.prevNormal.y),
Math.round(0),Math.round(-31)),g=m.i8888to32(0,0,0,a._bitset);n[0]=m.i1616to32(8*b.currentVertex.x,8*b.currentVertex.y);n[1]=a.id;n[2]=a._fillColor;n[3]=f;n[4]=e;n[5]=a._tl;n[6]=a._br;n[7]=g;n[8]=m.i1616to32(d,0);b.entry2=a.offset+a.vertexCount++;e=m.i1616to32(b.distance,c);f=m.i8888to32(Math.round(31*-b.prevNormal.x),Math.round(31*-b.prevNormal.y),Math.round(0),Math.round(31));g=m.i8888to32(0,0,0,a._bitset);n[9]=m.i1616to32(8*b.currentVertex.x,8*b.currentVertex.y);n[10]=a.id;n[11]=a._fillColor;n[12]=
f;n[13]=e;n[14]=a._tl;n[15]=a._br;n[16]=g;n[17]=m.i1616to32(d,0);b.exit0=a.offset+a.vertexCount++;e=m.i1616to32(b.distance,c);f=m.i8888to32(Math.round(31*b.nextNormal.x),Math.round(31*b.nextNormal.y),Math.round(0),Math.round(-31));g=m.i8888to32(0,0,0,a._bitset);n[18]=m.i1616to32(8*b.currentVertex.x,8*b.currentVertex.y);n[19]=a.id;n[20]=a._fillColor;n[21]=f;n[22]=e;n[23]=a._tl;n[24]=a._br;n[25]=g;n[26]=m.i1616to32(d,0);b.exit2=a.offset+a.vertexCount++;e=m.i1616to32(b.distance,c);f=m.i8888to32(Math.round(31*
-b.nextNormal.x),Math.round(31*-b.nextNormal.y),Math.round(0),Math.round(31));g=m.i8888to32(0,0,0,a._bitset);n[27]=m.i1616to32(8*b.currentVertex.x,8*b.currentVertex.y);n[28]=a.id;n[29]=a._fillColor;n[30]=f;n[31]=e;n[32]=a._tl;n[33]=a._br;n[34]=g;n[35]=m.i1616to32(d,0);a.geometryBuf.writeRegion(n)}},q=function(a){return function(b){k[0]=b.leftExit0;k[1]=b.rightEntry0;k[2]=b.leftExit2;k[3]=b.rightEntry0;k[4]=b.rightEntry2;k[5]=b.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(k)}},z=function(a){return function(b,
c,d,e,f,g,h,k,n){n=m.i1616to32(n,Math.ceil(1024*a._halfWidth));f=m.i8888to32(Math.round(31*f),Math.round(31*g),Math.round(31*h),Math.round(31*k));d=m.i8888to32(31*d,31*e,0,a._bitset);t[0]=m.i1616to32(8*b,8*c);t[1]=a.id;t[2]=a._fillColor;t[3]=f;t[4]=n;t[5]=a._tl;t[6]=a._br;t[7]=d;t[8]=m.i1616to32(Math.ceil(1024*a._halfReferenceWidth),0);a.geometryBuf.writeRegion(t);return a.offset+a.vertexCount++}},B=function(a){return function(b,c,d){r[0]=b;r[1]=c;r[2]=d;a.indexCount+=3;a.indexBuf.writeRegion(r)}};
d.default=function(a){return function(a){function d(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=a.apply(this,c)||this;c.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};c._tessellationOptions={};c.geometryType=b.WGLGeometryType.LINE;return c}e.__extends(d,a);d.prototype.writeMeshWithGeometry=function(a,b,c,d,e,f){c=b.indexVector;e=b.get("geometry");
var h=new g(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;h.vertexFrom=b;h.indexFrom=c.length;v.isPolyline(f)?(f=this._clipLines(f.paths),0!==f.length&&(this._write(h,c,e,b,d,f),a.push(h))):v.isPolygon(f)&&(f=this._clipLines(f.rings),0!==f.length&&(this._write(h,c,e,b,d,f),a.push(h)))};d.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];y.reset(2);var g=f[0],h=g[0],g=g[1];if(c)y.moveTo(h,g);else{if(-16>h||h>x||-16>g||g>x){c=!0;continue}e.push({x:h,
y:g})}for(var k=!1,n=f.length,l=1;l<n;++l)if(h+=f[l][0],g+=f[l][1],c)y.lineTo(h,g);else{if(-16>h||h>x||-16>g||g>x){k=!0;break}e.push({x:h,y:g})}if(k)c=!0;else{if(c){if(e=y.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};d.prototype._write=function(a,b,d,e,f,g){this.tessellationProperties.id=f;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=d;this.tessellationProperties.vertexCount=
0;this.tessellationProperties.offset=e;for(b=0;b<g.length;b++)d=g[b],e=d.line,2>e.length||(this._tessellationOptions.initialDistance=d.start%65535,this._tessellationCallbacks instanceof c.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),c.tessellate(e,this._tessellationOptions,this._tessellationCallbacks),c.cleanup());a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;
a.zOrder=this._zOrder};d.prototype._initializeTessellator=function(a){var b=u.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<f.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=l;this._tessellationOptions.enableOuterBisectorSplit=
this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=l;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:w(this.tessellationProperties),bridge:q(this.tessellationProperties)}:(a=new c.StandardTessellationCallbacks(z(this.tessellationProperties),B(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,
a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a)};return d}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports tslib ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),function(a,d,e,h,f,b,m,p,c,g,
u,v,x){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(c,d,e,f,h,l,p,y,A,x,v,H,J,F,C,G,I,K,M,N,L){var k=a.call(this)||this;k.angle=f;k.height=p;k.width=l;k.xOffset=d*M;k.yOffset=e*M;k._markerPlacement=N;k.effects=L;k._anchorX=.5-((.5+G)*C.width+1)/C.rect.width;k._anchorY=.5-((.5+I)*C.height+1)/C.rect.height;d=(1===F?1:0)|(v?1:0)<<1|(J?1:0)<<2|(H?1:0)<<3;e=C&&C.sdf;c=u.MarkerMaterialKey.load(u.createMaterialKey(k.geometryType,c,!1));c.sdf=e;c.pattern=!0;c.textureBinding=C.textureBinding;
k._materialKey=c.data;k._fillColor=h;k._outlineColor=A;k._sizeOutlineWidth=g.i8888to32(Math.round(Math.min(Math.sqrt(128*l),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*y),255)));h=C.rect.x;y=C.rect.y;A=h+C.rect.width;x=y+C.rect.height;k._texUpperLeft=g.i1616to32(h,y);k._texUpperRight=g.i1616to32(A,y);k._texBottomLeft=g.i1616to32(h,x);k._texBottomRight=g.i1616to32(A,x);l=l*K*M;p=p*K*M;k._bitestAndDistRatio=g.i8888to32(0,
0,d,Math.round(Math.min(64*K,255)));l*=C.rect.width/C.width;p*=C.rect.height/C.height;k._computedWidth=l;k._computedHeight=p;l=m.vec2f32.create();p=b.mat2df32.create();k._applyTransformation(p,l);return k}e.__extends(d,a);d.fromCIMMarker=function(a,b,c){var e=b.size,g=(c&&c.width||1)/(c&&c.height||1)*b.scaleX,n=b.scaleSymbolsProportionally&&b.frameHeight?e/b.frameHeight:1,l=p.premultiplyAlphaRGBA(b.color),m=p.premultiplyAlphaRGBA(b.outlineColor),r=f.pt2px(e),t=r*g,y=f.pt2px(b.offsetX||0),u=f.pt2px(b.offsetY||
0),n=f.pt2px(b.outlineWidth||0)*n,x=b.alignment||0,v=f.pt2px(b.referenceSize),C=b.rotation||0;b.rotateClockwise||(C=-C);var G=0,I=0,K=b.anchorPoint;K&&(b.isAbsoluteAnchorPoint?e&&(G=-K.x/(e*g),I=K.y/e):(G=K.x,I=K.y));return new d(a,y,u,C,l,t,r,v,m,n,b.colorLocked,b.scaleSymbolsProportionally,!1,x,c,G,I,b.sizeRatio,h.unwrapOr(b.scaleFactor,1),b.markerPlacement,b.effects)};d.fromPictureMarker=function(a,b,e){var g=Math.round(f.pt2px(b.width)),h=Math.round(f.pt2px(b.height)),n=c.PICTURE_FILL_COLOR,l=
Math.round(f.pt2px(b.xoffset||0)),m=Math.round(f.pt2px(b.yoffset||0));return new d(a,l,m,b.angle,n,g,h,h,0,0,!1,!1,!1,0,e,0,0,1,1,null,null)};d.fromSimpleMarker=function(a,b,c){var e=p.premultiplyAlphaRGBA(b.color),g=Math.round(f.pt2px(b.size)),h=Math.round(f.pt2px(b.xoffset||0)),n=Math.round(f.pt2px(b.yoffset||0)),l=b.style,m=b.outline,r=(m&&m.color&&p.premultiplyAlphaRGBA(m.color))|0,m=(m&&m.width&&Math.round(f.pt2px(m.width)))|0;a=new d(a,h,n,b.angle,e,g,g,g,r,m,!1,!1,"cross"===l||"x"===l,0,c,
0,0,1.96875,1,null,null);a.boundsType="circle"===l?"circle":"square";return a};d.fromLineSymbolMarker=function(a,b,c){var e=b.marker,g=e.color?p.premultiplyAlphaRGBA(e.color):p.premultiplyAlphaRGBA(b.color),h=Math.round(f.pt2px(6*b.width)),n=e.style,l="cross"===n||"x"===n;switch(e.placement){case "begin-end":e="Both";break;case "begin":e="JustBegin";break;case "end":e="JustEnd";break;default:e="None"}e={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0};
a=new d(a,0,0,0,g,h,h,h/6,g,l?Math.round(f.pt2px(b.width)):0,!1,!1,l,1,c,0,0,1.96875,1,e,null);a.boundsType="circle"===n?"circle":"square";return a};return d}(v.default(x.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports tslib ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../enums ../../number ../../WGLDisplayRecord ./util".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y){Object.defineProperty(d,"__esModule",{value:!0});var t=h.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase"),n=3.14159265359/180;d.default=function(a){return function(a){function d(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.angle=0;b.xOffset=0;b.yOffset=0;b.width=0;b.height=0;b.boundsType="square";b._anchorX=0;b._anchorY=0;b._computedWidth=0;b._computedHeight=0;b.geometryType=v.WGLGeometryType.MARKER;return b}
e.__extends(d,a);d.prototype.writeMeshWithGeometry=function(a,b,c,d,e,f){c=b.indexVector;var g=b.get("geometry"),h=new l(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(h);h.vertexFrom=b;h.indexFrom=c.length;this._markerPlacement?this._writePlacedMarkers(h,g,c,b,d,e,f):y.isPoint(f)?(a=f.x,f=f.y,this._writeVertices(h,g,d,this._getPos(a,f)),this._writeIndices(h,c,b)):y.isPolyline(f)?this._writeMany(h,c,g,b,d,f.paths[0]):y.isPolygon(f)?(f=e.centroid)?(a=f.x,f=f.y,
this._writeVertices(h,g,d,this._getPos(a,f)),this._writeIndices(h,c,b)):t.error("Tried to render polygon geometries as markers, but found no centroid!"):y.isMultipoint(f)&&this._writeMany(h,c,g,b,d,f.points)};d.prototype._applyTransformation=function(a,b,d){void 0===d&&(d=0);m.mat2d.identity(a);m.mat2d.translate(a,a,g.vec2f32.fromValues(this.xOffset,-this.yOffset));0!==this.angle+d&&m.mat2d.rotate(a,a,n*(this.angle+d));d=this._computedWidth;var e=this._computedHeight,f=(this._anchorX-.5)*d,h=(this._anchorY-
.5)*e;c.vec2.set(b,f,h);c.vec2.transformMat2d(b,b,a);this._offsetUpperLeft=x.i1616to32(16*b[0],16*b[1]);c.vec2.set(b,f+d,h);c.vec2.transformMat2d(b,b,a);this._offsetUpperRight=x.i1616to32(16*b[0],16*b[1]);c.vec2.set(b,f,h+e);c.vec2.transformMat2d(b,b,a);this._offsetBottomLeft=x.i1616to32(16*b[0],16*b[1]);c.vec2.set(b,f+d,h+e);c.vec2.transformMat2d(b,b,a);this._offsetBottomRight=x.i1616to32(16*b[0],16*b[1])};d.prototype._writePlacedMarkers=function(a,c,d,e,h,k,l){if(k=u.CIMMarkerPlacementHelper.getPlacement(l,
f.unwrap(this._markerPlacement),b.pt2px(1))){l=g.vec2f32.create();for(var m=p.mat2df32.create(),q=0,r=k.next();null!=r;)-128<=r.tx&&640>=r.tx&&-128<=r.ty&&640>=r.ty&&(this._applyTransformation(m,l,r.getAngle()/n),this._writeVertices(a,c,h,this._getPos(r.tx,r.ty)),this._writeIndices(a,d,e+q),q+=4),r=k.next()}};d.prototype._getPos=function(a,b){return x.i1616to32(Math.round(8*a),Math.round(8*b))};d.prototype._writeMany=function(a,b,c,d,e,f){for(var g=0,h=0,k=0,n=0;n<f.length;n++){var l=f[n],m=l[0],
l=l[1],p=this._getPos(m+g,l+h);this._writeVertices(a,c,e,p);this._writeIndices(a,b,d+k);g+=m;h+=l;k+=4}};d.prototype._writeVertices=function(a,b,c,d){b.push(d);b.push(this._offsetUpperLeft);b.push(this._texUpperLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);b.push(this._texUpperRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);
b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};d.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+
1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return d}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaults ./WGLDynamicFillTemplate ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/Lock ../../util/Result ../../../../layers/features/textUtils".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r){function k(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function w(a){return!!(a&1)}Object.defineProperty(d,"__esModule",{value:!0});var q=f.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),z=[];d.isDynamicId=w;a=function(){function a(a,b){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new t.default;this._fetchResource=a;this._joinOnUTurn=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c){this._initErrorTemplates();var d=a.hash();if(this._symbolToTemplate.has(d))return this._symbolToTemplate.get(d);var e=[];b&&this._createMeshTemplates(e,b,c,!0);this._createMeshTemplates(e,a,c,!1);a=this._createGroupId("expanded-cim"===a.type);this._idToTemplateGroup.set(a,e);this._symbolToTemplate.set(d,a);return a};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?
this._idToTemplateGroup.get(a):z};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return z;w(a)||q.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.getMosaicItem=function(a,c,d){var e=this,f=this._createTemplateId(),g=b.create(function(a){return e._idToResolver.set(f,a)});a=c?a.toJSON():a;this._fetchQueue.push({symbol:a,id:f,glyphIds:d});return g};a.prototype.finalize=function(a){return this._fetchQueue.length||
this._lock.isHeld()?t.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):b.resolve()};a.prototype._initErrorTemplates=function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],m.errorPolygonSymbol2D,null,!1),marker:this._createMeshTemplates([],m.errorPointSymbol2D,null,!1),line:this._createMeshTemplates([],m.errorPolylineSymbol2D,null,!1)})};a.prototype._fetchAllQueuedResources=function(a){var c=this;if(!this._fetchQueue.length)return b.resolve();var d=
this._fetchQueue,e=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return b.all(e).then(function(){return c._fetchResource(d,a).then(function(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.id,d=d.mosaicItem;c._idToResolver.get(e)(d);c._idToResolver.delete(e)}})}).catch(function(a){b.isAbortError(a)?c._fetchQueue=c._fetchQueue.concat(d):q.error(new h("mapview-template-store","Unable to fetch requested texture resources",a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<
1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._createSMS=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,q)?[2,l.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,
function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,q)?[2,l.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,c){return e.__awaiter(this,void 0,void 0,function(){var d,f;return e.__generator(this,function(e){switch(e.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return d=e.sent().spriteMosaicItem,f=a,n.ok(d,q)?[2,v.default.fromSimpleFill(b,f,d,c)]:[2,this._fillError]}})})};
a.prototype._createPFS=function(a,b,c){return e.__awaiter(this,void 0,void 0,function(){var d,f;return e.__generator(this,function(e){switch(e.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return d=e.sent().spriteMosaicItem,f=a,n.ok(d,q)?[2,v.default.fromPictureFill(b,f,d,c)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return e.__awaiter(this,void 0,void 0,function(){var d,f;return e.__generator(this,function(e){switch(e.label){case 0:return[4,this.getMosaicItem(a,!0)];
case 1:return d=e.sent().spriteMosaicItem,f=a,n.ok(d,q)?[2,x.default.fromSimpleLine(b,c,f,d,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createLMS=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c,d;return e.__generator(this,function(e){switch(e.label){case 0:return c=a,[4,this.getMosaicItem(c.marker,!0)];case 1:return d=e.sent().spriteMosaicItem,n.ok(d,q)?[2,l.default.fromLineSymbolMarker(b,c,d)]:[2,this._markerError]}})})};a.prototype._createTS=function(a,b){return e.__awaiter(this,
void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().glyphMosaicItems,[2,y.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a.cim,!1,r.codepoints(a.text))];case 1:return c=d.sent().glyphMosaicItems,a.cim.mosaicHash=a.materialHash,n.ok(c,
q)?[2,y.default.fromCIMText(b,a,c)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getMosaicItem(a.cim,!1)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,q)?[2,v.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;
return e.__generator(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getMosaicItem(a.cim,!1)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,q)?[2,x.default.fromCIMLine(b,a,c,!1,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getMosaicItem(a.cim,!1)];case 1:return c=
d.sent().spriteMosaicItem,n.ok(c,q)?[2,l.default.fromCIMMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c,d,f=this;return e.__generator(this,function(e){c=a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,b);break;case "text":d=this._createCIMText(a,
b)}d.then(function(a){return f._cimTemplateCache.set(c,a)});return[2,d]})})};a.prototype._createDynamicCIM=function(a,b){var d=a.templateHash;if(this._cimTemplateCache.has(d))return this._cimTemplateCache.get(d);var e;switch(a.type){case "marker":e=g.default.fromCIMMarker(b,a);break;case "line":e=c.default.fromCIMLine(b,a);break;case "fill":e=p.default.fromCIMFill(b,a);break;case "text":e=u.default.fromCIMText(b,a)}this._cimTemplateCache.set(d,e);return e};a.prototype._createMeshTemplates=function(a,
b,c,d){if(-1!==b.type.indexOf("3d"))return q.error("3D symbols are not supported with MapView"),a;switch(b.type){case "cim":return q.error(new h("mapview-bad-type","Found a cim type not yet expanded")),a;case "expanded-cim":d=0;for(b=b.layers;d<b.length;d++){var e=b[d];"function"===typeof e.materialHash?a.push(this._createDynamicCIM(e,c)):k(a,this._createCIM(e,c))}return a;case "simple-marker":return k(a,this._createSMS(b,c));case "picture-marker":return k(a,this._createPMS(b,c));case "simple-fill":return k(a,
this._createSFS(b,c,d)),b.outline&&k(a,this._createSLS(b.outline,c,!0)),a;case "picture-fill":return k(a,this._createPFS(b,c,d)),b.outline&&k(a,this._createSLS(b.outline,c,!0)),a;case "simple-line":return k(a,this._createSLS(b,c,!1)),b.marker&&k(a,this._createLMS(b,c)),a;case "text":return k(a,this._createTS(b,c));default:return q.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),a}};return a}();d.WGLTemplateStore=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicFillTemplate":function(){define("require exports tslib ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../color ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(d,e){var h=a.call(this,e)||this;if(g.isFunction(e.color))h._dynamicPropertyMap.set("_fillColor",function(a,c,d){return(a=e.color(a,c,d))&&b.premultiplyAlphaRGBA(a)||0});else{var k=e.color;h.fillColor=k&&b.premultiplyAlphaRGBA(k)||0}var l=0;g.isFunction(e.height)||(l=e.height||0);h._dynamicPropertyMap.set("_height",function(a,b,c){return g.isFunction(e.height)?e.height(a,b,c):l});var n=0;g.isFunction(e.offsetX)||
(n=f.pt2px(e.offsetX||0)+128,255<n&&(n=255));h._dynamicPropertyMap.set("_offsetX",function(a,b,c){return g.isFunction(e.offsetX)?(a=f.pt2px(e.offsetX(a,b,c))+128,255<a&&(a=255),a):n});var p=1;g.isFunction(e.scaleX)||(p=e.scaleX||1);h._dynamicPropertyMap.set("_scaleX",function(a,b,c){return g.isFunction(e.scaleX)?e.scaleX(a,b,c):p});var t=0;g.isFunction(e.offsetY)||(t=f.pt2px(-e.offsetY||0)+128,255<t&&(t=255));h._dynamicPropertyMap.set("_offsetY",function(a,b,c){return g.isFunction(e.offsetY)?(a=f.pt2px(-e.offsetY(a,
b,c))+128,255<a&&(a=255),a):t});var y=0;g.isFunction(e.angle)||(y=m.radToByte(e.angle)||0);h._dynamicPropertyMap.set("_angle",function(a,b,c){return g.isFunction(e.angle)?m.radToByte(e.angle(a,b,c)):y});h.isBFS=!1;h.effects=e.effects;h._cimFillLayer=e;h._fillMaterialKey=c.FillMaterialKey.load(c.createMaterialKey(h.geometryType,d,!1));return h}e.__extends(d,a);d.fromCIMFill=function(a,b){return new d(a,b)};d.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,
f){d[f]=e(a,b,c)});var e=this._fillMaterialKey,g=this._materialCache,l=this._cimFillLayer;this.aux3=p.i8888to32(0,0,this._angle,l.colorLocked?1:0);l=l.materialHash;l=l(a,b,c);l=g.get(l);g=null;l&&x.ok(l.spriteMosaicItem)&&(g=l.spriteMosaicItem);if(g){var n=g.rect,m=g.width,r=g.height,l=n.x+1,n=n.y+1,t=l+m,y=n+r,u=h.nextHighestPowerOfTwo(f.pt2px(this._height));255<u?u=255:0>=u&&(u=h.nextHighestPowerOfTwo(y-n));m=h.nextHighestPowerOfTwo(f.pt2px(this._height/r*m||0));255<m?m=255:0>=m&&(m=h.nextHighestPowerOfTwo(t-
l));r=this._scaleX;this.tl=p.i1616to32(l,n);this.br=p.i1616to32(t,y);this.aux1=p.i8888to32(m,u,this._offsetX,this._offsetY);this.aux2=p.i1616to32(128*r,128);e.sdf=g.sdf;e.pattern=!0;e.textureBinding=g.textureBinding}else this.aux2=this.aux1=this.br=this.tl=0,e.sdf=!1,e.pattern=!1,e.textureBinding=0;this._materialKey=e.data};return d}(u.default(v.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseFillTemplate":function(){define("require exports tslib ../../../../../../core/Logger ../../../../../../core/libs/earcut/earcut ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v){Object.defineProperty(d,"__esModule",{value:!0});var x=h.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLBaseFillTemplate"),l=[],y=[];d.default=function(a){return function(a){function d(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];d=a.apply(this,d)||this;d.forceLibtess=!1;d.geometryType=m.WGLGeometryType.FILL;d._tesselator=new v.default;d._tileClipper=new c.TileClipper(0,0,0,1,8);d._tileClipper.setExtent(b.TILE_SIZE);return d}e.__extends(d,
a);d.prototype.writeMeshWithGeometry=function(a,b,c,d,e,f){l.length=0;if("esriGeometryPolygon"!==c)"esriGeometryPolyline"!==c&&x.error("Unable to handle geometryType: "+c);else{c=u.FillMaterialKey.load(this._materialKey);var g=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){f=f.rings;for(var h=0,k=0;k<f.length;k++)for(var n=f[k],m=n[0],p=m[0],m=m[1],q=1;q<n.length;q++)var r=n[q],t=p+r[0],r=m+r[1],h=h-(t-p)*(r+m)/2,p=t,m=r;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,
b,d,g,e,c,f):this._writeMeshEarcut(a,b,d,g,e,c,f)||this._writeMeshLibtess(a,b,d,g,e,c,f)}};d.prototype._isClippingRequired=function(a){var c=b.TILE_SIZE+8,d=0;for(a=a.rings;d<a.length;d++){var e=a[d],f=e.length;if(!(3>f)){var g=e[0][0],h=e[0][1];if(-8>g||g>c||-8>h||h>c)return!0;for(var k=1;k<f;++k)if(g+=e[k][0],h+=e[k][1],-8>g||g>c||-8>h||h>c)return!0}}return!1};d.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=
f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};d.prototype._writeMeshLibtess=function(a,b,c,d,e,f,h){if(d&&d.length){var k=[],n=b.indexVector;b=b.getVector("geometry");var m=new g(c,this.geometryType,this._materialKey),p=b.vertexCount;m.vertexFrom=p;m.indexFrom=n.length;this._tesselator.beginPolygon(l,k);for(var q=0;q<d.length;q++){var r=d[q];if(!(3>r.length)){this._tesselator.beginContour();
var t=void 0,w=void 0;e?(t=r[0].x,w=r[0].y):(t=r[0][0],w=r[0][1]);var y=[t,w,0];this._tesselator.addVertex(y,y);for(y=1;y<r.length-1;y++){var u=void 0,x=void 0;e?(t=r[y].x,w=r[y].y):(u=r[y][0],x=r[y][1],t+=u,w+=x);u=[t,w,0];this._tesselator.addVertex(u,u)}this._tesselator.endContour()}}this._tesselator.endPolygon();this._writeVerticesLibTess(m,b,c,l,f,h);this._writeIndicesLibTess(m,n,p,k);0<m.indexCount&&a.push(m)}};d.prototype._writeMeshEarcut=function(a,b,c,d,e,f,h){if(d&&d.length){var k=b.indexVector;
b=b.getVector("geometry");var n=new g(c,this.geometryType,this._materialKey),m=k.length,p=b.data.length;n.vertexFrom=b.vertexCount;n.indexFrom=k.length;for(var r=0,q=0,t=0;t<d.length;t++){var w=d[t],u=q,x=void 0,v=void 0;e?(x=w[0].x,v=w[0].y):(x=w[0][0],v=w[0][1]);l[q++]=x;l[q++]=v;for(var z=0,B=1;B<w.length;++B){var A=void 0,D=void 0;e?(A=x,D=v,x=w[B].x,v=w[B].y,A=x-A,D=v-D):(A=w[B][0],D=w[B][1],x+=A,v+=D);z-=A*(v+v-D);l[q++]=x;l[q++]=v}if(0<z){if(0<u-r){if(!this._write(n,k,b,c,l,y,r,u,f,h))return k.seek(m),
b.data.seek(p),l.length=y.length=0,!1;r=u}y.length=0}else 0>z?0<u-r?y.push(.5*(u-r)):q=u:q=u}if(0<q-r&&!this._write(n,k,b,c,l,y,r,q,f,h))return k.seek(m),b.data.seek(p),l.length=y.length=0,!1;l.length=y.length=0;a.push(n);return!0}};d.prototype._write=function(a,b,c,d,e,g,h,l,n,m){e=e.slice(h,l);h=f.earcut(e,g,2);if(0<f.deviation(e,g,2,h))return!1;if(h.length)return g=c.vertexCount,this._writeVertices(a,c,d,e,n,m),this._writeIndices(a,b,g,h),!0};d.prototype._writeVertices=function(a,b,c,d,e,f){for(var g=
0;g<d.length;g+=2){var h=p.i1616to32(8*d[g],8*d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndices=function(a,b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};d.prototype._writeVerticesLibTess=function(a,b,c,d,e,f){for(var g=0;g<d.length;g+=2){var h=
p.i1616to32(8*d[g],8*d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return d}(a)}})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],
function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});var f=e.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");a=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new h.GluTesselator;this.glu.gluTessCallback(h.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_END,this._endcallback.bind(this));
this.glu.gluTessCallback(h.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(h.gluEnum.GLU_TESS_WINDING_RULE,h.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=
0;this.glu.gluTessBeginPolygon(a);this._indices=b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&
(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){f.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=
function(a){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(){};return a}();d.default=a})},"esri/core/libs/libtess/libtess":function(){define([],function(){var a={DEBUG:!1,assert:function(d,e){if(a.DEBUG&&!d)throw Error("Assertion failed"+(e?": "+e:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},
primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,
GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};a.geom.vertEq=function(a,e){return a.s===e.s&&a.t===e.t};a.geom.vertLeq=function(a,e){return a.s<e.s||a.s===e.s&&a.t<=e.t};a.geom.edgeEval=function(d,e,h){a.assert(a.geom.vertLeq(d,e)&&a.geom.vertLeq(e,h));var f=e.s-d.s,b=h.s-
e.s;return 0<f+b?f<b?e.t-d.t+f/(f+b)*(d.t-h.t):e.t-h.t+b/(f+b)*(h.t-d.t):0};a.geom.edgeSign=function(d,e,h){a.assert(a.geom.vertLeq(d,e)&&a.geom.vertLeq(e,h));var f=e.s-d.s,b=h.s-e.s;return 0<f+b?(e.t-h.t)*f+(e.t-d.t)*b:0};a.geom.transLeq=function(a,e){return a.t<e.t||a.t===e.t&&a.s<=e.s};a.geom.transEval=function(d,e,h){a.assert(a.geom.transLeq(d,e)&&a.geom.transLeq(e,h));var f=e.t-d.t,b=h.t-e.t;return 0<f+b?f<b?e.s-d.s+f/(f+b)*(d.s-h.s):e.s-h.s+b/(f+b)*(h.s-d.s):0};a.geom.transSign=function(d,e,
h){a.assert(a.geom.transLeq(d,e)&&a.geom.transLeq(e,h));var f=e.t-d.t,b=h.t-e.t;return 0<f+b?(e.s-h.s)*f+(e.s-d.s)*b:0};a.geom.edgeGoesLeft=function(d){return a.geom.vertLeq(d.dst(),d.org)};a.geom.edgeGoesRight=function(d){return a.geom.vertLeq(d.org,d.dst())};a.geom.vertL1dist=function(a,e){return Math.abs(a.s-e.s)+Math.abs(a.t-e.t)};a.geom.vertCCW=function(a,e,h){return 0<=a.s*(e.t-h.t)+e.s*(h.t-a.t)+h.s*(a.t-e.t)};a.geom.interpolate_=function(a,e,h,f){a=0>a?0:a;h=0>h?0:h;return a<=h?0===h?(e+f)/
2:e+a/(a+h)*(f-e):f+h/(a+h)*(e-f)};a.geom.edgeIntersect=function(d,e,h,f,b){var m,p;a.geom.vertLeq(d,e)||(m=d,d=e,e=m);a.geom.vertLeq(h,f)||(m=h,h=f,f=m);a.geom.vertLeq(d,h)||(m=d,d=h,h=m,m=e,e=f,f=m);a.geom.vertLeq(h,e)?a.geom.vertLeq(e,f)?(m=a.geom.edgeEval(d,h,e),p=a.geom.edgeEval(h,e,f),0>m+p&&(m=-m,p=-p),b.s=a.geom.interpolate_(m,h.s,p,e.s)):(m=a.geom.edgeSign(d,h,e),p=-a.geom.edgeSign(d,f,e),0>m+p&&(m=-m,p=-p),b.s=a.geom.interpolate_(m,h.s,p,f.s)):b.s=(h.s+e.s)/2;a.geom.transLeq(d,e)||(m=d,
d=e,e=m);a.geom.transLeq(h,f)||(m=h,h=f,f=m);a.geom.transLeq(d,h)||(m=d,d=h,h=m,m=e,e=f,f=m);a.geom.transLeq(h,e)?a.geom.transLeq(e,f)?(m=a.geom.transEval(d,h,e),p=a.geom.transEval(h,e,f),0>m+p&&(m=-m,p=-p),b.t=a.geom.interpolate_(m,h.t,p,e.t)):(m=a.geom.transSign(d,h,e),p=-a.geom.transSign(d,f,e),0>m+p&&(m=-m,p=-p),b.t=a.geom.interpolate_(m,h.t,p,f.t)):b.t=(h.t+e.t)/2};a.mesh={};a.mesh.makeEdge=function(d){var e=a.mesh.makeEdgePair_(d.eHead);a.mesh.makeVertex_(e,d.vHead);a.mesh.makeVertex_(e.sym,
d.vHead);a.mesh.makeFace_(e,d.fHead);return e};a.mesh.meshSplice=function(d,e){var h=!1,f=!1;d!==e&&(e.org!==d.org&&(f=!0,a.mesh.killVertex_(e.org,d.org)),e.lFace!==d.lFace&&(h=!0,a.mesh.killFace_(e.lFace,d.lFace)),a.mesh.splice_(e,d),f||(a.mesh.makeVertex_(e,d.org),d.org.anEdge=d),h||(a.mesh.makeFace_(e,d.lFace),d.lFace.anEdge=d))};a.mesh.deleteEdge=function(d){var e=d.sym,h=!1;d.lFace!==d.rFace()&&(h=!0,a.mesh.killFace_(d.lFace,d.rFace()));d.oNext===d?a.mesh.killVertex_(d.org,null):(d.rFace().anEdge=
d.oPrev(),d.org.anEdge=d.oNext,a.mesh.splice_(d,d.oPrev()),h||a.mesh.makeFace_(d,d.lFace));e.oNext===e?(a.mesh.killVertex_(e.org,null),a.mesh.killFace_(e.lFace,null)):(d.lFace.anEdge=e.oPrev(),e.org.anEdge=e.oNext,a.mesh.splice_(e,e.oPrev()));a.mesh.killEdge_(d)};a.mesh.addEdgeVertex=function(d){var e=a.mesh.makeEdgePair_(d),h=e.sym;a.mesh.splice_(e,d.lNext);e.org=d.dst();a.mesh.makeVertex_(h,e.org);e.lFace=h.lFace=d.lFace;return e};a.mesh.splitEdge=function(d){var e=a.mesh.addEdgeVertex(d).sym;a.mesh.splice_(d.sym,
d.sym.oPrev());a.mesh.splice_(d.sym,e);d.sym.org=e.org;e.dst().anEdge=e.sym;e.sym.lFace=d.rFace();e.winding=d.winding;e.sym.winding=d.sym.winding;return e};a.mesh.connect=function(d,e){var h=!1,f=a.mesh.makeEdgePair_(d),b=f.sym;e.lFace!==d.lFace&&(h=!0,a.mesh.killFace_(e.lFace,d.lFace));a.mesh.splice_(f,d.lNext);a.mesh.splice_(b,e);f.org=d.dst();b.org=e.org;f.lFace=b.lFace=d.lFace;d.lFace.anEdge=b;h||a.mesh.makeFace_(f,d.lFace);return f};a.mesh.zapFace=function(d){var e=d.anEdge,h=e.lNext,f;do if(f=
h,h=f.lNext,f.lFace=null,null===f.rFace()){f.oNext===f?a.mesh.killVertex_(f.org,null):(f.org.anEdge=f.oNext,a.mesh.splice_(f,f.oPrev()));var b=f.sym;b.oNext===b?a.mesh.killVertex_(b.org,null):(b.org.anEdge=b.oNext,a.mesh.splice_(b,b.oPrev()));a.mesh.killEdge_(f)}while(f!==e);e=d.prev;d=d.next;d.prev=e;e.next=d};a.mesh.meshUnion=function(a,e){var d=a.fHead,f=a.vHead,b=a.eHead,m=e.fHead,p=e.vHead;e=e.eHead;m.next!==m&&(d.prev.next=m.next,m.next.prev=d.prev,m.prev.next=d,d.prev=m.prev);p.next!==p&&(f.prev.next=
p.next,p.next.prev=f.prev,p.prev.next=f,f.prev=p.prev);e.next!==e&&(b.sym.next.sym.next=e.next,e.next.sym.next=b.sym.next,e.sym.next.sym.next=b,b.sym.next=e.sym.next);return a};a.mesh.deleteMesh=function(a){};a.mesh.makeEdgePair_=function(d){var e=new a.GluHalfEdge,h=new a.GluHalfEdge,f=d.sym.next;h.next=f;f.sym.next=e;e.next=d;d.sym.next=h;e.sym=h;e.oNext=e;e.lNext=h;h.sym=e;h.oNext=h;return h.lNext=e};a.mesh.splice_=function(a,e){var d=a.oNext,f=e.oNext;d.sym.lNext=e;f.sym.lNext=a;a.oNext=f;e.oNext=
d};a.mesh.makeVertex_=function(d,e){var h=e.prev,f=new a.GluVertex(e,h);h.next=f;e.prev=f;e=f.anEdge=d;do e.org=f,e=e.oNext;while(e!==d)};a.mesh.makeFace_=function(d,e){var h=e.prev,f=new a.GluFace(e,h);h.next=f;e.prev=f;f.anEdge=d;f.inside=e.inside;e=d;do e.lFace=f,e=e.lNext;while(e!==d)};a.mesh.killEdge_=function(a){var d=a.next;a=a.sym.next;d.sym.next=a;a.sym.next=d};a.mesh.killVertex_=function(a,e){var d=a.anEdge,f=d;do f.org=e,f=f.oNext;while(f!==d);e=a.prev;a=a.next;a.prev=e;e.next=a};a.mesh.killFace_=
function(a,e){var d=a.anEdge,f=d;do f.lFace=e,f=f.lNext;while(f!==d);e=a.prev;a=a.next;a.prev=e;e.next=a};a.normal={};a.normal.S_UNIT_X_=1;a.normal.S_UNIT_Y_=0;a.normal.projectPolygon=function(d,e,h,f){var b=!1,m=[e,h,f];0===e&&0===h&&0===f&&(a.normal.computeNormal_(d,m),b=!0);h=a.normal.longAxis_(m);e=d.mesh.vHead;if(a.TRUE_PROJECT){a.normal.normalize_(m);f=[0,0,0];var p=[0,0,0];f[h]=0;f[(h+1)%3]=a.normal.S_UNIT_X_;f[(h+2)%3]=a.normal.S_UNIT_Y_;h=a.normal.dot_(f,m);f[0]-=h*m[0];f[1]-=h*m[1];f[2]-=
h*m[2];a.normal.normalize_(f);p[0]=m[1]*f[2]-m[2]*f[1];p[1]=m[2]*f[0]-m[0]*f[2];p[2]=m[0]*f[1]-m[1]*f[0];a.normal.normalize_(p);for(m=e.next;m!==e;m=m.next)m.s=a.normal.dot_(m.coords,f),m.t=a.normal.dot_(m.coords,p)}else for(f=(h+1)%3,p=(h+2)%3,h=0<m[h]?1:-1,m=e.next;m!==e;m=m.next)m.s=m.coords[f],m.t=h*m.coords[p];b&&a.normal.checkOrientation_(d)};a.normal.dot_=function(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]};a.normal.normalize_=function(d){var e=d[0]*d[0]+d[1]*d[1]+d[2]*d[2];a.assert(0<e);e=
Math.sqrt(e);d[0]/=e;d[1]/=e;d[2]/=e};a.normal.longAxis_=function(a){var d=0;Math.abs(a[1])>Math.abs(a[0])&&(d=1);Math.abs(a[2])>Math.abs(a[d])&&(d=2);return d};a.normal.computeNormal_=function(d,e){var h=[-2*a.GLU_TESS_MAX_COORD,-2*a.GLU_TESS_MAX_COORD,-2*a.GLU_TESS_MAX_COORD],f=[2*a.GLU_TESS_MAX_COORD,2*a.GLU_TESS_MAX_COORD,2*a.GLU_TESS_MAX_COORD],b=[],m=[],p;d=d.mesh.vHead;for(p=d.next;p!==d;p=p.next)for(var c=0;3>c;++c){var g=p.coords[c];g<f[c]&&(f[c]=g,m[c]=p);g>h[c]&&(h[c]=g,b[c]=p)}p=0;h[1]-
f[1]>h[0]-f[0]&&(p=1);h[2]-f[2]>h[p]-f[p]&&(p=2);if(f[p]>=h[p])e[0]=0,e[1]=0,e[2]=1;else{h=0;f=m[p];b=b[p];m=[0,0,0];f=[f.coords[0]-b.coords[0],f.coords[1]-b.coords[1],f.coords[2]-b.coords[2]];c=[0,0,0];for(p=d.next;p!==d;p=p.next)c[0]=p.coords[0]-b.coords[0],c[1]=p.coords[1]-b.coords[1],c[2]=p.coords[2]-b.coords[2],m[0]=f[1]*c[2]-f[2]*c[1],m[1]=f[2]*c[0]-f[0]*c[2],m[2]=f[0]*c[1]-f[1]*c[0],g=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],g>h&&(h=g,e[0]=m[0],e[1]=m[1],e[2]=m[2]);0>=h&&(e[0]=e[1]=e[2]=0,e[a.normal.longAxis_(f)]=
1)}};a.normal.checkOrientation_=function(a){for(var d=0,h=a.mesh.fHead,f=h.next;f!==h;f=f.next){var b=f.anEdge;if(!(0>=b.winding)){do d+=(b.org.s-b.dst().s)*(b.org.t+b.dst().t),b=b.lNext;while(b!==f.anEdge)}}if(0>d)for(a=a.mesh.vHead,d=a.next;d!==a;d=d.next)d.t=-d.t};a.render={};a.render.renderMesh=function(d,e,h){for(var f=!1,b=-1,m=e.fHead.prev;m!==e.fHead;m=m.prev)if(m.inside){f||(d.callBeginCallback(a.primitiveType.GL_TRIANGLES),f=!0);var p=m.anEdge;a.assert(p.lNext.lNext.lNext===p,"renderMesh called with non-triangulated mesh");
do{if(h){var c=p.rFace().inside?0:1;b!==c&&(b=c,d.callEdgeFlagCallback(!!b))}d.callVertexCallback(p.org.data);p=p.lNext}while(p!==m.anEdge)}f&&d.callEndCallback()};a.render.renderBoundary=function(d,e){for(var h=e.fHead.next;h!==e.fHead;h=h.next)if(h.inside){d.callBeginCallback(a.primitiveType.GL_LINE_LOOP);var f=h.anEdge;do d.callVertexCallback(f.org.data),f=f.lNext;while(f!==h.anEdge);d.callEndCallback()}};a.sweep={};a.sweep.SENTINEL_COORD_=4*a.GLU_TESS_MAX_COORD;a.sweep.TOLERANCE_NONZERO_=!1;a.sweep.computeInterior=
function(d){d.fatalError=!1;a.sweep.removeDegenerateEdges_(d);a.sweep.initPriorityQ_(d);a.sweep.initEdgeDict_(d);for(var e;null!==(e=d.pq.extractMin());){for(;;){var h=d.pq.minimum();if(null===h||!a.geom.vertEq(h,e))break;h=d.pq.extractMin();a.sweep.spliceMergeVertices_(d,e.anEdge,h.anEdge)}a.sweep.sweepEvent_(d,e)}e=d.dict.getMin().getKey();d.event=e.eUp.org;a.sweep.doneEdgeDict_(d);a.sweep.donePriorityQ_(d);a.sweep.removeDegenerateFaces_(d.mesh);d.mesh.checkMesh()};a.sweep.addWinding_=function(a,
e){a.winding+=e.winding;a.sym.winding+=e.sym.winding};a.sweep.edgeLeq_=function(d,e,h){d=d.event;e=e.eUp;h=h.eUp;if(e.dst()===d)return h.dst()===d?a.geom.vertLeq(e.org,h.org)?0>=a.geom.edgeSign(h.dst(),e.org,h.org):0<=a.geom.edgeSign(e.dst(),h.org,e.org):0>=a.geom.edgeSign(h.dst(),d,h.org);if(h.dst()===d)return 0<=a.geom.edgeSign(e.dst(),d,e.org);e=a.geom.edgeEval(e.dst(),d,e.org);d=a.geom.edgeEval(h.dst(),d,h.org);return e>=d};a.sweep.deleteRegion_=function(d,e){e.fixUpperEdge&&a.assert(0===e.eUp.winding);
e.eUp.activeRegion=null;d.dict.deleteNode(e.nodeUp);e.nodeUp=null};a.sweep.fixUpperEdge_=function(d,e){a.assert(d.fixUpperEdge);a.mesh.deleteEdge(d.eUp);d.fixUpperEdge=!1;d.eUp=e;e.activeRegion=d};a.sweep.topLeftRegion_=function(d){var e=d.eUp.org;do d=d.regionAbove();while(d.eUp.org===e);d.fixUpperEdge&&(e=a.mesh.connect(d.regionBelow().eUp.sym,d.eUp.lNext),a.sweep.fixUpperEdge_(d,e),d=d.regionAbove());return d};a.sweep.topRightRegion_=function(a){var d=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===
d);return a};a.sweep.addRegionBelow_=function(d,e,h){var f=new a.ActiveRegion;f.eUp=h;f.nodeUp=d.dict.insertBefore(e.nodeUp,f);return h.activeRegion=f};a.sweep.isWindingInside_=function(d,e){switch(d.windingRule){case a.windingRule.GLU_TESS_WINDING_ODD:return 0!==(e&1);case a.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==e;case a.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<e;case a.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>e;case a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=e||-2>=
e}a.assert(!1);return!1};a.sweep.computeWinding_=function(d,e){e.windingNumber=e.regionAbove().windingNumber+e.eUp.winding;e.inside=a.sweep.isWindingInside_(d,e.windingNumber)};a.sweep.finishRegion_=function(d,e){var h=e.eUp,f=h.lFace;f.inside=e.inside;f.anEdge=h;a.sweep.deleteRegion_(d,e)};a.sweep.finishLeftRegions_=function(d,e,h){var f=e;for(e=e.eUp;f!==h;){f.fixUpperEdge=!1;var b=f.regionBelow(),m=b.eUp;if(m.org!==e.org){if(!b.fixUpperEdge){a.sweep.finishRegion_(d,f);break}m=a.mesh.connect(e.lPrev(),
m.sym);a.sweep.fixUpperEdge_(b,m)}e.oNext!==m&&(a.mesh.meshSplice(m.oPrev(),m),a.mesh.meshSplice(e,m));a.sweep.finishRegion_(d,f);e=b.eUp;f=b}return e};a.sweep.addRightEdges_=function(d,e,h,f,b,m){var p=!0;do a.assert(a.geom.vertLeq(h.org,h.dst())),a.sweep.addRegionBelow_(d,e,h.sym),h=h.oNext;while(h!==f);for(null===b&&(b=e.regionBelow().eUp.rPrev());;){f=e.regionBelow();h=f.eUp.sym;if(h.org!==b.org)break;h.oNext!==b&&(a.mesh.meshSplice(h.oPrev(),h),a.mesh.meshSplice(b.oPrev(),h));f.windingNumber=
e.windingNumber-h.winding;f.inside=a.sweep.isWindingInside_(d,f.windingNumber);e.dirty=!0;!p&&a.sweep.checkForRightSplice_(d,e)&&(a.sweep.addWinding_(h,b),a.sweep.deleteRegion_(d,e),a.mesh.deleteEdge(b));p=!1;e=f;b=h}e.dirty=!0;a.assert(e.windingNumber-h.winding===f.windingNumber);m&&a.sweep.walkDirtyRegions_(d,e)};a.sweep.callCombine_=function(d,e,h,f,b){var m=[e.coords[0],e.coords[1],e.coords[2]];e.data=null;e.data=d.callCombineCallback(m,h,f);null===e.data&&(b?d.fatalError||(d.callErrorCallback(a.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),
d.fatalError=!0):e.data=h[0])};a.sweep.spliceMergeVertices_=function(d,e,h){var f=[null,null,null,null];f[0]=e.org.data;f[1]=h.org.data;a.sweep.callCombine_(d,e.org,f,[.5,.5,0,0],!1);a.mesh.meshSplice(e,h)};a.sweep.vertexWeights_=function(d,e,h,f,b){var m=a.geom.vertL1dist(e,d),p=a.geom.vertL1dist(h,d),c=b+1;f[b]=.5*p/(m+p);f[c]=.5*m/(m+p);d.coords[0]+=f[b]*e.coords[0]+f[c]*h.coords[0];d.coords[1]+=f[b]*e.coords[1]+f[c]*h.coords[1];d.coords[2]+=f[b]*e.coords[2]+f[c]*h.coords[2]};a.sweep.getIntersectData_=
function(d,e,h,f,b,m){var p=[0,0,0,0],c=[h.data,f.data,b.data,m.data];e.coords[0]=e.coords[1]=e.coords[2]=0;a.sweep.vertexWeights_(e,h,f,p,0);a.sweep.vertexWeights_(e,b,m,p,2);a.sweep.callCombine_(d,e,c,p,!0)};a.sweep.checkForRightSplice_=function(d,e){var h=e.regionBelow(),f=e.eUp,b=h.eUp;if(a.geom.vertLeq(f.org,b.org)){if(0<a.geom.edgeSign(b.dst(),f.org,b.org))return!1;a.geom.vertEq(f.org,b.org)?f.org!==b.org&&(d.pq.remove(f.org.pqHandle),a.sweep.spliceMergeVertices_(d,b.oPrev(),f)):(a.mesh.splitEdge(b.sym),
a.mesh.meshSplice(f,b.oPrev()),e.dirty=h.dirty=!0)}else{if(0>a.geom.edgeSign(f.dst(),b.org,f.org))return!1;e.regionAbove().dirty=e.dirty=!0;a.mesh.splitEdge(f.sym);a.mesh.meshSplice(b.oPrev(),f)}return!0};a.sweep.checkForLeftSplice_=function(d,e){var h=e.regionBelow();d=e.eUp;var f=h.eUp;a.assert(!a.geom.vertEq(d.dst(),f.dst()));if(a.geom.vertLeq(d.dst(),f.dst())){if(0>a.geom.edgeSign(d.dst(),f.dst(),d.org))return!1;e.regionAbove().dirty=e.dirty=!0;h=a.mesh.splitEdge(d);a.mesh.meshSplice(f.sym,h);
h.lFace.inside=e.inside}else{if(0<a.geom.edgeSign(f.dst(),d.dst(),f.org))return!1;e.dirty=h.dirty=!0;h=a.mesh.splitEdge(f);a.mesh.meshSplice(d.lNext,f.sym);h.rFace().inside=e.inside}return!0};a.sweep.checkForIntersect_=function(d,e){var h=e.regionBelow(),f=e.eUp,b=h.eUp,m=f.org,p=b.org,c=f.dst(),g=b.dst(),u=new a.GluVertex;a.assert(!a.geom.vertEq(g,c));a.assert(0>=a.geom.edgeSign(c,d.event,m));a.assert(0<=a.geom.edgeSign(g,d.event,p));a.assert(m!==d.event&&p!==d.event);a.assert(!e.fixUpperEdge&&!h.fixUpperEdge);
if(m===p||Math.min(m.t,c.t)>Math.max(p.t,g.t))return!1;if(a.geom.vertLeq(m,p)){if(0<a.geom.edgeSign(g,m,p))return!1}else if(0>a.geom.edgeSign(c,p,m))return!1;a.geom.edgeIntersect(c,m,g,p,u);a.assert(Math.min(m.t,c.t)<=u.t);a.assert(u.t<=Math.max(p.t,g.t));a.assert(Math.min(g.s,c.s)<=u.s);a.assert(u.s<=Math.max(p.s,m.s));a.geom.vertLeq(u,d.event)&&(u.s=d.event.s,u.t=d.event.t);var v=a.geom.vertLeq(m,p)?m:p;a.geom.vertLeq(v,u)&&(u.s=v.s,u.t=v.t);if(a.geom.vertEq(u,m)||a.geom.vertEq(u,p))return a.sweep.checkForRightSplice_(d,
e),!1;if(!a.geom.vertEq(c,d.event)&&0<=a.geom.edgeSign(c,d.event,u)||!a.geom.vertEq(g,d.event)&&0>=a.geom.edgeSign(g,d.event,u)){if(g===d.event)return a.mesh.splitEdge(f.sym),a.mesh.meshSplice(b.sym,f),e=a.sweep.topLeftRegion_(e),f=e.regionBelow().eUp,a.sweep.finishLeftRegions_(d,e.regionBelow(),h),a.sweep.addRightEdges_(d,e,f.oPrev(),f,f,!0),!0;if(c===d.event)return a.mesh.splitEdge(b.sym),a.mesh.meshSplice(f.lNext,b.oPrev()),h=e,e=a.sweep.topRightRegion_(e),m=e.regionBelow().eUp.rPrev(),h.eUp=b.oPrev(),
b=a.sweep.finishLeftRegions_(d,h,null),a.sweep.addRightEdges_(d,e,b.oNext,f.rPrev(),m,!0),!0;0<=a.geom.edgeSign(c,d.event,u)&&(e.regionAbove().dirty=e.dirty=!0,a.mesh.splitEdge(f.sym),f.org.s=d.event.s,f.org.t=d.event.t);0>=a.geom.edgeSign(g,d.event,u)&&(e.dirty=h.dirty=!0,a.mesh.splitEdge(b.sym),b.org.s=d.event.s,b.org.t=d.event.t);return!1}a.mesh.splitEdge(f.sym);a.mesh.splitEdge(b.sym);a.mesh.meshSplice(b.oPrev(),f);f.org.s=u.s;f.org.t=u.t;f.org.pqHandle=d.pq.insert(f.org);a.sweep.getIntersectData_(d,
f.org,m,c,p,g);e.regionAbove().dirty=e.dirty=h.dirty=!0;return!1};a.sweep.walkDirtyRegions_=function(d,e){for(var h=e.regionBelow();;){for(;h.dirty;)e=h,h=h.regionBelow();if(!e.dirty&&(h=e,e=e.regionAbove(),null===e||!e.dirty))break;e.dirty=!1;var f=e.eUp,b=h.eUp;f.dst()!==b.dst()&&a.sweep.checkForLeftSplice_(d,e)&&(h.fixUpperEdge?(a.sweep.deleteRegion_(d,h),a.mesh.deleteEdge(b),h=e.regionBelow(),b=h.eUp):e.fixUpperEdge&&(a.sweep.deleteRegion_(d,e),a.mesh.deleteEdge(f),e=h.regionAbove(),f=e.eUp));
if(f.org!==b.org)if(f.dst()===b.dst()||e.fixUpperEdge||h.fixUpperEdge||f.dst()!==d.event&&b.dst()!==d.event)a.sweep.checkForRightSplice_(d,e);else if(a.sweep.checkForIntersect_(d,e))break;f.org===b.org&&f.dst()===b.dst()&&(a.sweep.addWinding_(b,f),a.sweep.deleteRegion_(d,e),a.mesh.deleteEdge(f),e=h.regionAbove())}};a.sweep.connectRightVertex_=function(d,e,h){var f=h.oNext,b=e.regionBelow(),m=e.eUp,p=b.eUp,c=!1;m.dst()!==p.dst()&&a.sweep.checkForIntersect_(d,e);a.geom.vertEq(m.org,d.event)&&(a.mesh.meshSplice(f.oPrev(),
m),e=a.sweep.topLeftRegion_(e),f=e.regionBelow().eUp,a.sweep.finishLeftRegions_(d,e.regionBelow(),b),c=!0);a.geom.vertEq(p.org,d.event)&&(a.mesh.meshSplice(h,p.oPrev()),h=a.sweep.finishLeftRegions_(d,b,null),c=!0);c?a.sweep.addRightEdges_(d,e,h.oNext,f,f,!0):(f=a.geom.vertLeq(p.org,m.org)?p.oPrev():m,f=a.mesh.connect(h.lPrev(),f),a.sweep.addRightEdges_(d,e,f,f.oNext,f.oNext,!1),f.sym.activeRegion.fixUpperEdge=!0,a.sweep.walkDirtyRegions_(d,e))};a.sweep.connectLeftDegenerate_=function(d,e,h){var f=
e.eUp;if(a.geom.vertEq(f.org,h))a.assert(a.sweep.TOLERANCE_NONZERO_),a.sweep.TOLERANCE_NONZERO_&&a.sweep.spliceMergeVertices_(d,f,h.anEdge);else if(a.geom.vertEq(f.dst(),h)){if(a.assert(a.sweep.TOLERANCE_NONZERO_),a.sweep.TOLERANCE_NONZERO_){e=a.sweep.topRightRegion_(e);var f=e.regionBelow(),b=f.eUp.sym,m=b.oNext,p=m;f.fixUpperEdge&&(a.assert(m!==b),a.sweep.deleteRegion_(d,f),a.mesh.deleteEdge(b),b=m.oPrev());a.mesh.meshSplice(h.anEdge,b);a.geom.edgeGoesLeft(m)||(m=null);a.sweep.addRightEdges_(d,
e,b.oNext,p,m,!0)}}else a.mesh.splitEdge(f.sym),e.fixUpperEdge&&(a.mesh.deleteEdge(f.oNext),e.fixUpperEdge=!1),a.mesh.meshSplice(h.anEdge,f),a.sweep.sweepEvent_(d,h)};a.sweep.connectLeftVertex_=function(d,e){var h=new a.ActiveRegion;h.eUp=e.anEdge.sym;var h=d.dict.search(h).getKey(),f=h.regionBelow(),b=h.eUp,m=f.eUp;0===a.geom.edgeSign(b.dst(),e,b.org)?a.sweep.connectLeftDegenerate_(d,h,e):(f=a.geom.vertLeq(m.dst(),b.dst())?h:f,h.inside||f.fixUpperEdge?(b=f===h?a.mesh.connect(e.anEdge.sym,b.lNext):
a.mesh.connect(m.dNext(),e.anEdge).sym,f.fixUpperEdge?a.sweep.fixUpperEdge_(f,b):a.sweep.computeWinding_(d,a.sweep.addRegionBelow_(d,h,b)),a.sweep.sweepEvent_(d,e)):a.sweep.addRightEdges_(d,h,e.anEdge,e.anEdge,null,!0))};a.sweep.sweepEvent_=function(d,e){d.event=e;for(var h=e.anEdge;null===h.activeRegion;)if(h=h.oNext,h===e.anEdge){a.sweep.connectLeftVertex_(d,e);return}e=a.sweep.topLeftRegion_(h.activeRegion);var f=e.regionBelow(),h=f.eUp,f=a.sweep.finishLeftRegions_(d,f,null);f.oNext===h?a.sweep.connectRightVertex_(d,
e,f):a.sweep.addRightEdges_(d,e,f.oNext,h,h,!0)};a.sweep.addSentinel_=function(d,e){var h=new a.ActiveRegion,f=a.mesh.makeEdge(d.mesh);f.org.s=a.sweep.SENTINEL_COORD_;f.org.t=e;f.dst().s=-a.sweep.SENTINEL_COORD_;f.dst().t=e;d.event=f.dst();h.eUp=f;h.windingNumber=0;h.inside=!1;h.fixUpperEdge=!1;h.sentinel=!0;h.dirty=!1;h.nodeUp=d.dict.insert(h)};a.sweep.initEdgeDict_=function(d){d.dict=new a.Dict(d,a.sweep.edgeLeq_);a.sweep.addSentinel_(d,-a.sweep.SENTINEL_COORD_);a.sweep.addSentinel_(d,a.sweep.SENTINEL_COORD_)};
a.sweep.doneEdgeDict_=function(d){for(var e=0,h;null!==(h=d.dict.getMin().getKey());)h.sentinel||(a.assert(h.fixUpperEdge),a.assert(1===++e)),a.assert(0===h.windingNumber),a.sweep.deleteRegion_(d,h);d.dict=null};a.sweep.removeDegenerateEdges_=function(d){for(var e=d.mesh.eHead,h,f=e.next;f!==e;f=h){h=f.next;var b=f.lNext;a.geom.vertEq(f.org,f.dst())&&f.lNext.lNext!==f&&(a.sweep.spliceMergeVertices_(d,b,f),a.mesh.deleteEdge(f),f=b,b=f.lNext);if(b.lNext===f){if(b!==f){if(b===h||b===h.sym)h=h.next;a.mesh.deleteEdge(b)}if(f===
h||f===h.sym)h=h.next;a.mesh.deleteEdge(f)}}};a.sweep.initPriorityQ_=function(d){var e=new a.PriorityQ;d.pq=e;d=d.mesh.vHead;var h;for(h=d.next;h!==d;h=h.next)h.pqHandle=e.insert(h);e.init()};a.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};a.sweep.removeDegenerateFaces_=function(d){for(var e,h=d.fHead.next;h!==d.fHead;h=e)e=h.next,h=h.anEdge,a.assert(h.lNext!==h),h.lNext.lNext===h&&(a.sweep.addWinding_(h.oNext,h),a.mesh.deleteEdge(h))};a.tessmono={};a.tessmono.tessellateMonoRegion_=function(d){d=
d.anEdge;for(a.assert(d.lNext!==d&&d.lNext.lNext!==d);a.geom.vertLeq(d.dst(),d.org);d=d.lPrev());for(;a.geom.vertLeq(d.org,d.dst());d=d.lNext);for(var e=d.lPrev(),h;d.lNext!==e;)if(a.geom.vertLeq(d.dst(),e.org)){for(;e.lNext!==d&&(a.geom.edgeGoesLeft(e.lNext)||0>=a.geom.edgeSign(e.org,e.dst(),e.lNext.dst()));)h=a.mesh.connect(e.lNext,e),e=h.sym;e=e.lPrev()}else{for(;e.lNext!==d&&(a.geom.edgeGoesRight(d.lPrev())||0<=a.geom.edgeSign(d.dst(),d.org,d.lPrev().org));)h=a.mesh.connect(d,d.lPrev()),d=h.sym;
d=d.lNext}for(a.assert(e.lNext!==d);e.lNext.lNext!==d;)h=a.mesh.connect(e.lNext,e),e=h.sym};a.tessmono.tessellateInterior=function(d){for(var e,h=d.fHead.next;h!==d.fHead;h=e)e=h.next,h.inside&&a.tessmono.tessellateMonoRegion_(h)};a.tessmono.discardExterior=function(d){for(var e,h=d.fHead.next;h!==d.fHead;h=e)e=h.next,h.inside||a.mesh.zapFace(h)};a.tessmono.setWindingNumber=function(d,e,h){for(var f,b=d.eHead.next;b!==d.eHead;b=f)f=b.next,b.rFace().inside!==b.lFace.inside?b.winding=b.lFace.inside?
e:-e:h?a.mesh.deleteEdge(b):b.winding=0};a.Dict=function(d,e){this.head_=new a.DictNode;this.frame_=d;this.leq_=e};a.Dict.prototype.deleteDict_=function(){};a.Dict.prototype.insertBefore=function(d,e){do d=d.prev;while(null!==d.key&&!this.leq_(this.frame_,d.key,e));e=new a.DictNode(e,d.next,d);d.next.prev=e;return d.next=e};a.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};a.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};a.Dict.prototype.search=
function(a){var d=this.head_;do d=d.next;while(null!==d.key&&!this.leq_(this.frame_,a,d.key));return d};a.Dict.prototype.getMin=function(){return this.head_.next};a.Dict.prototype.getMax=function(){return this.head_.prev};a.DictNode=function(a,e,h){this.key=a||null;this.next=e||this;this.prev=h||this};a.DictNode.prototype.getKey=function(){return this.key};a.DictNode.prototype.getSuccessor=function(){return this.next};a.DictNode.prototype.getPredecessor=function(){return this.prev};a.GluTesselator=
function(){this.state_=a.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=a.windingRule.GLU_TESS_WINDING_ODD;this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};a.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};a.GluTesselator.prototype.gluDeleteTess=
function(){this.requireState_(a.GluTesselator.tessState_.T_DORMANT)};a.GluTesselator.prototype.gluTessProperty=function(d,e){switch(d){case a.gluEnum.GLU_TESS_TOLERANCE:return;case a.gluEnum.GLU_TESS_WINDING_RULE:switch(e){case a.windingRule.GLU_TESS_WINDING_ODD:case a.windingRule.GLU_TESS_WINDING_NONZERO:case a.windingRule.GLU_TESS_WINDING_POSITIVE:case a.windingRule.GLU_TESS_WINDING_NEGATIVE:case a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=e;return}break;case a.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=
!!e;return;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(a.gluEnum.GLU_INVALID_VALUE)};a.GluTesselator.prototype.gluGetTessProperty=function(d){switch(d){case a.gluEnum.GLU_TESS_TOLERANCE:return 0;case a.gluEnum.GLU_TESS_WINDING_RULE:return d=this.windingRule,a.assert(d===a.windingRule.GLU_TESS_WINDING_ODD||d===a.windingRule.GLU_TESS_WINDING_NONZERO||d===a.windingRule.GLU_TESS_WINDING_POSITIVE||d===a.windingRule.GLU_TESS_WINDING_NEGATIVE||d===a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),
d;case a.gluEnum.GLU_TESS_BOUNDARY_ONLY:return a.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM)}return!1};a.GluTesselator.prototype.gluTessNormal=function(a,e,h){this.normal_[0]=a;this.normal_[1]=e;this.normal_[2]=h};a.GluTesselator.prototype.gluTessCallback=function(d,e){e=e?e:null;switch(d){case a.gluEnum.GLU_TESS_BEGIN:case a.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=e;break;case a.gluEnum.GLU_TESS_EDGE_FLAG:case a.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=
e;break;case a.gluEnum.GLU_TESS_VERTEX:case a.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=e;break;case a.gluEnum.GLU_TESS_END:case a.gluEnum.GLU_TESS_END_DATA:this.endCallback_=e;break;case a.gluEnum.GLU_TESS_ERROR:case a.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=e;break;case a.gluEnum.GLU_TESS_COMBINE:case a.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=e;break;case a.gluEnum.GLU_TESS_MESH:this.meshCallback_=e;break;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM)}};a.GluTesselator.prototype.gluTessVertex=
function(d,e){var h=!1,f=[0,0,0];this.requireState_(a.GluTesselator.tessState_.T_IN_CONTOUR);for(var b=0;3>b;++b){var m=d[b];m<-a.GLU_TESS_MAX_COORD&&(m=-a.GLU_TESS_MAX_COORD,h=!0);m>a.GLU_TESS_MAX_COORD&&(m=a.GLU_TESS_MAX_COORD,h=!0);f[b]=m}h&&this.callErrorCallback(a.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(f,e)};a.GluTesselator.prototype.gluTessBeginPolygon=function(d){this.requireState_(a.GluTesselator.tessState_.T_DORMANT);this.state_=a.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=
new a.GluMesh;this.polygonData_=d};a.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_POLYGON);this.state_=a.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};a.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=a.GluTesselator.tessState_.T_IN_POLYGON};a.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=a.GluTesselator.tessState_.T_DORMANT;a.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);a.sweep.computeInterior(this);if(!this.fatalError){var d=this.mesh;this.boundaryOnly_?a.tessmono.setWindingNumber(d,1,!0):a.tessmono.tessellateInterior(d);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?a.render.renderBoundary(this,this.mesh):a.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);
if(this.meshCallback_){a.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}a.mesh.deleteMesh(this.mesh);this.mesh=this.polygonData_=null};a.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};a.GluTesselator.prototype.gotoState_=function(d){for(;this.state_!==d;)if(this.state_<d)switch(this.state_){case a.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);
this.gluTessBeginPolygon(null);break;case a.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case a.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_END_CONTOUR);this.gluTessEndContour();break;case a.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};a.GluTesselator.prototype.addVertex_=
function(d,e){var h=this.lastEdge_;null===h?(h=a.mesh.makeEdge(this.mesh),a.mesh.meshSplice(h,h.sym)):(a.mesh.splitEdge(h),h=h.lNext);h.org.data=e;h.org.coords[0]=d[0];h.org.coords[1]=d[1];h.org.coords[2]=d[2];h.winding=1;h.sym.winding=-1;this.lastEdge_=h};a.GluTesselator.prototype.callBeginCallback=function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callEdgeFlagCallback=
function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};a.GluTesselator.prototype.callCombineCallback=function(a,e,h){return this.combineCallback_?this.combineCallback_(a,e,h,this.polygonData_)||null:null};a.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};a.GluFace=function(a,e){this.next=a||this;
this.prev=e||this;this.anEdge=null;this.inside=!1};a.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};a.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};a.GluHalfEdge.prototype.dst=function(){return this.sym.org};a.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};a.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};a.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};
a.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};a.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};a.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};a.GluMesh=function(){this.vHead=new a.GluVertex;this.fHead=new a.GluFace;this.eHead=new a.GluHalfEdge;this.eHeadSym=new a.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};a.GluMesh.prototype.checkMesh=function(){if(a.DEBUG){var d=this.fHead,e=this.vHead,h=this.eHead,f,b;for(f=f=d;(b=
f.next)!==d;f=b){a.assert(b.prev===f);f=b.anEdge;do a.assert(f.sym!==f),a.assert(f.sym.sym===f),a.assert(f.lNext.oNext.sym===f),a.assert(f.oNext.sym.lNext===f),a.assert(f.lFace===b),f=f.lNext;while(f!==b.anEdge)}a.assert(b.prev===f&&null===b.anEdge);for(f=f=e;(d=f.next)!==e;f=d){a.assert(d.prev===f);f=d.anEdge;do a.assert(f.sym!==f),a.assert(f.sym.sym===f),a.assert(f.lNext.oNext.sym===f),a.assert(f.oNext.sym.lNext===f),a.assert(f.org===d),f=f.oNext;while(f!==d.anEdge)}a.assert(d.prev===f&&null===
d.anEdge&&null===d.data);for(e=e=h;(f=e.next)!==h;e=f)a.assert(f.sym.next===e.sym),a.assert(f.sym!==f),a.assert(f.sym.sym===f),a.assert(null!==f.org),a.assert(null!==f.dst()),a.assert(f.lNext.oNext.sym===f),a.assert(f.oNext.sym.lNext===f);a.assert(f.sym.next===e.sym&&f.sym===this.eHeadSym&&f.sym.sym===f&&null===f.org&&null===f.dst()&&null===f.lFace&&null===f.rFace())}};a.GluVertex=function(a,e){this.next=a||this;this.prev=e||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=
this.s=0};a.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new a.PriorityQHeap};a.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};a.PriorityQ.prototype.init=function(){this.order_=[];for(var d=0;d<this.size_;d++)this.order_[d]=d;d=function(d){return function(e,b){return a.geom.vertLeq(d[e],d[b])?1:-1}}(this.verts_);this.order_.sort(d);this.initialized_=!0;this.heap_.init();if(a.DEBUG)for(var e=0+this.size_-1,d=0;d<
e;++d)a.assert(a.geom.vertLeq(this.verts_[this.order_[d+1]],this.verts_[this.order_[d]]))};a.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var d=this.size_++;this.verts_[d]=a;return-(d+1)};a.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var d=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(a.geom.vertLeq(e,d))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&
null===this.verts_[this.order_[this.size_-1]]);return d};a.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var d=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(a.geom.vertLeq(e,d))return e}return d};a.PriorityQ.prototype.remove=function(d){if(0<=d)this.heap_.remove(d);else for(d=-(d+1),a.assert(d<this.verts_.length&&null!==this.verts_[d]),this.verts_[d]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-
1]];)--this.size_};a.PriorityQHeap=function(){this.heap_=a.PriorityQHeap.reallocNumeric_([0],a.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=a.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};a.PriorityQHeap.INIT_SIZE_=32;a.PriorityQHeap.reallocNumeric_=function(a,e){for(var d=Array(e),f=0;f<a.length;f++)d[f]=a[f];for(;f<e;f++)d[f]=0;return d};a.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);
this.initialized_=!0};a.PriorityQHeap.prototype.insert=function(d){var e=++this.size_;2*e>this.max_&&(this.max_*=2,this.handles_=a.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var h;0===this.freeList_?h=e:(h=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[h]=d;this.handles_[h]=e;this.heap_[e]=h;this.initialized_&&this.floatUp_(e);return h};a.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};a.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};
a.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,e=this.verts_,h=this.handles_,f=a[1],b=e[f];0<this.size_&&(a[1]=a[this.size_],h[a[1]]=1,e[f]=null,h[f]=this.freeList_,this.freeList_=f,0<--this.size_&&this.floatDown_(1));return b};a.PriorityQHeap.prototype.remove=function(d){var e=this.heap_,h=this.verts_,f=this.handles_;a.assert(1<=d&&d<=this.max_&&null!==h[d]);var b=f[d];e[b]=e[this.size_];f[e[b]]=b;b<=--this.size_&&(1>=b?this.floatDown_(b):a.geom.vertLeq(h[e[b>>1]],h[e[b]])?this.floatDown_(b):
this.floatUp_(b));h[d]=null;f[d]=this.freeList_;this.freeList_=d};a.PriorityQHeap.prototype.floatDown_=function(d){for(var e=this.heap_,h=this.verts_,f=this.handles_,b=e[d];;){var m=d<<1;m<this.size_&&a.geom.vertLeq(h[e[m+1]],h[e[m]])&&(m+=1);a.assert(m<=this.max_);var p=e[m];if(m>this.size_||a.geom.vertLeq(h[b],h[p])){e[d]=b;f[b]=d;break}e[d]=p;f[p]=d;d=m}};a.PriorityQHeap.prototype.floatUp_=function(d){for(var e=this.heap_,h=this.verts_,f=this.handles_,b=e[d];;){var m=d>>1,p=e[m];if(0===m||a.geom.vertLeq(h[p],
h[b])){e[d]=b;f[b]=d;break}e[d]=p;f[p]=d;d=m}};a.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};a.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};a.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports tslib ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),
function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});var p=h.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");a=function(a){function c(b){var c=a.call(this)||this;c._ongoingMaterialRequestMap=new Map;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=b;return c}e.__extends(c,a);c.prototype.analyze=function(a,c,d,e){var g=this,h=this._materialCache,l=this._cimLayer.materialHash;if(!l)return p.error("A Dynamic mesh template must have a material hash value or function!"),
f.reject(null);var m="function"===typeof l?l(c,d,e):l;if(h.has(m))return a=h.get(m),f.resolve(a);if(this._ongoingMaterialRequestMap.has(m))return this._ongoingMaterialRequestMap.get(m);c=b.analyzeCIMResource(this._cimLayer.cim,this._cimLayer.materialOverrides);c.mosaicHash=m;a=a.getMosaicItem(c,!1).then(function(a){g._ongoingMaterialRequestMap.delete(m);h.set(m,a);return a}).catch(function(a){g._ongoingMaterialRequestMap.delete(m);p.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(m,
a);return a};return c}(m.default);d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports tslib ../../../../../../core/screenUtils ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(a,d,e,h,f,b,m,p,c,g,u){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(b,c){var d=a.call(this,c)||this;d._cimLineLayer=c;var e=0;p.isFunction(c.width)||
(e=.5*h.pt2px(c.width));d._dynamicPropertyMap.set("_halfWidth",function(a,b,d){return p.isFunction(c.width)?.5*h.pt2px(c.width(a,b,d)):e});p.isFunction(c.cap)?d._dynamicPropertyMap.set("_capType",c.cap):d._capType=c.cap;p.isFunction(c.join)?d._dynamicPropertyMap.set("_joinType",c.join):d._joinType=c.join;if(p.isFunction(c.color))d._dynamicPropertyMap.set("_fillColor",function(a,b,d){return(a=c.color(a,b,d))&&f.premultiplyAlphaRGBA(a)||0});else{var g=c.color;d._fillColor=g&&f.premultiplyAlphaRGBA(g)||
0}p.isFunction(c.miterLimit)?d._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,d){return p.getLimitCosine(c.miterLimit(a,b,d))}):d._miterLimitCosine=p.getLimitCosine(c.miterLimit);d._scaleFactor=c.scaleFactor||1;d._isDashed=c.isDashed;d.effects=c.effects;d.tessellationProperties._bitset=c.colorLocked?1:0;d._materialKey=m.createMaterialKey(d.geometryType,b,c.isOutline);d._initializeTessellator(!0);return d}e.__extends(c,a);c.fromCIMLine=function(a,b){return new c(a,b)};c.prototype.bindFeature=
function(a,c,d){var e=this;this._dynamicPropertyMap.forEach(function(b,f){e[f]=b(a,c,d)});this._halfWidth*=this._scaleFactor;var f=this._materialCache,g=this._cimLineLayer.materialHash,g=g(a,c,d),g=f.get(g),f=null;g&&u.ok(g.spriteMosaicItem)&&(f=g.spriteMosaicItem);if(f){this._hasPattern=!0;var g=f.rect,h=g.x+1+f.width,l=g.y+1+f.height;this.tessellationProperties._tl=b.i1616to32(g.x+1,g.y+1);this.tessellationProperties._br=b.i1616to32(h,l)}else this._hasPattern=!1,this.tessellationProperties._tl=
0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;g=m.LineMaterialKey.load(this._materialKey);f&&(g.sdf=f.sdf,g.pattern=!0,g.textureBinding=f.textureBinding);this._materialKey=g.data};return c}(c.default(g.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports tslib ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u,v,x,l,y,t){Object.defineProperty(d,"__esModule",{value:!0});var n=c.vec2f32.create(),r=p.mat2df32.create(),k=f.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");a=function(a){function c(c,d){var e=a.call(this,d)||this;e._cimMarkerLayer=d;x.isFunction(d.color)?e._dynamicPropertyMap.set("_fillColor",function(a,b,c){return g.premultiplyAlphaRGBA(d.color(a,b,c))}):e._fillColor=g.premultiplyAlphaRGBA(d.color);x.isFunction(d.outlineColor)?e._dynamicPropertyMap.set("_outlineColor",
function(a,b,c){return g.premultiplyAlphaRGBA(d.outlineColor(a,b,c))}):e._outlineColor=g.premultiplyAlphaRGBA(d.outlineColor);x.isFunction(d.size)?e._dynamicPropertyMap.set("_size",function(a,b,c){return m.pt2px(d.size(a,b,c))}):e._size=m.pt2px(d.size);x.isFunction(d.scaleX)?e._dynamicPropertyMap.set("_scaleX",d.scaleX):e._scaleX=d.scaleX;x.isFunction(d.offsetX)?e._dynamicPropertyMap.set("xOffset",function(a,b,c){return m.pt2px(d.offsetX(a,b,c))}):e.xOffset=m.pt2px(d.offsetX);x.isFunction(d.offsetY)?
e._dynamicPropertyMap.set("yOffset",function(a,b,c){return m.pt2px(d.offsetY(a,b,c))}):e.yOffset=m.pt2px(d.offsetY);x.isFunction(d.outlineWidth)?e._dynamicPropertyMap.set("_outlineWidth",function(a,b,c){return m.pt2px(d.outlineWidth(a,b,c))}):e._outlineWidth=m.pt2px(d.outlineWidth);x.isFunction(d.rotation)?e._dynamicPropertyMap.set("_angle",d.rotation):e._angle=d.rotation;e._scaleFactor=b.unwrapOr(d.scaleFactor,1);e._markerPlacement=d.markerPlacement;e.effects=d.effects;e._bitSet=(1===d.alignment?
1:0)|(d.colorLocked?1:0)<<1|(d.scaleSymbolsProportionally?1:0)<<3;e._materialKey=v.createMaterialKey(e.geometryType,c,!1);return e}e.__extends(c,a);c.fromCIMMarker=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,f){d[f]=e(a,b,c)});var e=this._cimMarkerLayer.materialHash,e="function"===typeof e?e(a,b,c):e;if((e=this._materialCache.get(e))&&t.ok(e.spriteMosaicItem)&&e.spriteMosaicItem){var e=e.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,
g=e.width/e.height*this._scaleX,l=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,p=this._size,q=p*g,w=this.xOffset,y=this.yOffset;this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var x=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/m.pt2px(this._cimMarkerLayer.frameHeight):1,z=this._outlineWidth*x,B=m.pt2px(this._cimMarkerLayer.referenceSize),A=x=0,O=this._cimMarkerLayer.anchorPoint;O&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?
this._size&&(x=-O.x/(this._size*g),A=O.y/this._size):(x=O.x,A=O.y));this._sizeOutlineWidth=u.i8888to32(Math.round(Math.min(Math.sqrt(128*q),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*z),255)),Math.round(Math.min(Math.sqrt(128*B),255)));this.angle=l;this._bitestAndDistRatio=u.i8888to32(0,0,this._bitSet,Math.round(Math.min(64*f,255)));g=e.rect.x;l=e.rect.y;z=g+e.rect.width;B=l+e.rect.height;this._texUpperLeft=u.i1616to32(g,l);this._texUpperRight=u.i1616to32(z,
l);this._texBottomLeft=u.i1616to32(g,B);this._texBottomRight=u.i1616to32(z,B);g=v.MarkerMaterialKey.load(this._materialKey);g.sdf=e.sdf;g.pattern=!0;g.textureBinding=e.textureBinding;this._materialKey=g.data;this._anchorX=.5-((.5+x)*e.width+1)/e.rect.width;this._anchorY=.5-((.5+A)*e.height+1)/e.rect.height;q=q*f*this._scaleFactor;p=p*f*this._scaleFactor;q*=e.rect.width/e.width;p*=e.rect.height/e.height;this._computedWidth=q;this._computedHeight=p;this._applyTransformation(r,n);this.xOffset=w;this.yOffset=
y}else k.error(new h("mapview-cim","Encountered an error when binding feature"))};return c}(l.default(y.default));d.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports tslib ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(a,d,e,h,f,b,m,p,c,g,u){Object.defineProperty(d,"__esModule",
{value:!0});a=function(a){function c(c,d){var e=a.call(this,d)||this;e._horizontalAlignment="center";e._verticalAlignment="middle";e._textToGlyphs=new Map;var f=d.scaleFactor||1;e._cimTextLayer=d;p.isFunction(d.color)?e._dynamicPropertyMap.set("_color",function(a,c,e){return b.premultiplyAlphaRGBA(d.color(a,c,e))}):e._color=b.premultiplyAlphaRGBA(d.color);p.isFunction(d.color)?e._dynamicPropertyMap.set("_haloColor",function(a,c,e){return b.premultiplyAlphaRGBA(d.outlineColor(a,c,e))}):e._haloColor=
b.premultiplyAlphaRGBA(d.outlineColor);var g;p.isFunction(d.size)||(g=Math.min(Math.round(h.pt2px(d.size*d.sizeRatio)),127));e._dynamicPropertyMap.set("_size",function(a,b,c){return p.isFunction(d.size)?Math.min(Math.round(h.pt2px(d.size(a,b,c)*d.sizeRatio)),127):g});p.isFunction(d.outlineSize)?e._dynamicPropertyMap.set("_haloSize",function(a,b,c){return Math.min(Math.floor(5*h.pt2px(d.outlineSize(a,b,c)*d.sizeRatio)),127)}):e._haloSize=Math.min(Math.floor(5*h.pt2px(d.outlineSize*d.sizeRatio)),127);
var k;p.isFunction(d.offsetX)||(k=Math.round(h.pt2px(d.offsetX*d.sizeRatio)));e._dynamicPropertyMap.set("_xOffset",function(a,b,c){return p.isFunction(d.offsetX)?Math.round(h.pt2px(d.offsetX(a,b,c)*d.sizeRatio)):k});var l;p.isFunction(d.offsetY)||(l=Math.round(h.pt2px(d.offsetY*d.sizeRatio)));e._dynamicPropertyMap.set("_yOffset",function(a,b,c){return p.isFunction(d.offsetY)?Math.round(h.pt2px(d.offsetY(a,b,c)*d.sizeRatio)):l});p.isFunction(d.angle)?e._dynamicPropertyMap.set("_angle",d.angle):e._angle=
d.angle;p.isFunction(d.horizontalAlignment)?e._dynamicPropertyMap.set("_horizontalAlignment",d.horizontalAlignment):e._horizontalAlignment=d.horizontalAlignment;p.isFunction(d.verticalAlignment)?e._dynamicPropertyMap.set("_verticalAlignment",d.verticalAlignment):e._verticalAlignment=d.verticalAlignment;e._scaleFactor=f;p.isFunction(d.text)?e._dynamicPropertyMap.set("_text",d.text):e._text=d.text;f=Math.min(Math.round(h.pt2px(d.referenceSize*d.sizeRatio)),127);e._referenceSize=Math.round(Math.sqrt(256*
f));e._materialKey=m.createMaterialKey(e.geometryType,c,!1);c=m.TextMaterialKey.load(e._materialKey);c.sdf=!0;e._bitset=(1===d.alignment?1:0)|(d.colorLocked?1:0)<<1;e._materialKey=c.data;e._decoration="none";e._lineHeight=1;e._lineWidth=512;e._textPlacement=d.markerPlacement;e.effects=d.effects;e._isCIM=!0;return e}e.__extends(c,a);c.fromCIMText=function(a,b){return new c(a,b)};c.prototype.analyze=function(a,b,c,d){return e.__awaiter(this,void 0,void 0,function(){var f,g;return e.__generator(this,
function(e){switch(e.label){case 0:return e=this._cimTextLayer,f="string"===typeof e.text?e.text:"function"===typeof e.text?e.text(b,c,d):"",[4,a.getMosaicItem(this._cimTextLayer.cim,!1,u.codepoints(f))];case 1:return g=e.sent(),this._textToGlyphs.set(f,g.glyphMosaicItems),[2,g]}})})};c.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,f){d[f]=e(a,b,c)});if(this._text&&0!==this._text.length){this._size*=this._scaleFactor;this._scale=this._size/24;this._xOffset*=
this._scaleFactor;this._yOffset*=this._scaleFactor;this._xAlignD=f.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=f.getYAnchorDirection(this._verticalAlignment||"baseline");var e=this._textToGlyphs.get(this._text);this.bindTextInfo(e,!1)}else this._shapingInfo=null};return c}(c.default(g.default));d.default=a})},"esri/views/2d/layers/features/textUtils":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});d.codepoints=function(a){for(var d=
Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return d}})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports tslib ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./WGLBaseFillTemplate ./WGLMeshTemplate".split(" "),function(a,d,e,h,f,b,m,p,c,g,u,v){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function d(b,c,d,e,f,
h,l,m,p,u){var k=a.call(this)||this;k.effects=u;b=g.FillMaterialKey.load(g.createMaterialKey(k.geometryType,b,!1));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);k.fillColor=d;k.tl=e;k.br=f;k.aux1=h;k.aux2=l;k.aux3=m;k.isBFS=p;k._materialKey=b.data;return k}e.__extends(d,a);d.fromCIMFill=function(a,e,g,l){void 0===l&&(l=!1);var k=e.color,k=k&&b.premultiplyAlphaRGBA(k)||0;if(!g)return g=c.i8888to32(0,0,0,e.colorLocked?1:0),new d(a,null,k,0,0,0,0,g,l,e.effects);var n=g.rect,m=g.width,
r=g.height,t=n.x+1,u=n.y+1,x=t+m,v=u+r,n=h.nextHighestPowerOfTwo(f.pt2px(e.height||0));255<n?n=255:0>=n&&(n=h.nextHighestPowerOfTwo(v-u));r=h.nextHighestPowerOfTwo(f.pt2px(e.height/r*m||0));255<r?r=255:0>=r&&(r=h.nextHighestPowerOfTwo(x-t));var y=f.pt2px(e.offsetX||0)+128;255<y&&(y=255);var J=f.pt2px(-e.offsetY||0)+128;255<J&&(J=255);m=e.scaleX||1;t=c.i1616to32(t,u);x=c.i1616to32(x,v);n=c.i8888to32(r,n,y,J);v=c.i1616to32(128*m,128);m=c.i8888to32(0,0,p.degToByte(e.angle),e.colorLocked?1:0);return new d(a,
g,k,t,x,n,v,m,l,e.effects)};d.fromSimpleFill=function(a,e,f,g){void 0===g&&(g=!1);var k=e.color;e=k&&"none"!==e.style&&b.premultiplyAlphaRGBA(k)||0;k=c.i8888to32(0,0,0,g?255:0);if(!f)return new d(a,null,e,0,0,0,0,k,g,null);var l=f.rect,n=l.x+1,m=l.y+1,p=l.x+1+f.width,r=l.y+1+f.height,l=c.i1616to32(n,m),t=c.i1616to32(p,r),n=c.i8888to32(h.nextHighestPowerOfTwo(p-n),h.nextHighestPowerOfTwo(r-m),0,0),m=c.i1616to32(128,128);return new d(a,f,e,l,t,n,m,k,g,null)};d.fromPictureFill=function(a,b,e,g){void 0===
g&&(g=!1);var k=m.PICTURE_FILL_COLOR,l=e.rect,n=l.x+1,p=l.y+1,l=n+e.width,r=p+e.height,n=c.i1616to32(n,p),l=c.i1616to32(l,r),r=h.nextHighestPowerOfTwo(f.pt2px(b.width));255<r&&(r=255);p=h.nextHighestPowerOfTwo(f.pt2px(b.height));255<p&&(p=255);var t=f.pt2px(b.xoffset)+128;255<t&&(t=255);var u=f.pt2px(-b.yoffset)+128;255<u&&(u=255);r=c.i8888to32(r,p,t,u);b=c.i1616to32(128*b.xscale,128*b.yscale);p=c.i8888to32(0,0,0,g?255:0);return new d(a,e,k,n,l,r,b,p,g,null)};return d}(u.default(v.default));d.default=
a})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(a,d,e){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;return this._resolver?this._resolver.promise.then(function(){return a.acquire()}):(this._resolver=e.createResolver(),e.resolve())};a.prototype.release=function(){var a=this._resolver;
this._resolver=null;a.resolve()};return a}();d.default=a;d.withLock=function(a,d,b){return a.acquire().then(function(){return d(b)}).then(function(){return a.release()}).catch(function(b){a.release();throw b;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),function(a,d,e,h,
f,b,m,p,c,g,u,v,x){Object.defineProperty(d,"__esModule",{value:!0});var l=new e.default,y=new e.default;a=function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){l.reset();for(var c=f.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),d=0;d<c.length;d++)for(var e=c[d],g=0,p=e;g<p.length;g++){var t=p[g];t&&l.needMore(t.geometryType,t.meshData?t.meshData.vertexCount:t.vertexCount,t.meshData?t.meshData.indexData.length:t.indexCount)}g=c.length;
d=new h;for(p=0;p<g;++p){d.geometries[p].indexBuffer=new Uint32Array(Math.round(1.15*l.indicesFor(p)));var t=[],u;for(u in this.tileBufferData.geometries[p].vertexBuffer)t.push(this.tileBufferData.geometries[p].vertexBuffer[u].stride);var t=a._computeVertexAlignment(t),e=Math.round(1.15*l.verticesFor(p)),t=a._align(e,t),x;for(x in this.tileBufferData.geometries[p].vertexBuffer)e=this.tileBufferData.geometries[p].vertexBuffer[x].stride,d.geometries[p].vertexBuffer[x]={stride:e,data:m.allocateTypedArrayBuffer(t,
e)}}y.reset();this.tileDisplayData.displayList.clear();for(p=0;p<g;++p){e=c[p];u=0;for(x=e;u<x.length;u++){t=x[u];if(t.meshData)t.writeMeshDataToBuffers(y.verticesFor(p),d.geometries[p].vertexBuffer,y.indicesFor(p),d.geometries[p].indexBuffer),t.meshData=null;else{var v=this.tileBufferData.geometries[p].vertexBuffer,E=this.tileBufferData.geometries[p].indexBuffer,H=d.geometries[p].vertexBuffer,J=d.geometries[p].indexBuffer,F=y.verticesFor(p),C=y.indicesFor(p);b.copyMeshData(F,C,H,J,t,v,E);t.vertexFrom=
F;t.indexFrom=C}y.needMore(p,t.vertexCount,t.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(e)}if(this.tileDisplayData.displayList.unified)for(c=0,g=this.tileDisplayData.displayObjects;c<g.length;c++)this.tileDisplayData.displayList.addToList(g[c].displayRecords);this.tileBufferData=d};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=
c.vertexBuffer[d].stride}return a};a.prototype.clone=function(){var b=new a;b.tileBufferData=this.tileBufferData.clone();b.tileDisplayData=this.tileDisplayData.clone();return b};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new x.default(Int32Array,
this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};a.decode=function(b){var c=v.deserializeList(new u.default(b.displayObjects),p),d={},e;for(e in b.vertexBuffersMap)d[e]=g.VertexBuffers.decode(b.vertexBuffersMap[e]);return a.fromMeshData({displayObjects:c,vertexBuffersMap:d})};a.fromMeshData=function(b){var c=new a,d=new f.default,e=new h;d.displayObjects=b.displayObjects;for(var g in b.vertexBuffersMap){var l=b.vertexBuffersMap[g];e.geometries[g].indexBuffer=
l.indexBuffer;e.geometries[g].vertexBuffer=l.namedBuffers}c.tileDisplayData=d;c.tileBufferData=e;return c};a.bind=function(b,c){var d=new a;d.tileDisplayData=b;d.tileBufferData=c;return d};a.create=function(b,d){var e=new a;e.tileDisplayData=new f.default;e.tileDisplayData.displayObjects=b;for(var g=[0,0,0,0,0],l=[0,0,0,0,0],n=[[],[],[],[],[]],p=0;p<b.length;p++)for(var r=0,t=b[p].displayRecords;r<t.length;r++){var u=t[r];n[u.geometryType].push(u);g[u.geometryType]+=u.meshData.vertexCount;l[u.geometryType]+=
u.meshData.indexData.length}b=new h;d=[d.fill||{},d.line||{},d.icon||{},d.text||{},d.label||{}];for(p=0;5>p;p++){var r=new Uint32Array(l[p]),t=d[p],u=g[p],x={},v=void 0;for(v in t){var y={data:m.allocateTypedArrayBuffer(u,t[v]),stride:t[v]};x[v]=y}t=x;c.writeAllMeshDataToBuffers(n[p],t,r);b.geometries[p]={indexBuffer:r,vertexBuffer:t}}e.tileBufferData=b;return e};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=
a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return a}();d.TileData=a})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._byGeometryType=null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?
this._byGeometryType[a].vertices:0};a.prototype.indicesFor=function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,d,b){if(d||b)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=d,a.indices+=b};return a}();d.default=a})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports",
"./Utils"],function(a,d,e){return function(){function a(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}a.prototype.clone=function(){for(var d=new a,b=0;b<this.geometries.length;b++){var e=this.geometries[b],h=d.geometries[b];h.indexBuffer=e.indexBuffer.slice();h.vertexBuffer={};for(var c in e.vertexBuffer){var g=e.vertexBuffer[c],u=g.stride;
h.vertexBuffer[c]={data:g.data.slice(),stride:u}}}return d};a.deserialize=function(d){for(var b=new a,f=0;5>f;++f){b.geometries[f].indexBuffer=new Uint32Array(d.geometries[f].indexBuffer);b.geometries[f].vertexBuffer={};for(var h in d.geometries[f].vertexBuffer)b.geometries[f].vertexBuffer[h]={data:e.allocateTypedArrayBufferwithData(d.geometries[f].vertexBuffer[h].data,d.geometries[f].vertexBuffer[h].stride),stride:d.geometries[f].vertexBuffer[h].stride}}return b};a.prototype.serialize=function(){for(var a=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},b=0;5>b;++b)for(var d in this.geometries[b].vertexBuffer)a.geometries[b].vertexBuffer[d]={data:this.geometries[b].vertexBuffer[d].data.buffer,stride:this.geometries[b].vertexBuffer[d].stride};
return a};a.prototype.getBuffers=function(){for(var a=[],b=0;5>b;++b){a.push(this.geometries[b].indexBuffer.buffer);for(var d in this.geometries[b].vertexBuffer)a.push(this.geometries[b].vertexBuffer[d].data.buffer)}return a};return a}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(a,d,e,h,f){function b(a){for(var b=[[],[],[],[],[]],c=0;c<a.length;c++)for(var d=0,e=a[c].displayRecords;d<
e.length;d++){var f=e[d];b[f.geometryType].push(f)}return b}Object.defineProperty(d,"__esModule",{value:!0});d.groupRecordsByGeometryType=b;a=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var d=b[a];this._displayObjectRegistry.set(d.id,d)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new e(a);if(a){a=0;for(var c=this.displayObjects;a<c.length;a++)for(var d=0,f=c[a].displayRecords;d<f.length;d++)this._displayList.addToList(f[d])}else for(a=b(this.displayObjects),c=a.length,d=0;d<c;++d)this._displayList.addToList(a[d])};a.prototype.clone=function(){var b=new a;this.displayObjects&&(b.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return b};a.prototype.serialize=function(a){f.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),d=new Map,e=0;e<b.length;++e){var f=h.deserialize(a);b[e]=f;d.set(f.id,f)}this.displayObjects=b;this._displayList=null;this._displayObjectRegistry=d};a.deserialize=function(b){var c=new a;c._deserializeObjects(b);return c};return a}();d.default=a})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"tslib","../../../../core/Logger","./enums"],function(a,d,e,h,f){function b(a,b,c){for(var d=[],f=3;f<arguments.length;f++)d[f-3]=arguments[f];b<a.length?a.splice.apply(a,e.__spreadArrays([b,c],d)):a.push.apply(a,d)}var m=h.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");a=new Map;a.set(f.WGLDrawPhase.MAP,[f.WGLGeometryType.FILL,f.WGLGeometryType.LINE,f.WGLGeometryType.MARKER,f.WGLGeometryType.TEXT]);a.set(f.WGLDrawPhase.LABEL,[f.WGLGeometryType.LABEL]);a.set(f.WGLDrawPhase.LABEL_ALPHA,[f.WGLGeometryType.LABEL]);
a=function(){function a(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b,c){if(this.unified)for(var d=0,e=this.symbolLevels;d<e.length;d++)for(var f=0,g=e[d].zLevels;f<g.length;f++){var h=g[f].geometryDPInfo,l;for(l in h)if(h[l])for(var m=0,p=h[l];m<p.length;m++){var u=p[m],x=a.painter.getGeometryBrush(u.geometryType),v=b.getGeometry(u.geometryType);x.prepareState(a,b);x.drawGeometry(a,b,u,v,c)}}};Object.defineProperty(a.prototype,"empty",{get:function(){return!this.symbolLevels||
0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<d.length;c++)for(var e=0,f=d[c].zLevels;e<f.length;e++){var g=
f[e].geometryDPInfo,h=this.getDPInfoType(a);if(g[h])for(var l=0,g=g[h];l<g.length;l++)b(g[l])}};a.prototype.clone=function(){for(var b=new a(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)b.symbolLevels.push(d[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,e=0;e<c;++e){var f=b[e];if(f.geometryType===a.geometryType&&d>f.indexFrom&&d<=f.indexFrom+f.indexCount)return d<f.indexFrom+
f.indexCount&&(a=new p,a.geometryType=f.geometryType,a.materialKey=f.materialKey,a.indexFrom=d,a.indexCount=f.indexFrom+f.indexCount-d,b.splice(e+1,0,a),f.indexCount=d-f.indexFrom),e}};a.prototype._addToList=function(a,c){var d=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);c=null!=c?c:d.length-1;var e=0<=c&&c<d.length?d[c]:null;null===e||e.materialKey!==a.materialKey||e.indexFrom+e.indexCount!==a.indexFrom||this.unified&&e.geometryType!==a.geometryType?(e=new p,e.indexFrom=a.indexFrom,
e.indexCount=a.indexCount,e.materialKey=a.materialKey,e.geometryType=a.geometryType,b(d,c+1,0,e)):e.indexCount+=a.indexCount};a.prototype._removeFromList=function(a){for(var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),d=c.length,e=void 0,f=0;f<d;++f){var g=c[f];if(a.indexFrom+a.indexCount>g.indexFrom&&a.indexFrom<g.indexFrom+g.indexCount&&(!this.unified||g.geometryType===a.geometryType)){e=f;break}}if(void 0!==e){g=c[e];if(a.indexFrom===g.indexFrom)return g.indexCount-=a.indexCount,
g.indexFrom+=a.indexCount,0===g.indexCount&&b(c,e,1),e-1;if(a.indexFrom+a.indexCount===g.indexFrom+g.indexCount)return g.indexCount-=a.indexCount,0===g.indexCount?(b(c,e,1),e-1):e;var d=g.indexFrom,f=a.indexFrom-g.indexFrom,h=a.indexCount;a=g.indexFrom+g.indexCount-(a.indexFrom+a.indexCount);g.indexCount=f;var m=new p;m.geometryType=g.geometryType;m.materialKey=g.materialKey;m.indexFrom=d+f+h;m.indexCount=a;b(c,e+1,0,m);return e}return null};a.prototype._getDisplayList=function(a,b,d){for(var e,h=
this.symbolLevels.length,l=0;l<h;l++)if(this.symbolLevels[l].symbolLevel===a){e=this.symbolLevels[l];break}e||(e=new u,e.symbolLevel=a,this.symbolLevels.push(e));var k;a=e.zLevels.length;for(h=0;h<a;h++)if(e.zLevels[h].zLevel===b){k=e.zLevels[h];break}k||(k=new g,k.geometryDPInfo=new c,k.zLevel=b,e.zLevels.push(k));var m;if(this.unified)k.geometryDPInfo.unified||(k.geometryDPInfo.unified=[]),m=k.geometryDPInfo.unified;else switch(d){case f.WGLGeometryType.FILL:k.geometryDPInfo.fill||(k.geometryDPInfo.fill=
[]);m=k.geometryDPInfo.fill;break;case f.WGLGeometryType.LINE:k.geometryDPInfo.line||(k.geometryDPInfo.line=[]);m=k.geometryDPInfo.line;break;case f.WGLGeometryType.MARKER:k.geometryDPInfo.marker||(k.geometryDPInfo.marker=[]);m=k.geometryDPInfo.marker;break;case f.WGLGeometryType.TEXT:k.geometryDPInfo.text||(k.geometryDPInfo.text=[]);m=k.geometryDPInfo.text;break;case f.WGLGeometryType.LABEL:k.geometryDPInfo.label||(k.geometryDPInfo.label=[]);m=k.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+
d+"'.")}return m};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case f.WGLGeometryType.FILL:return"fill";case f.WGLGeometryType.LINE:return"line";case f.WGLGeometryType.MARKER:return"marker";case f.WGLGeometryType.TEXT:return"text";case f.WGLGeometryType.LABEL:return"label";default:m.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var p=function(){function a(){this.materialKey=null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=
new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),c=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});
b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),g=function(){function a(){this.geometryDPInfo=new c}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),u=function(){function a(){this.zLevels=[]}a.prototype.clone=function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());
return b};return a}();return a})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();d.default=a})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),
function(a,d,e,h,f,b,m,p,c,g,u){function v(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function x(a,b,c){void 0===c&&(c=0);if(f.isNone(b))a[c+0]=0,a[c+1]=0,a[c+2]=0,a[c+3]=0;else{var d=b.g,e=b.b,g=b.a;a[c+0]=b.r*g/255;a[c+1]=d*g/255;a[c+2]=e*g/255;a[c+3]=g}}Object.defineProperty(d,"__esModule",{value:!0});var l=function(a,b,c){for(var d=c*=16,
e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},y=p.mat4f32.create();a=function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*g.MAX_FILTERS);this.insideOpacity=1;
this.outsideEffect=new Float32Array(16*g.MAX_FILTERS);this.outsideOpacity=1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<g.MAX_FILTERS;a++)l(this.insideEffect,y,a),l(this.outsideEffect,y,a)}Object.defineProperty(a.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;
return this._buf0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});a.prototype.getSizeVVFieldStops=function(a){var b=this._vvSizeFieldStops;switch(b.type){case "static":return b;case "level-dependent":return f.unwrapOr(b.levels[a],function(){var c=Infinity,d=0,e;for(e in b.levels){var g=parseFloat(e),h=Math.abs(a-g);h<c&&(c=h,d=g)}if(Infinity===
c)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};c=Math.pow(2,(a-d)/2);d=f.unwrap(b.levels[d]);e=new Float32Array(d.values);e[2]*=c;e[3]*=c;return{sizes:f.unwrap(d.sizes),values:e}})}};Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.update=function(a){f.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,a)};a.prototype.setInfo=function(a,
b,c){var d=this;f.isSome(c)?(c.forEach(function(a,b){return d._updateEffects(b,a)}),this.effectCount=c.length):this.effectCount=0;this._vvInfo=b;switch(a.type){case "dot-density":this._updateDotDensityInfo(a)}};a.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:h("esri-webgl-texture-float")}};a.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?
1:0)<<1|this.effectCount<<2};a.prototype._updateEffects=function(a,b){a+=1;if(f.isSome(b)&&b.filter&&b.filter.enabled){this.outsideLabelsVisible=b.excludedLabelsVisible;var c=b.parsedIncludedEffect;b=b.parsedExcludedEffect;f.isSome(c)?(l(this.insideEffect,c.getColorMatrix(),a),this.insideOpacity=c.getOpacity()):(l(this.insideEffect,y,a),this.insideOpacity=1);f.isSome(b)?(l(this.outsideEffect,b.getColorMatrix(),a),this.outsideOpacity=b.getOpacity()):(l(this.outsideEffect,y,a),this.outsideOpacity=1)}else l(this.insideEffect,
y,a),l(this.outsideEffect,y,a),this.outsideOpacity=this.insideOpacity=1};a.prototype._updateVisualVariables=function(a,d){var e=this._vvMaterialParameters;e.vvOpacityEnabled=!1;e.vvSizeEnabled=!1;e.vvColorEnabled=!1;e.vvRotationEnabled=!1;if(a){var f=a.size;if(f){e.vvSizeEnabled=!0;if(f.minMaxValue){var g=f.minMaxValue,h=void 0,l=void 0;u.isDefined(g.minSize)&&u.isDefined(g.maxSize)&&(u.isNumber(g.minSize)&&u.isNumber(g.maxSize)?(h=b.pt2px(g.minSize),l=b.pt2px(g.maxSize)):(l=d.scale,h=b.pt2px(v(l,
g.minSize.stops)),l=b.pt2px(v(l,g.maxSize.stops))));this.vvSizeMinMaxValue.set([g.minDataValue,g.maxDataValue,h,l])}f.scaleStops&&(this.vvSizeScaleStopsValue=b.pt2px(v(d.scale,f.scaleStops.stops)));f.unitValue&&(this.vvSizeUnitValueToPixelsRatio=m.getMetersPerUnitForSR(d.spatialReference)/c.meterIn[f.unitValue.unit]/d.resolution);f.fieldStops&&(this._vvSizeFieldStops=f.fieldStops)}if(d=a.color)e.vvColorEnabled=!0,this.vvColorValues.set(d.values),this.vvColors.set(d.colors);if(d=a.opacity)e.vvOpacityEnabled=
!0,this.vvOpacityValues.set(d.values),this.vvOpacities.set(d.opacities);if(a=a.rotation)e.vvRotationEnabled=!0,e.vvRotationType=a.type}};a.prototype._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var c=0;c<g.DOT_DENSITY_MAX_FIELDS;c++){var d=c>=b.length?new e([0,0,0,0]):b[c].color;x(this.ddColors,d,4*c)}for(c=0;8>c;c++)this.ddActiveDots[c]=c<a.attributes.length?
1:0;x(this.ddBackgroundColor,a.backgroundColor)};return a}();d.WGLRendererInfo=a})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./definitions ./DirtyMap ./DisplayRecordStore ./Fader ./TiledDisplayObject ./WGLBuffers".split(" "),function(a,d,e,h,f,b,m,p,c,g,u,v,x){Object.defineProperty(d,"__esModule",{value:!0});
var l=new Set;a=function(a){function d(b,d,e){void 0===e&&(e=!1);b=a.call(this,b,d,[p.TILE_SIZE,p.TILE_SIZE])||this;b._data=null;b._displayList=null;b._wglBuffers=null;b._dirtyMap=new c.default;b._labelIndex=null;b._dirty=!0;b.fader=new u.default;b._ensureCorrectZOrder=e;b.transforms.labelMat2d=f.mat2df32.create();return b}e.__extends(d,a);d.prototype.destroy=function(){this.clear()};Object.defineProperty(d.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"labelIndex",{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});d.prototype.getGeometry=function(a){return this._wglBuffers&&
this._wglBuffers.has(a)?this._wglBuffers.get(a):null};d.prototype.getDisplayList=function(){return this._data&&this._displayList};Object.defineProperty(d.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});d.prototype.setTransform=function(c,d){a.prototype.setTransform.call(this,c,d);var e=this.transforms.labelMat2d;d=c.getScreenTransform(e,d);var f=m.vec2f32.create();b.vec2.transformMat2d(f,this.coords,d);h.mat2d.identity(e);h.mat2d.translate(e,e,f);h.mat2d.multiply(e,
c.viewMat2d,e)};d.prototype.setData=function(a,b,d){var e=a.addOrUpdate,f=a.remove;!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:f},b,d):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new c.default,this._dispRecStore=g.default.fromTileData(e,this._dirtyMap),this._data=e,this._readyTileIfNoLabels(b,d),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):
(this.clear(),this.ready());this.emit("change")};d.prototype.commitChanges=function(){this.fader.step()||this.requestRender();this._wglBuffers||(this._wglBuffers=new x.default(this.stage.context));this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap);this._displayList=this._data.tileDisplayData.displayList.clone();this._dirtyMap.markAllClean()};d.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=
null)};d.prototype._readyTileIfNoLabels=function(a,b){a&&this._rebuildLabelIndex();this.isDirty=a&&b?!0:!1};d.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=g.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,c);this.requestRender()};d.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<
d.length;c++)this._insertIntoLabelIndex(d[c])};d.prototype._insertIntoLabelIndex=function(a){0>a.xBucket||0>a.yBucket||3<a.yBucket||3<a.xBucket||this.labelIndex[a.yBucket][a.xBucket].push(a)};d.prototype._initLabelIndex=function(){for(var a=[],b=0;b<p.TILE_SIZE/p.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<p.TILE_SIZE/p.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};d.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||
[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var f=c[e];null!=f.insertAfter&&d.push(f.id)}for(f=0;f<d.length;f++){var g=d[f];if(e=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var h=0,m=e.displayRecords;h<m.length;h++)this._dispRecStore.delete(m[h]);this._data.tileDisplayData.displayObjectRegistry.delete(g);e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,
1)}}for(d=0;d<c.length;d++){f=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(f.id);g=void 0;if(e){h=e.displayRecords;e.set(f);e.displayRecords=h;h=e.displayRecords.length;for(m=0;m<h;++m){var p=e.displayRecords[m],n=f.displayRecords[m];if(m>=f.displayRecords.length||p.geometryType!==n.geometryType||p.symbolLevel!==n.symbolLevel||p.zOrder!==n.zOrder||p.materialKey!==n.materialKey)this._dispRecStore.delete(e.displayRecords[m]),m<f.displayRecords.length&&(e.displayRecords[m]=void 0)}e.displayRecords.length=
f.displayRecords.length;e.metrics=f.metrics}else if(e=f.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,e),m=void 0,p=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(g={},0<=e.insertAfter?(h=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(m=p.indexOf(h)+1,m<p.length?p.splice(m,0,e):(p.push(e),m=p.length)):(p.push(e),m=p.length):(p.unshift(e),m=0)):(p.push(e),m=p.length),g){n=void 0;if(this._data.tileDisplayData.displayList.unified)n=
0<f.displayRecords.length?1:0;else{l.clear();for(var n=0,u=f.displayRecords;n<u.length;n++)h=this._data.tileDisplayData.displayList.getDPInfoType(u[n].geometryType),l.add(h);n=l.size}u=0;for(--m;0<=m&&u<n;--m)for(var t=p[m].displayRecords.length-1;0<=t&&u<n;--t){var v=p[m].displayRecords[t],h=this._data.tileDisplayData.displayList.getDPInfoType(v.geometryType);g[h]||(g[h]=v,++u)}}u=f.displayRecords.length;for(m=0;m<u;++m){n=f.displayRecords[m];(p=e.displayRecords[m])?(p.meshData=n.meshData,p.materialKey=
n.materialKey):(p=n.copy(),p.vertexFrom=void 0,p.indexFrom=void 0,e.displayRecords[m]=p);var t=n.geometryType,h=this._data.tileDisplayData.displayList.getDPInfoType(t),v=a.addOrUpdate.tileBufferData.geometries[t],t=v.vertexBuffer,v=v.indexBuffer,x=void 0;g&&(x=g[h]?this._data.tileDisplayData.displayList.splitAfter(g[h]):-1);b=this._dispRecStore.setMeshData(p,n,t,v,x)&&b;g&&null!=p.indexFrom&&null!=p.indexFrom&&(g[h]=p)}}return b};return d}(v.TiledDisplayObject);d.WGLTile=a})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require",
"exports","./Utils"],function(a,d,e){function h(a,b,d){if(!a.allDirty)if(null!=a.from&&null!=a.count){var e=Math.min(a.from,b);b=Math.max(a.from+a.count,b+d)-e;a.from=e;a.count=b}else a.from=b,a.count=d}Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){this._dirties=e.createGeometryData(function(){return{indices:{from:null,count:null,allDirty:!1}}},function(){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.hasDirty=function(){for(var a=0,d=this._dirties;a<
d.length;a++){var e=d[a];if(null!==e.data.indices.count||e.data.indices.allDirty)return!0}return!1};a.prototype.markAllClean=function(){for(var a=0,d=this._dirties;a<d.length;a++){var e=d[a];e.data.indices.from=null;e.data.indices.count=null;e.data.indices.allDirty=!1;for(var c in e.buffers)e.buffers[c].data.vertices.from=null,e.buffers[c].data.vertices.count=null,e.buffers[c].data.vertices.allDirty=!1}};a.prototype.markAllDirty=function(){for(var a=0,d=this._dirties;a<d.length;a++){var e=d[a];e.data.indices.allDirty=
!0;for(var c in e.buffers)e.buffers[c].data.vertices.allDirty=!0}};a.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var d=this._dirties[b],c={},e;for(e in d.buffers){var f=d.buffers[e].data.vertices;if(f.allDirty||null!=f.from&&null!=f.count&&0<f.count)c[e]=f}d=d.data.indices;f=void 0;f=d.allDirty||null!=d.from&&null!=d.count&&0<d.count?{indices:d,vertices:c}:{indices:null,vertices:c};(f.indices||0<Object.keys(f).length)&&a(f,b)}};a.prototype.markDirtyIndices=function(a,d,e){h(this._dirties[a].data.indices,
d,e)};a.prototype.markDirtyVertices=function(a,d,e,c){h(this._dirties[a].buffers[d].data.vertices,e,c)};return a}();d.default=a})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(a,d,e,h,f){function b(a){a=a.getStrides();for(var b={},d=0;d<a.length;d++)b[m[d]]=a[d];return b}Object.defineProperty(d,"__esModule",{value:!0});var m=["FILL","LINE","MARKER","TEXT","LABEL"];a=function(){function a(a,b,d,e){this._strides=
a;this._displayList=b;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=d;for(var c in a){this._freeListsAndStorage[c]={vtxFreeList:e?new h.FreeList(e):null,idxFreeList:e?new h.FreeList(e):null,vertexBuffers:{},indexBuffer:e?new Uint32Array(e):null};for(var g in a[c])this._freeListsAndStorage[c].vertexBuffers[g]={data:e?f.allocateTypedArrayBuffer(e,a[c][g]):null,stride:a[c][g]}}}a.fromTileData=function(c,d){var e=b(c),g=[0,0,0,0,0],p=[0,0,0,0,0],l=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){l.push(a)});
for(var y=0;y<l.length;y++)for(var t=0,n=l[y].displayRecords;t<n.length;t++){var r=n[t];g[r.geometryType]=Math.max(g[r.geometryType],r.vertexFrom+r.vertexCount);p[r.geometryType]=Math.max(p[r.geometryType],r.indexFrom+r.indexCount)}d=new a(e,c.tileDisplayData.displayList,d,null);for(e=0;e<c.tileBufferData.geometries.length;++e){var y=g[e],n=p[e],r=c.tileBufferData.geometries[e],t=d._storageFor(m[e]),k=c.tileBufferData.geometries[e].indexBuffer;t.indexBuffer=k;t.idxFreeList=new h.FreeList(k.length);
t.idxFreeList.allocate(n);var n=void 0,w;for(w in r.vertexBuffer)r=c.tileBufferData.geometries[e].vertexBuffer[w],t.vertexBuffers[w].data=r.data,t.vertexBuffers[w].stride=r.stride,k=f.strideToPackingFactor(r.stride),r=r.data.length*k/r.stride,n||(n=r);t.vtxFreeList=new h.FreeList(n);t.vtxFreeList.allocate(y)}return d};a.prototype.delete=function(a){var b=m[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);
a.vertexFrom=void 0;a.indexFrom=void 0};a.prototype.setMeshData=function(a,b,d,e,h){var c=m[a.geometryType];a.meshData=null;var g=void 0,p=void 0;void 0===a.vertexFrom?(p=b.vertexCount,g=this._allocateVertices(c,p)):b.vertexCount>a.vertexCount?(this._freeVertices(c,a.vertexFrom,a.vertexCount),p=b.vertexCount,g=this._allocateVertices(c,p)):b.vertexCount===a.vertexCount?(g=a.vertexFrom,p=a.vertexCount):(this._freeVertices(c,a.vertexFrom+b.vertexCount,a.vertexCount-b.vertexCount),g=a.vertexFrom,p=b.vertexCount);
var n=!0,r=void 0,k=void 0,u=void 0;void 0===a.indexFrom?(r=h,u=b.indexCount,k=this._allocateIndices(c,u)):b.indexCount>a.indexCount?(r=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom,a.indexCount),u=b.indexCount,k=this._allocateIndices(c,u)):b.indexCount===a.indexCount?(n=!1,k=a.indexFrom,u=a.indexCount):(r=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom+b.indexCount,a.indexCount-b.indexCount),k=a.indexFrom,u=b.indexCount);if(-1!==g&&-1!==k){h=this._storageFor(c);
f.copyMeshData(g,k,h.vertexBuffers,h.indexBuffer,b,d,e);a.vertexFrom=g;a.indexFrom=k;a.vertexCount=b.vertexCount;a.indexCount=b.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var q in d)this._dirtyMap.markDirtyVertices(a.geometryType,q,a.vertexFrom,a.vertexCount)}n&&this._displayList.addToList(a,r);return!0}-1!==g&&this._freeVertices(c,g,p);-1!==k&&this._freeIndices(c,k,u);a.setMeshDataFromBuffers(b,d,e);a.vertexFrom=void 0;a.vertexCount=
0;a.indexFrom=void 0;a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};a.prototype._freeVertices=function(a,b,d){this._storageFor(a).vtxFreeList.free(b,d)};a.prototype._freeIndices=function(a,b,d){this._storageFor(a).idxFreeList.free(b,d)};a.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:
b};a.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=function(a,b){return this._strides[a][b]};return a}();d.default=a})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});var e=function(){function a(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,
configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.rangeResized=function(a,b){if(a===this._largestRange)a.count<b&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var b=this._parent._freeHead,d=null;null!==b;)b.count>=a&&(!d||b.count-a<d.count-a)&&(d=b),b=b.next;return d};a.prototype.findAdjacentRanges=
function(a,b){for(var d=!0,e=!1,c=null,f=this._parent._freeHead;d&&!e;){var h=null!==f?f.from:this._parent._size;a>=(null!==c?c.from+c.count:0)&&a+b<=h?(d=!1,e=!0):null!==f?(c=f,f=f.next):d=!1}return[c,f]};a.prototype._updateLargestRange=function(){for(var a=null,b=this._parent._freeHead;null!==b;){if(!a||b.count>a.count)a=b;b=b.next}this._largestRange=a};return a}();a=function(){function a(a,b){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=
b||new e(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(d){var b=this._bookKeeper.findBestRange(d);if(null===b)return-1;var e=b.from,f=b.count;b.from+=d;b.count-=d;this._bookKeeper.rangeResized(b,e,f);this._allocated+=d;0===b.count&&(d=null!==b.prev?this._freeHead:b.next,a._removeRange(b),this._freeHead=d);return e};a.prototype.free=function(d,b){var e=this._bookKeeper.findAdjacentRanges(d,b),f=e[0],e=e[1];d={from:d,count:b,prev:f,next:e};null!==
f&&(f.next=d);null!==e&&(e.prev=d);this._bookKeeper.rangeCreated(d);this._allocated-=b;if(null!==e&&d.from+d.count===e.from){b=d.from;var c=d.count;a._fuse(d,e);a._removeRange(e);this._bookKeeper.rangeResized(d,b,c);this._bookKeeper.rangeResized(e,void 0,0)}null!==f&&f.from+f.count===d.from&&(b=f.from,c=f.count,a._fuse(f,d),a._removeRange(d),this._bookKeeper.rangeResized(f,b,c),this._bookKeeper.rangeResized(d,void 0,0));this._freeHead=null!==d.prev?this._freeHead:d};Object.defineProperty(a.prototype,
"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,b){a.count+=b.count;a.next=b.next;b.from+=b.count;b.count=0;null!==b.next&&(b.next.prev=a)};return a}();d.FreeList=a})},"esri/views/2d/engine/webgl/Fader":function(){define(["require",
"exports"],function(a,d){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=
this.duration)return!0;this._elapsed+=a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();d.default=a})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","../../../webgl","./Utils"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(a){this.geometryMap=h.createGeometryData(function(){return{indexBuffer:e.BufferObject.createIndex(a,35044),vao:null}},function(b,d){return{vertexBuffer:e.BufferObject.createVertex(a,
h.C_VBO_INFO[d])}})}a.prototype.dispose=function(){for(var a=0;5>a;a++){var d=this.geometryMap[a];if(d){d.data.vao&&d.data.vao.dispose(!1);d.data.indexBuffer&&d.data.indexBuffer.dispose();for(var e in d.buffers)d.buffers[e]&&d.buffers[e].data.vertexBuffer.dispose()}}};a.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var d in b.buffers)a[d]=b.buffers[d].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};a.prototype.has=
function(a){return null!=this.geometryMap[a]};a.prototype.upload=function(a,d){var b=this;d.forEach(function(c,d){b._upload(c,d,a)})};a.prototype._upload=function(a,d,e){a.indices&&(a.indices.allDirty?this._uploadIndices(e,d):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(e,d,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var b in a){var f=a[b];f.allDirty?this._uploadVertices(e,d,b):null!=f.from&&null!=f.count&&this._uploadVertices(e,d,b,f.from,f.count)}}};a.prototype._uploadVertices=
function(a,d,e,c,f){var b=this.geometryMap[d];b&&(d=a.geometries[d].vertexBuffer[e])&&(a=d.stride,d=d.data.buffer,b.buffers[e]&&0<d.byteLength&&(null!=c&&null!=f?b.buffers[e].data.vertexBuffer.setSubData(d,c*a,c*a,(c+f)*a):b.buffers[e].data.vertexBuffer.setData(d)))};a.prototype._uploadIndices=function(a,d,e,c){var b=this.geometryMap[d];b&&(a=a.geometries[d].indexBuffer.buffer,b.data.indexBuffer&&0<a.byteLength&&(null!=e&&null!=c?b.data.indexBuffer.setSubData(a,4*e,4*e,4*(e+c)):b.data.indexBuffer.setData(a)))};
return a}();d.default=a})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(a,d,e,h){Object.defineProperty(d,"__esModule",{value:!0});d.magnifier={name:"magnifier",shaders:{vertexShader:h.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:h.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};d.createMagnifierProgram=function(a){return e.createProgram(a,d.magnifier)}})},"esri/views/2d/engine/BitmapTileContainer":function(){define("require exports tslib ../../../geometry/support/aaBoundingRect ../engine ./BitmapTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(a,d,e,h,f,b,m,p){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e.__extends(c,a);c.prototype.createTile=function(a){var c=this._tileInfoView.getTileBounds(h.create(),a);return new b.BitmapTile(a,c,this._tileInfoView.tileInfo.size)};c.prototype.destroyTile=function(){};c.prototype.prepareRenderPasses=function(b){var c=this,d=b.registerRenderPass({name:"bitmap (tile)",brushes:[f.brushes.Bitmap],target:function(){return c.children.map(function(a){return a.bitmap})},
drawPhase:m.WGLDrawPhase.MAP});return e.__spreadArrays(a.prototype.prepareRenderPasses.call(this,b),[d])};c.prototype.doRender=function(b){this.visible&&b.drawPhase===m.WGLDrawPhase.MAP&&a.prototype.doRender.call(this,b)};return c}(p.default);d.BitmapTileContainer=a})},"esri/views/2d/engine/LevelDependentSizeVariable":function(){define("require exports tslib ../../../core/lang ../../../core/accessorSupport/decorators ../../../renderers/visualVariables/SizeVariable ../../../renderers/visualVariables/support/sizeVariableUtils".split(" "),
function(a,d,e,h,f,b,m){Object.defineProperty(d,"__esModule",{value:!0});a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}e.__extends(b,a);d=b;b.prototype.writeLevels=function(a,b,c){for(var d in a){b.stops=this.levels[d];break}};b.prototype.clone=function(){return new d({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:m.isSizeVariable(this.maxSize)?this.maxSize.clone():
this.maxSize,minDataValue:this.minDataValue,minSize:m.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(function(a){return a.clone()}),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:h.clone(this.levels)})};var d;e.__decorate([f.property()],b.prototype,"levels",void 0);
e.__decorate([f.writer("levels")],b.prototype,"writeLevels",null);return b=d=e.__decorate([f.subclass("esri.views.2d.engine.LevelDependentSizeVariable")],b)}(b);d.LevelDependentSizeVariable=a})},"*noref":1}});
define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/webgl/TileContainer ./engine/DisplayObject ./engine/RasterTile ./engine/RasterTileContainer ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/brushes/BrushBitmap ./engine/webgl/brushes/BrushClip ./engine/webgl/brushes/WGLBrushInfo ./engine/webgl/brushes/WGLBrushStencil ./engine/webgl/brushes/WGLBrushVTLBackground ./engine/webgl/brushes/WGLBrushVTLCircle ./engine/webgl/brushes/WGLBrushVTLFill ./engine/webgl/brushes/WGLBrushVTLLine ./engine/webgl/brushes/WGLBrushVTLSymbol ./engine/webgl/brushes/WGLGeometryBrush ./engine/webgl/brushes/WGLGeometryBrushFill ./engine/webgl/brushes/WGLGeometryBrushLabel ./engine/webgl/brushes/WGLGeometryBrushLine ./engine/webgl/brushes/WGLGeometryBrushMarker ./engine/webgl/brushes/WGLGeometryBrushText ./engine/webgl/brushes/raster/BrushRasterBitmap ./engine/webgl/util/debug ./engine/webgl/mesh/templates/shapingUtils ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util ./engine/webgl/painter/RenderPass ./engine/webgl/TiledDisplayObject ./engine/BitmapTileContainer ./engine/LevelDependentSizeVariable".split(" "),function(a,
d,e,h,f,b,m,p,c,g,u,v,x,l,y,t,n,r,k,w,q,z,B,A,D,E,H,J,F,C,G,I,K,M,N,L,P,O,U,S,T,R,Q,V,Y,Z,W,aa,ba,ca,da,ea,fa,ga,ha,X,ia,ja,ka,la,ma,na,oa){Object.defineProperty(d,"__esModule",{value:!0});d.Bitmap=e.Bitmap;d.BitmapContainer=h.BitmapContainer;d.BitmapTile=f.BitmapTile;d.Container=b.Container;d.TileContainer=m.default;d.DisplayObject=p.DisplayObject;d.RasterTile=c.RasterTile;d.RasterTileContainer=g.RasterTileContainer;d.Stage=u.Stage;d.AttributeStoreView=v.AttributeStoreView;d.CollisionGrid=x.CollisionGrid;
d.CollisionEngine=l.CollisionEngine;d.LayerViewSorter=y.LayerViewSorter;d.Point=t.Point;d.alignmentUtils=n;d.color=r;d.definitions=k;d.enums=w;d.fontUtils=q;d.Utils=z;d.debug=U;d.ShapedGlyph=S.ShapedGlyph;d.shapeGlyphs=S.shapeGlyphs;d.ShapingInfo=S.ShapingInfo;d.TileClipper=T.TileClipper;d.SimpleBuilder=T.SimpleBuilder;d.tessellate=R.tessellate;d.TessellationState=R.TessellationState;d.splitVertex=R.splitVertex;d.createMatcher=Q.createMatcher;d.WGLMeshFactory=V.WGLMeshFactory;d.MeshData=Y.MeshData;
d.WGLTemplateStore=Z.WGLTemplateStore;d.Painter=W.default;d.PainterOptions=W.PainterOptions;d.TileData=aa.TileData;d.bidiText=ba.bidiText;d.FeatureMatcher=ca.FeatureMatcher;d.getVVFlags=da.getVVFlags;d.getTypeOfSizeVisualVariable=ea.getTypeOfSizeVisualVariable;d.WGLRendererInfo=fa.WGLRendererInfo;d.WGLTile=ga.WGLTile;d.BitBlitRenderer=ha.BitBlitRenderer;d.createMagnifierProgram=X.createMagnifierProgram;d.magnifier=X.magnifier;d.CIMSymbolHelper=ia.CIMSymbolHelper;d.Rect=ja.default;d.getLimitCosine=
ka.getLimitCosine;a=d.brushes||(d.brushes={});a.Geometry=I.default;a.Marker=L.default;a.Line=N.default;a.Fill=K.default;a.Text=P.default;a.Label=M.default;a.Clip=A.default;a.Stencil=E.default;a.Bitmap=B.default;a.Raster=O.default;a.TileInfo=D.default;a.VTLBackground=H.WGLBrushVTLBackground;a.VTLFill=F.WGLBrushVTLFill;a.VTLLine=C.WGLBrushVTLLine;a.VTLCircle=J.WGLBrushVTLCircle;a.VTLSymbol=G.WGLBrushVTLSymbol;d.RenderPass=la.default;d.TiledDisplayObject=ma.TiledDisplayObject;d.BitmapTileContainer=na.BitmapTileContainer;
d.LevelDependentSizeVariable=oa.LevelDependentSizeVariable});