// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),function(p,d,r,t,u,q,w,y,z,A){Object.defineProperty(d,"__esModule",{value:!0});d.C_DEG_TO_RAD=Math.PI/180;var B=[1,1,1,1];p=function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a._color=u.vec4f32.create();a._dashArray=t.vec2f32.create();a._programOptions={id:!1,dd:!1,pattern:!1};a._vertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};a._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,
type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return a}r.__extends(l,d);l.prototype.dispose=function(){};l.prototype.drawMany=function(a,e){var g=a.context,f=a.displayLevel,n=a.state,b=a.drawPhase,d=a.styleLayerId,h=a.styleLayer,l=a.painter.getVectorTileProgramCach(),p=h.getPaintValue("line-translate",f),q=h.getPaintValue("line-translate-anchor",
f),c=h.getPaintValue("line-pattern",f),v=void 0!==c,r=1/a.pixelRatio,t=h.getPaintValue("line-blur",f),m=h.hasDataDrivenColor?B:h.getPaintValue("line-color",f),k=h.hasDataDrivenOpacity?1:h.getPaintValue("line-opacity",f),u=h.hasDataDrivenWidth?1:h.getPaintValue("line-width",f),k=k*m[3];this._color[0]=k*m[0];this._color[1]=k*m[1];this._color[2]=k*m[2];this._color[3]=k;var m=h.hasDataDrivenLine,k=b===y.WGLDrawPhase.HITTEST,x;k&&(x=z.u32to4Xu8(d+1));b=this._programOptions;b.id=k;b.dd=m;b.pattern=v;b=
l.getProgram(3,(k?1:0)<<2|(m?1:0)<<1|(v?1:0),b);g.bindProgram(b);b.setUniformMatrix3fv("u_displayViewMat3",n.displayViewMat3);b.setUniformMatrix3fv("u_displayMat3",1===q?n.displayMat3:n.displayViewMat3);b.setUniform2fv("u_lineTranslation",p);b.setUniform1f("u_depth",h.z);b.setUniform1f("u_blur",t);b.setUniform1f("u_antialiasing",r);b.setUniform4fv("u_color",this._color);b.setUniform1f("u_width",u);k&&b.setUniform4fv("u_id",x);if(v){if(a=a.spriteMosaic,c=a.getMosaicItemPosition(c,!0))a.bind(g,9729,
c.page,w.VTL_TEXTURE_BINDING_UNIT_SPRITES),b.setUniform2f("u_pattern_tl",c.tl[0],c.br[1]),b.setUniform2f("u_pattern_br",c.br[0],c.tl[1]),b.setUniform2f("u_spriteSize",8*c.size[0],c.size[1]),b.setUniform1i("u_texture",w.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else c=h.getPaintValue("line-dasharray",f),2>c.length&&(c=[1,-1]),this._dashArray[0]=8*c[0],this._dashArray[1]=8*c[1],b.setUniform2fv("u_dasharray",this._dashArray);for(c=0;c<e.length;c++)if(a=e[c],a.layerData[d]&&(f=a.layerData[d],n=this._getLineVAO(g,
a,m,l)))g.bindVAO(n),b.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs),g.setStencilFunction(514,a.stencilRef,255),g.drawElements(4,f.triangleElementCount,5125,12*f.triangleElementStart),a.triangleCount+=f.triangleElementCount/3};l.prototype._getLineVAO=function(a,e,g,f){if(g){if(e.lineDDVertexArrayObject)return e.lineDDVertexArrayObject;g=e.lineDDVertexBuffer;var d=e.lineIndexBuffer;if(!g||!d)return null;e.lineDDVertexArrayObject=new q.VertexArrayObject(a,f.getProgramAttributes(3),this._vertexAttributesDD,
{geometry:g},d);return e.lineDDVertexArrayObject}if(e.lineVertexArrayObject)return e.lineVertexArrayObject;g=e.lineVertexBuffer;d=e.lineIndexBuffer;if(!g||!d)return null;e.lineVertexArrayObject=new q.VertexArrayObject(a,f.getProgramAttributes(3),this._vertexAttributes,{geometry:g},d);return e.lineVertexArrayObject};return l}(A.default);d.WGLBrushVTLLine=p});