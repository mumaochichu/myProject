// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils ../../tasks/support/MultipartColorRamp".split(" "),function(J,m,v,z,u,k,t,A,B){function x(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?x(b.functionArguments):a}function C(a,b){var c=[],e=[],d=[],h=[],g=b.pixelType,f=(b=b.rasterAttributeTable)&&b.features,D=y(b);if(f&&Array.isArray(f)&&
a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var d=b.symbol.color,e;d.a&&f.forEach(function(f){e=f.attributes[a.field];(e>=b.minValue&&e<b.maxValue||c===a.classBreakInfos.length-1&&e>=b.minValue)&&h.push([f.attributes[D],d.r,d.g,d.b])})}),g=g?q(h,g):h,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=g,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var f=a.symbol&&a.symbol.color;f.a?(0===b?c.push(a.minValue,a.maxValue+1E-6):
c.push(a.minValue+1E-6,a.maxValue+1E-6),e.push(b),h.push([b,f.r,f.g,f.b])):d.push(a.minValue,a.maxValue)});g=g?q(h,g):h;b=new k;b.functionName="Remap";b.functionArguments={InputRanges:c,OutputValues:e,NoDataRanges:d};b.variableName="Raster";var l=new k;l.functionName="Colormap";l.functionArguments={Colormap:g,Raster:b};return l}function q(a,b){(b=E[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function y(a){if(a)return(a=(a=a.fields)&&z.find(a,function(a){return a&&
a.name&&"value"===a.name.toLowerCase()}))&&a.name}function F(a,b){var c=[],e=b.pixelType,d=(b=b.rasterAttributeTable)&&b.features,h=y(b),g=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var e=b.symbol.color;e.a&&(a.field!==h&&d?d&&d.forEach(function(d){String(d.attributes[a.field])===String(b.value)&&c.push([d.attributes[h],e.r,e.g,e.b])}):isNaN(b.value)?g=!0:c.push([b.value,e.r,e.g,e.b]))});if(g)return null;e=e&&0<c.length?q(c,e):c;b=new k;b.functionName="Colormap";b.functionArguments=
{};b.functionArguments.Colormap=e;b.variableName="Raster";return b}function G(a){var b=[];a.forEach(function(a){Array.isArray(a)?b.push(a):null!=a.min&&null!=a.max&&b.push([a.min,a.max,a.avg||0,a.stddev||0])});return b}Object.defineProperty(m,"__esModule",{value:!0});var E={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},H={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],
toColor:[255,0,0]}]},I=B.fromJSON(t.PREDEFINED_JSON_COLOR_RAMPS[0]);m.isSupportedRendererType=function(a){return-1<["raster-stretch","unique-value","class-breaks","raster-shaded-relief"].indexOf(a.type)};m.combineRenderingRules=function(a,b){if(!a||!b)return u.clone(a||b);a=u.clone(a);"none"!==b.functionName.toLowerCase()&&(x(a.functionArguments).Raster=b);return a};m.convertRendererToRenderingRule=function(a,b){b=b||{};switch(a.type){case "raster-stretch":var c=new k;c.functionName="Stretch";var e=
p[A.stretchTypeJSONDict.toJSON(a.stretchType)],d=G(a.statistics),d={StretchType:e,Statistics:d,DRA:a.dynamicRangeAdjustment,UseGamma:a.useGamma,Gamma:a.gamma,ComputeGamma:a.computeGamma};null!=a.outputMin&&(d.Min=a.outputMin);null!=a.outputMax&&(d.Max=a.outputMax);e===p.standardDeviation?(d.NumberOfStandardDeviations=a.numberOfStandardDeviations,c.outputPixelType="u8"):e===p.percentClip?(d.MinPercent=a.minPercent,d.MaxPercent=a.maxPercent,c.outputPixelType="u8"):e===p.minMax?c.outputPixelType="u8":
e===p.sigmoid&&(d.SigmoidStrengthLevel=a.sigmoidStrengthLevel);c.functionArguments=d;c.variableName="Raster";if(a.colorRamp){var e=a.colorRamp,d=new k,h=t.getColorRampName(e);d.functionArguments=h?{colorRamp:h}:!b.convertColorRampToColormap||"algorithmic"!==e.type&&"multipart"!==e.type?{colorRamp:a.colorRamp.toJSON()}:{Colormap:t.convertColorRampToColormap(e,256)};d.variableName="Raster";d.functionName="Colormap";d.functionArguments.Raster=c;a=d}else a=c;return a;case "class-breaks":return C(a,b);
case "unique-value":return F(a,b);case "raster-colormap":return(a=a.extractColormap())&&0!==a.length?(a=(b=b.pixelType)?q(a,b):a,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=a,a=b):a=void 0,a;case "raster-shaded-relief":return"elevation"!==b.dataType?a=new k:(b=new k,b.functionName="Hillshade",c="traditional"===a.hillshadeType?0:1,e="none"===a.scalingType?1:3,d={HillshadeType:c,SlopeType:e,ZFactor:a.zFactor},0===c&&(d.Azimuth=a.azimuth,d.Altitude=a.altitude),
3===e&&(d.PSPower=a.pixelSizePower,d.PSZFactor=a.pixelSizeFactor),b.functionArguments=d,b.variableName="Raster",a.colorRamp&&(b.functionName="ShadedRelief",d.Colormap=t.convertColorRampToColormap(a.colorRamp,256)),a=b),a}};m.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,e=a.dataType,d=a.bandCount,h=a.pixelType,g=a.colormap,f=a.statistics,k=a.histograms;b&&0<b.length&&(f=f?b.map(function(a){return f[a]}):null,k=k?b.map(function(a){return k[a]}):null);var l,m,p,q,n,r;c&&(m=c.fields.filter(function(a){return"red"===
a.name.toLowerCase()})[0],p=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],q=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0],r=c.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0],n=c.fields.filter(function(a){return"classname"===a.name.toLowerCase()||"class_name"===a.name.toLowerCase()})[0],n||(n=c.fields.filter(function(a){return"string"===a.type})[0])||(n=r));if(1===d&&0<(null===g||void 0===g?void 0:g.length)){var w;c&&m&&p&&q&&(w={},
c.features.forEach(function(a){a=a.attributes;w[a[r.name]]=n?a[n.name]:a[r.name]}));l=v.RasterColormapRenderer.createFromColormap(g,w)}else if(1===d&&c){a=void 0;c=c.features;if(m&&p&&q&&n)a=c.map(function(a){return{value:a.attributes[n.name],label:a.attributes[n.name],symbol:{type:"esriSFS",style:"esriSFSSolid",color:[a.attributes[m.name],a.attributes[p.name],a.attributes[q.name],255]}}});else{var u=t.convertColorRampToColormap(I,c.length);a=c.map(function(a,b){return{value:a.attributes[r.name],
label:a.attributes[r.name],symbol:{color:u[b].slice(1,4),type:"esriSFS",style:"esriSFSSolid"}}})}a.sort(function(a,b){return a.value>b.value?1:-1});l=v.UniqueValueRenderer.fromJSON({field1:n.name,uniqueValueInfos:a})}l||(c=void 0,a=!1,l=g=b=void 0,"u8"===h&&"processed"===e?(c="none",f=1===d?[{min:0,max:255}]:[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===h||"elevation"===e?(c="min-max",a=f?!1:!0):"scientific"===e?(c="min-max",a=f?!1:!0,b=H):k&&0<k.length?(c="percent-clip",l=g=.25):f?c=
"min-max":(c="percent-clip",a=!0),l=v.RasterStretchRenderer.fromJSON({stretchType:c,dra:a,colorRamp:b,min:0,max:255,statistics:a?null:f,histograms:a?null:k,maxPercent:g,minPercent:l}));return l}};m.getDefaultBandCombination=function(a){var b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;var c,e,d,h,g;if(a&&a.length===b){for(var f=0;f<a.length;f++)a[f].BandName&&"red"===a[f].BandName.toLowerCase()&&(e=f),a[f].BandName&&"green"===a[f].BandName.toLowerCase()&&
(d=f),a[f].BandName&&"blue"===a[f].BandName.toLowerCase()&&(h=f),a[f].BandName&&"nearinfrared"===a[f].BandName.toLowerCase()&&(g=f);void 0!==e&&void 0!==d&&void 0!==h?c=[e,d,h]:void 0!==e&&void 0!==d&&void 0!==g&&(c=[g,e,d])}!c&&3<b&&(c=[0,1,2]);return c};var p={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9}});