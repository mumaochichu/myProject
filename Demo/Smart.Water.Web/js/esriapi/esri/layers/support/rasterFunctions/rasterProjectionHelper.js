// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../geometry ../../../core/Error ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(J,p,w,B,C,n,I,D){Object.defineProperty(p,"__esModule",{value:!0});var E=function(b,c){var a=(b.isWGS84||b.isWebMercator)&&(c.isWGS84||c.isWebMercator);return!(b.equals(c)||a)};p.defaultGridSpacing=32;p.load=function(){return w.__awaiter(this,void 0,void 0,function(){return w.__generator(this,
function(b){switch(b.label){case 0:return n.isLoaded()||!n.isSupported()?[2,null]:[4,n.load()];case 1:return b.sent(),[2]}})})};p.projectResolution=function(b,c,a,d){void 0===d&&(d=null);if(b.spatialReference.equals(c))return b;var e=E(b.spatialReference,c);if(e&&!n.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");a=a.center;b=new B.Extent({xmin:a.x-b.x/2,xmax:a.x+b.x/2,ymin:a.y-b.y/2,ymax:a.y+b.y/2,spatialReference:b.spatialReference});d=e?n.project(b,
c,d):D.project(b,c);return null==d?null:new B.Point(d.xmax-d.xmin,d.ymax-d.ymin,c)};p.projectPoint=function(b,c,a){void 0===a&&(a=null);if(b.spatialReference.equals(c))return b;var d=E(b.spatialReference,c);if(d&&!n.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");return d?n.project(b,c,a):D.project(b,c)};p.projectExtent=function(b,c,a){void 0===a&&(a=null);if(b.spatialReference.equals(c))return b;var d=E(b.spatialReference,c);if(d&&!n.isLoaded())throw new C("rasterprojectionhelper-projectExtent",
"projection engine is not loaded");return d?n.project(b,c,a):D.project(b,c)};p.getProjectionOffsetGrid=function(b,c,a,d,e,x){void 0===d&&(d=null);void 0===e&&(e=!1);void 0===x&&(x=[p.defaultGridSpacing,p.defaultGridSpacing]);var t=c.spatialReference.equals(b.spatialReference),y=E(b.spatialReference,c.spatialReference);if(y&&!n.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&c&&a))return null;var z=b.xmin,m=b.ymin,q=b.xmax,F=b.ymax,G=b.spatialReference,
H=c.spatialReference,u=I.getInfo(G),h=u&&u.valid[0],f=u&&u.valid[1],v=x[0]*a.x,k=x[1]*a.y,q=Math.ceil((q-z)/v-.1)+1,m=Math.ceil((F-m)/k-.1)+1,l;a=[];var A;b=!1;for(var r=0;r<q;r++){for(var w=[],g=0;g<m;g++)l=new B.Point({x:z+v*r,y:F-k*g,spatialReference:G}),l=t?l:y?n.project(l,H,d):D.project(l,H),w.push(l),0<r&&e&&l&&A[g]&&u&&l.x<A[g].x&&(l.x+=f-h),l?(a.push((l.x-c.xmin)/(c.xmax-c.xmin)),a.push((c.ymax-l.y)/(c.ymax-c.ymin))):(a.push(NaN),a.push(NaN),b=!0);A=w}c=[Math.abs((a[0]+a[4]+a[4*q]+a[4*q+4])/
4-a[2*m+2]),Math.abs((a[1]+a[5]+a[4*m+1]+a[4*m+5])/4-a[2*m+3])];d=new Float32Array((q-1)*(m-1)*12);e=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);t=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(r=0;r<q-1;r++){for(g=0;g<m-1;g++){h=r*m*2+2*g;y=a[h];z=a[h+1];F=a[h+2];A=a[h+3];h+=2*m;G=a[h];H=a[h+1];u=a[h+2];h=a[h+3];f=0;v=12*(g*(q-1)+r);for(k=0;3>k;k++)d[v++]=e[f++]*y+e[f++]*F+e[f++]*u;for(k=f=0;3>k;k++)d[v++]=e[f++]*z+e[f++]*A+e[f++]*h;for(k=f=0;3>k;k++)d[v++]=t[f++]*y+t[f++]*G+t[f++]*u;for(k=f=0;3>k;k++)d[v++]=
t[f++]*z+t[f++]*H+t[f++]*h}if(b)for(g=0;g<d.length;g++)isNaN(d[g])&&(d[g]=-1)}return{offsets:a,error:c,coefficients:d,spacing:x,size:[q-1,m-1]}};p.snapPyramid=function(b,c,a){var d=Math.log(b.x/c.pixelSize.x)/Math.LN2,e=Math.log(b.y/c.pixelSize.y)/Math.LN2;b=c.storageInfo.maximumPyramidLevel||0;a="down"===a?Math.floor(Math.min(d,e)):"up"===a?Math.ceil(Math.max(d,e)):Math.round((d+e)/2);d=!1;0>a?a=0:a>b&&(d=a>b+3,a=b);b=Math.pow(2,a);c=new B.Point({x:b*c.pixelSize.x,y:b*c.pixelSize.y,spatialReference:c.spatialReference});
return{pyramidLevel:a,pyramidResolution:c,excessiveReading:d}}});