// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../Basemap ../../Ground ../../WebScene ../../core/compilerUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/extensions/serializableProperty/type ../../layers/GroupLayer ../../layers/KMLLayer ../../layers/mixins/operationalLayerModuleMap ../../layers/mixins/operationalLayers ./utils".split(" "),function(ba,E,d,F,K,L,w,z,M,G,N,O,P,Q){function y(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){switch(e.label){case 0:f=
b.typeName;switch(f){case "array":return[3,1];case "union":return[3,3];case "json":return[3,5];case "native":return[3,7];case "enum":return[3,9]}return[3,11];case 1:return[4,R(a,b,c)];case 2:return e.sent(),[3,12];case 3:return[4,S(a,b,c)];case 4:return e.sent(),[3,12];case 5:return[4,H(a,b,c)];case 6:return e.sent(),[3,12];case 7:return[4,T(a,b,c)];case 8:return e.sent(),[3,12];case 9:return[4,U(a,b,c)];case 10:return e.sent(),[3,12];case 11:w.neverReached(b),e.label=12;case 12:return[2]}})})}function T(a,
b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(f){c.addProperty({name:a,type:p(b),default:b.default});return[2]})})}function V(a){a=a.slice();a.sort();return a}function U(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){f=b.values.slice();b.nullable&&f.push(null);c.currentClass&&c.currentClass.typeValue&&"type"===a?c.addProperty({name:a,type:"string",enum:'"'+c.currentClass.typeValue+'"'}):c.addProperty({name:a,
type:p(b),enum:V(f).map(function(a){return"string"===typeof a?'"'+a+'"':""+a}).join("|"),default:b.default});return[2]})})}function R(a,b,c){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(f){switch(f.label){case 0:return[4,y(a+"[]",b.elementType,c)];case 1:return f.sent(),[2]}})})}function S(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,e,k,h,g,l;return d.__generator(this,function(d){switch(d.label){case 0:f=[],e=0,k=b.types,d.label=1;case 1:if(!(e<
k.length))return[3,5];h=k[e];if("native"!==h.type.typeName&&b.key)return[3,2];f.push(h.type);return[3,4];case 2:var m=h.type;d=h.value;if("json"===m.typeName){var u=(m=(m=m.type.__accessorMetadata__)&&m.properties&&m.properties&&m.properties.type)&&q(m),r=(u=u&&u.type)||m&&m.type;r&&Array.isArray(r)&&1===r.length&&"string"===typeof r[0]&&(d=u?r[0]:A(m,r[0]))}g=a+"\x3c"+d+"\x3e";return[4,y(g,h.type,c)];case 3:d.sent(),d.label=4;case 4:return e++,[3,1];case 5:return f.length&&(l=f.map(p),b.nullable&&
l.push("null"),l.sort(),c.addProperty({type:l.join("|"),name:a,default:b.default})),[2]}})})}function I(a,b){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(c){return a.type===L&&"layers"===b?[2,v("web-scene/operational-layers")]:a.type!==F||"baseLayers"!==b&&"baseMapLayers"!==b?a.type===F&&"elevationLayers"===b||a.type===K&&"layers"===b?[2,v("web-scene/ground")]:a.type===G&&"layers"===b?[2,v("web-scene/operational-layers",function(a){return a!==G})]:[2,null]:[2,
v("web-scene/basemap")]})})}function W(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f;return d.__generator(this,function(e){switch(e.label){case 0:return[4,I(a,b)];case 1:if(f=e.sent())return[2,f];e=q(c);if(e.types)e=t(e.types);else if(!e.type&&c.types)e=t(c.types);else{e=B;var d=q(c),h=C(c),g=n(d&&d.type||c.type);d&&void 0!==d.default&&"function"!==typeof d.default&&(g.default=A(c,d.default));h.allowNull&&(g.nullable=!0);e=e(g)}return[2,e]}})})}function H(a,b,c){return d.__awaiter(this,
void 0,void 0,function(){var f,e,k,h,g,l,u,m,n,r,p,q,v,t,x,w;return d.__generator(this,function(d){switch(d.label){case 0:f=b.type.__accessorMetadata__;e=b.type.prototype.declaredClass.replace(/\./g,"/");k=f&&f.properties;if(!k)return a&&c.addProperty({name:a,type:"unknown"}),[2,null];h=e;g=null;if(l=a&&a.match(/<([^>]+)>$/))h+="--"+l[1],g=l[1];if((u=c.seen.get(h))&&a)return c.addProperty({name:a,type:u}),[2,u];m={type:b.type,name:e,id:h,properties:[]};a&&(c.addProperty({name:a,type:m}),m.typeValue=
g);c.push(a,m);n=[];for(r in k)n.push(r);p=0;d.label=1;case 1:if(!(p<n.length))return[3,7];q=n[p];v=k[q];t=C(v);if(!t||!t.enabled)return[3,6];x=t.target;return"string"!==typeof x&&null!=x?[3,4]:[4,W(b,q,v)];case 2:return(w=d.sent())?[4,y("string"===typeof x?x:q,w,c)]:[3,6];case 3:return d.sent(),[3,6];case 4:return[4,X(b,x,c)];case 5:d.sent(),d.label=6;case 6:return p++,[3,1];case 7:return[2,c.pop()]}})})}function X(a,b,c){return d.__awaiter(this,void 0,void 0,function(){var f,e,k,h,g,l;return d.__generator(this,
function(d){switch(d.label){case 0:f=[];for(e in b)f.push(e);k=0;d.label=1;case 1:if(!(k<f.length))return[3,5];h=f[k];return[4,I(a,h)];case 2:return g=d.sent(),g||(l=b[h],g=l.types?t(l.types):n(l.type),g.default=l.default,g=B(g)),[4,y(h,g,c)];case 3:d.sent(),d.label=4;case 4:return k++,[3,1];case 5:return[2]}})})}function v(a,b){return d.__awaiter(this,void 0,void 0,function(){var c,f,e,k,h,g,l;return d.__generator(this,function(d){switch(d.label){case 0:c={typeName:"union",key:"layerType",types:[]};
f=[];for(e in P.supportedTypes[a])f.push(e);k=0;d.label=1;case 1:if(!(k<f.length))return[3,4];h=f[k];return[4,O.typeModuleMap[h]()];case 2:g=d.sent();if(!g||b&&!b(g)||g===N)return[3,3];c.types.push({type:{typeName:"json",type:g},value:h});d.label=3;case 3:return k++,[3,1];case 4:if(0===c.types.length)return[2,null];l={typeName:"array",elementType:1===c.types.length?c.types[0].type:c};return[2,l]}})})}function p(a){switch(a.typeName){case "array":return p(a.elementType)+"[]";case "union":var b=a.types.map(function(a){return p(a.type)});
a.nullable&&b.push("null");b.sort();return""+b.join(" | ");case "native":switch(a.type){case Number:return"number";case z.Integer:return"integer";case String:return"string";case Boolean:return"boolean";case Object:return"object";default:return"unknown"}case "json":return a.type.prototype.declaredClass;case "enum":return"string";default:w.neverReached(a)}}function Y(a){a=a.prototype.itemType&&a.prototype.itemType.Type;if(!a)return{typeName:"array",elementType:{typeName:"native",type:null}};if("function"===
typeof a)return{typeName:"array",elementType:n(a)};if(a.typeMap){var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:n(d),value:D(d)?null:c})}return{typeName:"array",elementType:{typeName:"union",key:"string"===typeof a.key?a.key:"type",types:b}}}}function Z(a){if("json"!==a.typeName)return null;var b=(a=a.type.__accessorMetadata__)&&a.properties&&a.properties.type,c=(a=(a=b&&q(b))&&a.type)||b&&b.type;return c&&Array.isArray(c)&&"string"===typeof c[0]?a?a:b.type.map(function(a){return A(b,
a)}):null}function B(a){if("array"===a.typeName)return a.elementType=B(a.elementType),a;var b=Z(a);return b?{typeName:"union",key:"type",types:b.map(function(b){return{value:b,type:a}})}:a}function t(a){if(Array.isArray(a))return{typeName:"array",elementType:t(a[0])};var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:n(d),value:D(d)?null:c})}return{typeName:"union",key:"string"===typeof a.key?a.key:"type",types:b}}function A(a,b){a=C(a);var c=a.writer;return null!=c&&c.name&&-1!==c.name.indexOf("JSONMapWrite")?
(c={value:""},a.writer(b,c,"value"),c.value):b}function n(a){return a?z.isLongFormType(a)?J(a):Array.isArray(a)?"string"===typeof a[0]||"number"===typeof a[0]?{typeName:"enum",values:a}:1<a.length?{typeName:"union",key:null,types:a.map(function(a){return{type:n(a),value:null}})}:{typeName:"array",elementType:n(a[0])}:M.isCollection(a)?Y(a):D(a)?{typeName:"native",type:a}:aa(a)?{typeName:"json",type:a}:{typeName:"native",type:null}:{typeName:"native",type:null}}function J(a){switch(a.type){case "native":return{typeName:"native",
type:a.value};case "array":return{typeName:"array",elementType:n(a.value)};case "one-of":return{typeName:"union",key:null,types:a.values.map(function(a){return{type:J(a),value:null}})};default:w.neverReached(a)}}function aa(a){for(;a;){if(a.prototype&&("esri.core.JSONSupport"===a.prototype.declaredClass||"esri.core.MultiOriginJSONSupport"===a.prototype.declaredClass))return!0;a=Object.getPrototypeOf(a)}return!1}function D(a){return a===String||a===Boolean||a===Number||a===z.Integer||a===Object}function q(a){if(!a.json)return null;
var b=a.json.origins;a=a.json;var c=b&&b["web-document"];return b&&b["web-scene"]||c||a||null}function C(a){if(!a.json)return null;var b=a.json.origins;a=a.json.write;var c=b&&b["web-document"]&&b["web-document"].write;return b&&b["web-scene"]&&b["web-scene"].write||c||a||null}Object.defineProperty(E,"__esModule",{value:!0});E.scan=function(a){return d.__awaiter(this,void 0,void 0,function(){var b;return d.__generator(this,function(c){b=new Q.ScanContext;return[2,H(null,{typeName:"json",type:a},b)]})})}});