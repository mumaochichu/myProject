// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./ManipulatorState ./settings ../visualElements/LaserlineVisualElement ../visualElements/LineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState ../../support/projectionUtils".split(" "),
function(U,r,l,D,t,E,F,G,w,H,z,I,g,A,J,K,L,M,N,x){function O(a,e,b,c){var h=a.view,k=a.graphic,u=new J.LineVisualElement({view:h,infinite:g.settings.visualElements.zVerticalLine.infiniteType,attached:!1});g.settings.visualElements.zVerticalLine.apply(u);var p=new A.LaserlineVisualElement({view:h,intersectsLineInfinite:!0,attached:!1});g.settings.visualElements.pointGraphics.shadowStyle.apply(p);var m=D.deg2rad(g.settings.visualElements.heightPlaneAngleCutoff),n=new A.LaserlineVisualElement({view:h,
attached:!1,angleCutoff:m});g.settings.visualElements.heightPlane.apply(n);var m=z.getGraphicEffectiveElevationInfo(a.graphic),r=M.ElevationContext.fromElevationInfo(m),t="on-the-ground"===m.mode||!m.offset&&"absolute-height"!==m.mode,y=new I.ManipulatorState,B=1,C=1,v=function(){y.update(a);var b=t&&(e.isDraped||!q(k)||!k.geometry.hasZ),l=!0;if(!b&&q(k)){var f=k.geometry,m=L.evaluateElevationAlignmentAtPoint(k.geometry,h.elevationProvider,r,h.renderCoordsHelper);F.vec3.set(d,f.x,f.y,m);x.vectorToVector(d,
f.spatialReference,d,h.renderCoordsHelper.spatialReference);u.worldDownAtLocation=d;p.intersectsWorldUpAtLocation=d}else l=!1;f=y.grabbingState&2?g.settings.visualElements.laserlineAlphaMultiplier:1;f!==B&&(B=f,g.settings.visualElements.heightPlane.apply(n,f));f=w.empty(P);!b&&e.displaying&&c.calculateMapBounds(f)&&x.vectorToVector(w.getMin(f,d),h.spatialReference,d,h.renderCoordsHelper.spatialReference)?(n.heightManifoldTarget=d,n.attached=!0):n.attached=!1;f=y.grabbingState&4?g.settings.visualElements.laserlineAlphaMultiplier:
1;f!==C&&(C=f,g.settings.visualElements.pointGraphics.shadowStyle.apply(p,f));b=l&&e.displaying&&!b;p.attached=b;u.attached=b};b.push(e.watch(["displaying","isDraped"],v),e.on("changed",v));a.forEachManipulator(function(a){b.push(a.events.on("grab-changed",v))});b.push(l.destroyHandle(p));b.push(l.destroyHandle(u));b.push(l.destroyHandle(n));v()}function Q(a,e,b){var c=a.graphic,c=new K.PointVisualElement({view:a.view,geometry:q(c)?c.geometry:null,elevationInfo:z.getGraphicEffectiveElevationInfo(c),
attached:!1});R(a,c,e,b);b.push(l.destroyHandle(c));return c}function R(a,e,b,c){S(a,e,b,c);g.settings.visualElements.pointGraphics.outline.apply(e);c.push(E.init(b,"displaying",function(){return e.attached=b.displaying}))}function S(a,e,b,c){var h=a.view,k=a.graphic,d=null,g=function(){t.isSome(d)&&(d.remove(),d=null);b.isDraped&&q(k)&&(d=T(h,k.geometry,function(){e.geometry=k.geometry}))};a=function(){g();e.geometry=q(k)?k.geometry:null};c.push(b.on("changed",a),l.refHandle(function(){return d}));
a()}function T(a,e,b){x.pointToVector(e,d,a.elevationProvider.spatialReference);var c=d[0],h=d[1];return a.elevationProvider.on("elevation-change",function(a){H.containsXY(a.extent,c,h)&&b()})}function q(a){return t.isSome(a.geometry)&&"point"===a.geometry.type}Object.defineProperty(r,"__esModule",{value:!0});r.createVisualElements=function(a){var e=a.view,b=new N.GraphicState({graphic:a.graphic}),c=[],d=Q(a,b,c);O(a,b,c,d);c.push(e.trackGraphicState(b));return{visualElement:d,remove:function(){l.handlesGroup(c).remove()}}};
var d=G.vec3f64.create(),P=w.create()});